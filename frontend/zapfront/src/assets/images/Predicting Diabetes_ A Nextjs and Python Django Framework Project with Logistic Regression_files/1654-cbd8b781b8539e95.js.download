"use strict";(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[1654],{79271:function(e,t,o){var n,i=o(67294);function a(){return a=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var o=arguments[t];for(var n in o)Object.prototype.hasOwnProperty.call(o,n)&&(e[n]=o[n])}return e},a.apply(this,arguments)}t.Z=function(e){return i.createElement("svg",a({width:28,height:28,fill:"none",xmlns:"http://www.w3.org/2000/svg"},e),n||(n=i.createElement("path",{d:"M8 3.5L5.46 6.547a.6.6 0 01-.921 0L1.999 3.5",stroke:"inherit",strokeWidth:1.5,strokeLinecap:"round",strokeLinejoin:"round"})))}},51430:function(e,t,o){o.d(t,{W:function(){return n}});const n=o(59016).ZP.div.withConfig({displayName:"BottomRightButtons",componentId:"sc-57187e91-0"})`
  position: absolute;
  bottom: ${e=>e.theme.tightPanelSpacing}px;
  right: ${e=>e.theme.tightPanelSpacing}px;
  flex-direction: column;
  display: grid;
  gap: 8px;
`},89834:function(e,t,o){o.d(t,{N:function(){return m}});var n=o(85893),i=(o(67294),o(59016)),a=o(41664),r=o.n(a),l=o(72457),s=o(91966);const d=i.ZP.div.withConfig({displayName:"FullScreenMessage__PageContainer",componentId:"sc-90a4dcc9-0"})`
  align-items: center;
  display: flex;
  height: 100%;
  justify-content: center;
  width: 100%;
  background-color: ${e=>{let{theme:t}=e;return t.colors.background}};
  user-select: text;
`,c=i.ZP.div.withConfig({displayName:"FullScreenMessage__Content",componentId:"sc-90a4dcc9-1"})`
  flex-direction: row;
  text-align: center;
  max-width: 340px;
  width: 100%;
  padding: 0 20px;
`,u=i.ZP.div.withConfig({displayName:"FullScreenMessage__LogoContainer",componentId:"sc-90a4dcc9-2"})`
  margin-bottom: 28px;

  &:hover {
    cursor: pointer;
  }
`,p=i.ZP.div.withConfig({displayName:"FullScreenMessage__MainMessage",componentId:"sc-90a4dcc9-3"})`
  font-weight: 500;
  font-size: 15px;
  line-height: 20px;
`,m=i.ZP.div.withConfig({displayName:"FullScreenMessage__SubMessage",componentId:"sc-90a4dcc9-4"})`
  margin: 24px 0;
  font-size: 13px;
  line-height: 16px;
  color: ${e=>{let{theme:t}=e;return t.colors.subMessageText}};

  a {
    color: ${e=>{let{theme:t}=e;return t.colors.subMessageLink}};

    &:hover,
    :focus,
    :active {
      text-decoration: underline;
    }
  }
`;t.Z=e=>{let{mainMessage:t,children:o}=e;const{workspaceUrl:i}=(0,s.B)();return(0,n.jsx)(d,{children:(0,n.jsxs)(c,{children:[(0,n.jsx)(r(),{href:i,children:(0,n.jsx)(u,{children:(0,n.jsx)(l.Z,{style:{width:"40px",height:"40px"}})})}),(0,n.jsx)(p,{children:t}),o]})})}},41654:function(e,t,o){o.d(t,{E:function(){return Hx},Z:function(){return Vx}});var n,i=o(85893),a=o(67294),r=o(4480),l=o(64310),s=o(13433),d=o(69336),c=o(82703),u=o(5152),p=o.n(u),m=o(11163),h=o.n(m),g=o(59016),C=o(1922),f=o(25937),x=o(30072),v=o(89522),b=o(44359);function y(){return y=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var o=arguments[t];for(var n in o)Object.prototype.hasOwnProperty.call(o,n)&&(e[n]=o[n])}return e},y.apply(this,arguments)}var w=function(e){return a.createElement("svg",y({width:14,height:14,fill:"none",xmlns:"http://www.w3.org/2000/svg"},e),n||(n=a.createElement("path",{fillRule:"evenodd",clipRule:"evenodd",d:"M12.833 0A1.167 1.167 0 0114 1.167v11.666A1.167 1.167 0 0112.833 14H1.167A1.167 1.167 0 010 12.833V1.167A1.167 1.167 0 011.167 0h11.666z",fill:"#FF3434"})))},T=o(61098),I=o(51521),P=o(89605),E=o(22755),_=o(73406);const j=(0,g.ZP)(d.E.div).withConfig({displayName:"RecordingInProgressPanel__ContainerStyles",componentId:"sc-7f0b11b6-0"})`
  margin-right: ${e=>e.theme.panelSpacing}px;
  width: ${e=>{let{width:t}=e;return t}}px;
  height: ${e=>{let{height:t}=e;return t}}px;
  overflow: hidden;
  z-index: ${I.Mf};

  position: absolute;
  top: ${e=>-e.theme.headerHeight}px;
  right: 0;
  flex-direction: column;
  display: flex;
  justify-content: center;
`,k=(0,g.ZP)(b.Z).withConfig({displayName:"RecordingInProgressPanel__StopButton",componentId:"sc-7f0b11b6-1"})`
  height: 40px;
  width: 40px;
  border-radius: 53px;
  display: flex;
  align-items: center;
  justify-content: center;
  color: ${e=>e.theme.colors.sheetBg};
`;var S=e=>{let{width:t,height:o,resetToFullCanvas:n}=e;const[l,s]=(0,r.FV)(T.wo);(0,a.useEffect)((()=>()=>s(!1)),[s]);const d=(0,a.useRef)(l);d.current=l;const c=(0,E.t2)(),u=(0,a.useCallback)((()=>{d.current&&(n(),s(!1),c.setPropertyPanel(_.Z.RECORD))}),[n,s,c]),p=(0,a.useCallback)((e=>{"Space"!==e.code&&"Escape"!==e.code||u()}),[u]);return(0,a.useEffect)((()=>l?(document.addEventListener("keyup",p),()=>{document.removeEventListener("keyup",p)}):()=>{}),[l,p]),l?(0,i.jsx)(j,{width:t,height:o,initial:{x:t},animate:{x:0},exit:{x:t},transition:P.Z2,children:(0,i.jsx)(k,{"data-testid":"stop_recording_button",onClick:u,children:(0,i.jsx)(w,{})})}):null},Z=o(15764),R=o(82360),O=o(60153),M=o(25675),$=o(86388),L=o(41350),A=o(9228),N=o(2939),D=o(59090),B=o(22189),H=o(64364),V=o(66810),F=o(36409),G=o(96215);var U=o(51672),z=o(76163),W=o(50921),K=o(99364),q=o(37887),Y=o(38166);var J=e=>{const{skip:t}=e??{},{apolloClient:o}=(0,L.bp)(),n=(0,r.sJ)(V.zO),[i,l]=(0,a.useState)(null),{data:s}=(0,q.a)(Y.Z,{variables:{id:n},skip:null==n||t});return(0,a.useEffect)((()=>{l(null)}),[n]),(0,a.useEffect)((()=>{var e,t,n,i;const a=null===(i=s)||void 0===i||null===(n=i.tile)||void 0===n||null===(t=n.compositeTileData)||void 0===t||null===(e=t.tileIds)||void 0===e?void 0:e[0];a&&l(o.readFragment({id:`Tile:${a}`,fragment:G.mXG,fragmentName:"TileFragment"}))}),[o,s]),s?i??s.tile:null},X=o(37683),Q=o(21441),ee=o(40405),te=o(47201);const oe=g.ZP.div.withConfig({displayName:"Common__PanelContainer",componentId:"sc-8ed0fbd0-0"})`
  margin: 0 12px 12px 12px;
  font-size: ${e=>e.theme.fontSizes.sm};
  width: 216px;
`,ne=g.ZP.div.withConfig({displayName:"Common__PropertyRow",componentId:"sc-8ed0fbd0-1"})`
  width: 100%;
  height: 28px;
  margin-bottom: ${e=>{let{$lastItem:t=!1}=e;return t?"0px":"12px"}};
  ${e=>{let{disabled:t=!1}=e;return t&&g.iv`
      opacity: 0.4;
    `}}
`,ie=(0,g.ZP)(ne).withConfig({displayName:"Common__PropertyRowText",componentId:"sc-8ed0fbd0-2"})`
  font-size: ${e=>e.theme.fontSizes.xxs};
  line-height: 13px;
  height: 24px;
  padding-top: 1px;
  padding-bottom: 8px;
  color: ${e=>e.theme.colors.contrast40};
  margin-bottom: 0;
  ${te.wR}
`,ae=(0,g.ZP)(ne).withConfig({displayName:"Common__TwoButtonRow",componentId:"sc-8ed0fbd0-3"})`
  display: flex;
  flex-direction: row;
  align-items: center;
  justify-content: space-between;
  gap: 10px;
`,re=(0,g.ZP)(ne).withConfig({displayName:"Common__ToggleRow",componentId:"sc-8ed0fbd0-4"})`
  font-size: ${e=>e.theme.fontSizes.sm};
  color: ${e=>e.theme.colors.contrast40};
  height: 20px;
  margin-bottom: 12px;
  display: flex;
  flex-direction: row;
  align-items: center;
  justify-content: space-between;
  ${e=>e.disabled&&"\n    opacity: 0.4;\n  "}
  // Toggle labels should not exceed the container.
  & label {
    ${te.wR}
  }
`,le=(0,g.ZP)(ee.Z).withConfig({displayName:"Common__PropertyPanelInput",componentId:"sc-8ed0fbd0-5"})`
  height: 28px;
  min-height: 28px;
  margin-top: 0;
  padding: 6px 12px;
  background-color: ${e=>{let{theme:t}=e;return t.colors.inputBg}};
  color: ${e=>{let{theme:t}=e;return t.colors.inputText}};

  ::placeholder {
    color: ${e=>{let{theme:t}=e;return t.colors.inputPlaceholder}};
  }

  :disabled {
    background-color: ${e=>{let{theme:t}=e;return t.colors.inputBgDisabled}};
    border-color: ${e=>{let{theme:t}=e;return t.colors.inputBorderDisabled}};
    color: ${e=>{let{theme:t}=e;return t.colors.inputTextDisabled}};
  }

  :disabled::placeholder {
    color: ${e=>{let{theme:t}=e;return t.colors.inputPlaceholderDisabled}};
  }

  :focus {
    background-color: ${e=>{let{theme:t}=e;return t.colors.inputBgFocus}};
    border-color: ${e=>{let{theme:t}=e;return t.colors.inputBorderFocus}};
  }
`,se=g.ZP.textarea.withConfig({displayName:"Common__TextareaInput",componentId:"sc-8ed0fbd0-6"})`
  width: 100%;
  height: 80px;
  font-size: 13px;
  line-height: 16px;
  padding: 8px;
  margin: 0;
  background-color: ${e=>{let{theme:t}=e;return t.colors.inputBg}};
  appearance: none;
  display: block;
  border: none;
  border-top: none;
  box-sizing: border-box;
  border-radius: ${e=>e.theme.borderRadius.sm};
  font-size: ${e=>e.theme.fontSizes.sm};
  caret-color: ${e=>e.theme.colors.uiAccent};
  color: ${e=>e.theme.colors.inputText};
  outline: none;
  resize: none;

  & ::selection {
    background-color: ${e=>e.theme.colors.textSelection};
  }
`,de=g.ZP.div.withConfig({displayName:"Common__InputRow",componentId:"sc-8ed0fbd0-7"})`
  width: 100%;
  margin-bottom: 12px;
`;var ce=o(53569),ue=o(5370),pe=o(79271),me=o(39090);const he=g.ZP.div.withConfig({displayName:"TextSelector__OptionContainer",componentId:"sc-e52546cf-0"})`
  padding: 6px 4px 6px 8px;
  display: flex;
  align-items: center;
  flex-wrap: wrap;
`,ge=g.ZP.div.withConfig({displayName:"TextSelector__OptionValue",componentId:"sc-e52546cf-1"})`
  flex: 1;
  text-overflow: ellipsis;
  white-space: nowrap;
  overflow: hidden;
`,Ce=g.ZP.div.withConfig({displayName:"TextSelector__OptionDescription",componentId:"sc-e52546cf-2"})`
  margin-top: 2px;
  color: ${e=>{let{theme:t}=e;return t.colors.menuTextSecondary}};
  font-size: ${e=>{let{theme:t}=e;return t.fontSizes.xxs}};
  line-height: 1.2;

  // when the option is hovered, display description in white.
  ${he}:hover & {
    color: ${e=>{let{theme:t}=e;return t.colors.menuTextHover}};
  }
`,fe=e=>{let{isDisabled:t,...o}=e;return(0,i.jsx)(ce.F.DropdownIndicator,{...o,children:t?(0,i.jsx)(pe.Z,{opacity:"0.2",height:"10",width:"10",viewBox:"0 0 10 10"}):(0,i.jsx)(pe.Z,{height:"10",width:"10",viewBox:"0 0 10 10"})})},xe=e=>{let{children:t,...o}=e;return(0,i.jsx)(ce.F.Option,{...o,children:(0,i.jsxs)(he,{children:[(0,i.jsx)(ge,{children:t}),o.isSelected&&(0,i.jsx)(me.Z,{}),o.data.description&&(0,i.jsx)(Ce,{children:o.data.description})]})})},ve=e=>{let{children:t,isDisabled:o,...n}=e;return ce.F.ValueContainer&&(0,i.jsxs)(ce.F.ValueContainer,{...n,children:[!!t&&n.selectProps.icon&&(0,i.jsx)(n.selectProps.icon,{style:{width:18,height:18,fill:"currentColor",marginRight:"5px",flex:"none",opacity:o?"0.5":1}}),t]})};var be=e=>{let{currentValue:t,options:o,onBlur:n,onFocus:r,onChange:l,menuWidth:s,controlWidth:d,disabled:c,icon:u,backgroundColor:p,styles:m,placeholder:h}=e;const C=(0,g.Fg)(),f=o.filter((e=>e.value===t)),x=f.length>0?f[0]:o[0],v=(0,a.useMemo)((()=>({menu:(e,t)=>({...e,width:t.selectProps.menuWidth,fontSize:"12px",lineHeight:"16px",marginTop:"-28px",padding:"6px",color:C.colors.menuControlText,backgroundColor:C.colors.menuBackgroundLayer[0]}),control:(e,t)=>({...e,width:t.selectProps.controlWidth,border:0,boxShadow:"none",fontSize:"12px",height:"28px",minHeight:"28px",lineHeight:"16px",paddingLeft:"4px",color:C.colors.menuControlText,"&:hover":{backgroundColor:C.colors.contrast12}}),valueContainer:e=>({...e,flexWrap:"initial"}),singleValue:()=>({color:C.colors.menuControlText,textOverflow:"ellipsis",whiteSpace:"nowrap",overflow:"hidden"}),placeholder:(e,t)=>({color:C.colors.menuControlText,opacity:t.selectProps.isDisabled?.5:1}),menuList:e=>({...e,paddingTop:0,paddingBottom:0}),option:(e,t)=>{let{data:o}=t;return{...e,borderRadius:"6px",color:o.color||C.colors.menuText,padding:"0px","&:hover":{color:o.colorHover||o.color||C.colors.menuTextHover,backgroundColor:o.backgroundColorHover||C.colors.uiAccent}}},indicatorsContainer:e=>({...e,height:"26px",paddingRight:"2px","& > div":{marginTop:"4px"}}),dropdownIndicator:e=>({...e,stroke:C.colors.menuControlText})})),[C]),b={...v,...m};return(0,i.jsx)(ue.ZP,{isDisabled:c,onChange:e=>l(e.value),onBlur:n,onFocus:r,styles:b,menuWidth:s,controlWidth:d,options:o,isSearchable:!1,value:x,icon:u,placeholder:h||"",components:{DropdownIndicator:fe,IndicatorSeparator:()=>null,Option:xe,ValueContainer:ve},theme:e=>({...e,borderRadius:6,colors:{...e.colors,primary25:C.colors.transparent,primary50:C.colors.transparent,primary75:C.colors.transparent,primary:C.colors.transparent,neutral0:p??C.colors.contrast8,neutral5:C.colors.contrast8,neutral10:C.colors.contrast8,neutral90:C.colors.contrast,neutral80:C.colors.contrast,neutral70:C.colors.contrast,neutral60:C.colors.contrast,neutral50:C.colors.contrast}})})},ye=o(2767);const we=(e,t)=>{const{style:o,isSelected:n,...a}=e,r=(0,g.Fg)();return(0,i.jsxs)(ye.Z,{ref:t,style:{...o,width:24,height:24,fillOpacity:0,borderRadius:"100%",border:n?`2px solid ${r.colors.contentAccent}`:null},viewBox:"0 0 24 24",...a,children:[(0,i.jsx)("path",{d:"M21 3L3 21",stroke:n?`${r.colors.contentAccent}`:r.colors.colorSwatchBlackBorder,strokeWidth:"1.5"}),(0,i.jsx)("rect",{x:"0.75",y:"0.75",width:"22.5",height:"22.5",rx:"11.25",stroke:n?"transparent":r.colors.colorSwatchBlackBorder,strokeWidth:"1.5"})]})};var Te=(0,a.forwardRef)(we),Ie=o(74215);const Pe=g.ZP.div.withConfig({displayName:"ColorSelector.styles__LegacySwatchContainer",componentId:"sc-a5b8f412-0"})`
  width: 100%;
  height: 24px;
  margin-top: 4px;
  display: flex;
  flex-direction: row;
  gap: 12px;
`,Ee=(0,g.ZP)(Ie.Z).attrs((()=>({type:"button"}))).withConfig({displayName:"ColorSelector.styles__LegacySwatch",componentId:"sc-a5b8f412-1"})`
  width: 24px;
  height: 24px;
  border-radius: 100%;
  box-sizing: border-box;
  ${e=>e.$isSelected&&`border: 2px solid ${e.$colorPickerMode?e.theme.colors.contrast:e.theme.colors.uiAccent}`};
  background: ${e=>"black"===e.$color?e.theme.colors.colorSwatchBlack:"light"===e.$color?e.theme.colors.colorSwatchWhite:null};
  ${e=>"black"===e.$color&&!e.$isSelected&&`border: 1.5px solid ${e.theme.colors.colorSwatchBlackBorder}`};
  ${e=>"light"===e.$color&&!e.$isSelected&&`border: 1.5px solid ${e.theme.colors.colorSwatchBlackBorder}`};
  ${e=>e.$colorPickerMode&&"background: url(/assets/color-picker.png)"};
  background-size: cover;
`;var _e;!function(e){e[e.dark=0]="dark",e[e.light=1]="light",e[e.black=2]="black"}(_e||(_e={}));var je=e=>{let t,{color:o,setColor:n,disabled:r}=e;t="black"===o?"black":"light"===o?"light":"dark"===o?"dark":"custom";const l=(0,a.useCallback)((e=>{n(e.currentTarget.value)}),[n]),s=(0,E.t2)(),{t:d}=(0,C.$G)(),c=(0,a.useCallback)((()=>{s.pushPropertyPanel(_.Z.COLOR_PICKER)}),[s]);return(0,i.jsxs)(Pe,{children:[(0,i.jsx)(Ee,{disabled:r,title:"#00000",value:"black",$isSelected:"black"===t,$color:"black",onClick:l,"data-testid":"black_color_input"}),(0,i.jsx)(Ee,{disabled:r,title:"#ffffff",value:"light",$isSelected:"light"===t,$color:"light",onClick:l,"data-testid":"white_color_input"}),(0,i.jsx)(Ee,{disabled:r,title:`${d("library.colorSelector.onhoverTitle.chooseAColor")}`,$colorPickerMode:!0,$isSelected:"custom"===t,onClick:c,"data-testid":"custom_color_input"}),(0,i.jsx)(Ee,{disabled:r,title:`${d("library.colorSelector.onhoverTitle.removeBackgroundColor")}`,value:"dark",$isSelected:!1,onClick:l,children:(0,i.jsx)(Te,{isSelected:"dark"===t})})]})},ke=o(60531),Se=o(759),Ze=o(9615),Re=o(38452);const Oe=g.ZP.div.withConfig({displayName:"SegmentedControls",componentId:"sc-ec888f8d-0"})`
  display: grid;
  grid-auto-flow: column;
  grid-auto-columns: minmax(0, 1fr);

  & button {
    min-width: unset;
  }

  // First button in segment
  & button:nth-child(1) span {
    border-top-right-radius: 0px;
    border-bottom-right-radius: 0px;
  }
  // Middle buttons in segment
  & button:not(:first-child):not(:last-child) span {
    border-radius: 0px;
  }
  // Last button in segment
  & button:nth-last-child(1) span {
    border-top-left-radius: 0px;
    border-bottom-left-radius: 0px;
  }

  // Border
  border: 1px solid ${e=>e.theme.colors.segmentedBorder};
  border-radius: ${"8px"};

  // Selected Background Color
  & [aria-selected='true'] ${Re.e9} {
    background: ${e=>{let{theme:t}=e;return t.colors.segmentedSelected}};
  }
`;var Me=Oe,$e=o(94232),Le=o(17145),Ae=o(96767),Ne=o(41697),De=o(47390),Be=o(3558),He=o(5993),Ve=o(99949);var Fe=(e,t,o,n)=>{const{apolloClient:i,clientId:r}=(0,L.bp)(),{deleteTilesAction:l}=(0,Ve.Z)(),s=(0,E.t2)(),{exclusiveSelectTiles:d}=(0,V.N4)();return{removeTileFromCompositeTile:(0,a.useCallback)((()=>{var a,c,u,p;if(!o)return;const m=null===(c=i.cache.readFragment({id:`Page:${t}`,fragment:G.bsn,fragmentName:"PageWithTilesFragment",variables:{fetchFullPage:!0,prefetchPreviewImage:!1}}))||void 0===c||null===(a=c.tiles)||void 0===a?void 0:a.find((e=>{var t,o;return null===(o=e.compositeTileData)||void 0===o||null===(t=o.tileIds)||void 0===t?void 0:t.includes(n)}));if(!m)throw new Error("Cannot clear background image of a non-composite tile");const h=null===(p=m.compositeTileData)||void 0===p||null===(u=p.tileIds)||void 0===u?void 0:u.filter((e=>e!==n))[0];if(!h)throw new Error("Cannot clear background image of a composite tile with only one tile");l([h],t,o,s,e,i,r,!1),d([n]),s.setPropertyPanel(_.Z.TILE)}),[i,r,l,d,o,t,s,n,e])}};const Ge={width:"20px",height:"20px"},Ue={marginBottom:"4px"},ze=(0,g.ZP)(Re.ZP).withConfig({displayName:"ImageSidebar__ImageFillTypeButton",componentId:"sc-4699352f-0"})`
  padding: 10px;
`;var We=e=>{let{pageId:t,tileData:o,updateTileData:n,pageController:l}=e;var s;const{apolloClient:d}=(0,L.bp)(),c=(0,a.useRef)(null),u=(0,r.Zl)(ke.cm),p=(0,r.Zl)(ke.VJ),m=(0,r.Zl)((0,$e.vw)(o.id)),h=(0,a.useCallback)((e=>{if(e.target.files&&e.target.files.length>0){const t=e.target.files[0];m((0,$e.aY)(t))}}),[m]),{imageAttributes:g,mediaTileData:f,id:x,tomeId:v}=o,{mediaFillType:b,backgroundColor:y,captionStyle:w,fillCropCenterX:T,fillCropCenterY:I,fillCropScale:P,mediaStatus:j}=f||{},k=b||W.AL,S=y||W.M2,Z=j===G.Jpv.UploadInProgress,R=(0,a.useCallback)((e=>{n((t=>({...t,mediaTileData:{...t.mediaTileData,mediaFillType:e}}))),Ne.ZP.reportImageFillTypeChange({apolloClient:d,tomeId:v,tileId:x,fillType:e})}),[n,v,x,d]),O=w||W.Io,M=(0,W.Gj)(g,j),$=(0,a.useCallback)((e=>{const t=e;n((e=>({...e,mediaTileData:{...e.mediaTileData,captionStyle:t}}))),O!==G.ubC.None&&null!==O||t===G.ubC.None||(0,A.VY)(!0)}),[O,n]),N=(0,a.useCallback)((e=>(0,Se.$V)(n,e)),[n]),B=(0,a.useCallback)((e=>{n((t=>({...t,mediaTileData:{...t.mediaTileData,backgroundColor:e}}))),Ne.ZP.reportImageBackgroundColorChange({apolloClient:d,tomeId:v,tileId:x,color:e})}),[n,d,v,x]),H=null!=T&&null!=I&&null!=P,V=(0,a.useCallback)((()=>{k!==G.EwX.Fill&&k!==G.EwX.Fit||H?R(G.EwX.Crop):(p(k),u(!0))}),[k,H,u,p,R]),F=(0,a.useCallback)((()=>{p(k),u(!0)}),[k,u,p]),U=(0,E.t2)(),z=(0,a.useCallback)((()=>{U.pushPropertyPanel(_.Z.IMAGE_CREATE)}),[U]),K=(0,a.useCallback)((()=>{U.pushPropertyPanel(_.Z.IMAGE_SEARCH)}),[U]),{t:q}=(0,C.$G)(),Y=(0,D.ye)(D.TT.CREATE_COMPOSITE_TILE),[J,X]=(0,a.useState)(!1),Q=(0,a.useMemo)((()=>{var e;return void 0!==(null===(e=l)||void 0===e?void 0:e.getTileRowId(o.id))}),[l,o.id,J]),{addTextToImageTile:ee}=(0,He.Z)(v,t,l,o),{removeTileFromCompositeTile:te}=Fe(v,t,l,o.id),oe=(0,a.useCallback)((()=>{Q?ee():(te(),X((e=>!e)))}),[ee,te,Q]);let re={height:"56px"},se={minWidth:"unset",width:"100%",fontSize:11,paddingLeft:20,paddingRight:20};return re={...re,gap:8},se={...se,paddingLeft:10,paddingRight:10},(0,i.jsxs)("div",{"data-testid":"image_sidebar",children:[(o.type===G.YUT.Image||o.type===G.YUT.ImageGenerative)&&(0,i.jsxs)(i.Fragment,{children:[(0,i.jsxs)(ae,{style:re,children:[(0,i.jsx)(Re.ZP,{onClick:z,size:"tall",startIcon:(0,i.jsx)(Le.Z,{style:Ge}),iconStyles:Ue,style:se,"data-testid":"media_create_button",children:q("sidebar.media.create")}),(0,i.jsx)(Ze.Z,{onClick:()=>{var e;null===(e=c.current)||void 0===e||e.click()},actionText:q("sidebar.media.upload"),disabled:Z,style:se,size:"tall",startIcon:(0,i.jsx)(Ae.Z,{style:Ge}),iconStyles:Ue,"data-testid":"media_upload_button"}),(0,i.jsx)(Re.ZP,{onClick:K,size:"tall",startIcon:(0,i.jsx)(De.Z,{style:Ge}),iconStyles:Ue,style:se,children:q("sidebar.media.search")})]}),(0,i.jsx)("input",{ref:c,type:"file",accept:W.lW,onChange:h,style:{display:"none"}})]}),o.type===G.YUT.Giphy&&(0,i.jsxs)(i.Fragment,{children:[(0,i.jsx)(ie,{children:q("sidebar.media.URL")}),(0,i.jsx)(ne,{children:(0,i.jsx)(le,{type:"text",value:o.contentLink||"",onChange:e=>N(e.target.value),placeholder:q("sidebar.media.giphyLink")})})]}),(0,i.jsx)(ie,{disabled:M,children:q("sidebar.media.size")}),(0,i.jsxs)(Me,{style:{marginBottom:12},role:"listbox",children:[(0,i.jsx)(ze,{disabled:M,"data-testid":"image_fill_type_fit_option",selected:k===G.EwX.Fit,onClick:()=>R(G.EwX.Fit),isSegment:!0,children:q("sidebar.media.fit")}),(0,i.jsx)(ze,{disabled:M,"data-testid":"image_fill_type_fill_option",selected:k===G.EwX.Fill,onClick:()=>R(G.EwX.Fill),isSegment:!0,children:q("sidebar.media.fill")}),(0,i.jsx)(ze,{disabled:M,"data-testid":"image_fill_type_crop_option",selected:k===G.EwX.Crop,onClick:V,isSegment:!0,children:q("sidebar.media.custom")})]}),(0,i.jsx)(ne,{children:(0,i.jsx)(Re.ZP,{disabled:M,onClick:F,style:{width:"100%"},children:q("sidebar.media.adjust")})}),!Y&&(0,i.jsxs)(i.Fragment,{children:[(0,i.jsx)(ie,{disabled:M,children:q("sidebar.caption")}),(0,i.jsx)(ne,{disabled:M,"data-testid":"image_caption_input",children:(0,i.jsx)(be,{disabled:M,currentValue:O,options:[{value:"none",label:q("sidebar.none")},{value:"top",label:q("sidebar.top")},{value:"bottom",label:q("sidebar.bottom")}],onChange:$,menuWidth:"100%",controlWidth:"100%"})})]}),Y&&(null===(s=o.imageAttributes)||void 0===s?void 0:s.imagePath)&&(0,i.jsx)(i.Fragment,{children:(0,i.jsxs)(ae,{children:[(0,i.jsx)(ie,{disabled:M,children:q("sidebar.text")}),(0,i.jsx)(Be.Z,{inputId:"add_text_to_image_tile_toggle",width:"40px",height:"20px",onClick:oe,onBgColor:!0,radius:4,checked:!Q})]})}),(0,i.jsx)(ie,{disabled:M,children:q("sidebar.backgroundColor")}),(0,i.jsx)(ne,{disabled:M,"data-testid":"image_background_color_input",$lastItem:!0,children:(0,i.jsx)(je,{color:S,setColor:B,disabled:M})})]})},Ke=o(17625),qe=o(81735);const Ye=(0,g.ZP)(Re.ZP).withConfig({displayName:"VideoSidebar__VideoFillTypeButton",componentId:"sc-990c2d14-0"})`
  padding: 10px;
`;var Je=e=>{let{tileData:t,updateTileData:o}=e;var n,l;const{id:s,videoTileData:d,mediaTileData:c}=t,{autoplay:u,loop:p,url:m}=d||{},{captionStyle:h,mediaFillType:g,fillCropCenterX:f,fillCropCenterY:x,fillCropScale:v,backgroundColor:b}=c||{},y=(0,D.ye)(D.TT.NARRATION_VIDEO_OVERRIDE),w=(0,a.useRef)(null),T=(0,r.Zl)(ke.s5),I=(0,r.Zl)(ke.VJ),P=(0,r.Zl)((0,$e.vw)(s)),E=(0,a.useCallback)((e=>{if(e.target.files&&e.target.files.length>0){const t=e.target.files[0];P((0,$e.aY)(t))}}),[P]),_=b||W.M2,j=g||G.EwX.Fit,k=(null===(n=c)||void 0===n?void 0:n.mediaStatus)===G.Jpv.UploadInProgress,S=(0,r.sJ)((0,qe.M)({tileId:t.id,url:m||""})),Z=(0,Ke.M)(c||void 0,S),R=(0,a.useCallback)((e=>{o((t=>({...t,mediaTileData:{...t.mediaTileData,captionStyle:e}}))),"none"!==h&&null!==h||"none"===e||(0,A.VY)(!0)}),[h,o]),O=(0,a.useCallback)((()=>{o((e=>{var t;return{...e,videoTileData:{...e.videoTileData,autoplay:!(null===(t=e.videoTileData)||void 0===t?void 0:t.autoplay)}}}))}),[o]),M=(0,a.useCallback)((()=>{o((e=>{var t;return{...e,videoTileData:{...e.videoTileData,loop:!(null===(t=e.videoTileData)||void 0===t?void 0:t.loop)}}}))}),[o]),$=(0,a.useCallback)((e=>{o((t=>({...t,mediaTileData:{...t.mediaTileData,backgroundColor:e}})))}),[o]),L=(0,a.useCallback)((e=>{o((t=>({...t,mediaTileData:{...t.mediaTileData,mediaFillType:e}})))}),[o]),N=null!=f&&null!=x&&null!=v,B=(0,a.useCallback)((()=>{j!==G.EwX.Fill&&j!==G.EwX.Fit||N?L(G.EwX.Crop):(I(j),T(!0))}),[j,N,T,I,L]),H=(0,a.useCallback)((()=>{I(j),T(!0)}),[j,T,I]),{t:V}=(0,C.$G)();return(0,i.jsxs)("div",{"data-testid":"video_sidebar",children:[y&&(0,i.jsxs)(i.Fragment,{children:[(0,i.jsx)(ie,{children:V("sidebar.media.muxVideoId")}),(0,i.jsx)(ne,{style:{userSelect:"text"},children:V("sidebar.media.videoId",{videoId:null===(l=d)||void 0===l?void 0:l.videoId})||"null"})]}),(0,i.jsx)(ne,{children:(0,i.jsx)(Ze.Z,{style:{width:"100%"},onClick:()=>{var e;return null===(e=w.current)||void 0===e?void 0:e.click()},actionText:V("sidebar.media.upload"),disabled:k})}),(0,i.jsx)(ie,{disabled:Z,children:V("sidebar.media.size")}),(0,i.jsxs)(Me,{style:{marginBottom:12},role:"listbox",children:[(0,i.jsx)(Ye,{disabled:Z,"data-testid":"video_fill_type_fit_option",selected:j===G.EwX.Fit,onClick:()=>L(G.EwX.Fit),isSegment:!0,children:V("sidebar.media.fit")}),(0,i.jsx)(Ye,{disabled:Z,"data-testid":"video_fill_type_fill_option",selected:j===G.EwX.Fill,onClick:()=>L(G.EwX.Fill),isSegment:!0,children:V("sidebar.media.fill")}),(0,i.jsx)(Ye,{disabled:Z,"data-testid":"video_fill_type_crop_option",selected:j===G.EwX.Crop,onClick:B,isSegment:!0,children:V("sidebar.media.custom")})]}),(0,i.jsxs)(ae,{children:[(0,i.jsx)(Re.ZP,{disabled:Z,onClick:H,children:V("sidebar.media.adjust")}),(0,i.jsx)(Re.ZP,{disabled:Z,onClick:()=>(0,A.PS)(!(0,A.PS)()),children:V("sidebar.media.trim")})]}),(0,i.jsxs)(re,{disabled:Z,children:[(0,i.jsx)("label",{htmlFor:"VideoSidebarAutoplay",children:V("sidebar.media.autoplay")}),(0,i.jsx)(Be.Z,{inputId:"VideoSidebarAutoplay",width:"40px",height:"20px",onBgColor:!0,checked:!!u,disabled:Z,onClick:O})]}),(0,i.jsxs)(re,{disabled:Z,children:[(0,i.jsx)("label",{htmlFor:"VideoSidebarRepeat",children:V("sidebar.media.repeat")}),(0,i.jsx)(Be.Z,{inputId:"VideoSidebarRepeat",width:"40px",height:"20px",onBgColor:!0,checked:!!p,disabled:Z,onClick:M})]}),(0,i.jsx)(ie,{disabled:Z,children:V("sidebar.caption")}),(0,i.jsx)(ne,{disabled:Z,"data-testid":"video_caption_input",children:(0,i.jsx)(be,{disabled:Z,currentValue:h||"none",options:[{value:"none",label:V("sidebar.none")},{value:"top",label:V("sidebar.top")},{value:"bottom",label:V("sidebar.bottom")}],onChange:R,menuWidth:"100%",controlWidth:"100%"})}),(0,i.jsx)(ie,{disabled:Z,children:V("sidebar.backgroundColor")}),(0,i.jsx)(ne,{$lastItem:!0,disabled:Z,children:(0,i.jsx)(je,{color:_,setColor:$,disabled:Z})}),(0,i.jsx)("input",{ref:w,type:"file",accept:"video/*",onChange:E,style:{display:"none"}})]})},Xe=o(3266);var Qe=(0,a.forwardRef)(((e,t)=>(0,i.jsx)(ye.Z,{ref:t,viewBox:"0 0 64 64",...e,children:(0,i.jsx)("path",{d:"M12 32C12 30.8954 12.8954 30 14 30H50C51.1046 30 52 30.8954 52 32C52 33.1046 51.1046 34 50 34H14C12.8954 34 12 33.1046 12 32Z"})})));const et=g.ZP.div.withConfig({displayName:"Stepper__StepperWrapper",componentId:"sc-6e9e838c-0"})`
  display: flex;
  align-items: center;
  border-radius: 6px;
  width: fit-content;
  padding: 4px;
  background-color: ${e=>e.theme.colors.stepperBackground};
`,tt=(0,g.ZP)(Re.ZP).withConfig({displayName:"Stepper__StepButton",componentId:"sc-6e9e838c-1"})`
  min-width: 24px;
  padding: 0 0px;
  height: 20px;

  ${Re.e9} {
    border-radius: 4px;
  }
`,ot=g.ZP.input.withConfig({displayName:"Stepper__CustomInput",componentId:"sc-6e9e838c-2"})`
  background-color: transparent;
  height: 20px;
  color: ${e=>e.theme.colors.inputText};
  border: 0;
  border-radius: 0;
  padding: 0;
  width: 46px; // Note: this could be configurable based off of context
  outline: none;
  caret-color: ${e=>e.theme.colors.uiAccent};

  // Center content
  text-align: center;
  display: inline-block;
`;var nt=e=>{let{max:t=Number.MAX_SAFE_INTEGER,min:o=Number.MIN_SAFE_INTEGER,step:n=1,setValue:r,value:l}=e;const s=(0,a.useCallback)((()=>{r((e=>e+n<=t?e+n:e))}),[t,r,n]),d=(0,a.useCallback)((()=>{r((e=>e-n>=o?e-n:e))}),[o,r,n]),{t:c}=(0,C.$G)();return(0,i.jsxs)(et,{children:[(0,i.jsx)(tt,{onClick:d,"aria-label":c("library.stepper.ariaLabelDecreaseValue"),disabled:l-n<o,size:"small",variant:"uncontained",iconOpacity:1,startIcon:(0,i.jsx)(Qe,{style:{width:16}}),iconStyles:{margin:0}}),(0,i.jsx)(ot,{value:l,readOnly:!0,autoComplete:"off",role:"spinbutton","aria-valuemin":o,"aria-valuemax":t,"aria-valuenow":l}),(0,i.jsx)(tt,{onClick:s,"aria-label":c("library.stepper.ariaLabelIncreaseValue"),disabled:l+n>t,size:"small",variant:"uncontained",iconOpacity:1,startIcon:(0,i.jsx)(Xe.Z,{style:{width:16}}),iconStyles:{margin:0}})]})},it=o(94754),at=o(39554),rt=o(83575),lt=o(36680);const st=g.ZP.div.withConfig({displayName:"TableSidebar__StepperColumn",componentId:"sc-d6b8a0de-0"})`
  padding-bottom: 12px;
`;var dt=e=>{let{isSingleTileRow:t,tileData:o,updateTileData:n}=e;var r,l,s,d,c,u,p,m;const{tableTileData:h}=o,{showTitle:g,wrapText:f}=h,x=(0,a.useMemo)((()=>{var e,t;return((null===(t=h)||void 0===t||null===(e=t.payload)||void 0===e?void 0:e.data)||[]).map((e=>e.id))}),[h]),v=(0,a.useMemo)((()=>{var e,t;return((null===(t=h)||void 0===t||null===(e=t.payload)||void 0===e?void 0:e.columns)||[]).map((e=>e.accessor))}),[h]),b=(0,a.useRef)({data:null===(l=h)||void 0===l||null===(r=l.payload)||void 0===r?void 0:r.data,columns:null===(d=h)||void 0===d||null===(s=d.payload)||void 0===s?void 0:s.columns});(0,a.useEffect)((()=>{var e,t;b.current.data=null===(t=h)||void 0===t||null===(e=t.payload)||void 0===e?void 0:e.data}),[null===(u=h)||void 0===u||null===(c=u.payload)||void 0===c?void 0:c.data]),(0,a.useEffect)((()=>{var e,t;b.current.columns=null===(t=h)||void 0===t||null===(e=t.payload)||void 0===e?void 0:e.columns}),[null===(m=h)||void 0===m||null===(p=m.payload)||void 0===p?void 0:p.columns]);const y=(0,rt.Z)(b,o.id).deselectAllCells,w=(0,a.useCallback)((e=>(0,at.Sd)(n,e)),[n]),{deleteColumn:T,deleteRow:I,insertColumn:P,insertRow:E}=(0,it.ZP)(w,y),_=(0,a.useCallback)((()=>{n((e=>{var t,o;return{...e,tableTileData:{...e.tableTileData,showTitle:!(null===(o=e)||void 0===o||null===(t=o.tableTileData)||void 0===t?void 0:t.showTitle)}}}))}),[n]),j=(0,a.useCallback)((()=>{n((e=>{var t,o;return{...e,tableTileData:{...e.tableTileData,wrapText:!(null===(o=e)||void 0===o||null===(t=o.tableTileData)||void 0===t?void 0:t.wrapText)}}}))}),[n]),k=(0,a.useCallback)((e=>{const t=e(x.length)-x.length;t>0&&E(),t<0&&I(x[x.length-1])}),[I,E,x]),S=(0,a.useCallback)((e=>{const t=e(v.length)-v.length;t>0&&P(lt.Hr.string),t<0&&T(v[v.length-1])}),[v,P,T]),Z=(0,a.useCallback)((()=>{n((e=>{var o;const n=Object.entries(null===(o=e.tableTileData)||void 0===o?void 0:o.columnWidths),i=(t?2:1)/n.length,a=Object.fromEntries(n.map((e=>{let[t]=e;return[t,i]})));return{...e,tableTileData:{...e.tableTileData,columnWidths:a}}}))}),[t,n]),{t:R}=(0,C.$G)();return(0,i.jsxs)(i.Fragment,{children:[(0,i.jsxs)("div",{"data-testid":"table_sidebar",style:{display:"flex",justifyContent:"space-between"},children:[(0,i.jsxs)(st,{"data-testid":"table_row_stepper",children:[(0,i.jsx)(ie,{children:R("sidebar.rows")}),(0,i.jsx)(nt,{min:1,max:100,value:x.length,setValue:k})]}),(0,i.jsxs)(st,{"data-testid":"table_column_stepper",children:[(0,i.jsx)(ie,{children:R("sidebar.columns")}),(0,i.jsx)(nt,{min:1,max:100,value:v.length,setValue:S})]})]}),(0,i.jsxs)(re,{children:[(0,i.jsx)("label",{htmlFor:"TableSidebarShowTitle",children:R("sidebar.showTitle")}),(0,i.jsx)(Be.Z,{inputId:"TableSidebarShowTitle",width:"40px",height:"20px",onBgColor:!0,checked:!!g,onClick:_})]}),(0,i.jsxs)(re,{children:[(0,i.jsx)("label",{htmlFor:"TableSidebarWrapText",children:R("sidebar.wrapText")}),(0,i.jsx)(Be.Z,{inputId:"TableSidebarWrapText",width:"40px",height:"20px",onBgColor:!0,checked:!!f,onClick:j})]}),(0,i.jsx)(ne,{$lastItem:!0,children:(0,i.jsx)(Re.ZP,{onClick:Z,style:{width:"100%"},children:R("sidebar.distributeColumns")})})]})},ct=o(34981),ut=o(76967);const pt=g.ZP.div.withConfig({displayName:"MessageWithTag__MessageContainer",componentId:"sc-d2d164ba-0"})`
  line-height: 16px;
`,mt=g.ZP.span.withConfig({displayName:"MessageWithTag__Message",componentId:"sc-d2d164ba-1"})`
  font-style: normal;
  font-weight: normal;
  font-size: 11px;
  line-height: 15px;
  color: ${e=>e.theme.colors.contrast40};
`;var ht=e=>{let{message:t,tag:o}=e;return(0,i.jsxs)(pt,{children:[(0,i.jsx)(ut.Vp,{color:"gray",children:o})," ",(0,i.jsx)(mt,{children:t})]})};var gt=e=>{let{tileData:t,updateTileData:o}=e;const n=(0,z.An)(t.type),a=n.length>0?n[0].label:void 0,{t:r}=(0,C.$G)();return(0,i.jsxs)(i.Fragment,{children:[(0,i.jsx)(ie,{children:r("sidebar.url")}),(0,i.jsx)(ne,{children:(0,i.jsx)(le,{type:"text",value:t.contentLink||"",onChange:e=>{o((t=>({...t,contentLink:e.target.value})))},placeholder:`${r("sidebar.embed.placeholder",a?{tileType:a,context:"tileLabel"}:{})}`,onContextMenuCapture:ct.Z})}),a&&(0,i.jsx)(ht,{tag:r("tag.tip"),message:`${r("sidebar.embed.message",a?{tileType:a,context:"tileLabel"}:{})}`})]})},Ct=o(41792),ft=o(61105),xt=o(24389);var vt=(0,a.forwardRef)(((e,t)=>(0,i.jsx)(ye.Z,{ref:t,viewBox:"0 0 28 3",...e,children:(0,i.jsx)("rect",{rx:"1.5",style:{width:28,height:3}})})));const bt="12px",yt=(0,g.ZP)(vt).withConfig({displayName:"SidebarTemplate__CustomDraggableIcon",componentId:"sc-e2fd0a1f-0"})`
  position: absolute;
  fill: ${e=>{let{theme:t}=e;return t.colors.sidebarDraggingIcon}};
  transition: fill 0.2s ease-out;
`,wt=g.ZP.div.withConfig({displayName:"SidebarTemplate__DraggableHandleHeader",componentId:"sc-e2fd0a1f-1"})`
  display: flex;
  flex-direction: row;
  align-items: center;
  justify-items: center;
  // Specify z-index one higher than PanelHeader's to allow hover state to show
  z-index: ${I.C8+1};
  position: relative;
  border-radius: 3px;
  top: 8px;

  margin: 0 auto;
  margin-bottom: 4px;

  height: 3px;
  width: 28px;

  ${e=>{let{$draggable:t}=e;return t&&Tt}}
`,Tt=g.iv`
  &:hover {
    cursor: grab;
  }
`,It=g.ZP.div.withConfig({displayName:"SidebarTemplate__PanelHeader",componentId:"sc-e2fd0a1f-2"})`
  width: 100%;
  max-width: 240px;
  padding-left: ${bt};
  padding-right: ${bt};
  padding-top: 12px;
  padding-bottom: 12px;
  display: flex;
  flex-direction: row;
  justify-content: space-between;
  gap: 12px;
  align-items: center;
  z-index: ${I.C8};
  position: relative;

  ${e=>{let{$draggable:t}=e;return t&&Tt}}
`,Pt=g.iv`
  justify-content: center;
  width: 100%;
  position: absolute;
  left: 0;
  display: flex;
`,Et=g.ZP.div.withConfig({displayName:"SidebarTemplate__HeaderLabel",componentId:"sc-e2fd0a1f-3"})`
  font-size: ${e=>{let{$draggable:t,theme:o}=e;return t?o.fontSizes.sm:o.fontSizes.smmd}};
  color: ${e=>{let{theme:t}=e;return t.colors.sidebarHeaderText}};
  line-height: 20px;
  font-weight: 600;
  max-width: calc(100% - 24px);

  // Truncate text if it flows beyond available space.
  ${te.wR}

  ${e=>{let{$childLabel:t}=e;return t&&Pt}};
`,_t=g.ZP.div.withConfig({displayName:"SidebarTemplate__SubheaderLabel",componentId:"sc-e2fd0a1f-4"})`
  font-size: ${e=>{let{theme:t}=e;return t.fontSizes.xxs}};
  color: ${e=>{let{theme:t}=e;return t.colors.sidebarSubheaderText}};
  line-height: 14px;
  font-weight: 400;

  width: 100%;
  padding-left: ${bt};
  padding-right: ${bt};
  margin-top: -12px;
  padding-bottom: 10px;

  ${te.wR}
`,jt=g.iv`
  height: 24px;
  width: 24px;
  min-width: auto;
`,kt=(0,g.ZP)(Re.ZP).attrs({variant:"uncontained"}).withConfig({displayName:"SidebarTemplate__CloseButton",componentId:"sc-e2fd0a1f-5"})`
  position: absolute;
  right: 12px;
  top: 10px;

  ${jt}
`,St=g.ZP.div.withConfig({displayName:"SidebarTemplate__CloseButtonBorder",componentId:"sc-e2fd0a1f-6"})`
  margin-left: 12px;
`,Zt=(0,g.ZP)(Ie.Z).withConfig({displayName:"SidebarTemplate__CloseButtonInteractionTarget",componentId:"sc-e2fd0a1f-7"})`
  position: absolute;
  right: 0px;
  top: 0px;
  height: 34px;
  width: 32px;
  cursor: pointer;
`,Rt=(0,g.ZP)(Re.ZP).withConfig({displayName:"SidebarTemplate__SidebarHeaderButton",componentId:"sc-e2fd0a1f-8"})`
  ${jt}
  margin-left: -4px;
  z-index: ${I.Mf+1};
`,Ot=g.ZP.div.withConfig({displayName:"SidebarTemplate__PanelContent",componentId:"sc-e2fd0a1f-9"})`
  will-change: height, padding;
  padding: ${e=>e.$noPadding?"0px":`8px ${bt} ${bt} ${bt}`};

  ${e=>"number"==typeof e.$imageCreatePanelsMaxHeight&&g.iv`
      max-height: ${e.$imageCreatePanelsMaxHeight}px;
      ${e.$scrollable?"overflow-y: auto;":""}
    `}
`,Mt=(0,g.ZP)(ut.Ur).withConfig({displayName:"SidebarTemplate__SidebarBetaTag",componentId:"sc-e2fd0a1f-10"})`
  :first-child {
    line-height: 100%;
    margin: 3px 0 3px 6px;
  }
`,$t=[_.Z.IMAGE_CREATE,_.Z.IMAGE_GENERATION_HISTORY,_.Z.IMAGE_SEARCH];var Lt=(0,a.forwardRef)(((e,t)=>{let{hasHeader:o,headerText:n,subheaderText:l,contentNoPadding:s,panelContent:d,headerBetaTag:c=!1,draggable:u,startDrag:p}=e;const m=(0,E.Z5)(),h=(0,E.t2)(),g=(0,E.f3)(),[f,x]=(0,a.useState)(!1),{height:v}=(0,B.Z)(),b=(0,r.sJ)(V.ej),y=(0,a.useCallback)((e=>{u&&p&&(p(e),x(!0))}),[u,p]),w=(0,a.useCallback)((()=>{x(!1)}),[]),T=(0,M.E)(),I=(0,a.useCallback)((()=>{T.start("hover")}),[T]),P=(0,a.useCallback)((()=>{T.start("default")}),[T]),j=(0,a.useCallback)((()=>{T.start("active"),h.closePropertyPanel()}),[T,h]),k=!!g&&$t.includes(g),S=m>1,{t:Z}=(0,C.$G)();return(0,i.jsxs)("div",{ref:t,children:[o&&(0,i.jsx)(wt,{onPointerDown:y,onPointerUp:w,$draggable:u,children:!S&&(0,i.jsx)(yt,{})}),o&&(0,i.jsxs)(It,{onPointerDown:y,onPointerUp:w,$draggable:u,children:[S&&(0,i.jsx)(Rt,{variant:"uncontained",size:"small","data-testid":"property_panel_back_button",startIcon:(0,i.jsx)(Ct.Z,{style:{height:20,width:20}}),iconStyles:{margin:0},iconOpacity:.2,onClick:h.popPropertyPanel}),(0,i.jsxs)(Et,{"data-testid":"property_panel_header_label",$draggable:!!u,$childLabel:S,children:[n,c&&(0,i.jsx)(Mt,{})]}),u&&(0,i.jsxs)(St,{children:[(0,i.jsx)(kt,{size:"small",animationControls:T,iconStyles:{margin:0},icon:(0,i.jsx)(ft.Z,{style:{width:22,height:22}}),iconOpacity:.2}),(0,i.jsx)(Zt,{"aria-label":Z("sidebar.closePanel"),onMouseOver:I,onMouseOut:P,onClick:j,"data-testid":"property_panel_close_button"})]})]}),(0,i.jsx)(_t,{"data-testid":"property_panel_subheader_label",children:l}),(0,i.jsx)(Ot,{$imageCreatePanelsMaxHeight:k?v-48-156:void 0,$scrollable:k&&g!==_.Z.IMAGE_SEARCH,style:{height:g===_.Z.IMAGE_GENERATION_HISTORY?Math.max(b,476):"unset"},$noPadding:s,children:d}),f&&(0,i.jsx)(xt.Z,{})]})})),At=o(50576),Nt=o(18814),Dt=o(91421);var Bt=()=>{var e;const{activeEditorRef:t}=(0,a.useContext)(Nt.f);return(0,r.sJ)(Dt.Z),null===(e=t)||void 0===e?void 0:e.current},Ht=o(78137),Vt=o(87473),Ft=o(9141),Gt=o(66347);var Ut=(0,a.forwardRef)(((e,t)=>(0,i.jsxs)(ye.Z,{ref:t,viewBox:"0 0 64 64",...e,children:[(0,i.jsx)("path",{d:"M12 20C12 18.8954 12.8954 18 14 18H50C51.1046 18 52 18.8954 52 20C52 21.1046 51.1046 22 50 22H14C12.8954 22 12 21.1046 12 20Z"}),(0,i.jsx)("path",{d:"M12 32C12 30.8954 12.8954 30 14 30H38C39.1046 30 40 30.8954 40 32C40 33.1046 39.1046 34 38 34H14C12.8954 34 12 33.1046 12 32Z"}),(0,i.jsx)("path",{d:"M14 42C12.8954 42 12 42.8954 12 44C12 45.1046 12.8954 46 14 46H50C51.1046 46 52 45.1046 52 44C52 42.8954 51.1046 42 50 42H14Z"})]})));var zt=(0,a.forwardRef)(((e,t)=>(0,i.jsxs)(ye.Z,{ref:t,viewBox:"0 0 64 64",...e,children:[(0,i.jsx)("path",{d:"M12 20C12 18.8954 12.8954 18 14 18H50C51.1046 18 52 18.8954 52 20C52 21.1046 51.1046 22 50 22H14C12.8954 22 12 21.1046 12 20Z"}),(0,i.jsx)("path",{d:"M18 32C18 30.8954 18.8954 30 20 30H44C45.1046 30 46 30.8954 46 32C46 33.1046 45.1046 34 44 34H20C18.8954 34 18 33.1046 18 32Z"}),(0,i.jsx)("path",{d:"M14 42C12.8954 42 12 42.8954 12 44C12 45.1046 12.8954 46 14 46H50C51.1046 46 52 45.1046 52 44C52 42.8954 51.1046 42 50 42H14Z"})]})));var Wt=(0,a.forwardRef)(((e,t)=>(0,i.jsxs)(ye.Z,{ref:t,viewBox:"0 0 64 64",...e,children:[(0,i.jsx)("path",{d:"M12 20C12 18.8954 12.8954 18 14 18H50C51.1046 18 52 18.8954 52 20C52 21.1046 51.1046 22 50 22H14C12.8954 22 12 21.1046 12 20Z"}),(0,i.jsx)("path",{d:"M24 32C24 30.8954 24.8954 30 26 30H50C51.1046 30 52 30.8954 52 32C52 33.1046 51.1046 34 50 34H26C24.8954 34 24 33.1046 24 32Z"}),(0,i.jsx)("path",{d:"M14 42C12.8954 42 12 42.8954 12 44C12 45.1046 12.8954 46 14 46H50C51.1046 46 52 45.1046 52 44C52 42.8954 51.1046 42 50 42H14Z"})]})));var Kt=(0,a.forwardRef)(((e,t)=>(0,i.jsxs)(ye.Z,{ref:t,viewBox:"0 0 64 64",...e,children:[(0,i.jsx)("path",{d:"M14 18C12.8954 18 12 18.8954 12 20C12 21.1046 12.8954 22 14 22H50C51.1046 22 52 21.1046 52 20C52 18.8954 51.1046 18 50 18H14Z"}),(0,i.jsx)("path",{d:"M33.4142 33.5858C32.6332 32.8047 31.3668 32.8047 30.5858 33.5858L22.5858 41.5858C21.8047 42.3668 21.8047 43.6332 22.5858 44.4142C23.3668 45.1953 24.6332 45.1953 25.4142 44.4142L32 37.8284L38.5858 44.4142C39.3668 45.1953 40.6332 45.1953 41.4142 44.4142C42.1953 43.6332 42.1953 42.3668 41.4142 41.5858L33.4142 33.5858Z"})]})));var qt=(0,a.forwardRef)(((e,t)=>(0,i.jsxs)(ye.Z,{ref:t,viewBox:"0 0 64 64",...e,children:[(0,i.jsx)("path",{d:"M33.4142 24.4142L41.4142 16.4142C42.1953 15.6332 42.1953 14.3668 41.4142 13.5858C40.6332 12.8047 39.3668 12.8047 38.5858 13.5858L32 20.1716L25.4142 13.5858C24.6332 12.8047 23.3668 12.8047 22.5858 13.5858C21.8047 14.3668 21.8047 15.6332 22.5858 16.4142L30.5858 24.4142C31.3668 25.1953 32.6332 25.1953 33.4142 24.4142Z"}),(0,i.jsx)("path",{d:"M12 32C12 33.1046 12.8954 34 14 34H50C51.1046 34 52 33.1046 52 32C52 30.8954 51.1046 30 50 30H14C12.8954 30 12 30.8954 12 32Z"}),(0,i.jsx)("path",{d:"M41.4142 47.5858L33.4142 39.5858C32.6332 38.8047 31.3668 38.8047 30.5858 39.5858L22.5858 47.5858C21.8047 48.3668 21.8047 49.6332 22.5858 50.4142C23.3668 51.1953 24.6332 51.1953 25.4142 50.4142L32 43.8284L38.5858 50.4142C39.3668 51.1953 40.6332 51.1953 41.4142 50.4142C42.1953 49.6332 42.1953 48.3668 41.4142 47.5858Z"})]})));var Yt=(0,a.forwardRef)(((e,t)=>(0,i.jsxs)(ye.Z,{ref:t,viewBox:"0 0 64 64",...e,children:[(0,i.jsx)("path",{d:"M41.4142 22.4142L33.4142 30.4142C32.6332 31.1953 31.3668 31.1953 30.5858 30.4142L22.5858 22.4142C21.8047 21.6332 21.8047 20.3668 22.5858 19.5858C23.3668 18.8047 24.6332 18.8047 25.4142 19.5858L32 26.1716L38.5858 19.5858C39.3668 18.8047 40.6332 18.8047 41.4142 19.5858C42.1953 20.3668 42.1953 21.6332 41.4142 22.4142Z"}),(0,i.jsx)("path",{d:"M14 46C12.8954 46 12 45.1046 12 44C12 42.8954 12.8954 42 14 42H50C51.1046 42 52 42.8954 52 44C52 45.1046 51.1046 46 50 46H14Z"})]}))),Jt=o(70203),Xt=o(64945);var Qt=(e,t)=>({...e,textTileData:{...e.textTileData,...t}}),eo=o(84683),to=o(22021),oo=o(75570);const no=(0,g.ZP)(Re.ZP).attrs(to.g).withConfig({displayName:"SlateTextSidebar__TextStyleButton",componentId:"sc-dabf2e61-0"})`
  width: 50%;
  padding: 12px;
`,io=(0,g.ZP)(ne).withConfig({displayName:"SlateTextSidebar__TextStyleRow",componentId:"sc-dabf2e61-1"})`
  position: relative;
  display: flex;
  margin-bottom: 8px;

  ${no} + ${no} {
    margin-left: 8px;
  }

  :last-child {
    margin-bottom: 0;
  }
`,ao=(0,g.ZP)(no).withConfig({displayName:"SlateTextSidebar__DisplayButton",componentId:"sc-dabf2e61-2"})`
  font-size: 17px;
  font-weight: 600;
`,ro=(0,g.ZP)(no).withConfig({displayName:"SlateTextSidebar__TitleButton",componentId:"sc-dabf2e61-3"})`
  font-size: 16px;
  font-weight: 600;
`,lo=(0,g.ZP)(no).withConfig({displayName:"SlateTextSidebar__HeadingButton",componentId:"sc-dabf2e61-4"})`
  font-size: 14.5px;
  font-weight: 600;
`,so=(0,g.ZP)(no).withConfig({displayName:"SlateTextSidebar__SubheadingButton",componentId:"sc-dabf2e61-5"})`
  font-size: 13px;
  font-weight: 600;
`,co=(0,g.ZP)("span").withConfig({displayName:"SlateTextSidebar__GroupLabel",componentId:"sc-dabf2e61-6"})`
  display: flex;
  color: ${e=>e.theme.colors.commentEditorPlaceholder};
  font-size: ${e=>e.theme.fontSizes.xxs};
  margin-top: 12px;
  margin-bottom: 8px;

  :first-child {
    margin-top: 0;
  }
`,uo=(0,g.ZP)(no).attrs(to.g).withConfig({displayName:"SlateTextSidebar__BodyButton",componentId:"sc-dabf2e61-7"})`
  font-size: 13px;
  font-weight: 400;
  svg {
    width: 24px;
    height: 24px;
  }
`,po=(0,g.ZP)(uo).withConfig({displayName:"SlateTextSidebar__FullWidthButton",componentId:"sc-dabf2e61-8"})`
  width: 100%;
`,mo=(0,g.ZP)(no).attrs(to.g).withConfig({displayName:"SlateTextSidebar__CaptionButton",componentId:"sc-dabf2e61-9"})`
  font-size: 11px;
  font-weight: 400;
`,ho=(0,g.ZP)(Re.ZP).attrs(to.g).withConfig({displayName:"SlateTextSidebar__AlignmentButton",componentId:"sc-dabf2e61-10"})`
  svg {
    width: 24px;
    height: 24px;
  }
`,go=(0,g.ZP)(Me).attrs(to.J).withConfig({displayName:"SlateTextSidebar__StyledSegmentedControls",componentId:"sc-dabf2e61-11"})`
  margin-bottom: 8px;

  :last-child {
    margin-bottom: 0;
  }
`;var Co=e=>{let{tomeId:t,pageId:o,pageController:n,tileData:r,updateTileData:l}=e;var s,d,c;const u=Bt(),{t:p}=(0,C.$G)(),m=(0,D.ye)(D.TT.CREATE_COMPOSITE_TILE),h=(0,a.useMemo)((()=>{var e;return void 0!==(null===(e=n)||void 0===e?void 0:e.getTileRowId(r.id))}),[n,r.id]),g=(0,a.useRef)(null),f=(0,a.useCallback)((()=>{g.current&&g.current.click()}),[]),{removeTileFromCompositeTile:x}=Fe(t,o,n,r.id),{addBackgroundImageToTextTile:v}=(0,oo.Z)(t,o,n,r),b=(0,Xt.Z)((function(){let{vertical:e,horizontal:t}=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return()=>{l((o=>{var n,i;return Qt(o,{verticalAlignment:e||(null===(n=o.textTileData)||void 0===n?void 0:n.verticalAlignment),horizontalAlignment:t||(null===(i=o.textTileData)||void 0===i?void 0:i.horizontalAlignment)})}))}}),[l]);if(!(null===(s=u)||void 0===s?void 0:s.children.length))return null;const y=(0,Jt.oA)(null===(d=r.textTileData)||void 0===d?void 0:d.horizontalAlignment),w=(0,Jt.xZ)(null===(c=r.textTileData)||void 0===c?void 0:c.verticalAlignment),T=(0,Ht.Hk)(u),I=(0,Ht.Lk)(u,T);return(0,i.jsxs)("div",{"data-testid":"text_sidebar",children:[(0,i.jsx)(co,{children:p("sidebar.alignment")}),(0,i.jsxs)(go,{role:"listbox",children:[(0,i.jsx)(ho,{isSegment:!0,role:"option",onClick:b({horizontal:G.KxP.Leading}),"aria-selected":y===G.KxP.Leading,selected:y===G.KxP.Leading,startIcon:(0,i.jsx)(Ut,{})}),(0,i.jsx)(ho,{isSegment:!0,role:"option",onClick:b({horizontal:G.KxP.Center}),"aria-selected":y===G.KxP.Center,selected:y===G.KxP.Center,startIcon:(0,i.jsx)(zt,{})}),(0,i.jsx)(ho,{isSegment:!0,role:"option",onClick:b({horizontal:G.KxP.Trailing}),"aria-selected":y===G.KxP.Trailing,selected:y===G.KxP.Trailing,startIcon:(0,i.jsx)(Wt,{})})]}),(0,i.jsxs)(go,{role:"listbox",children:[(0,i.jsx)(ho,{isSegment:!0,role:"option",onClick:b({vertical:G.Q4P.Top}),"aria-selected":w===G.Q4P.Top,selected:w===G.Q4P.Top,startIcon:(0,i.jsx)(Kt,{})}),(0,i.jsx)(ho,{isSegment:!0,role:"option",onClick:b({vertical:G.Q4P.Center}),"aria-selected":w===G.Q4P.Center,selected:w===G.Q4P.Center,startIcon:(0,i.jsx)(qt,{})}),(0,i.jsx)(ho,{isSegment:!0,role:"option",onClick:b({vertical:G.Q4P.Bottom}),"aria-selected":w===G.Q4P.Bottom,selected:w===G.Q4P.Bottom,startIcon:(0,i.jsx)(Yt,{})})]}),(0,i.jsx)(co,{children:p("sidebar.style")}),(0,i.jsxs)(io,{children:[(0,i.jsx)(ao,{"data-testid":"sidebar_button_display",selected:(0,At.Z)(I,[Vt.L$]),onClick:()=>{(0,Ht.U9)(u,Vt.L$,!0)},children:p("sidebar.display")}),(0,i.jsx)(ro,{"data-testid":"sidebar_button_title",selected:(0,At.Z)(I,[Vt.Ch]),onClick:()=>{(0,Ht.U9)(u,Vt.Ch,!0)},children:p("sidebar.title")})]}),(0,i.jsxs)(io,{children:[(0,i.jsx)(lo,{"data-testid":"sidebar_button_heading",selected:(0,At.Z)(I,[Vt.r3]),onClick:()=>{(0,Ht.U9)(u,Vt.r3,!0)},children:p("sidebar.heading")}),(0,i.jsx)(so,{"data-testid":"sidebar_button_subheading",selected:(0,At.Z)(I,[Vt.yq]),onClick:()=>{(0,Ht.U9)(u,Vt.yq,!0)},children:p("sidebar.subheading")})]}),(0,i.jsxs)(io,{children:[(0,i.jsx)(uo,{"data-testid":"sidebar_button_body",selected:(0,At.Z)(I,[Vt.JB]),onClick:()=>{(0,Ht.U9)(u,Vt.JB,!0)},children:p("sidebar.body")}),(0,i.jsx)(mo,{"data-testid":"sidebar_button_caption",selected:(0,At.Z)(I,[Vt.Oo]),onClick:()=>{(0,Ht.U9)(u,Vt.Oo,!0)},children:p("sidebar.caption")})]}),(0,i.jsx)(co,{children:p("sidebar.lists")}),(0,i.jsxs)(io,{children:[(0,i.jsx)(uo,{"data-testid":"sidebar_button_bulleted",selected:(0,Ht.ku)(u,Vt.qR),onClick:()=>{(0,Ht.th)(u,Vt.qR,!0)},startIcon:(0,i.jsx)(Ft.Z,{})}),(0,i.jsx)(uo,{"data-testid":"sidebar_button_numbered",selected:(0,Ht.ku)(u,Vt.y1),onClick:()=>{(0,Ht.th)(u,Vt.y1,!0)},startIcon:(0,i.jsx)(Gt.Z,{})})]}),(0,i.jsx)(co,{children:p("sidebar.colors")}),(0,i.jsx)(io,{children:(0,i.jsx)(eo.EL,{onChange:e=>(0,Ht.z_)(u,e),editor:u})}),m&&(0,i.jsxs)(i.Fragment,{children:[(0,i.jsx)(co,{children:p("sidebar.backgroundImage")}),(0,i.jsxs)(io,{children:[(0,i.jsx)(po,{onClick:f,children:p("sidebar.upload")}),!h&&(0,i.jsx)(po,{"data-testid":"clear_background_image_button",onClick:x,children:p("sidebar.clear")})]}),(0,i.jsx)("input",{"data-testid":"add_background_image_sidebar_input",ref:g,type:"file",accept:W.lW,onChange:v,style:{display:"none"}})]})]})},fo=o(25854),xo=o(89755),vo=o.n(xo);const bo=g.ZP.div.withConfig({displayName:"ImageCardList__CardListWrapper",componentId:"sc-2a970e7b-0"})``;function yo(e){let t,o;switch(e){case G.h7B.Square:t=103,o=103;break;case G.h7B.Widescreen:t=216,o=121;break;case G.h7B.Vertical:t=103,o=183;break;case G.h7B.Ultrawide:t=216,o=92;break;case G.h7B.Portrait:t=103,o=128}return{width:t,height:o}}const wo=g.ZP.div.withConfig({displayName:"ImageCardList__PreviewDiv",componentId:"sc-2a970e7b-1"})`
  ${e=>{let{$dimensionType:t}=e;const{width:o,height:n}=yo(t);return`width: ${o}px; height: ${n}px;`}}
  border-radius: 8px;
  background-color: ${e=>{let{theme:t}=e;return t.colors.inputBg}};
  display: flex;
  justify-content: center;
  align-items: center;
`,To=(0,g.ZP)(wo).withConfig({displayName:"ImageCardList__GlimmerPreviewDiv",componentId:"sc-2a970e7b-2"})`
  animation: glimmer 1.36s infinite;

  animation-delay: ${e=>{let{index:t}=e;switch(t){case 0:default:return"0s";case 1:case 2:return"0.198s";case 3:return"0.395s"}}};
  background: linear-gradient(
    to bottom right,
    rgba(255, 255, 255, 0) 0%,
    rgba(255, 255, 255, 0) 32.65%,
    rgba(255, 255, 255, 0.2) 45.58%,
    rgba(255, 255, 255, 0) 60.74%,
    rgba(255, 255, 255, 0) 100%
  );
  background-size: 400px 400px;
  @keyframes glimmer {
    0% {
      background-position: -220px -220px;
    }
    100% {
      background-position: -10px -10px;
    }
  }
`,Io=[G.h7B.Ultrawide,G.h7B.Widescreen],Po=g.ZP.div.withConfig({displayName:"ImageCardList__CardList",componentId:"sc-2a970e7b-3"})`
  gap: 10px;
  display: grid;

  ${e=>{let{$dimensionType:t,columns:o}=e;return Io.includes(t)?"":`grid-template-columns: repeat(${o}, 1fr);`}}
`,Eo=g.ZP.div.withConfig({displayName:"ImageCardList__Card",componentId:"sc-2a970e7b-4"})`
  display: flex;
  column-span: 1;
  -webkit-column-break-inside: avoid;
  -moz-column-break-inside: avoid;
  border-radius: 8px;
  ${e=>{let{$dimensionType:t}=e;const{width:o,height:n}=yo(t);return`width: ${o}px; height: ${n}px;`}}
  border-width: 2px;
  border-width: ${e=>{let{selected:t}=e;return t?"2px":"0px"}};
  border-style: solid;
  border-color: ${e=>{let{selected:t,theme:o}=e;return t?o.colors.contentAccent:"transparent"}};
  img {
    width: 100%;
    height: 100%;
    border-radius: 8px;
  }
  cursor: ${e=>{let{disabled:t}=e;return t?"default":"pointer"}};
  content-visibility: auto;
`;var _o=e=>{let{images:t,selectedImage:o,dimensionType:n,onImageClick:a,loading:r=!1,columns:l,style:s}=e;var d;const c=r?[0,1,2,3].map((e=>({index:e,imagePath:`${e}`,imageUrlPreview:"",imageUrlTile:""}))):t,{width:u,height:p}=yo(n);return(0,i.jsx)(bo,{style:s,children:c&&(0,i.jsx)(Po,{$dimensionType:n,columns:l,children:null===(d=c)||void 0===d?void 0:d.map((e=>{var t,l,s,d;return(0,i.jsxs)(Eo,{$dimensionType:n,disabled:r,selected:(null===(t=o)||void 0===t?void 0:t.imagePath)===e.imagePath,onClick:()=>{r||a(e)},children:[!r&&(0,i.jsx)(vo(),{unoptimized:!0,width:u,height:p,alt:e.imagePath,src:e.imageUrlPreview,loader:(0,Se.T8)(e.imageUrlPreview),quality:50,draggable:!1,placeholder:"blur",blurDataURL:`data:image/svg+xml;base64,${s=103,d=103,l=`\n<svg width="${s}" height="${d}" version="1.1" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink">\n<path d="M0,0 h103 v103 h-103 v-103 a8,8 0 0 1 8,-8 z" fill="rgba(255, 255, 255, 0.1)" />\n</svg>`,window.btoa(l)}`}),r&&(0,i.jsx)(wo,{$dimensionType:n,children:(0,i.jsx)(To,{$dimensionType:n,index:e.index})})]},e.imagePath)}))})})};const jo=g.ZP.div.withConfig({displayName:"ImageGenerationHistory__RecordRow",componentId:"sc-ba74f027-0"})``,ko=(0,g.ZP)(oe).withConfig({displayName:"ImageGenerationHistory__MinHeightPanelContent",componentId:"sc-ba74f027-1"})`
  height: 100%;
`,So=(0,g.ZP)(ie).withConfig({displayName:"ImageGenerationHistory__RecordRowText",componentId:"sc-ba74f027-2"})`
  line-height: 14px;
  height: auto;
  font-weight: 400;
  padding: 0px;
  margin-top: 12px;
  margin-bottom: 6px;
  user-select: text;
  cursor: text;

  & ::selection {
    background-color: ${e=>e.theme.colors.textSelection};
  }
`,Zo=e=>{let{record:t,setImage:o}=e;const n=(0,a.useCallback)((e=>{o({url:e.imagePath,prompt:t.prompt,generationId:t.id,generationCandidates:t.images||[],negativePrompt:t.negativePrompt??null,engineType:t.engineType||null,dimensionType:t.dimensionType??null,usedCustomNegativePrompt:t.usedCustomNegativePrompt??!1})}),[o,t.prompt,t.id,t.images,t.negativePrompt,t.engineType,t.dimensionType,t.usedCustomNegativePrompt]);return(0,i.jsxs)(jo,{children:[(0,i.jsx)(So,{children:`"${t.prompt}"`}),(0,i.jsx)(_o,{dimensionType:t.dimensionType??G.h7B.Square,images:t.images||[],onImageClick:n,columns:2})]})};var Ro=e=>{let{setImage:t}=e;var o,n;const r=(0,a.useRef)(new AbortController),{loading:l,data:s}=(0,G.Z5V)({fetchPolicy:"network-only",context:{fetchOptions:{signal:r.current.signal}}});return(0,a.useEffect)((()=>()=>{r.current.abort()}),[]),l?(0,i.jsx)(ko,{children:(0,i.jsx)(fo.Z,{shouldCenter:!0})}):s?(0,i.jsx)(oe,{children:null===(n=s.me)||void 0===n||null===(o=n.imageGenerationRecords)||void 0===o?void 0:o.map((e=>(0,i.jsx)(Zo,{record:e,setImage:t},e.id)))}):null},Oo=o(20195);var Mo=(0,a.forwardRef)(((e,t)=>(0,i.jsxs)(ye.Z,{ref:t,viewBox:"0 0 64 64",...e,children:[(0,i.jsx)("path",{d:"M34 20C34 18.8954 33.1046 18 32 18C30.8954 18 30 18.8954 30 20V32C30 32.5304 30.2107 33.0391 30.5858 33.4142L39.0858 41.9142C39.8668 42.6953 41.1332 42.6953 41.9142 41.9142C42.6953 41.1332 42.6953 39.8668 41.9142 39.0858L34 31.1716V20Z"}),(0,i.jsx)("path",{fillRule:"evenodd",clipRule:"evenodd",d:"M56 32C56 45.2548 45.2548 56 32 56C18.7452 56 8 45.2548 8 32C8 18.7452 18.7452 8 32 8C45.2548 8 56 18.7452 56 32ZM52 32C52 43.0457 43.0457 52 32 52C20.9543 52 12 43.0457 12 32C12 20.9543 20.9543 12 32 12C43.0457 12 52 20.9543 52 32Z"})]}))),$o=o(93996);const Lo=g.ZP.div.withConfig({displayName:"TextRowWithIconButton__RowContainer",componentId:"sc-54342e72-0"})`
  display: flex;
  // same spacing as PropertyRowText
  padding-top: 4px;
  padding-bottom: 8px;
`,Ao=g.ZP.div.withConfig({displayName:"TextRowWithIconButton__TextContainer",componentId:"sc-54342e72-1"})`
  font-size: ${e=>e.theme.fontSizes.xxs};
  // icon 14px + 3px top and bottom padding
  line-height: 20px;
  color: ${e=>e.theme.colors.contrast40};
  flex: 1;
`,No=g.ZP.div.withConfig({displayName:"TextRowWithIconButton__TipIconContainer",componentId:"sc-54342e72-2"})`
  width: 20px;
  height: 20px;
`;var Do=e=>{let{text:t,icon:o,onIconClick:n,tooltipText:a}=e;return(0,i.jsxs)(Lo,{children:[(0,i.jsx)(Ao,{children:t}),(0,i.jsx)(No,{children:(0,i.jsx)($o.Z,{content:a,placement:"left",children:(0,i.jsx)(Re.ZP,{variant:"uncontained",size:"small",icon:o,onClick:n,style:{padding:3,minWidth:"unset",height:"unset"}})})})]})},Bo=o(85017),Ho=o(82282),Vo=o(59140),Fo=o(8292),Go=o(45533);const Uo=g.ZP.button.withConfig({displayName:"DimensionTypeDropdown__DimensionDropdownButton",componentId:"sc-e251c8a7-0"})`
  width: 100%;
  color: ${e=>e.theme.colors.menuControlText};
  background-color: ${e=>e.theme.colors.inputBg};
  text-align: center;
  z-index: 1000000;
  display: flex;
  justify-content: center;
  align-items: center;
  border-radius: 8px;
  font-size: 12px;
  height: 28px;
  padding: 4px 8px;
  will-change: transform;
  cursor: pointer;

  svg {
    display: flex;
  }

  ${ye.K} {
    fill: ${e=>e.isActive?e.theme.colors.uiAccent:"currentColor"};
  }

  &:hover:enabled {
    background-color: ${e=>e.theme.colors.inputBgFocus};
    // default button style in browser dims the opacity to 0.8, override it.
    opacity: 1;
  }

  &[data-dropdown-option='true']:hover {
    color: ${e=>(0,Vo.VQ)(e)};
    background-color: ${e=>(0,Vo.jR)(e)};
  }

  &[data-state='open'] {
    background-color: ${e=>e.theme.colors.inputBgHover};
  }
`,zo=g.ZP.span.withConfig({displayName:"DimensionTypeDropdown__ButtonIconStyle",componentId:"sc-e251c8a7-1"})`
  display: flex;
  align-items: center;
  opacity: ${e=>e.disabled?.16:1};
  width: 100%;
  height: 100%;
`,Wo=g.ZP.span.withConfig({displayName:"DimensionTypeDropdown__DimensionDropdownButtonText",componentId:"sc-e251c8a7-2"})`
  flex: 1 0 auto;
  font-size: 12px;
  line-height: 12px;
  display: flex;
  align-items: center;
  padding: 0 4px;
`,Ko=g.ZP.div.withConfig({displayName:"DimensionTypeDropdown__ItemContainer",componentId:"sc-e251c8a7-3"})`
  width: 100%;
  display: flex;
  align-items: center;
  justify-content: space-between;
`,qo=g.ZP.div.withConfig({displayName:"DimensionTypeDropdown__ItemLabel",componentId:"sc-e251c8a7-4"})`
  flex: 0 0 auto;
  display: flex;
  align-items: center;
  font-size: 12px;
`,Yo=g.ZP.div.withConfig({displayName:"DimensionTypeDropdown__ItemCheckIcon",componentId:"sc-e251c8a7-5"})`
  flex: 0 0 auto;
  display: flex;
  align-items: center;
`;var Jo=e=>{let{disabled:t,containerRef:o,value:n,onChange:a,items:r}=e;var l;return(0,Go.Z)()?(0,i.jsxs)(Bo.h_,{modal:!1,children:[(0,i.jsx)(Bo.$F,{asChild:!0,disabled:t,"data-testid":"dimension_dropdown_trigger",children:(0,i.jsx)(Uo,{type:"button",disabled:t,children:(0,i.jsxs)(zo,{disabled:t,children:[(0,i.jsx)(Wo,{children:null===(l=r.find((e=>e.value===n)))||void 0===l?void 0:l.label}),(0,i.jsx)(Ho.Z,{style:{width:14,height:14}})]})})}),(0,i.jsx)(Bo.AW,{portalProps:{container:o.current},align:"start",avoidCollisions:!1,side:"bottom",sideOffset:8,style:{marginLeft:6,width:216,zIndex:550},"data-testid":"dimension_dropdown_content",children:r.map((e=>{let{label:t,value:o}=e;return(0,i.jsx)(Bo.Xi,{onSelect:()=>{a(o)},children:(0,i.jsxs)(Ko,{children:[(0,i.jsx)(qo,{children:t}),n===o&&(0,i.jsx)(Yo,{children:(0,i.jsx)(Fo.Z,{style:{width:16}})})]})},o)}))})]}):null};const Xo=(0,g.ZP)(d.E.div).withConfig({displayName:"ImageGenerationSidebar__AdvancedSettingsContainer",componentId:"sc-593411-0"})`
  will-change: height, opacity;
  overflow: hidden;
`,Qo=(0,g.ZP)(se).withConfig({displayName:"ImageGenerationSidebar__PromptInput",componentId:"sc-593411-1"})`
  height: 112px;
  padding-left: 12px;
`,en=(0,g.ZP)(se).withConfig({displayName:"ImageGenerationSidebar__NegativePromptInput",componentId:"sc-593411-2"})`
  height: 28px;
  padding: 6px 0 6px 12px;
`,tn={duration:.3,type:"spring",bounce:0};var on=e=>{let{tomeId:t,tileData:o,setImage:n,advancedSettingsVisible:s=!1}=e;var d,c,u,p,m,h,g,f,x,v;const{apolloClient:b}=(0,L.bp)(),y=(0,a.useRef)(null),w=(0,r.Zl)(V.ej);(0,$.Z)({ref:y,onResize:e=>{let{height:t}=e;"number"==typeof t&&w(t??1/0)}});const T=(0,a.useRef)(null),I=(0,a.useRef)(null),P=o.id,[j,k]=(0,r.FV)((0,V.$v)(P)),[S,Z]=(0,a.useState)((null===(d=o.imageTileData)||void 0===d?void 0:d.dimensionType)||G.h7B.Square),[R,O]=(0,a.useState)(!!(null===(c=o.imageTileData)||void 0===c?void 0:c.usedCustomNegativePrompt)),[M,A]=(0,a.useState)(R?(null===(u=o.imageTileData)||void 0===u?void 0:u.negativePrompt)??"":""),[N,D]=(0,r.FV)((0,V.L2)(P)),[B,H]=(0,r.FV)((0,V.xZ)(P)),F=!!(null===(p=B)||void 0===p?void 0:p.images)&&B.images.length>1,U=(0,a.useRef)(),[z,W]=(0,r.FV)((0,V.j3)(P)),{isBalanceLoading:K,refetchCurrentCreditBalance:q,attemptToPerformCreditsOperation:Y,handleGenerationError:J}=(0,Oo.KW)(),X=(0,a.useRef)(),[Q,{loading:ee,error:te}]=(0,G.Lre)({errorPolicy:"all",onCompleted:e=>{var t,n,i,a,r,l,s;(q(),e.generateImages&&U.current)&&(H({prevGenerationId:(null===(t=o.imageTileData)||void 0===t?void 0:t.generationId)||"",generationId:(null===(i=e)||void 0===i||null===(n=i.generateImages)||void 0===n?void 0:n.id)||"",prompt:U.current,images:(null===(r=e)||void 0===r||null===(a=r.generateImages)||void 0===a?void 0:a.images)||[],negativePrompt:M,engineType:(null===(s=e)||void 0===s||null===(l=s.generateImages)||void 0===l?void 0:l.engineType)||null,dimensionType:S,usedCustomNegativePrompt:R}),U.current=void 0)}});(0,a.useEffect)((()=>{J(te)}),[te,J]),(0,a.useEffect)((()=>()=>{var e;null===(e=X.current)||void 0===e||e.abort()}),[]),(0,a.useEffect)((()=>{z&&(W(null),D(z),Y(Oo.Cw.DALLE_TILE,(()=>{var e,o;U.current=z,null===(e=X.current)||void 0===e||e.abort(),X.current=new AbortController,Q({variables:{prompt:z,tileId:P,tomeId:t},context:{fetchOptions:{signal:null===(o=X.current)||void 0===o?void 0:o.signal}}})})))}),[z,W,P,t,Q,D,Y]);const oe=s||!!(null===(m=o.imageTileData)||void 0===m?void 0:m.dimensionType)&&o.imageTileData.dimensionType!==G.h7B.Square||!!(null===(h=o.imageTileData)||void 0===h?void 0:h.negativePrompt)&&R;(0,a.useEffect)((()=>{var e,t,n,i,a,r,l,s,d,c,u,p,m,h,g;(null===(e=o.imageTileData)||void 0===e?void 0:e.prompt)&&(!B&&!N||(null===(t=o.imageTileData)||void 0===t?void 0:t.generationId)&&(null===(n=o.imageTileData)||void 0===n?void 0:n.generationId)!==(null===(i=B)||void 0===i?void 0:i.prevGenerationId))&&(D(null===(a=o.imageTileData)||void 0===a?void 0:a.prompt),H({prevGenerationId:(null===(r=o.imageTileData)||void 0===r?void 0:r.generationId)||"",generationId:(null===(l=o.imageTileData)||void 0===l?void 0:l.generationId)||"",prompt:null===(s=o.imageTileData)||void 0===s?void 0:s.prompt,images:(null===(c=o.imageTileData)||void 0===c||null===(d=c.generationCandidates)||void 0===d?void 0:d.length)&&(null===(u=o.imageTileData)||void 0===u?void 0:u.generationCandidates)||[],negativePrompt:(null===(p=o.imageTileData)||void 0===p?void 0:p.negativePrompt)||"",engineType:(null===(m=o.imageTileData)||void 0===m?void 0:m.engineType)||null,usedCustomNegativePrompt:!!(null===(h=o.imageTileData)||void 0===h?void 0:h.usedCustomNegativePrompt),dimensionType:(null===(g=o.imageTileData)||void 0===g?void 0:g.dimensionType)||G.h7B.Square}));j.isDirty||k({isDirty:!0,value:oe})}),[]),(0,a.useEffect)((()=>{T.current&&(T.current.selectionStart=T.current.value.length,T.current.selectionEnd=T.current.value.length,T.current.focus())}),[]);const ae=(0,a.useCallback)((e=>{var o;if(null===(o=e)||void 0===o||o.preventDefault(),ee)return;const n=N;n&&Y(Oo.Cw.DALLE_TILE,(()=>{U.current=n,Q({variables:{prompt:n,tileId:P,tomeId:t,advancedOptions:{negativePrompt:M,dimension:S}}})}))}),[ee,N,M,S,Y,Q,P,t]),le=(0,E.t2)(),se=(0,a.useCallback)((()=>{l.v.addAction("openImageGenerativeHistory"),le.pushPropertyPanel(_.Z.IMAGE_GENERATION_HISTORY)}),[le]),ce=(0,a.useCallback)((e=>{var t,o,i,a,r,l,s,d,c;(null===(t=B)||void 0===t?void 0:t.generationId)&&(null===(o=B)||void 0===o?void 0:o.prompt)&&n({url:e.imagePath,prompt:null===(i=B)||void 0===i?void 0:i.prompt,generationId:null===(a=B)||void 0===a?void 0:a.generationId,generationCandidates:null===(r=B)||void 0===r?void 0:r.images,negativePrompt:(null===(l=B)||void 0===l?void 0:l.negativePrompt)??null,engineType:(null===(s=B)||void 0===s?void 0:s.engineType)||null,dimensionType:null===(d=B)||void 0===d?void 0:d.dimensionType,usedCustomNegativePrompt:null===(c=B)||void 0===c?void 0:c.usedCustomNegativePrompt})}),[n,B]),ue=(0,a.useCallback)((e=>{Z(e)}),[]),pe=(0,a.useMemo)((()=>j.isDirty?j.value:oe),[oe,j.isDirty,j.value]),me=(0,a.useCallback)((e=>{"Enter"===e.key?(e.preventDefault(),ae()):"Escape"===e.key&&le.closePropertyPanel()}),[le,ae]),he=(0,a.useCallback)((()=>{k((e=>(Ne.ZP.reportToggleImageAdvancedSettings({apolloClient:b,tomeId:t,tileId:P,mode:e.value?Ne.jv.OFF:Ne.jv.ON}),{...e,value:!e.value})))}),[b,t,P,k]),ge=ee||K(),{t:Ce}=(0,C.$G)();return(0,i.jsxs)("form",{ref:y,onSubmit:ae,children:[(0,i.jsx)(Do,{text:Ce("sidebar.imageGeneration.prompt"),tooltipText:Ce("sidebar.imageGeneration.historyTooltip"),icon:(0,i.jsx)(Mo,{}),onIconClick:se}),(0,i.jsx)(de,{children:(0,i.jsx)(Qo,{ref:T,disabled:ge,value:N,placeholder:Ce("sidebar.imageGeneration.imagePlaceholder"),rows:3,onKeyDown:me,onChange:e=>{D(e.target.value)}})}),(0,i.jsx)(ne,{children:(0,i.jsx)(Re.ZP,{type:"submit",style:{width:"100%"},disabled:0===N.trim().length||ge,children:Ce("sidebar.imageGeneration.generate")})}),(0,i.jsxs)(re,{children:[(0,i.jsx)("label",{htmlFor:"AdvancedSettingsToggle",children:Ce("sidebar.media.advanced")}),(0,i.jsx)(Be.Z,{inputId:"AdvancedSettingsToggle",width:"40px",height:"20px",onBgColor:!0,checked:pe,disabled:ge,onClick:he,onKeydown:me})]}),(0,i.jsxs)(Xo,{initial:{opacity:pe?1:0,height:pe?130:0},animate:{opacity:pe?1:0,height:pe?130:0},transition:tn,children:[(0,i.jsx)(ie,{children:Ce("sidebar.imageGeneration.negativePrompt")}),(0,i.jsx)(de,{children:(0,i.jsx)(en,{disabled:ge,ref:I,value:M,placeholder:Ce("sidebar.imageGeneration.negativePromptPlaceholder"),rows:1,onKeyDown:me,onChange:e=>{A(e.target.value),O(e.target.value.trim().length>0)}})}),(0,i.jsx)(ie,{children:Ce("sidebar.imageGeneration.dimension")}),(0,i.jsx)(ne,{children:(0,i.jsx)(Jo,{disabled:ee,containerRef:y,value:S,onChange:ue,items:[{value:G.h7B.Square,label:Ce("sidebar.imageGeneration.dimensionType.square")},{value:G.h7B.Widescreen,label:Ce("sidebar.imageGeneration.dimensionType.widescreen")},{value:G.h7B.Ultrawide,label:Ce("sidebar.imageGeneration.dimensionType.ultrawide")},{value:G.h7B.Vertical,label:Ce("sidebar.imageGeneration.dimensionType.vertical")},{value:G.h7B.Portrait,label:Ce("sidebar.imageGeneration.dimensionType.portrait")}]})})]},P),(ee||(null===(g=B)||void 0===g?void 0:g.images)&&B.images.length>1)&&(0,i.jsx)(_o,{style:{paddingBottom:"12px"},dimensionType:!ee&&F&&(null===(f=B)||void 0===f?void 0:f.dimensionType)?null===(x=B)||void 0===x?void 0:x.dimensionType:S,images:(null===(v=B)||void 0===v?void 0:v.images)||[],onImageClick:ce,loading:!!N&&ee,columns:2})]})},nn=o(40419),an=o(32587),rn=o(60057),ln=o(91829);var sn=e=>{let{tileId:t}=e;const o=Bt(),n=(0,ln.Oz)(),l=(0,H.Z)(t),s=(0,E.t2)(),d=(0,a.useCallback)((e=>{o&&((0,Ht.z_)(o,e),requestAnimationFrame((()=>{(0,nn.$Rk)(o)})))}),[o]),c=(0,ln.px)({editor:o}),u=(0,r.Zl)(rn.k);(0,a.useEffect)((()=>(u(!0),()=>{u(!1)})),[u]),(0,a.useEffect)((()=>{l&&t!==l&&s.popPropertyPanel()}),[t,l,s]);const p=(0,a.useCallback)((()=>{const e=c();return e.length?e[0]:"white"}),[c]);return(0,i.jsx)(an.default,{color:p(),setColor:d,setColorComplete:n})};const dn=g.ZP.div.withConfig({displayName:"WaterfallGrid__NoResultDiv",componentId:"sc-9357a76e-0"})`
  font-size: 11px;
  line-height: 14px;
  opacity: 0.4;
  padding: 2px;
`,cn=g.ZP.div.withConfig({displayName:"WaterfallGrid__Grid",componentId:"sc-9357a76e-1"})`
  display: flex;
  flex-direction: row;
  gap: ${e=>{let{$gap:t}=e;return t}}px;
`,un=g.ZP.div.withConfig({displayName:"WaterfallGrid__Column",componentId:"sc-9357a76e-2"})`
  display: flex;
  flex-direction: column;
  width: ${e=>{let{$width:t}=e;return t}}px;
  gap: ${e=>{let{$gap:t}=e;return t}}px;
`,pn=80,mn=140,hn=g.ZP.div.withConfig({displayName:"WaterfallGrid__ImagePlaceholderDiv",componentId:"sc-9357a76e-3"})`
  background-color: ${e=>{let{theme:t}=e;return t.colors.inputBg}};
  height: ${e=>{let{$height:t}=e;return t}}px;
  border-radius: 6px;
  margin-bottom: ${6}px;
`,gn=g.ZP.div.withConfig({displayName:"WaterfallGrid__ImagePlaceholderAttributionDiv",componentId:"sc-9357a76e-4"})`
  background-color: ${e=>{let{theme:t}=e;return t.colors.inputBg}};
  height: ${6}px;
  border-radius: 6px;
  width: 64px;
`,Cn=e=>{let{height:t}=e;return(0,i.jsxs)("div",{children:[(0,i.jsx)(hn,{$height:t}),(0,i.jsx)(gn,{})]})},fn=e=>{let{columnWidth:t,gap:o,items:n,loading:r,hasMore:l}=e;const[s,d]=(0,a.useState)([]),[c,u]=(0,a.useState)([]),p=(0,a.useRef)(0),m=(0,a.useRef)(0),h=(0,a.useRef)(new Set),g=(0,a.useRef)("");(0,a.useEffect)((()=>{const e=0===n.length||n.length>0&&n[0].query!==g.current;var t;e&&(g.current=(null===(t=n[0])||void 0===t?void 0:t.query)??"",p.current=0,m.current=0,h.current.clear());const o=[],i=[];for(const e of n)h.current.has(e.id)||(h.current.add(e.id),p.current<=m.current?(o.push(e.node),p.current+=e.height):(i.push(e.node),m.current+=e.height));d((t=>e?o:[...t,...o])),u((t=>e?i:[...t,...i]))}),[n,r]);const{t:f}=(0,C.$G)();return!l&&0===n.length&&!r?(0,i.jsx)(dn,{children:f("sidebar.imageSearch.noResult")}):(0,i.jsxs)(cn,{$gap:o,"data-testid":"waterfall_grid",children:[(0,i.jsxs)(un,{$width:t,$gap:o,"data-testid":"waterfall_grid_column",children:[s.map(((e,t)=>(0,i.jsx)(a.Fragment,{children:e},t))),l&&(0,i.jsxs)(a.Fragment,{children:[(0,i.jsx)(Cn,{height:mn}),(0,i.jsx)(Cn,{height:pn})]},"placeholder")]},1),(0,i.jsxs)(un,{$width:t,$gap:o,"data-testid":"waterfall_grid_column",children:[c.map(((e,t)=>(0,i.jsx)(a.Fragment,{children:e},t))),l&&(0,i.jsxs)(a.Fragment,{children:[(0,i.jsx)(Cn,{height:pn}),(0,i.jsx)(Cn,{height:mn})]},"placeholder")]},2)]})};var xn=(0,a.memo)(fn),vn=o(43985);function bn(e){return"UnsplashImageResult"===e.__typename}const yn=g.ZP.div.withConfig({displayName:"ImageSearchPreviewItem__Container",componentId:"sc-959b37ec-0"})`
  & > span {
    border-radius: 6px;
  }
`,wn=g.ZP.div.withConfig({displayName:"ImageSearchPreviewItem__Attribution",componentId:"sc-959b37ec-1"})`
  font-size: 11px;
  line-height: 14px;
  margin-top: 4px;
  height: ${14}px;
  overflow: hidden;
  white-space: nowrap;
  text-overflow: ellipsis;
  color: ${e=>{let{theme:t}=e;return t.colors.contrast40}};

  a {
    color: ${e=>{let{theme:t}=e;return t.colors.contrast40}};

    &:hover {
      color: ${e=>{let{theme:t}=e;return t.colors.contrast60}};
    }
  }
`,Tn=(0,g.ZP)(vo()).withConfig({displayName:"ImageSearchPreviewItem__StyledImage",componentId:"sc-959b37ec-2"})`
  border-radius: 6px;
  cursor: pointer;
`;var In,Pn=e=>{let{image:t,width:o,onImageSelect:n}=e;const r=o,l=Math.floor(t.height/t.width*r),s=(0,a.useMemo)((()=>{if(bn(t))return function(e,t,o){const n=(0,vn.x3)(e).result?e:"L99[Gh-@4TNFG1kXsko000Io-=t7",i=(0,vn.Jx)(n,t,o),a=document.createElement("canvas"),r=a.getContext("2d"),l=r.createImageData(t,o);return l.data.set(i),r.putImageData(l,0,0),a.toDataURL("image/jpeg",.7)}(t.blurHash,r,l)}),[t.__typename,l,r]),d=(0,a.useCallback)((()=>{n(t)}),[t,n]);return(0,i.jsxs)(yn,{"data-testid":"waterfall_grid_item",children:[(0,i.jsx)(Tn,{src:t.thumbnailUrl,alt:t.imageId,width:r,height:l,loader:(0,Se.T8)(t.thumbnailUrl),...s&&{blurDataURL:s,placeholder:"blur"},unoptimized:!0,onClick:d}),(0,i.jsx)(wn,{children:(0,i.jsx)("a",{target:"_blank",rel:"noreferrer",href:t.attributionUrl,children:t.attributionName})})]},t.imageId)};!function(e){e.UNKNOWN="UNKNOWN",e.UNSPLASH="UNSPLASH",e.GOOGLE_IMAGES="GOOGLE_IMAGES"}(In||(In={}));var En=function(e){let{tomeId:t,tileId:o,initialSearchQuery:n,setExternalImageUrl:r}=e;var l,s;const[d,c]=(0,a.useState)(n??""),[u,p]=(0,a.useState)(!0),m=(0,a.useRef)(null),h=(0,a.useRef)(null),[g,C]=(0,a.useState)([]),f=(0,E.t2)(),x=(0,D.W9)(D.TT.WEB_IMAGE_SEARCH),v=(0,a.useRef)([]),b=(0,a.useRef)(new AbortController),y=(0,a.useRef)(0),w=(0,a.useRef)(0),T=(0,a.useRef)(0),[I,{data:P,loading:_}]=(0,G.ySt)(),[j,{data:k,loading:S}]=(0,G.EUm)(),Z=x?S:_,[R]=(0,G.OlJ)(),O=(0,a.useCallback)((0,F.Z)((async e=>{if(v.current.length>0)return void B();if(!u)return;const n=e.trim();x?await j({variables:{tomeId:t,tileId:o,query:n,page:w.current+1},context:{fetchOptions:{signal:b.current.signal}}}):await I({variables:{tomeId:t,tileId:o,query:n,perPage:20,page:w.current+1},context:{fetchOptions:{signal:b.current.signal}}}),w.current+=1}),300),[I,o,t]),M=(0,a.useCallback)((e=>{b.current.abort(),b.current=new AbortController,w.current=0,cancelAnimationFrame(y.current),m.current&&(m.current.scrollTop=0),v.current=[],c(e.target.value),C([]),p(!0),O(e.target.value)}),[O]),$=(0,a.useCallback)((e=>{if(Z||!u)return void e.preventDefault();const t=m.current;t&&t.scrollHeight-t.scrollTop-t.clientHeight<=240&&O(d)}),[u,Z,d,O]),L=(0,a.useCallback)((e=>{let{imageId:n,imageUrl:i,downloadLocation:a}=e;r(i,d,In.UNSPLASH),R({variables:{tomeId:t,tileId:o,imageId:n,downloadLocation:a}})}),[r,d,R,t,o]),A=(0,a.useCallback)((e=>{let{imageUrl:t}=e;r(t,d,In.GOOGLE_IMAGES)}),[r,d]),N=(0,a.useCallback)((e=>{var t;"Enter"===e.key?(e.preventDefault(),null===(t=h.current)||void 0===t||t.blur()):"Escape"===e.key&&f.closePropertyPanel()}),[f]),B=(0,a.useCallback)((()=>{var e;T.current=(null===(e=m.current)||void 0===e?void 0:e.scrollTop)??0;const t=v.current.splice(0,20);C((e=>1===w.current?t:[...e,...t])),p(20===t.length)}),[]);return(0,a.useEffect)((()=>(O(d),h.current&&h.current.focus(),()=>{b.current.abort(),cancelAnimationFrame(y.current)})),[]),(0,a.useEffect)((()=>{var e,t,o;if(0===w.current||Z)return;const n=(null===(o=x?null===(e=k)||void 0===e?void 0:e.searchGoogleImages:null===(t=P)||void 0===t?void 0:t.searchUnsplashImages)||void 0===o?void 0:o.map((e=>{const t=Math.floor(e.height/e.width*102)+14,o=bn(e)?L:A;return{node:(0,i.jsx)(Pn,{image:e,width:102,onImageSelect:o}),height:t,id:e.imageId,query:d}})))??[];v.current.push(...n),B()}),[B,null===(l=k)||void 0===l?void 0:l.searchGoogleImages,x,Z,A,L,d,null===(s=P)||void 0===s?void 0:s.searchUnsplashImages]),(0,a.useEffect)((()=>{y.current=requestAnimationFrame((()=>{m.current&&(m.current.scrollTop=T.current)}))}),[g]),{inputOnChange:M,inputOnKeydown:N,handleScroll:$,loading:Z,query:d,queryInputRef:h,gridContainerRef:m,items:g,hasMoreItems:u}};const _n=(0,g.ZP)(de).withConfig({displayName:"ImageSearchSidebar__SearchContainer",componentId:"sc-5eaec66-0"})`
  display: flex;
  align-items: center;
`,jn=(0,g.ZP)(le).withConfig({displayName:"ImageSearchSidebar__QueryInput",componentId:"sc-5eaec66-1"})`
  height: 28px;
  line-height: 16px;
  font-size: 13px;
  padding: 6px 8px 6px 13px;
  flex: 0 0 auto;
`,kn=g.ZP.div.withConfig({displayName:"ImageSearchSidebar__GridContainer",componentId:"sc-5eaec66-2"})`
  overflow-y: scroll;
  height: ${436}px;
`;var Sn=e=>{let{tomeId:t,tileData:o,setExternalImageUrl:n}=e;var a;const r=(0,D.W9)(D.TT.WEB_IMAGE_SEARCH),{inputOnChange:l,inputOnKeydown:s,handleScroll:d,loading:c,query:u,queryInputRef:p,gridContainerRef:m,items:h,hasMoreItems:g}=En({tomeId:t,tileId:o.id,initialSearchQuery:null===(a=o.imageTileData)||void 0===a?void 0:a.searchQuery,setExternalImageUrl:n}),{t:f}=(0,C.$G)();return(0,i.jsxs)(i.Fragment,{children:[(0,i.jsx)(_n,{"data-testid":"image_search_container",children:(0,i.jsx)(jn,{ref:p,value:u,placeholder:f(r?"sidebar.imageSearch.queryInputPlaceholder.googleImages":"sidebar.imageSearch.queryInputPlaceholder.unsplash"),onChange:l,onKeyDown:s})}),(0,i.jsx)(kn,{ref:m,onScroll:d,"data-testid":"waterfall_grid_container",children:(0,i.jsx)(xn,{loading:c,items:h,columnWidth:102,gap:12,hasMore:g})})]})},Zn=o(62830),Rn=o.n(Zn);function On(e,t){return Math.floor(Math.random()*(t-e+1)+e)}const Mn={__typename:"Ellipse",type:G.DYs.Ellipse,x:0,y:0,height:144,width:144},$n={__typename:"Rectangle",type:G.DYs.Rectangle,x:0,y:0,height:144,width:144};var Ln=e=>{let{updateTileData:t}=e;const o=(0,a.useCallback)((()=>{const e=["Ellipse","Rectangle"],o=[G.DYs.Ellipse,G.DYs.Rectangle],n=On(0,1);t((t=>{var i,a;return{...t,drawingTileData:{layers:[...(null===(a=t)||void 0===a||null===(i=a.drawingTileData)||void 0===i?void 0:i.layers)||[],{__typename:e[n],id:Rn()(),type:o[n],x:On(-400,400),y:On(-400,400),height:On(30,150),width:On(30,150)}]}}}))}),[t]),n=(0,a.useCallback)((()=>{t((e=>{var t,o;return{...e,drawingTileData:{layers:[...(null===(o=e)||void 0===o||null===(t=o.drawingTileData)||void 0===t?void 0:t.layers)||[],{id:Rn()(),...$n}]}}}))}),[t]),r=(0,a.useCallback)((()=>{t((e=>{var t,o;return{...e,drawingTileData:{layers:[...(null===(o=e)||void 0===o||null===(t=o.drawingTileData)||void 0===t?void 0:t.layers)||[],{id:Rn()(),...Mn}]}}}))}),[t]);return(0,i.jsxs)("div",{"data-testid":"drawing_sidebar",style:{display:"flex",flexWrap:"wrap",gap:5},children:[(0,i.jsx)(Re.ZP,{onClick:o,children:"Add random shape"}),(0,i.jsx)(Re.ZP,{onClick:n,children:"Add rectangle"}),(0,i.jsx)(Re.ZP,{onClick:r,children:"Add ellipse"})]})};const An=p()((()=>Promise.resolve().then(o.bind(o,32587))),{loadableGenerated:{webpack:()=>[32587]}}),Nn=g.ZP.div.withConfig({displayName:"TileSidebar__TilePanelContainer",componentId:"sc-7a8bd204-0"})`
  width: 216px;
`,Dn=e=>{let{tomeId:t,pageId:o,tile:n,currentPanel:l,draggable:s,startDrag:d}=e;var c,u,p;const{apolloClient:h,clientId:g}=(0,L.bp)(),f=function(){const{query:{debug:e}}=(0,m.useRouter)();return"true"===e}(),{tileData:x,updateTileData:v}=(0,U.Z)(n,t),{t:b}=(0,C.$G)(),y=(0,r.Zl)((0,V.L2)(n.id)),w=(0,r.Zl)((0,V.xZ)(n.id)),{getActiveController:T}=(0,a.useContext)(X.Z),I=T(),P=(0,a.useMemo)((()=>{var e;return(null===(e=I)||void 0===e?void 0:e.isSingleTileRow(n.id))||!0}),[I,n.id]),E=(0,a.useCallback)((e=>{v((t=>({...t,mediaTileData:{...t.mediaTileData,backgroundColor:e}})))}),[v]),j=(0,a.useCallback)((e=>{let{url:t,prompt:o,generationId:n,generationCandidates:i,negativePrompt:a,engineType:r,usedCustomNegativePrompt:l,dimensionType:s}=e;var d,c;v((e=>({...e,contentLink:t,imageAttributes:{...e.imageAttributes,imagePath:t},imageTileData:{...e.imageTileData,searchQuery:null,prompt:o,generationId:n,generationCandidates:i,negativePrompt:a,engineType:r,dimensionType:s,usedCustomNegativePrompt:l},mediaTileData:{...e.mediaTileData,aspectRatio:null,fillCropCenterX:null,fillCropCenterY:null,fillCropScale:null,mediaFillType:G.EwX.Fill,mediaStatus:G.Jpv.Ready},fileUploadTileData:{uploadId:null,createdAt:null}}))),y(o),w({prevGenerationId:(null===(c=x)||void 0===c||null===(d=c.imageTileData)||void 0===d?void 0:d.generationId)||"",generationId:n,prompt:o,images:i,negativePrompt:a||null,engineType:r,dimensionType:s||G.h7B.Square,usedCustomNegativePrompt:l})}),[v,y,w,null===(u=x)||void 0===u||null===(c=u.imageTileData)||void 0===c?void 0:c.generationId]),k=(0,a.useCallback)(((e,t,o)=>{v((n=>({...n,contentLink:e,imageAttributes:{...n.imageAttributes,imagePath:e},imageTileData:{...n.imageTileData,searchQuery:t,source:o,prompt:null,generationId:null,generationCandidates:[],negativePrompt:null,dimensionType:null,usedCustomNegativePrompt:null},mediaTileData:{...n.mediaTileData,aspectRatio:null,fillCropCenterX:null,fillCropCenterY:null,fillCropScale:null,mediaFillType:G.EwX.Fill,mediaStatus:G.Jpv.Ready},fileUploadTileData:{uploadId:null,createdAt:null}})))}),[v]),S=(0,a.useCallback)((e=>{(0,K.Gs)(e,h,g)}),[h,g]),Z=(0,a.useMemo)((()=>(0,F.Z)((e=>S(e)),300)),[S]),R=(0,a.useMemo)((()=>z.KS.includes(x.type)?Z:S),[Z,S,x.type]);(0,Q.Z)({data:x,saveData:R});const O=(0,i.jsxs)(i.Fragment,{children:[l===_.Z.COLOR_PICKER&&((0,W.ck)(n.type)||n.type===G.YUT.Video)&&(0,i.jsx)(An,{color:(null===(p=x.mediaTileData)||void 0===p?void 0:p.backgroundColor)||W.M2,setColor:E}),l===_.Z.TEXT_COLOR_PICKER&&(0,i.jsx)(sn,{tileId:x.id}),l===_.Z.IMAGE_GENERATION_HISTORY&&n&&(0,i.jsx)(Ro,{setImage:j}),l===_.Z.IMAGE_EDIT&&n&&(0,i.jsx)(oe,{children:(0,i.jsx)(We,{pageId:o,tileData:x,updateTileData:v,pageController:I})}),l===_.Z.IMAGE_CREATE&&n&&(0,i.jsx)(oe,{style:{marginBottom:0},children:(0,i.jsx)(on,{tomeId:t,tileData:x,setImage:j})}),l===_.Z.IMAGE_SEARCH&&n&&(0,i.jsx)(oe,{style:{marginBottom:0},children:(0,i.jsx)(Sn,{tomeId:t,tileData:x,setExternalImageUrl:k})}),l===_.Z.TILE&&n&&(0,i.jsxs)(Nn,{children:[f&&(0,i.jsxs)(i.Fragment,{children:[(0,i.jsx)(ie,{children:"id"}),(0,i.jsx)(ne,{children:x.id}),(0,i.jsx)(ie,{children:"URL"}),(0,i.jsx)(ne,{children:x.contentLink})]}),("TEXT"===n.type||"TEXT_SLATE"===n.type)&&(0,i.jsx)(Co,{tomeId:t,pageId:o,pageController:I,tileData:x,updateTileData:v}),("IMAGE"===n.type||"GIPHY"===n.type||"IMAGE_GENERATIVE"===n.type)&&(0,i.jsx)(We,{pageId:o,tileData:x,updateTileData:v,pageController:I}),"VIDEO"===n.type&&(0,i.jsx)(Je,{tileData:x,updateTileData:v}),"TABLE"===n.type&&(0,i.jsx)(dt,{isSingleTileRow:P,tileData:x,updateTileData:v}),"DRAWING"===n.type&&(0,i.jsx)(Ln,{updateTileData:v}),z.KS.includes(n.type)&&(0,i.jsx)(gt,{tileData:x,updateTileData:v})]})]});let M=l,$=!1;if(l===_.Z.TILE){var A,N;const e=(0,z.An)(n.type)[0];M=null===(A=e)||void 0===A?void 0:A.label,$=!!(null===(N=e)||void 0===N?void 0:N.beta)}else l===_.Z.COLOR_PICKER?M=b("sidebar.tileSidebar.backgroundColorHeaderText"):l===_.Z.TEXT_COLOR_PICKER?M=b("sidebar.tileSidebar.textColorHeaderText"):l===_.Z.IMAGE_GENERATION_HISTORY?M=b("sidebar.tileSidebar.historyHeaderText"):l===_.Z.IMAGE_EDIT?M=b("sidebar.tileSidebar.editImageHeaderText"):l===_.Z.IMAGE_CREATE?M=b("sidebar.tileSidebar.createImageHeaderText"):l===_.Z.IMAGE_SEARCH&&(M=b("sidebar.tileSidebar.searchImageHeaderText"));return(0,i.jsx)(Lt,{hasHeader:!0,headerText:`${b("sidebar.header",{header:M})}`,contentNoPadding:l!==_.Z.TILE,panelContent:O,headerBetaTag:$,draggable:s,startDrag:d})};var Bn=e=>{let{tomeId:t,pageId:o,currentPanel:n,draggable:a,startDrag:r}=e;const l=J();return l?(0,i.jsx)(Dn,{tomeId:t,pageId:o,tile:l,currentPanel:n,draggable:a,startDrag:r}):null},Hn=o(21962),Vn=o(12464),Fn=o(35527),Gn=o(69806),Un=o(29605),zn=o(40663);const Wn=g.ZP.div.withConfig({displayName:"TileSelectionOption__TileOption",componentId:"sc-3e1ca604-0"})`
  // The position absolute is important so that the element can break out of the overflow scroll
  position: absolute;

  display: flex;
  flex-direction: column;
  align-items: center;
  background-color: transparent !important;
`,Kn=g.ZP.div.withConfig({displayName:"TileSelectionOption__TileContainer",componentId:"sc-3e1ca604-1"})`
  position: static;
  display: flex;
  justify-content: center;
`,qn=(0,g.ZP)(d.E.div).withConfig({displayName:"TileSelectionOption__OptionLabel",componentId:"sc-3e1ca604-2"})`
  font-weight: 400;
  font-size: ${e=>e.theme.fontSizes.xxs};
  color: ${e=>e.theme.colors.sidebarTileText};
  margin-top: 6px;
`,Yn=(0,g.ZP)(d.E.div).withConfig({displayName:"TileSelectionOption__OptionIcon",componentId:"sc-3e1ca604-3"})`
  width: 64px;
  height: 62px;
  display: inline-block;
  background-color: ${e=>e.$isDragging?e.theme.colors.sidebarTileDragging:e.theme.colors.sidebarTile};
  border-radius: 6px;
  display: flex;
  flex: none;
  transform: translate(0, 0);
  justify-content: center;
  align-items: center;
  flex-direction: column;
  border-width: 2px;
  border-color: ${e=>e.selected?e.theme.colors.contentAccent:e.theme.colors.transparent};
  border-style: solid;
  cursor: grab;

  svg {
    pointer-events: none;
    fill: ${e=>{let{theme:t}=e;return t.colors.sidebarTileIcon}};
  }

  &:hover {
    background-color: ${e=>{let{theme:t}=e;return t.colors.sidebarTileHover}};
  }
`,Jn=g.ZP.div.withConfig({displayName:"TileSelectionOption__AddTileIcon",componentId:"sc-3e1ca604-4"})`
  width: 26px;
  height: 26px;
  background: ${e=>e.theme.colors.contentAccent};
  border-radius: 99px;
  display: flex;
  align-items: center;
  justify-content: center;
  position: absolute;
  top: -13px;
  left: -13px;

  svg {
    fill: ${e=>{let{theme:t}=e;return t.colors.accentForeground}};
  }
`;var Xn=e=>{let{addNewTile:t,option:o,selectedType:n,tileData:l,onTileDragStart:s,onTileDragEnd:d}=e;var c;const u=(0,r.Zl)(R.LY),p=(0,r.Zl)(R.rQ),m=(0,r.sJ)(R.M9),[h,g]=(0,a.useState)(!1),[f,x]=(0,a.useState)(!1),[v,b]=(0,a.useState)({x:0,y:0}),y=(0,a.useRef)(null),w=(0,a.useMemo)((()=>(0,Vn.oD)()),[]),{scrollContainerIfNeeded:T,cancelAnyScrolling:E}=(0,Un.Z)(),_=(0,a.useCallback)(((e,t)=>{(Math.abs(t.offset.x)>8||Math.abs(t.offset.y)>8)&&s(),T(e)}),[T,s]),j=(0,a.useCallback)((()=>{E(),g(!1),u(null),p(!1)}),[E,p,u]);(0,a.useEffect)((()=>()=>{j()}),[j]);const k=(0,a.useCallback)((()=>{const e=y.current.getBoundingClientRect();x(!0),b({x:e.x,y:e.y}),g(!0),p(!0);const t={kind:Fn.A.ADD_TILE,createTileData:{type:o.value}};u(t)}),[o.value,p,u]),S=(0,a.useCallback)((()=>{d({dismiss:!m}),j()}),[j,m,d]),Z=(0,a.useCallback)((()=>{x(!1)}),[]),O={intital:{opacity:1,scale:1,width:64},addTile:{opacity:1,scale:.8,width:"horizontal"===(null===(c=m)||void 0===c?void 0:c.kind)?128:64}},{t:M}=(0,C.$G)();return(0,i.jsxs)(Kn,{children:[(0,i.jsxs)(Wn,{style:{...h?{pointerEvents:"none"}:{}},onClick:()=>t({tileType:o.value,additionalTileData:l,afterAddTileAction:zn.B.NONE}),children:[(0,i.jsx)(Vn.Nq,{node:w,children:(0,i.jsxs)(Yn,{ref:y,id:o.value,selected:o.value===n,$isDragging:h,onDragTransitionEnd:Z,drag:!0,dragSnapToOrigin:!0,onDrag:_,onDragStart:k,onDragEnd:S,dragTransition:{from:.001},dragPropagation:!0,initial:"intitial",variants:O,animate:h&&m?"addTile":"initial",transition:h&&m?P.iy:{duration:0},children:[h&&m&&(0,i.jsx)(Jn,{children:(0,i.jsx)(Xe.Z,{style:{width:"21px",height:"21px"}})}),(0,i.jsx)(o.icon,{style:{width:"24px",height:"24px"}}),(!h||h&&!m)&&(0,i.jsx)(qn,{children:`${M("sidebar.optionLabel",{option:o.label})}`})]})}),h||f?(0,i.jsx)(Gn.Z,{scaleToPage:!1,dragPosition:v,node:w,containerZIndex:I.C8}):(0,i.jsx)(Vn.t0,{node:w})]},o.value),(h||f)&&(0,i.jsx)(xt.Z,{})]})},Qn=o(69290),ei=o(849);const ti=e=>{let{tomeId:t,shouldSetPropertyPanel:o=!0,shouldFocusInput:n=!1}=e;const i=(0,r.sJ)(A.Vx),l=(0,E.t2)(),{apolloClient:s,clientId:d}=(0,L.bp)(),{getMainController:c}=(0,a.useContext)(X.Z),u=c(i),{exclusiveSelectTiles:p}=(0,V.N4)();return(0,r._8)((e=>{let{snapshot:a,set:r}=e;return e=>{let{tileType:c,additionalTileData:m={},afterAddTileAction:h}=e;var g,C;let f={kind:Qn.rw.END};const x=a.getLoadable(V.py).getValue(),v=u.getRowAndIndexOfLastTile(Array.from(x));x.size>0&&void 0!==(null===(g=v)||void 0===g?void 0:g.rowId)&&void 0!==(null===(C=v)||void 0===C?void 0:C.index)&&(f={kind:Qn.rw.EXISTING_ROW,rowId:v.rowId,newTileIdx:v.index+1});const b=(0,ei.x)(t,i,u,{type:c,...m},s,d,f);o&&l.setPropertyPanel(_.Z.TILE),b&&(p([b]),r((0,A.Eq)(b),!0),n&&r((0,V.pt)(b),!0),h!==zn.B.NONE&&r((0,zn.A)(b),{triggered:!0,action:h}))}}),[t,i,u,s,d,o,p,n,l])};var oi=o(51203),ni=o(97332);const ii=g.ZP.div.withConfig({displayName:"AddMoreTiles__Group",componentId:"sc-eb642b09-0"})`
  display: grid;
  grid-template-columns: 1fr 1fr;
  grid-template-rows: repeat(${e=>e.$numRows}, 62px);
  gap: 8px;
  padding: 8px 12px 12px;
  // Keep the scroll behavior in case of weird window dimensions.
  // If this is causing headaches we could also remove it.
  overflow-y: scroll;
  position: relative;
  max-height: ${e=>e.$maxHeight}px;
  min-height: ${e=>e.$minHeight}px;
  width: 160px;
`;var ai=e=>{let{tomeId:t,maxHeight:o,onTileDragStart:n,onTileDragEnd:r}=e;const{flags:l}=(0,a.useContext)(oi.Z),s=z.Cp.filter((e=>{var t;return!e.launchDarklyKey||(null===(t=l)||void 0===t?void 0:t[e.launchDarklyKey])})),d=Math.ceil(s.length/2),c=(0,a.useRef)(null),u={},[p,m]=(0,a.useState)(null),h=ti({tomeId:t}),g=64*d<o?64*d:o;return(0,i.jsx)(i.Fragment,{children:(0,i.jsx)(ni.Z,{exemptContainerRefs:c.current?[c.current.ref]:[],onClick:()=>{m(null)},children:(0,i.jsx)(ii,{$maxHeight:o,$minHeight:g,$numRows:d,children:s.map((e=>(0,i.jsx)(Xn,{option:e,addNewTile:h,selectedType:p,tileData:u,onTileDragStart:n,onTileDragEnd:r},e.value)))})})})},ri=o(69146);const li=g.ZP.div.withConfig({displayName:"AddTextTilePanel.styles__PanelContainer",componentId:"sc-b81adda4-0"})`
  margin: 0 12px 12px 12px;
  font-size: ${e=>e.theme.fontSizes.sm};
`,si=g.ZP.div.withConfig({displayName:"AddTextTilePanel.styles__TextTileOptionsContainer",componentId:"sc-b81adda4-1"})`
  display: flex;
  flex-direction: column;
  gap: 8px;
  padding-top: 8px;
`,di=g.ZP.div.withConfig({displayName:"AddTextTilePanel.styles__TextTileStyleButtonContainer",componentId:"sc-b81adda4-2"})`
  padding: 12px;
`,ci=g.ZP.div.withConfig({displayName:"AddTextTilePanel.styles__Heading",componentId:"sc-b81adda4-3"})`
  color: ${e=>{let{theme:t}=e;return t.colors.addTextHeadingColor}};
  font-size: 17px;
  font-weight: 500;
`,ui=g.ZP.div.withConfig({displayName:"AddTextTilePanel.styles__Body",componentId:"sc-b81adda4-4"})`
  color: ${e=>{let{theme:t}=e;return t.colors.addTextParagraphColor}};
  font-size: 13px;
  font-weight: 400;
`,pi=g.ZP.div.withConfig({displayName:"AddTextTilePanel.styles__List",componentId:"sc-b81adda4-5"})`
  color: ${e=>{let{theme:t}=e;return t.colors.addTextListColor}};
  font-size: 13px;
  font-weight: 400;
`,mi=g.ZP.div.withConfig({displayName:"AddTextTilePanel.styles__Caption",componentId:"sc-b81adda4-6"})`
  color: ${e=>{let{theme:t}=e;return t.colors.addTextCaptionColor}};
  font-size: 9px;
  font-weight: 400;
`,hi=g.ZP.div.withConfig({displayName:"AddMediaTilePanel__ButtonContainer",componentId:"sc-bccd5e04-0"})`
  display: flex;
  flex-direction: column;
  gap: 8px;
  align-items: center;
`;var gi=e=>{let{tomeId:t}=e;const{t:o}=(0,C.$G)(),{apolloClient:n,clientId:l}=(0,L.bp)(),s=(0,E.t2)(),{exclusiveSelectTiles:d}=(0,V.N4)(),{getActiveController:c}=(0,a.useContext)(X.Z),u=c(),p=ti({tomeId:t,shouldSetPropertyPanel:!0}),m=(0,a.useCallback)((()=>p({tileType:G.YUT.Image,afterAddTileAction:zn.B.CLICK_IMAGE_TILE_SEARCH_BUTTON})),[p]),h=(0,a.useCallback)((()=>p({tileType:G.YUT.Image,afterAddTileAction:zn.B.CLICK_IMAGE_TILE_CREATE_BUTTON})),[p]),g=(0,a.useRef)(null),f=(0,a.useCallback)((()=>{var e;null===(e=g.current)||void 0===e||e.click()}),[]),x=(0,r._8)((e=>{let{snapshot:o}=e;return function(e,i){let a=!(arguments.length>2&&void 0!==arguments[2])||arguments[2];if(!e.length||!u)return null;const r=o.getLoadable(A.Vx).getValue(),c=(0,ei.l)({tomeId:t,pageId:r,pageController:u,newTilesData:e,apolloClient:n,clientId:l,insertTileLocation:i});return d(c),a&&s.setPropertyPanel(_.Z.TILE),c}}),[t,u,n,l,d,s]),{onInsertFiles:v}=(0,ri.Z)({addTilesInPage:x}),b=(0,r._8)((e=>{let{snapshot:t}=e;return(e,o)=>{var n,i;if(!u)return;const a=t.getLoadable(V.py).getValue(),r=u.getRowAndIndexOfLastTile(Array.from(a));let l={kind:Qn.rw.END};t.getLoadable(V.$y).getValue()&&void 0!==(null===(n=r)||void 0===n?void 0:n.rowId)&&void 0!==(null===(i=r)||void 0===i?void 0:i.index)&&(l={kind:Qn.rw.EXISTING_ROW,rowId:r.rowId,newTileIdx:r.index+1}),v(o,l)}}),[v,u]),y=(0,a.useCallback)((e=>{if(e.target.files&&e.target.files.length>0){const t=Array.from(e.target.files);b(e,t)}}),[b]);return(0,i.jsx)(li,{children:(0,i.jsxs)(hi,{children:[(0,i.jsx)(Re.ZP,{onClick:f,"data-testid":"add_image_tile",children:o("sidebar.addMediaTilePanel.uploadButtonLabel")}),(0,i.jsx)("input",{ref:g,type:"file",multiple:!0,accept:`video/*, ${W.lW}`,onChange:y,style:{display:"none"}}),(0,i.jsx)(Re.ZP,{onClick:m,"data-testid":"add_image_search_tile",children:o("sidebar.addMediaTilePanel.searchButtonLabel")}),(0,i.jsx)(Re.ZP,{onClick:h,"data-testid":"add_image_generate_tile",children:o("sidebar.addMediaTilePanel.generateButtonLabel")})]})})},Ci=o(35383);const fi=(0,g.ZP)(d.E.div).withConfig({displayName:"DragAndDropAddTile__StyledLayoutOption",componentId:"sc-eaaac0e4-0"})`
  display: flex;
  flex: none;
  justify-content: center;
  align-items: center;
  flex-direction: column;
  cursor: grab;
`;var xi=e=>{let{onDragStart:t,onDragEnd:o,textTileData:n,children:l}=e;const s=(0,r.Zl)(R.LY),d=(0,r.Zl)(R.rQ),c=(0,r.sJ)(R.M9),[u,p]=(0,a.useState)(!1),[m,h]=(0,a.useState)(!1),[g,C]=(0,a.useState)({x:0,y:0}),f=(0,a.useRef)(null),x=(0,a.useMemo)((()=>(0,Vn.oD)()),[]),{scrollContainerIfNeeded:v,cancelAnyScrolling:b}=(0,Un.Z)(),y=(0,a.useCallback)(((e,o)=>{(Math.abs(o.offset.x)>8||Math.abs(o.offset.y)>8)&&t(),v(e)}),[v,t]),w=(0,a.useCallback)((()=>{b(),p(!1),s(null),d(!1)}),[b,d,s]);(0,a.useEffect)((()=>()=>{w()}),[w]);const T=(0,a.useCallback)((()=>{const e=f.current.getBoundingClientRect();h(!0),C({x:e.x,y:e.y}),p(!0),d(!0);const t={kind:Fn.A.ADD_TILE,createTileData:{type:G.YUT.Text,textTileData:{content:n}}};s(t)}),[d,s,n]),E=(0,a.useCallback)((()=>{o({dismiss:!c}),w()}),[w,c,o]),_=(0,a.useCallback)((()=>{h(!1)}),[]);return(0,i.jsxs)("div",{children:[(0,i.jsx)(Vn.Nq,{node:x,children:(0,i.jsx)(fi,{ref:f,onDragTransitionEnd:_,drag:!0,dragPropagation:!0,onDrag:y,onDragStart:T,onDragEnd:E,dragTransition:{from:.001},initial:"intitial",variants:{intital:{opacity:1,scale:1},addTile:{opacity:1,scale:.8}},animate:u&&c?"addTile":"initial",transition:u&&c?P.iy:{duration:0},children:l})}),u||m?(0,i.jsx)(Gn.Z,{scaleToPage:!1,dragPosition:g,node:x,containerZIndex:I.C8}):(0,i.jsx)(Vn.t0,{node:x})]})};const vi=g.ZP.div.withConfig({displayName:"TextTileStyleOption__StyledTextTileOption",componentId:"sc-411dcc1b-0"})`
  width: 136px;
  height: 68px;
  background-color: ${e=>e.theme.colors.sidebarTileV2};
  border-radius: ${e=>e.theme.borderRadius.xs};
  cursor: grab;
  &:hover {
    background-color: ${e=>{let{theme:t}=e;return t.colors.sidebarTileHover}};
  }
`;var bi=e=>{let{addNewTile:t,textType:o,textFormat:n,onTileDragStart:a,onTileDragEnd:r,dataTestId:l,children:s}=e;const d=(0,Ci.wj)(o,n);return(0,i.jsx)(xi,{onDragStart:a,onDragEnd:r,textTileData:d,children:(0,i.jsx)(vi,{"data-testid":l,onClick:()=>{t({tileType:G.YUT.Text,additionalTileData:{textTileData:{content:d}},afterAddTileAction:zn.B.NONE})},children:s})})};var yi=e=>{let{tomeId:t,onTileDragStart:o,onTileDragEnd:n}=e;const{t:a}=(0,C.$G)(),r=[{textType:Ci.yG.Heading,textFormat:Ci.SQ.Heading,dataTestId:"addTextTilePanelHeading",buttonText:a("sidebar.addTextTilePanel.heading"),buttonComponent:ci},{textType:Ci.yG.Body,dataTestId:"addTextTilePanelBody",buttonText:a("sidebar.addTextTilePanel.body"),buttonComponent:ui},{textType:Ci.yG.List,dataTestId:"addTextTilePanelList",buttonText:`•  ${a("sidebar.addTextTilePanel.list")}`,buttonComponent:pi},{textType:Ci.yG.Caption,dataTestId:"addTextTilePanelCaption",buttonText:a("sidebar.addTextTilePanel.caption"),buttonComponent:mi}],l=ti({tomeId:t,shouldSetPropertyPanel:!0});return(0,i.jsx)(li,{children:(0,i.jsx)(si,{children:r.map((e=>(0,i.jsx)(bi,{dataTestId:e.dataTestId,addNewTile:l,textType:e.textType,textFormat:e.textFormat,onTileDragStart:o,onTileDragEnd:n,children:(0,i.jsx)(di,{children:(0,i.jsx)(e.buttonComponent,{children:e.buttonText})})},e.textType)))})})},wi=o(1918),Ti=o(35951),Ii=o(85626);const Pi=104,Ei=g.ZP.div.withConfig({displayName:"OldTileSelectionOption__TileOption",componentId:"sc-21c72d27-0"})`
  // The position absolute is important so that the element can break out of the overflow scroll
  position: absolute;

  display: flex;
  flex-direction: column;
  align-items: center;
  background-color: transparent !important;
`,_i=g.ZP.div.withConfig({displayName:"OldTileSelectionOption__TileContainer",componentId:"sc-21c72d27-1"})`
  position: static;
  display: flex;
  justify-content: center;
`,ji=(0,g.ZP)(d.E.div).withConfig({displayName:"OldTileSelectionOption__OptionLabel",componentId:"sc-21c72d27-2"})`
  font-weight: 500;
  font-size: ${e=>e.theme.fontSizes.xxs};
  color: ${e=>e.theme.colors.sidebarTileText};
`,ki=(0,g.ZP)(d.E.div).withConfig({displayName:"OldTileSelectionOption__OptionIcon",componentId:"sc-21c72d27-3"})`
  width: ${Pi}px;
  height: ${Pi}px;
  display: inline-block;
  background-color: ${e=>e.$isDragging?e.theme.colors.sidebarTileDragging:e.theme.colors.sidebarTile};
  border-radius: 16px;
  display: flex;
  flex: none;
  transform: translate(0, 0);
  justify-content: center;
  align-items: center;
  flex-direction: column;
  border-width: 2px;
  border-color: ${e=>e.selected?e.theme.colors.contentAccent:e.theme.colors.transparent};
  border-style: solid;
  cursor: grab;

  svg {
    pointer-events: none;
    fill: ${e=>{let{theme:t}=e;return t.colors.sidebarTileIcon}};
  }

  &:hover {
    background-color: ${e=>{let{theme:t}=e;return t.colors.sidebarTileHover}};
  }
`,Si=g.ZP.div.withConfig({displayName:"OldTileSelectionOption__AddTileIcon",componentId:"sc-21c72d27-4"})`
  width: 26px;
  height: 26px;
  background: ${e=>e.theme.colors.contentAccent};
  border-radius: 99px;
  display: flex;
  align-items: center;
  justify-content: center;
  position: absolute;
  top: -13px;
  left: -13px;

  svg {
    fill: ${e=>{let{theme:t}=e;return t.colors.accentForeground}};
  }
`;var Zi=e=>{let{addNewTile:t,option:o,selectedType:n,tileData:l,onTileDragStart:s,onTileDragEnd:d}=e;var c;const u=(0,r.Zl)(R.LY),p=(0,r.Zl)(R.rQ),m=(0,r.sJ)(R.M9),[h,g]=(0,a.useState)(!1),[f,x]=(0,a.useState)(!1),[v,b]=(0,a.useState)({x:0,y:0}),y=(0,a.useRef)(null),w=(0,a.useMemo)((()=>(0,Vn.oD)()),[]),{scrollContainerIfNeeded:T,cancelAnyScrolling:E}=(0,Un.Z)(),_=(0,a.useCallback)(((e,t)=>{(Math.abs(t.offset.x)>8||Math.abs(t.offset.y)>8)&&s(),T(e)}),[T,s]),j=(0,a.useCallback)((()=>{E(),g(!1),u(null),p(!1)}),[E,p,u]);(0,a.useEffect)((()=>()=>{j()}),[j]);const k=(0,a.useCallback)((()=>{const e=y.current.getBoundingClientRect();x(!0),b({x:e.x,y:e.y}),g(!0),p(!0);const t={kind:Fn.A.ADD_TILE,createTileData:{type:o.value}};u(t)}),[o.value,p,u]),S=(0,a.useCallback)((()=>{d({dismiss:!m}),j()}),[j,m,d]),Z=(0,a.useCallback)((()=>{x(!1)}),[]),O={intital:{opacity:1,scale:1,width:Pi},addTile:{opacity:1,scale:.8,width:"horizontal"===(null===(c=m)||void 0===c?void 0:c.kind)?208:Pi}},{t:M}=(0,C.$G)();return(0,i.jsxs)(_i,{children:[(0,i.jsxs)(Ei,{style:{...h?{pointerEvents:"none"}:{}},onClick:()=>t({tileType:o.value,additionalTileData:l,afterAddTileAction:zn.B.NONE}),children:[(0,i.jsx)(Vn.Nq,{node:w,children:(0,i.jsxs)(ki,{ref:y,id:o.value,selected:o.value===n,$isDragging:h,onDragTransitionEnd:Z,drag:!0,dragSnapToOrigin:!0,onDrag:_,onDragStart:k,onDragEnd:S,dragTransition:{from:.001},dragPropagation:!0,initial:"intitial",variants:O,animate:h&&m?"addTile":"initial",transition:h&&m?P.iy:{duration:0},children:[h&&m&&(0,i.jsx)(Si,{children:(0,i.jsx)(Xe.Z,{style:{width:"21px",height:"21px"}})}),(0,i.jsx)(o.icon,{}),(!h||h&&!m)&&(0,i.jsx)(ji,{children:`${M("sidebar.optionLabel",{option:o.label})}`})]})}),h||f?(0,i.jsx)(Gn.Z,{scaleToPage:!1,dragPosition:v,node:w,containerZIndex:I.C8}):(0,i.jsx)(Vn.t0,{node:w})]},o.value),(h||f)&&(0,i.jsx)(xt.Z,{})]})};const Ri=g.ZP.div.withConfig({displayName:"AddTileSelector__SearchContainer",componentId:"sc-69c04e74-0"})``,Oi=(0,g.ZP)(ee.Z).withConfig({displayName:"AddTileSelector__SearchInput",componentId:"sc-69c04e74-1"})`
  height: ${45}px;
  /* On Safari, the SearchInput expands beyond the property panel width - so we're setting a fixed width here. */
  width: 240px;
  padding: 12px 14px;
  background: transparent;
  margin-top: 0;
  font-size: ${e=>e.theme.fontSizes.md};
  line-height: 21px;
  border-top-left-radius: 16px;
  border-top-right-radius: 16px;
  border-bottom-left-radius: 0px;
  border-bottom-right-radius: 0px;
  border-bottom: ${e=>e.theme.colors.contrast8}
    ${1}px solid;
`,Mi=g.ZP.div.withConfig({displayName:"AddTileSelector__DragHint",componentId:"sc-69c04e74-2"})`
  display: flex;
  flex-direction: column;
  align-items: center;
  justify-content: center;
  height: 42px;
  font-size: ${e=>e.theme.fontSizes.xxs};
  color: ${e=>{let{theme:t}=e;return t.colors.sidebarTileDragHint}};
  ${e=>{let{theme:t}=e;return(0,Ti.Z)({base:t.colors.sidebarTileDragHint,highlight:t.colors.sidebarTileDragShimmerHighlight})}}
`,$i=g.ZP.div.withConfig({displayName:"AddTileSelector__Group",componentId:"sc-69c04e74-3"})`
  display: grid;
  grid-template-columns: 1fr 1fr;
  grid-template-rows: repeat(${e=>e.$numRows}, 102px);
  gap: 12px;
  padding: 0 12px 12px;
  overflow-y: scroll;
  position: relative;
  max-height: ${e=>e.$maxHeight}px;
  min-height: ${e=>e.$minHeight}px;
  width: 240px;
`;var Li=e=>{let{tomeId:t,maxHeight:o,onTileDragStart:n,onTileDragEnd:r}=e;const[l,s]=(0,a.useState)(""),{flags:d}=(0,a.useContext)(oi.Z),c=z.YM.filter((e=>{var t;return!e.launchDarklyKey||(null===(t=d)||void 0===t?void 0:t[e.launchDarklyKey])})),u=Math.ceil(c.length/2),p=(0,a.useRef)(null),m=(0,a.useRef)(null);(0,a.useEffect)((()=>{m.current&&m.current.select()}),[]);const h=c.filter((e=>{let{label:t,value:o}=e;return!(l&&!t.toLowerCase().includes(l.toLowerCase())&&!o.toLowerCase().includes(l.toLowerCase()))}));let g=h,f={};if(0===h.length){const e=(0,Ii.w)(l);e.tileType&&(g=c.filter((t=>t.value===e.tileType)),f={...f,...e.tileData})}const x=(0,E.t2)(),v=(0,a.useCallback)((()=>{l&&l.length>0?s(""):x.closePropertyPanel()}),[x,l]),[b,y]=(0,a.useState)(null);(0,a.useEffect)((()=>{l&&l.length>0&&g.length>0?y(g[0].value):y(null)}),[l]);const w=ti({tomeId:t}),T=(0,a.useCallback)((()=>{b&&w({tileType:b,additionalTileData:f,afterAddTileAction:zn.B.NONE})}),[b,f]),{onKeyDown:I}=(0,wi.Z)({options:g.map((e=>e.value)),selectedType:b,setSelectedType:y,didSelect:T,didEscape:v}),P=o-45-1,_=104*u<P?104*u:P,{t:j}=(0,C.$G)();return(0,i.jsx)(i.Fragment,{children:(0,i.jsx)(ni.Z,{exemptContainerRefs:p.current?[p.current.ref]:[],onClick:()=>{y(null)},children:(0,i.jsxs)(Ri,{children:[(0,i.jsx)(Oi,{type:"text",placeholder:j("sidebar.searchInput"),value:l,onChange:e=>s(e.target.value),onKeyDown:I,ref:m}),(0,i.jsx)(Mi,{children:j("sidebar.dragTilesHint")}),(0,i.jsx)($i,{$maxHeight:P,$minHeight:_,$numRows:u,children:g.map((e=>(0,i.jsx)(Zi,{option:e,addNewTile:w,selectedType:b,tileData:f,onTileDragStart:n,onTileDragEnd:r},e.value)))})]})})})},Ai=o(13847),Ni=o(36512);var Di=(0,a.forwardRef)(((e,t)=>(0,i.jsx)(ye.Z,{ref:t,viewBox:"0 0 64 64",...e,children:(0,i.jsx)("path",{d:"M56.7661 45.8477V45.8477C56.0186 46.1574 55.1582 45.9863 54.5861 45.4141L44.5861 35.4141V35.4141C44.211 35.0391 44.0002 34.5304 44.0001 34V30V30.0003C44.0001 29.4699 44.2108 28.9612 44.5859 28.5861L54.5859 18.5861H54.5859C55.367 17.8052 56.6334 17.8054 57.4143 18.5866C57.7892 18.9615 57.9998 19.47 57.9999 20.0002V44.0002V44.0003C57.9999 44.8089 57.513 45.538 56.766 45.8477L56.7661 45.8477ZM12 16H36V16C39.3137 16 42 18.6863 42 22V42C42 45.3137 39.3137 48 36 48H12V48C8.68629 48 6 45.3137 6 42V42V22V22C6 18.6863 8.68629 16 12 16H12Z"})})));var Bi=(0,a.forwardRef)(((e,t)=>(0,i.jsx)(ye.Z,{ref:t,viewBox:"0 0 64 64",...e,children:(0,i.jsx)("path",{d:"M34.0208 47.8686V52.0068H42.0208C43.1254 52.0068 44.0208 52.9023 44.0208 54.0068C44.0208 55.1114 43.1254 56.0068 42.0208 56.0068H22.0208C20.9162 56.0068 20.0208 55.1114 20.0208 54.0068C20.0208 52.9023 20.9162 52.0068 22.0208 52.0068H30.0208V47.8686C22.0241 46.8643 16.0241 40.0664 16.0208 32.0068V28.0068C16.0208 26.9023 16.9162 26.0068 18.0208 26.0068C19.1254 26.0068 20.0208 26.9023 20.0208 28.0068V32.0068C20.0208 38.6343 25.3934 44.0068 32.0208 44.0068C38.6482 44.0068 44.0208 38.6343 44.0208 32.0068V28.0068C44.0208 26.9023 44.9162 26.0068 46.0208 26.0068C47.1254 26.0068 48.0208 26.9023 48.0208 28.0068V32.0068V32.0058C48.018 40.0654 42.0185 46.8636 34.0218 47.8685L34.0208 47.8686ZM32.0208 40.0068C27.6025 40.0068 24.0208 36.4251 24.0208 32.0068V16.0068V16.0068C24.0208 11.5886 27.6025 8.00684 32.0208 8.00684C36.4391 8.00684 40.0208 11.5886 40.0208 16.0068V32.0068C40.0208 36.4251 36.4391 40.0068 32.0208 40.0068C32.0208 40.0068 32.0208 40.0068 32.0208 40.0068H32.0208Z"})})));const Hi=g.ZP.div.withConfig({displayName:"RecordingPanel__ButtonsContainer",componentId:"sc-1167a857-0"})`
  display: flex;
  flex-direction: row;
  margin-bottom: 14px;
  gap: 9px;
  margin-top: 11px;
`,Vi=g.ZP.span.withConfig({displayName:"RecordingPanel__RecordCircle",componentId:"sc-1167a857-1"})`
  background-color: #ff3434;
  height: 12px;
  width: 12px;
  border-radius: 6px;
  margin-right: 5px;
`,Fi=g.ZP.div.withConfig({displayName:"RecordingPanel__DevicePicker",componentId:"sc-1167a857-2"})`
  margin-bottom: 7px;
`;var Gi=e=>{let{videoStatus:t,tomeId:o,pageId:n,videoId:l}=e;const{t:s}=(0,C.$G)(),{apolloClient:d,clientId:c}=(0,L.bp)(),u=(0,r.sJ)(T.ep),p=(0,r.sJ)((0,$e.vw)(n)),m=(0,r.rb)((0,$e.vw)(n)),h=(0,r.Zl)(T.wo),[g,f]=(0,r.FV)(T.HV),[x,v]=(0,r.FV)(T.LW),b=(0,r.sJ)(T.jd),y=(0,r.sJ)(T.$6),w=(0,D.ye)(D.TT.NARRATION_VIDEO_OVERRIDE),I=(0,E.t2)(),P=!!p.localMediaUrl||t===G.Kwn.Ready,_=e=>e.startsWith("Default - ")?s("sidebar.recordingPanel.sameAsSystemMicrophoneDropdownItem"):e.replace(/ *\([^)]*\) */g,""),j="NONE"!==u,k=u===Ni.D.NOT_ALLOWED_ERROR,S=u===Ni.D.NOT_READABLE_ERROR,Z=u===Ni.D.UNSUPPORTED_BROWSER||u===Ni.D.OVERCONSTRAINED_ERROR,R=(0,a.useCallback)((()=>{m(),(0,Ai.Np)(o,n,d,c)}),[d,c,n,m,o]),O=p.inProgress;let M;return M=s(O?"sidebar.recordingPanel.uploading":P?"sidebar.recordingPanel.retake":"sidebar.recordingPanel.record"),(0,i.jsxs)(oe,{children:[w&&(0,i.jsxs)(i.Fragment,{children:[(0,i.jsx)(ie,{children:s("sidebar.media.muxVideoId")}),(0,i.jsx)(ne,{children:(0,i.jsx)(le,{type:"text",value:l||"",onChange:e=>{e.target.value&&(0,Ai.w8)(o,n,e.target.value,d,c,(()=>{(0,A.ak)({message:`${s("sidebar.recording.overrideMessage")}`})}))}})})]}),(0,i.jsx)(Fi,{children:(0,i.jsx)(be,{disabled:0===y.length||j,currentValue:g||"",options:y.map((e=>({value:e.deviceId,label:_(e.label)}))),onChange:e=>{f(e)},menuWidth:"100%",icon:Di,controlWidth:"100%",placeholder:s("sidebar.media.camera")})}),(0,i.jsx)(Fi,{children:(0,i.jsx)(be,{disabled:0===b.length||j,currentValue:x||"",options:b.map((e=>({value:e.deviceId,label:_(e.label)}))),onChange:e=>{v(e)},menuWidth:"100%",icon:Bi,controlWidth:"100%",placeholder:s("sidebar.media.microphone")})}),(0,i.jsxs)(Hi,{children:[(0,i.jsx)(Re.ZP,{disabled:O||j,"data-testid":"record_button","aria-label":s("sidebar.media.record"),onClick:()=>{h(!0),I.closePropertyPanel(),(0,A.oG)(!0)},iconOpacity:1,startIcon:O?(0,i.jsx)(i.Fragment,{}):(0,i.jsx)(Vi,{}),style:{width:"100%"},children:M}),P&&(0,i.jsx)(Re.ZP,{"data-testid":"delete_recording_button","aria-label":s("sidebar.media.delete"),onClick:R,children:s("sidebar.media.delete")})]}),Z&&(0,i.jsx)(ht,{tag:s("sidebar.media.unsupportedBrowserTag"),message:s("sidebar.media.unsupportedBrowserMessage")}),S&&(0,i.jsx)(ht,{tag:s("sidebar.media.cameraErrorTag"),message:s("sidebar.media.cameraErrorMessage")}),k&&(0,i.jsx)(ht,{tag:s("sidebar.media.permissionNeededTag"),message:s("sidebar.media.permissionNeededMessage")})]})},Ui=o(28648),zi=o(28670),Wi=o.n(zi),Ki=o(32265),qi=o(11612),Yi=o(18428),Ji=o(34959),Xi=o(33601);const Qi=(0,g.ZP)((e=>(0,i.jsx)(pe.Z,{...e}))).attrs({width:"8",height:"8",viewBox:"0 0 10 10"}).withConfig({displayName:"ThemeDropdown__DropdownArrow",componentId:"sc-90c7746e-0"})`
  align-self: middle;
  display: inline-flex;
  margin: 0.1em 0 0 0.35em;
  stroke: currentColor;
  flex-shrink: 0;
`,ea=g.ZP.div.withConfig({displayName:"ThemeDropdown__ThemeRow",componentId:"sc-90c7746e-1"})`
  display: flex;
  flex-direction: row;
  gap: 8px;
  align-items: center;
  font-size: ${e=>{let{theme:t}=e;return t.fontSizes.sm}};
`,ta=g.ZP.div.attrs((e=>{let{color:t,theme:o}=e;return{style:{backgroundColor:t,borderColor:(0,Ji.D1)({foregroundColorHex:t,backgroundColorHex:o.RAW_VALUES_LEGACY.menuBackgroundLayer[0]})}}})).withConfig({displayName:"ThemeDropdown__ThemeSwatch",componentId:"sc-90c7746e-2"})`
  display: inline-flex;
  flex-direction: column;
  flex-shrink: 0;
  justify-content: center;
  align-items: flex-start;
  width: 32px;
  height: 20px;
  border-radius: 3px;
  border-width: 1px;
  border-style: solid;
  text-align: left;
  padding-left: 4px;
`,oa=g.ZP.div.withConfig({displayName:"ThemeDropdown__ThemeTitle",componentId:"sc-90c7746e-3"})`
  font-size: 7px;
  line-height: 1;
  color: ${e=>{let{color:t}=e;return t}};
`,na=g.ZP.div.withConfig({displayName:"ThemeDropdown__ThemeBody",componentId:"sc-90c7746e-4"})`
  font-size: 6px;
  line-height: 1;
  color: ${e=>{let{color:t}=e;return t}};
`,ia=g.ZP.button.withConfig({displayName:"ThemeDropdown__ThemeDropdownTrigger",componentId:"sc-90c7746e-5"})`
  background: ${e=>{let{theme:t}=e;return t.colors.inputBg}};
  color: ${e=>{let{theme:t}=e;return t.colors.menuControlText}};
  border-radius: ${e=>{let{theme:t}=e;return t.borderRadius.xs}};
  padding: 6px;
  width: 100%;

  ${ta} {
    width: 48px;
    height: 28px;
    border-radius: ${e=>{let{theme:t}=e;return t.borderRadius.xs}};
    padding-left: 5px;
  }

  ${oa} {
    font-size: 9px;
  }

  ${na} {
    font-size: 7px;
  }

  svg {
    margin-left: auto;
    margin-right: 6px;
  }
`,aa=g.ZP.div.withConfig({displayName:"ThemeDropdown__ThemeName",componentId:"sc-90c7746e-6"})`
  ${te.wR}

  ${e=>{let{$isAnonymous:t}=e;return t&&"\n    font-style: italic;\n  "}}
`,ra=e=>{let{colors:t,children:o}=e;const{t:n}=(0,C.$G)();return(0,i.jsxs)(ea,{children:[(0,i.jsxs)(ta,{color:t.pageColor,children:[(0,i.jsx)(oa,{color:t.titleColor,children:n("themes.themeDropdownMenuItem.title")}),(0,i.jsx)(na,{color:t.bodyColor,children:n("themes.themeDropdownMenuItem.body")})]}),o]})};var la=e=>{let{selected:t,themes:o,onChange:n,dropdownProps:a}=e;const{height:r}=(0,B.Z)(),l=o.map((e=>new Xi.Z(e))).filter((e=>!e.isAnonymous)).map((e=>({id:e.id,checked:e.id===t,action:()=>n(e.id),text:(0,i.jsx)(ra,{colors:e.colors,children:(0,i.jsx)(aa,{$isAnonymous:e.isAnonymous,title:e.displayName,children:e.displayName})})}))),s=new Xi.Z(o.filter((e=>e.id===t))[0]);return(0,i.jsx)(Yi.Z,{menuWidth:216,menuPosition:"below",menuAlign:"left",maxHeight:Math.min(r?.5*r+50:500,500),itemsOrFn:l,...a,children:(0,i.jsx)(ia,{type:"button","data-testid":"theme_dropdown_trigger",children:s&&s.hasColors&&(0,i.jsxs)(ra,{colors:s.colors,children:[(0,i.jsx)(aa,{$isAnonymous:s.isAnonymous,title:s.displayName,children:s.displayName}),(0,i.jsx)(Qi,{"data-testid":"dropdown_arrow"})]})})})},sa=o(19712),da=o(25934),ca=o(55201),ua=o(83694);function pa(e){let{tomeId:t,pageId:o,colors:{bodyColor:n,pageColor:i,titleColor:a},headingTypeface:r,paragraphTypeface:l,apolloClient:s,clientId:d}=e;var c,u,p;const m=Rn()(),h=(0,da.Z)(),g=null===(c=s.cache.readFragment({id:`Tome:${t}`,fragment:G.bcy,fragmentName:"TomeOrgIdFragment"}).org)||void 0===c?void 0:c.id;(0,ca.L)(!!g,"Trying to create a theme and update its page, but was not able to retrieve an orgId from the cache",{tomeId:t,pageId:o});const C=[{operation:G.C8.CreateTheme,id:m,theme:{orgId:g,colors:{bodyColor:n,pageColor:i,titleColor:a},headingTypeface:r,paragraphTypeface:l,headingFontId:null===(u=r)||void 0===u?void 0:u.baseline.id,paragraphFontId:null===(p=l)||void 0===p?void 0:p.baseline.id}}];C.push({operation:G.C8.UpdatePage,id:o,page:{themeId:m}});const f={id:h,tomeId:t,clientId:d,apply:C,revert:ua.Q.buildRevertForOperations(C,s.cache)};ua.Q.submitMutation(s,f)}function ma(e){let{tomeId:t,pageId:o,previousThemeId:n,colors:{bodyColor:i,pageColor:a,titleColor:r},headingTypeface:l,paragraphTypeface:s,apolloClient:d,clientId:c}=e;var u,p,m;const h=Rn()(),g=(0,da.Z)(),C=null===(u=d.cache.readFragment({id:`Tome:${t}`,fragment:G.bcy,fragmentName:"TomeOrgIdFragment"}).org)||void 0===u?void 0:u.id;(0,ca.L)(!!C,"Trying to create a theme and update its page, but was not able to retrieve an orgId from the cache",{tomeId:t,pageId:o});const f=[{operation:G.C8.CreateTheme,id:h,theme:{orgId:C,colors:{bodyColor:i,pageColor:a,titleColor:r},headingTypeface:l,paragraphTypeface:s,headingFontId:null===(p=l)||void 0===p?void 0:p.baseline.id,paragraphFontId:null===(m=s)||void 0===m?void 0:m.baseline.id}}];f.push({operation:G.C8.UpdateTome,id:t,tome:{themeId:h}});d.cache.readFragment({id:`Tome:${t}`,fragment:G.s0Y,fragmentName:"TomePagesFragment"}).pages.forEach((e=>{n&&e.theme.id!==n||f.push({operation:G.C8.UpdatePage,id:e.id,page:{id:e.id,themeId:h}})}));const x=ua.Q.buildRevertForOperations(f,d.cache),v={id:g,tomeId:t,clientId:c,apply:f,revert:x};ua.Q.submitMutation(d,v)}function ha(e,t,o,n,i){var a;const r=(0,da.Z)(),l=null===(a=n.cache.readFragment({id:`Tome:${e}`,fragment:G.bcy,fragmentName:"TomeOrgIdFragment"}).org)||void 0===a?void 0:a.id,s=[{operation:G.C8.UpdateTheme,id:t,theme:o}],d={id:r,tomeId:e,clientId:i,apply:s,revert:ua.Q.buildRevertForOperations(s,n.cache)},c=[{operation:G.C8.UpdateTheme,id:t,theme:{orgId:l,...o}}],u={id:r,tomeId:e,clientId:i,apply:c,revert:ua.Q.buildRevertForOperations(c,n.cache)};ua.Q.submitMutation(n,d,u)}var ga=o(42002),Ca=o(714),fa=o(979),xa=o(72625);function va(e){var t,o,n;const i=(0,fa.j)(),{data:r}=(0,G.OXH)({variables:{tomeId:i}}),l=null===(n=r)||void 0===n||null===(o=n.tome)||void 0===o||null===(t=o.org)||void 0===t?void 0:t.typeFamilies;return(0,a.useCallback)((()=>{const t=e?(0,Hn.Fx)(e,l):(0,Hn.RE)(l);xa.Z.getInstance().loadFonts(t,!1)}),[e,l])}const ba=(0,g.ZP)((e=>(0,i.jsx)(pe.Z,{...e}))).attrs({width:8,height:8,viewBox:"0 0 10 10"}).withConfig({displayName:"FontDropdown__DropdownArrow",componentId:"sc-10aeb6b2-0"})`
  stroke: currentColor;
  min-width: 8px;
`,ya=g.ZP.div.withConfig({displayName:"FontDropdown__RowText",componentId:"sc-10aeb6b2-1"})`
  ${te.wR}
`,wa=g.ZP.div.withConfig({displayName:"FontDropdown__Row",componentId:"sc-10aeb6b2-2"})`
  display: flex;
  justify-content: space-between;
  gap: 8px;
  width: 88px;
  align-items: center;
  font-family: ${e=>{let{$font:t}=e;return t??"Inter"}}, 'Inter', sans-serif;
  font-weight: ${e=>{let{$weight:t}=e;return t??"normal"}};
`,Ta=(0,g.ZP)(Re.ZP).withConfig({displayName:"FontDropdown__DropdownTrigger",componentId:"sc-10aeb6b2-3"})`
  padding: 0px 8px;
  justify-content: flex-start;
  width: 100%;
  line-height: 16px;
`,Ia=e=>{let{value:t,items:o,onChange:n,dropdownProps:r}=e;var l,s;const{height:d}=(0,B.Z)(),c=[];for(const e of o){c.length>0&&c.push({type:"separator"}),e.name&&c.push({type:"label",text:e.name,paddingVertical:5,paddingHorizontal:8});for(const o of e.typeFamilies){var u;c.push({type:"option",id:o.name,checked:o.id===(null===(u=t)||void 0===u?void 0:u.id),action:()=>{n(o)},text:(0,i.jsx)(wa,{$font:o.family,children:o.name})})}}const p=va(),m=(0,a.useCallback)((()=>{p()}),[p]);return(0,i.jsx)(Yi.Z,{menuWidth:106,menuPosition:"below",menuAlign:"left",dynamicMenuWidth:216,maxHeight:Math.min(d?.5*d+50:500,500),itemsOrFn:c,dataTestId:null===(l=r)||void 0===l?void 0:l.dataTestId,onOpenDropdown:m,...r,children:(0,i.jsx)(Ta,{type:"button","data-testid":"typeFamily_dropdown_trigger",onMouseOver:m,children:(0,i.jsxs)(wa,{children:[(0,i.jsx)(ya,{children:null===(s=t)||void 0===s?void 0:s.name}),(0,i.jsx)(ba,{"data-testid":"typefaceWeight_dropdown_arrow"})]})})})},Pa=e=>{let{value:t,font:o,items:n,onChange:r,dropdownProps:l}=e;var s;const{height:d}=(0,B.Z)(),{t:c}=(0,C.$G)(),u=n.map((e=>{var n;return{id:e.id??e.weight.toString(),checked:e.weight===(null===(n=t)||void 0===n?void 0:n.weight),action:()=>{r(e)},text:(0,i.jsx)(wa,{$font:o,$weight:e.weight,children:e.variantName??c("themes.regularFontType")})}})),p=va(o),m=(0,a.useCallback)((()=>{p()}),[p]);return(0,i.jsx)(Yi.Z,{menuWidth:106,menuPosition:"below",menuAlign:"left",dynamicMenuWidth:216,maxHeight:Math.min(d?.5*d+50:500,500),itemsOrFn:u,onOpenDropdown:m,...l,children:(0,i.jsx)(Ta,{type:"button","data-testid":"typefaceWeight_dropdown_trigger",onMouseOver:m,children:(0,i.jsxs)(wa,{children:[(0,i.jsx)(ya,{children:(null===(s=t)||void 0===s?void 0:s.variantName)??c("themes.regularFontType")}),(0,i.jsx)(ba,{"data-testid":"typefaceWeight_dropdown_arrow"})]})})})};var Ea=o(9965);const _a=g.ZP.div.withConfig({displayName:"CustomizePanelColorPicker__ColorPickerBackground",componentId:"sc-cab0cee6-0"})`
  background-color: ${e=>e.theme.colors.sidebar};
  border-radius: 20px;
  width: ${240}px;
  display: flex;
  box-shadow: ${e=>{let{theme:t}=e;return t.colors.sheetBoxShadow}};
`,ja=g.ZP.div.withConfig({displayName:"CustomizePanelColorPicker__ColorPickerWrapper",componentId:"sc-cab0cee6-1"})`
  padding-top: 12px;
`;var ka=e=>{let{top:t,right:o,color:n,setColor:a,setColorComplete:r}=e;const{colorPickerContainerRef:l}=(0,sa.R)();return(0,i.jsx)(Ea.Z,{top:t,left:o-240,zIndex:I.y$,children:(0,i.jsx)(_a,{ref:l,onMouseDown:ct.Z,children:(0,i.jsx)(ja,{children:(0,i.jsx)(an.default,{color:n,setColor:a,setColorComplete:r})})})})};const Sa=g.ZP.div.withConfig({displayName:"styles__CustomColorButtonWrapper",componentId:"sc-a0a4b22f-0"})`
  display: flex;
  flex-wrap: wrap;
  gap: 8px;
`,Za=g.ZP.div.withConfig({displayName:"styles__ButtonWrapper",componentId:"sc-a0a4b22f-1"})`
  display: grid;
  grid-auto-flow: column;
  grid-auto-columns: minmax(0, 1fr);
  gap: 8px;
  width: 100%;
`,Ra=g.ZP.div.withConfig({displayName:"styles__StyledSegmentedControlsContainer",componentId:"sc-a0a4b22f-2"})`
  padding-bottom: 12px;
`,Oa=g.ZP.div.withConfig({displayName:"styles__Content",componentId:"sc-a0a4b22f-3"})`
  margin-top: 8px;
  margin-bottom: 12px;
`,Ma=g.ZP.div.withConfig({displayName:"styles__FontSection",componentId:"sc-a0a4b22f-4"})`
  display: grid;
  grid-auto-flow: column;
  grid-auto-columns: minmax(0, 1fr) minmax(0, 1fr);
  width: 100%;
  gap: 8px;
`,$a=g.ZP.div.withConfig({displayName:"styles__FontDropdownsSection",componentId:"sc-a0a4b22f-5"})`
  display: flex;
  flex-direction: column;
  gap: 6px;
`,La=g.ZP.label.withConfig({displayName:"styles__ToggleWrapper",componentId:"sc-a0a4b22f-6"})`
  display: flex;
  margin-left: auto;
  cursor: pointer;
  height: auto;
`,Aa=(0,g.ZP)(ie).withConfig({displayName:"styles__TextColorPropertyRowText",componentId:"sc-a0a4b22f-7"})`
  display: flex;
  padding-top: 12px;
  padding-top: 8px;
  padding-bottom: 0px;
  height: auto;

  & span {
    ${te.wR}
  }
`;var Na;!function(e){e.TOME="Tome",e.PAGE="Page"}(Na||(Na={}));var Da,Ba=e=>{let{panelMode:t,closeColorPicker:o,setPanelMode:n}=e;const a=(0,Xt.Z)((e=>()=>{o(),n(e)}),[o,n]),{t:r}=(0,C.$G)();return(0,i.jsx)(Ra,{children:(0,i.jsx)(Me,{role:"listbox","data-testid":"customize_panel_mode_toggle",children:Object.values(Na).map((e=>(0,i.jsx)(Re.ZP,{isSegment:!0,onClick:a(e),selected:t===e,children:e===Na.PAGE?r("sidebar.customizePanel.pageMode"):r("sidebar.customizePanel.tomeMode")},e)))})})};!function(e){e.PAGE_COLOR="pageColor",e.TITLE_COLOR="titleColor",e.BODY_COLOR="bodyColor",e.NONE="none"}(Da||(Da={}));var Ha;!function(e){e.HEADING="HEADING",e.PARAGRAPH="PARAGRAPH"}(Ha||(Ha={}));const Va=e=>{let{checked:t,onClick:o}=e;return(0,i.jsx)(La,{"data-disable-event-propagation":!0,children:(0,i.jsx)(Be.Z,{inputId:"customize_panel_auto_color_toggle",width:"21px",height:"12px",radius:4,checked:t,onBgColor:!0,onClick:e=>{e.currentTarget.blur(),o(e)}})})};var Fa;!function(e){e.UPDATE_COLOR="UPDATE_COLOR",e.UPDATE_COLORS="UPDATE_COLORS",e.UPDATE_ACTIVE_COLOR_PROPERTY="UPDATE_ACTIVE_COLOR_PROPERTY",e.UPDATE_ACTIVE_COLOR_CHANGE="UPDATE_ACTIVE_COLOR_CHANGE",e.UPDATE_HEADING_FONT_ID="UPDATE_HEADING_FONT_ID",e.UPDATE_PARAGRAPH_FONT_ID="UPDATE_PARAGRAPH_FONT_ID"}(Fa||(Fa={}));const Ga=(e,t)=>{switch(t.type){case Fa.UPDATE_ACTIVE_COLOR_PROPERTY:return{...e,[e.activeColorChange]:t.payload};case Fa.UPDATE_ACTIVE_COLOR_CHANGE:return e.activeColorChange===t.payload?e:{...e,activeColorChange:t.payload};case Fa.UPDATE_COLORS:return{...e,...t.payload};case Fa.UPDATE_HEADING_FONT_ID:return{...e,headingFontId:t.payload};case Fa.UPDATE_PARAGRAPH_FONT_ID:return{...e,paragraphFontId:t.payload};default:return e}},Ua=(0,g.ZP)(Re.ZP).withConfig({displayName:"CustomizePanel__EditThemeButton",componentId:"sc-493f2f6-0"})`
  padding-left: 12px;
  padding-right: 12px;
`;function za(e){const t=(0,Ca.Z)(e.pageColor);return Wi()(e.titleColor).hex()===Wi()(t.titleColor).hex()&&Wi()(e.bodyColor).hex()===Wi()(t.bodyColor).hex()}var Wa=e=>{let{tomeId:t,pageId:o,pageTheme:n,tomeTheme:r,fontData:l,nonTileSidebarRef:s}=e;var d,c,u,p,m,h,g,f,x,v,b,y,w,T,I,P,E,_,j,k,S,Z,R,O,M,$,A,N,B;const H=(0,a.useRef)(!1),V=(0,a.useMemo)((()=>new Xi.Z(n)),[n]),F=(0,a.useMemo)((()=>new Xi.Z(r)),[r]),[U,z]=(0,a.useState)(n.id===r.id?Na.TOME:Na.PAGE),W=U===Na.TOME?F:V,[K,q]=(0,a.useReducer)(Ga,{activeColorChange:Da.NONE,pageColor:W.colors.pageColor,titleColor:W.colors.titleColor,bodyColor:W.colors.bodyColor,headingFontId:null===(c=W.headingTypeface)||void 0===c||null===(d=c.baseline)||void 0===d?void 0:d.id,paragraphFontId:null===(p=W.paragraphTypeface)||void 0===p||null===(u=p.baseline)||void 0===u?void 0:u.id}),[Y,J]=(0,a.useState)(za(V.colors)),[X,Q]=(0,a.useState)(za(F.colors)),ee=U===Na.TOME?X:Y;(0,a.useEffect)((()=>{H.current||(J(za(V.colors)),Q(za(F.colors))),H.current=!1}),[V.colors,V.id,F.colors,F.id]);const{updateThemeCssVars:te}=(0,sa.R)(),ne=(0,D.ye)(D.TT.FONTS),ae=(0,Ki.m)(),{propertyPanelRef:re}=(0,L.TR)(),{clientId:le,apolloClient:se}=(0,L.bp)(),de=(0,a.useCallback)((e=>{!function(e){let{tomeId:t,pageId:o,themeId:n,previousThemeId:i,apolloClient:a,clientId:r}=e;var l;const s=(0,da.Z)(),d=Xi.Z.fromCacheFragment(i,a.cache),c=[{operation:G.C8.UpdatePage,id:o,page:{themeId:n,autoThemeColor:!0}}];(null===(l=d)||void 0===l?void 0:l.isAnonymous)&&c.push({operation:G.C8.DeleteTheme,id:i});const u={id:s,tomeId:t,clientId:r,apply:c,revert:ua.Q.buildRevertForOperations(c,a.cache)};ua.Q.submitMutation(a,u)}({tomeId:t,pageId:o,themeId:e,previousThemeId:V.id,apolloClient:se,clientId:le}),J(za(V.colors))}),[se,le,V.id,V.colors,o,t]),ce=(0,a.useCallback)((()=>{q({type:Fa.UPDATE_ACTIVE_COLOR_CHANGE,payload:Da.NONE})}),[]),{data:ue,loading:pe}=(0,G.CHH)({variables:{tomeId:t},fetchPolicy:"cache-and-network",nextFetchPolicy:"cache-first"}),me=(null===(g=ue)||void 0===g||null===(h=g.tome)||void 0===h||null===(m=h.org)||void 0===m?void 0:m.themes)??[],{data:he}=(0,G.hC_)({variables:{tomeId:t,pageId:o},fetchPolicy:"cache-and-network",nextFetchPolicy:"cache-first"}),ge=null===(x=he)||void 0===x||null===(f=x.page)||void 0===f?void 0:f.theme,Ce=null===(b=he)||void 0===b||null===(v=b.tome)||void 0===v?void 0:v.theme,{data:fe}=(0,G.sn6)({variables:{tomeId:t}}),xe=(0,Ui.Z)([...me,...ge?[ge]:[]],(e=>e.id)),ve=(0,Ui.Z)([...me,...Ce?[Ce]:[]],(e=>e.id));(0,a.useEffect)((()=>{q({type:Fa.UPDATE_COLORS,payload:{pageColor:W.colors.pageColor,titleColor:W.colors.titleColor,bodyColor:W.colors.bodyColor}})}),[W.colors.pageColor,W.colors.titleColor,W.colors.bodyColor]),(0,a.useEffect)((()=>{var e,t;q({type:Fa.UPDATE_HEADING_FONT_ID,payload:null===(t=W.headingTypeface)||void 0===t||null===(e=t.baseline)||void 0===e?void 0:e.id})}),[null===(w=W.headingTypeface)||void 0===w||null===(y=w.baseline)||void 0===y?void 0:y.id]),(0,a.useEffect)((()=>{var e,t;q({type:Fa.UPDATE_PARAGRAPH_FONT_ID,payload:null===(t=W.paragraphTypeface)||void 0===t||null===(e=t.baseline)||void 0===e?void 0:e.id})}),[null===(I=W.paragraphTypeface)||void 0===I||null===(T=I.baseline)||void 0===T?void 0:T.id]);const be=(0,a.useCallback)((e=>{if(!e)return;const t=e.trim();return(0,ga.B)(t||"")?Wi()(t).hex():void 0}),[]),ye=(0,a.useCallback)(((e,t)=>{const o={pageColor:K.pageColor,titleColor:K.titleColor,bodyColor:K.bodyColor,...K.activeColorChange!==Da.NONE&&{[K.activeColorChange]:e}};if(t){const{titleColor:t,bodyColor:n}=(0,Ca.Z)(e);o.bodyColor=n,o.titleColor=t}return{colors:o}}),[K.activeColorChange,K.titleColor,K.pageColor,K.bodyColor]),we=(0,a.useCallback)(((e,n)=>{const i=be(e);if(!i)return;const{colors:a}=ye(i,n);switch(U){case Na.TOME:F.isAnonymous?ha(t,F.id,{colors:a},se,le):ma({tomeId:t,pageId:o,previousThemeId:F.id,colors:a,headingTypeface:F.headingTypeface,paragraphTypeface:F.paragraphTypeface,apolloClient:se,clientId:le});break;case Na.PAGE:V.isAnonymous&&V.id!==F.id?ha(t,V.id,{colors:a},se,le):pa({tomeId:t,pageId:o,colors:a,headingTypeface:V.headingTypeface,paragraphTypeface:V.paragraphTypeface,apolloClient:se,clientId:le})}H.current=!0}),[be,ye,U,F.isAnonymous,F.id,V.isAnonymous,V.id,F.headingTypeface,F.paragraphTypeface,V.headingTypeface,V.paragraphTypeface,t,o,se,le]),Te=(0,a.useCallback)((()=>{if(U===Na.PAGE){const e=!Y;za(V.colors)||we(K.pageColor,e),J(e)}if(U===Na.TOME){const e=!X;za(F.colors)||we(K.pageColor,e),Q(e)}}),[U,Y,V.colors,we,K.pageColor,X,F.colors]),Ie=(0,a.useCallback)((e=>{const t=be(e);if(!t)return;const o=K.activeColorChange===Da.PAGE_COLOR&&ee,{colors:n}=ye(t,o);q({type:Fa.UPDATE_COLORS,payload:n}),U===Na.TOME&&te(F.id,n),U===Na.PAGE&&te(V.id,n)}),[ye,be,te,U,F.id,V.id,K.activeColorChange,ee]),Pe=(0,a.useCallback)((e=>{null!==e.target.closest("[data-disable-event-propagation]")||K.activeColorChange===Da.NONE||q({type:Fa.UPDATE_ACTIVE_COLOR_CHANGE,payload:Da.NONE})}),[K.activeColorChange]),{headingFontId:Ee,paragraphFontId:_e}=K,je=(0,a.useMemo)((()=>(0,Hn.Rk)(l,Ee,Hn.uF)),[l,Ee]),ke=(0,a.useMemo)((()=>{var e;if(Ee){const e=l.fontIDToFontDataMap[Ee];if(e)return e}return(0,Hn.AK)(null===(e=l.typeFamilyToWeightsDataMap[Hn.uF])||void 0===e?void 0:e.normal,Hn.dR,"ROUND_UP")}),[Ee,l.fontIDToFontDataMap,l.typeFamilyToWeightsDataMap]),Se=(0,a.useMemo)((()=>(0,Hn.Rk)(l,_e,Hn.yc)),[l,_e]),Ze=(0,a.useMemo)((()=>{var e;if(_e){const e=l.fontIDToFontDataMap[_e];if(e)return e}return(0,Hn.AK)(null===(e=l.typeFamilyToWeightsDataMap[Hn.yc])||void 0===e?void 0:e.normal,Hn.w2,"ROUND_DOWN")}),[_e,l.fontIDToFontDataMap,l.typeFamilyToWeightsDataMap]);(0,a.useEffect)((()=>{var e;const t=null===(e=s)||void 0===e?void 0:e.current;return t&&t.addEventListener("click",Pe),()=>{var e;null===(e=t)||void 0===e||e.removeEventListener("click",Pe)}}),[Pe,s]);const Re=(0,Xt.Z)((e=>t=>{t.stopPropagation();const o=e===K.activeColorChange?Da.NONE:e;q({type:Fa.UPDATE_ACTIVE_COLOR_CHANGE,payload:o})}),[K.activeColorChange]),Oe=(0,a.useCallback)((e=>{if(!e)return;const o=U===Na.TOME?F.id:V.id;ha(t,o,{name:e},se,le)}),[U,t,F.id,se,le,V.id]),Me=(0,a.useCallback)((e=>{e||(U===Na.PAGE&&J(!1),U===Na.TOME&&Q(!1))}),[U,J,Q]),$e=(0,a.useCallback)((e=>{const t=K.activeColorChange===Da.PAGE_COLOR;Me(t);we(e,t&&ee)}),[K.activeColorChange,Me,ee,we]),Le=null===(P=re.current)||void 0===P?void 0:P.getBoundingClientRect(),Ae=(0,a.useCallback)((e=>{!function(e,t,o,n,i){const a=[{operation:G.C8.UpdateTome,id:e,tome:{themeId:t}}];n.cache.readFragment({id:`Tome:${e}`,fragment:G.s0Y,fragmentName:"TomePagesFragment"}).pages.forEach((e=>{o&&e.theme.id!==o||a.push({operation:G.C8.UpdatePage,id:e.id,page:{id:e.id,themeId:t}})}));const r=ua.Q.buildRevertForOperations(a,n.cache),l={id:(0,da.Z)(),tomeId:e,clientId:i,apply:a,revert:r};ua.Q.submitMutation(n,l)}(t,e,F.id,se,le),Q(za(F.colors))}),[se,le,t,F.id,F.colors]),Ne=(0,a.useCallback)((()=>{de(F.id)}),[de,F.id]),De=U===Na.TOME?!F.isAnonymous:!V.isAnonymous,Be=(0,a.useCallback)((e=>n=>{const i=U===Na.TOME,a=e===Ha.HEADING,r=a?n.id:K.headingFontId,s=a?K.paragraphFontId:n.id,d=(0,Hn.QL)(l,r),c=(0,Hn.QL)(l,s);i&&!F.isAnonymous?ma({tomeId:t,pageId:o,previousThemeId:F.id,colors:{pageColor:F.colors.pageColor,titleColor:F.colors.titleColor,bodyColor:F.colors.bodyColor},headingTypeface:d,paragraphTypeface:c,apolloClient:se,clientId:le}):i||V.isAnonymous&&V.id!==F.id?ha(t,i?F.id:V.id,{headingTypeface:d,paragraphTypeface:c,headingFontId:r,paragraphFontId:s},se,le):pa({tomeId:t,pageId:o,colors:{pageColor:V.colors.pageColor,titleColor:V.colors.titleColor,bodyColor:V.colors.bodyColor},headingTypeface:d,paragraphTypeface:c,apolloClient:se,clientId:le}),q({type:a?Fa.UPDATE_HEADING_FONT_ID:Fa.UPDATE_PARAGRAPH_FONT_ID,payload:n.id})}),[se,le,K.headingFontId,K.paragraphFontId,l,o,V.colors.bodyColor,V.colors.pageColor,V.colors.titleColor,V.id,V.isAnonymous,U,t,F.colors.bodyColor,F.colors.pageColor,F.colors.titleColor,F.id,F.isAnonymous]),He=(0,a.useCallback)((e=>t=>{var o,n;const i=t,a=l.typeFamilyToWeightsDataMap[i.name].normal,r=e===Ha.HEADING,s=(0,Hn.AK)(a,r?(null===(o=ke)||void 0===o?void 0:o.weight)??Hn.dR:(null===(n=Ze)||void 0===n?void 0:n.weight)??Hn.w2,r?"ROUND_UP":"ROUND_DOWN");s&&(q({type:r?Fa.UPDATE_HEADING_FONT_ID:Fa.UPDATE_PARAGRAPH_FONT_ID,payload:s.id}),Be(e)(s))}),[null===(E=Ze)||void 0===E?void 0:E.weight,null===(_=ke)||void 0===_?void 0:_.weight,l.typeFamilyToWeightsDataMap,Be]),{t:Ve}=(0,C.$G)(),Fe=U===Na.TOME?"sidebar.tomeTheme":"sidebar.pageTheme";return(0,i.jsx)(oe,{children:(!pe||me.length>0)&&n&&xe&&(0,i.jsxs)(i.Fragment,{children:[(0,i.jsxs)(Oa,{children:[(0,i.jsx)(Ba,{panelMode:U,setPanelMode:z,closeColorPicker:ce}),(0,i.jsx)(ie,{children:Ve(Fe)}),U===Na.TOME?(0,i.jsx)(la,{selected:F.id,themes:ve,onChange:Ae}):(0,i.jsx)(la,{selected:V.id,themes:xe,onChange:de}),(0,i.jsx)(ie,{style:{marginTop:12},children:Ve("sidebar.page")}),(0,i.jsxs)(Sa,{children:[(0,i.jsx)(qi.Z,{color:K.pageColor,label:Ve("sidebar.background"),selected:K.activeColorChange===Da.PAGE_COLOR,onButtonClick:Re(Da.PAGE_COLOR),"data-disable-event-propagation":!0}),!ne&&(0,i.jsxs)("div",{style:{marginTop:4},children:[(0,i.jsx)(ie,{children:Ve("sidebar.textColor")}),(0,i.jsxs)(Sa,{children:[(0,i.jsx)(qi.Z,{color:K.titleColor,label:Ve("sidebar.heading"),selected:K.activeColorChange===Da.TITLE_COLOR,onButtonClick:Re(Da.TITLE_COLOR),"data-disable-event-propagation":!0}),(0,i.jsx)(qi.Z,{color:K.bodyColor,label:Ve("sidebar.paragraph"),selected:K.activeColorChange===Da.BODY_COLOR,onButtonClick:Re(Da.BODY_COLOR),"data-disable-event-propagation":!0})]}),(0,i.jsxs)(Aa,{children:[Ve("sidebar.autoColor"),U===Na.PAGE&&(0,i.jsx)(Va,{checked:Y,onClick:Te}),U===Na.TOME&&(0,i.jsx)(Va,{checked:X,onClick:Te})]})]}),ne&&(0,i.jsxs)(i.Fragment,{children:[(0,i.jsxs)(Ma,{style:{marginTop:8},children:[(0,i.jsxs)("div",{children:[(0,i.jsx)(ie,{children:Ve("sidebar.heading")}),(0,i.jsxs)($a,{children:[(0,i.jsx)(Ia,{value:je,items:l.typeFamilySections,onChange:He(Ha.HEADING),dropdownProps:{dataTestId:"heading_type_family_dropdown",rebuildMenuTrigger:`${l.typeFamilySections.length}}`}},"typeFamily"),(0,i.jsx)(Pa,{value:ke,font:null===(j=je)||void 0===j?void 0:j.family,items:je?l.typeFamilyToWeightsDataMap[je.name].normal:[],onChange:Be(Ha.HEADING),dropdownProps:{dataTestId:"heading_weight_dropdown",rebuildMenuTrigger:null===(k=je)||void 0===k?void 0:k.family}},"weight"),(0,i.jsx)(Sa,{children:(0,i.jsx)(qi.Z,{color:K.titleColor,label:Ve("sidebar.heading"),selected:K.activeColorChange===Da.TITLE_COLOR,onButtonClick:Re(Da.TITLE_COLOR),"data-disable-event-propagation":!0})})]})]},"heading"),(0,i.jsxs)("div",{children:[(0,i.jsx)(ie,{children:Ve("sidebar.paragraph")}),(0,i.jsxs)($a,{children:[(0,i.jsx)(Ia,{value:Se,items:l.typeFamilySections,onChange:He(Ha.PARAGRAPH),dropdownProps:{menuAlign:"right",dataTestId:"paragraph_type_family_dropdown",rebuildMenuTrigger:`${l.typeFamilySections.length}}`}},"typeFamily"),(0,i.jsx)(Pa,{value:Ze,font:null===(S=Se)||void 0===S?void 0:S.family,items:Se?l.typeFamilyToWeightsDataMap[Se.name].normal:[],onChange:Be(Ha.PARAGRAPH),dropdownProps:{menuAlign:"right",dataTestId:"paragraph_weight_dropdown",rebuildMenuTrigger:null===(Z=Se)||void 0===Z?void 0:Z.family}},"weight"),(0,i.jsx)(Sa,{children:(0,i.jsx)(qi.Z,{color:K.bodyColor,label:Ve("sidebar.paragraph"),selected:K.activeColorChange===Da.BODY_COLOR,onButtonClick:Re(Da.BODY_COLOR),"data-disable-event-propagation":!0})})]})]},"paragraph")]}),(0,i.jsxs)(Aa,{style:{paddingTop:0},children:[(0,i.jsx)("span",{children:Ve("sidebar.autoColor")}),U===Na.PAGE&&(0,i.jsx)(Va,{checked:Y,onClick:Te}),U===Na.TOME&&(0,i.jsx)(Va,{checked:X,onClick:Te})]})]}),(0,i.jsxs)(Za,{style:{marginTop:4},children:[U===Na.PAGE&&(0,i.jsx)(Ua,{onClick:Ne,disabled:V.id===F.id,children:Ve("sidebar.reset")}),(0,i.jsx)(Ua,{onClick:ae.open,disabled:De,children:Ve("sidebar.customizePanel.saveThemeButtonLabel")})]})]}),(0,i.jsx)(Ki.Z,{ref:ae.ref,title:`${Ve("sidebar.customizePanel.saveTheme")}`,subtitle:(null===(M=fe)||void 0===M||null===(O=M.tome)||void 0===O||null===(R=O.org)||void 0===R?void 0:R.name)?Ve("sidebar.customizePanel.subtitle",{context:"organization",organization:null===(N=fe)||void 0===N||null===(A=N.tome)||void 0===A||null===($=A.org)||void 0===$?void 0:$.name}):Ve("sidebar.customizePanel.subtitle"),primaryButtonText:Ve("sidebar.save"),onSubmit:Oe,placeholder:Ve("sidebar.themeName")})]}),K.activeColorChange!==Da.NONE&&(0,i.jsx)(ka,{top:(null===(B=Le)||void 0===B?void 0:B.top)||0,right:Le?Le.left-8:0,color:K[K.activeColorChange],setColor:Ie,setColorComplete:$e})]})})};var Ka=e=>{let{tome:t,page:o,currentPanel:n,maxHeight:r,onTileDragStart:l,onTileDragEnd:s,draggable:d,startDrag:c}=e;var u,p,m;const h=(0,a.useRef)(null),{data:g}=(0,G.OXH)({variables:{tomeId:t.id}}),f=(0,a.useMemo)((()=>{var e,t,o;return(0,Hn.Zq)(null===(o=g)||void 0===o||null===(t=o.tome)||void 0===t||null===(e=t.org)||void 0===e?void 0:e.typeFamilies)}),[null===(m=g)||void 0===m||null===(p=m.tome)||void 0===p||null===(u=p.org)||void 0===u?void 0:u.typeFamilies]),{t:x}=(0,C.$G)();let v=n,b=null,y=null;switch(n){case _.Z.ADD_TILE:y=(0,i.jsx)(Li,{tomeId:t.id,maxHeight:r,onTileDragStart:l,onTileDragEnd:s});break;case _.Z.ADD_MORE_TILES:v=x("sidebar.nonTileSidebar.moreTiles"),b=x("sidebar.nonTileSidebar.moreTilesSubheader"),y=(0,i.jsx)(ai,{tomeId:t.id,maxHeight:r,onTileDragStart:l,onTileDragEnd:s});break;case _.Z.ADD_TEXT_TILE:v=x("sidebar.addTextTilePanel.title"),b=x("sidebar.addTextTilePanel.subheader"),y=(0,i.jsx)(yi,{tomeId:t.id,onTileDragStart:l,onTileDragEnd:s});break;case _.Z.ADD_MEDIA_TILE:v=x("sidebar.addMediaTilePanel.title"),y=(0,i.jsx)(gi,{tomeId:t.id});break;case _.Z.RECORD:var w,T;v=x("sidebar.nonTileSidebar.record"),y=(0,i.jsx)(Gi,{videoStatus:null===(w=o.overlay)||void 0===w?void 0:w.videoStatus,tomeId:t.id,pageId:o.id,videoId:null===(T=o.overlay)||void 0===T?void 0:T.videoId});break;case _.Z.CUSTOMIZE:v=x("sidebar.nonTileSidebar.setTheme"),y=(0,i.jsx)(Wa,{nonTileSidebarRef:h,tomeId:t.id,pageId:o.id,pageTheme:o.theme,tomeTheme:t.theme,fontData:f})}return(0,i.jsx)(Lt,{ref:h,hasHeader:n!==_.Z.ADD_TILE,headerText:`${x("sidebar.header",{header:v})}`,subheaderText:`${x("sidebar.subheader",{subheader:b})}`,contentNoPadding:!0,panelContent:y,draggable:d,startDrag:c})},qa=o(28665);const Ya=(0,g.ZP)(d.E.div).withConfig({displayName:"PropertyPanel__PanelContainer",componentId:"sc-7e473601-0"})`
  display: flex;
  align-items: center;
  position: absolute;
  top: 50%;
  translate: 0 calc(-50% - ${e=>e.theme.headerHeight/2}px);
  right: ${e=>e.$toolbarWidth+e.theme.panelSpacing}px;
  cursor: default;
  ${e=>{let{$draggablePanelsFlag:t}=e;return t&&`z-index: ${I.IT};`}}
  will-change: transition, transform, opacity;
  // This is needed to position child dropdowns (radix-ui) correctly.
  transform: translate3d(0, 0, 0);
`,Ja=(0,g.ZP)(d.E.div).withConfig({displayName:"PropertyPanel__PanelStyles",componentId:"sc-7e473601-1"})`
  margin-right: ${e=>e.theme.tightPanelSpacing}px;
  padding: 0;
  border-radius: ${e=>e.theme.borderRadius.md};
  z-index: ${I.Mf};
  height: fit-content;
  background: ${e=>e.theme.colors.sidebar};
  box-shadow: ${e=>e.theme.colors.panelBoxShadow};
  ${qa.Z}
`,Xa=[_.Z.TILE,_.Z.COLOR_PICKER,_.Z.TEXT_COLOR_PICKER,_.Z.IMAGE_GENERATION_HISTORY,_.Z.IMAGE_EDIT,_.Z.IMAGE_CREATE,_.Z.IMAGE_SEARCH];var Qa=e=>{let{tome:t,toolbarWidth:o,height:n}=e;const l=(0,g.Fg)(),s=(0,r.sJ)(A.Vx),d=(0,N.yW)(t.pages,s),u=(0,r.sJ)(V.zO),p=(0,H.Z)(u),[m,h]=(0,a.useState)(!1),[C,f]=(0,a.useState)({top:0,bottom:0,left:0,right:0}),x=(0,E.f3)(),v=(0,E.t2)(),{propertyPanelRef:b}=(0,L.TR)(),{width:y=0,height:w=0}=(0,B.Z)(),T=(0,a.useCallback)((()=>{var e;const t=null===(e=b.current)||void 0===e?void 0:e.getBoundingClientRect();t&&f({top:12-t.top,left:12-t.left,right:y-(t.left+t.width)-12,bottom:w-(t.top+t.height)-12})}),[b,w,y]);(0,$.Z)({ref:b,onResize:()=>{T()}});const I=(0,r.sJ)(A.uz),P=(0,a.useCallback)((()=>{I()}),[I]);(0,a.useEffect)((()=>{T()}),[w,y,u,T]);const j=(0,D.ye)(D.TT.DRAGGABLE_PANELS),k=(0,O.o)(),S=(0,M.E)(),Z=(0,a.useCallback)((e=>k.start(e)),[k]),R=(0,a.useCallback)((()=>{h(!0)}),[]),F=(0,a.useCallback)((e=>{let{dismiss:t=!1}=e;h(!1),t&&v.closePropertyPanel()}),[v]),G=(0,a.useCallback)((()=>{S.set({x:0,y:0})}),[S]);(0,a.useEffect)((()=>{p&&u!==p&&G()}),[p,u,G]);const U=j,z=x!==_.Z.ADD_TILE,W=n-2*l.headerHeight-32-43*(z?1:0),K=e=>Xa.includes(e)?(0,i.jsx)(Bn,{pageId:s,tomeId:t.id,currentPanel:e,draggable:U,startDrag:U?Z:void 0}):(0,i.jsx)(Ka,{tome:t,page:d,currentPanel:e,maxHeight:W,draggable:U,startDrag:U?Z:void 0,onTileDragStart:R,onTileDragEnd:F});return(0,i.jsx)(c.M,{children:x&&(0,i.jsx)(Ya,{initial:!1,animate:m?{x:0,opacity:0,pointerEvents:"none",scale:1}:{x:0,opacity:1,scale:1},transition:{duration:.2},exit:{opacity:0,scale:.95},transformTemplate:e=>{let{x:t,y:o,z:n}=e;return`translate3d(${t}px, ${o}px, ${n}px)`},$toolbarWidth:o,"data-testid":"property_panel_container",onClick:P,$draggablePanelsFlag:j,children:U?(0,i.jsx)(Ja,{drag:!0,dragListener:!1,dragMomentum:!1,animate:S,dragControls:k,dragElastic:.1,dragConstraints:C,ref:b,children:K(x)},x):(0,i.jsx)(Ja,{ref:b,children:K(x)})},"panel_container")})},er=o(12064);const tr=()=>{const{scrollingPageRef:e,setPageScrollTopAnimatedToRef:t,setPageScrollAnimationStopRef:o}=(0,a.useContext)(Z.Z);return(0,a.useCallback)((n=>{const i=e.current.scrollTop,a=(0,er.j)(i,n,{...P.yh,onUpdate:t=>{e.current&&(e.current.scrollTop=t)},onComplete:()=>{t(null),o(null)}});t(n),o(a.stop)}),[e,t,o])},or=()=>{const{scrollingPageRef:e}=(0,a.useContext)(Z.Z);return(0,a.useCallback)((()=>{if(!e.current)return 0;const t=(0,A.k6)(),o=e.current.getBoundingClientRect().height;return Math.floor(e.current.scrollHeight-o/t)}),[e])},nr=()=>{const{scrollingPageRef:e,pageScrollTopAnimatedToRef:t,pageScrollAnimationStopRef:o}=(0,a.useContext)(Z.Z),n=tr(),i=or();return(0,a.useCallback)((a=>{if(e.current){var r,l;null===(r=(l=o).current)||void 0===r||r.call(l);const d=Math.ceil(e.current.scrollTop);let c;c=null!=t.current&&t.current>d?t.current:d;const u=(0,A.k6)(),p=i(),m=.5*window.innerHeight/u,h=Math.floor(Math.min(c+m,p));var s;if(c>=p||d>=h)null===(s=a)||void 0===s||s();else n(h)}}),[e,o,t,n,i])};var ir=(0,a.forwardRef)(((e,t)=>(0,i.jsx)(ye.Z,{ref:t,viewBox:"0 0 24 10",...e,children:(0,i.jsx)("path",{d:"M2 2L11.4855 7.6913C11.8022 7.88131 12.1978 7.88131 12.5145 7.6913L22 2",strokeWidth:"2.5",strokeLinecap:"round",strokeLinejoin:"round"})})));const ar=(0,g.ZP)(d.E.div).withConfig({displayName:"ScrollIndicator__ScrollIndicatorContainer",componentId:"sc-7311d3f3-0"})`
  position: fixed;
  bottom: 20px;
  left: 50%;
  transform: translate(-50%, 0%);
  z-index: ${I.Ue};
  width: 40px;
  height: 40px;
  border-radius: 100%;
  background: ${e=>{let{theme:t}=e;return t.colors.scrollIndicatorBackground}};
  backdrop-filter: saturate(180%) blur(20px);
  display: flex;
  justify-content: center;
  align-items: center;
  cursor: pointer;
  &:hover {
    background: ${e=>{let{theme:t}=e;return t.colors.scrollIndicatorBackgroundHover}};
  }
`,rr=(0,g.ZP)(d.E.div).withConfig({displayName:"ScrollIndicator__ScrollIndicatorChevronContainer",componentId:"sc-7311d3f3-1"})`
  display: flex;
  justify-content: center;
  align-items: center;
`,lr=(0,g.ZP)(ir).withConfig({displayName:"ScrollIndicator__Chevron",componentId:"sc-7311d3f3-2"})`
  fill: transparent; // This icon is a stroke, not a fill, so override the default fill to transparent.
  width: 24px;
  stroke: ${e=>{let{theme:t}=e;return t.colors.scrollIndicatorChevron}};
`;var sr=()=>{var e;const[t,o]=(0,a.useState)(!1),[n,l]=(0,a.useState)(!1),{height:s}=(0,B.Z)(),[d]=(0,a.useState)(s),{scrollingPageRef:u}=(0,a.useContext)(Z.Z),p=nr(),m=or(),{t:h}=(0,C.$G)(),g=(0,r.sJ)(A.Vx);(0,a.useEffect)((()=>{if(!u.current)return()=>{};const e=u.current,t=()=>{e.scrollTop>20&&!n&&l(!0)};return e.addEventListener("scroll",t),()=>{e.removeEventListener("scroll",t)}})),(0,a.useEffect)((()=>{if(u.current){const e=d<u.current.scrollHeight,t=m(),n=Math.ceil(u.current.scrollTop)<t;o(e&&n)}else o(!1);l(!1)}),[g,u,d,null===(e=u.current)||void 0===e?void 0:e.scrollHeight,m]);const f=(0,a.useCallback)((()=>o(!1)),[]),x=h("tome.scrollIndicator.scrollLabel"),v=t&&!n;return(0,i.jsx)(c.M,{children:v&&(0,i.jsx)($o.Z,{content:x,placement:"top",children:(0,i.jsx)(ar,{animate:{opacity:1},initial:{opacity:0},exit:{opacity:0},onClick:()=>p(null),children:(0,i.jsx)(rr,{animate:{opacity:[1,0,0,1,1,0,0,1,1,0],y:[2,12,-12,2,2,12,-12,2,2,12],scale:[1,.75,.75,1,1,.75,.75,1,1,.75]},transition:{type:"tween",ease:"easeInOut",duration:7.5,times:[0,.2,.2,.4,.4,.6,.6,.8,.8,1]},onAnimationComplete:f,children:(0,i.jsx)(lr,{})})},"scroll-indicator")})})},dr=o(42207),cr=o(97808);var ur=e=>{let{tomeId:t}=e;const{apolloClient:o,clientId:n}=(0,L.bp)(),{user:i,loading:r,error:s}=(0,a.useContext)(oi.Z),d=!r&&!s&&!!i,c=(0,a.useRef)(),u=(0,a.useRef)();return(0,a.useEffect)((()=>(d&&u.current!==t&&(u.current&&c.current&&c.current.unsubscribe(),c.current=function(e,t,o){return e.subscribe({query:G.e9Y,variables:{tomeId:t,clientId:o}}).subscribe({next(t){let{data:o}=t;if(o&&o.tomeEdit)switch(o.tomeEdit.type){case G._tx.Generic:{const{edit:t}=o.tomeEdit;ua.Q.applyEditToCache(t,e.cache);break}case G._tx.CreateComment:{const{comment:t}=o.tomeEdit;(0,dr.I0)(e.cache,t);break}case G._tx.UpdateComment:{const{comment:t}=o.tomeEdit;(0,dr.QA)(e.cache,t);break}case G._tx.DeleteComment:{const{comment:t}=o.tomeEdit;(0,dr.PS)(e.cache,t);break}case G._tx.Presence:{const t=o.tomeEdit;cr.z.updateTomePresenceWithPresenceEdit(e.cache,t),cr.z.updatePagePresenceWithPresenceEdit(e.cache,t);break}default:l.v.addError(new Error(`Unknown edit type: ${o.tomeEdit.type}`),{edit:o.tomeEdit})}else l.v.addError(new Error("No tomeEdit data in subscription"),{data:o})},error(e){console.error("err",e),l.v.addError(e)}})}(o,t,n),u.current=t),()=>{c.current&&(c.current.unsubscribe(),c.current=void 0,u.current=void 0)})),[o,t,n,d]),null},pr=o(96176),mr=o(11293),hr=o(51961);var gr=e=>{const[t,o]=(0,r.FV)(A.Vx),n=(0,N.xh)(e,t),i=n>0,l=n<e.length-1,s=(0,a.useCallback)((()=>{l&&o(e[n+1].id)}),[n,l,e,o]),d=(0,a.useCallback)((()=>{i&&o(e[n-1].id)}),[n,i,e,o]);return(0,a.useMemo)((()=>({hasPrevPage:i,hasNextPage:l,nextPage:s,prevPage:d})),[l,i,s,d])};var Cr=e=>{let{timeout:t,visibilityBasedOnMouseEvent:o,disabled:n}=e;const i=(0,a.useRef)(),[r,l]=(0,a.useState)(!1),s=(0,a.useCallback)((()=>l(!1)),[l]),d=(0,a.useCallback)((()=>l(!0)),[l]),c=(0,a.useCallback)((()=>{i.current=setTimeout((()=>{d()}),t)}),[t,i,d]),u=(0,a.useCallback)((()=>{i.current&&clearTimeout(i.current),s()}),[i,s]),p=(0,a.useCallback)((()=>{n||(i.current&&clearTimeout(i.current),c())}),[n,c]),m=(0,a.useCallback)((e=>{o(e)?u():p()}),[o,u,p]);return(0,a.useEffect)((()=>(n?(i.current&&clearTimeout(i.current),document.removeEventListener("mousemove",m)):(document.addEventListener("mousemove",m),c()),()=>{i.current&&clearTimeout(i.current),document.removeEventListener("mousemove",m)})),[n,i,m,c]),{isHidden:r,show:s,hide:d}};const fr=(0,g.ZP)(d.E.div).withConfig({displayName:"FooterNavigation__FooterWrapper",componentId:"sc-59bcd0ab-0"})`
  height: ${40}px;
  position: fixed;
  bottom: 0;
  width: 100%;
  display: flex;
  align-items: center;
  justify-content: space-between;
  padding: ${16}px;
  margin-bottom: ${16}px;
`,xr=(0,g.ZP)(Re.ZP).withConfig({displayName:"FooterNavigation__FooterNavButton",componentId:"sc-59bcd0ab-1"})`
  width: ${40}px;
  height: ${40}px;
`;var vr=e=>{let{pages:t,isFullscreen:o}=e;const{t:n}=(0,C.$G)(),l=(0,a.useRef)(null),{currentPageRef:s}=(0,L.TR)(),d=(0,r.sJ)(T.wo),[u,p]=(0,a.useState)(!1),[m,h]=(0,a.useState)(!1),{hasPrevPage:f,hasNextPage:x,prevPage:v,nextPage:b}=gr(t),y=(0,g.Fg)(),w={width:y.largerIconSize,height:y.largerIconSize},I=(0,a.useCallback)((e=>{var t,o,n;if(!l.current)return!1;const i=l.current.getBoundingClientRect();if(e.clientY>=i.top)return h(!1),h(!1),!0;const a=null===(t=s.current)||void 0===t?void 0:t.getBoundingClientRect();return e.clientX<((null===(o=a)||void 0===o?void 0:o.left)??0)?(p(!0),!0):e.clientX>((null===(n=a)||void 0===n?void 0:n.right)??0)?(h(!0),!0):(p(!1),h(!1),!1)}),[s]),{isHidden:E}=Cr({visibilityBasedOnMouseEvent:I,timeout:3e3,disabled:o}),_=(0,a.useMemo)((()=>({animate:{opacity:t.length<2||E||o||d?0:1},transition:P.Z2,initial:{opacity:1},exit:{opacity:0}})),[t.length,E,o,d]);return(0,i.jsx)(c.M,{children:(0,i.jsxs)(fr,{ref:l,"data-testid":"footer_navigation",..._,children:[(0,i.jsx)(xr,{variant:"uncontained",disabled:!f,onClick:v,"aria-label":n("tome.footer.previousPageButtonLabel"),iconStyles:{margin:0,transform:u&&f?"translateX(-4px)":"none",transition:"transform 0.3s ease-out"},startIcon:(0,i.jsx)(mr.Z,{style:w}),style:f?{}:{visibility:"hidden"}}),(0,i.jsx)(xr,{variant:"uncontained",disabled:!x,onClick:b,"aria-label":n("tome.footer.nextPageButtonLabel"),iconStyles:{margin:0,transform:m&&x?"translateX(4px)":"none",transition:"transform 0.3s ease-out"},startIcon:(0,i.jsx)(hr.Z,{style:w}),style:x?{}:{visibility:"hidden"}})]})})},br=o(41664),yr=o.n(br),wr=o(56302),Tr=o(16618),Ir=o(95421),Pr=o(91966);const Er=g.ZP.div.withConfig({displayName:"PageProgressIndicator__IndicatorStyles",componentId:"sc-beec2e2d-0"})`
  display: flex;
  flex-direction: row;
  align-items: center;
  justify-content: center;
  width: 100%;
`,_r=g.ZP.div.withConfig({displayName:"PageProgressIndicator__ProgressSegment",componentId:"sc-beec2e2d-1"})`
  width: 100%;
  height: 2px;
  border-top-left-radius: ${e=>{let{$withLeftRadius:t}=e;return t?"4px":"0"}};
  border-bottom-left-radius: ${e=>{let{$withLeftRadius:t}=e;return t?"4px":"0"}};
  border-top-right-radius: ${e=>{let{$withRightRadius:t}=e;return t?"4px":"0"}};
  border-bottom-right-radius: ${e=>{let{$withRightRadius:t}=e;return t?"4px":"0"}};
  background-color: ${e=>{let{$active:t,theme:o}=e;return t?o.colors.contrast60:o.colors.contrast16}};
`,jr=g.ZP.div.withConfig({displayName:"PageProgressIndicator__ProgressSegmentHover",componentId:"sc-beec2e2d-2"})`
  width: ${e=>{let{$width:t}=e;return"number"==typeof t?`${t}px`:t}};
  margin-left: ${e=>{let{$space:t}=e;return t}}px;
  ${e=>{let{$interactive:t,$active:o,theme:n}=e;return t&&g.iv`
      cursor: pointer;
      padding: 4px 0;
      &:hover ${_r} {
        background-color: ${o?n.colors.contrast60:n.colors.contrast25};
      }
    `}}
`;var kr=e=>{let{pageIds:t,maxComponentWidthPx:o,activePageId:n,onSegmentClick:a,isMobile:r,numPages:l}=e;const s=n?t.indexOf(n):-1;let d=40,c=3;(r||40*l+3*(l-1)>o)&&(d=(o-3*(l-1))/l,d<24&&(d=100/l+"%",c=0));const u=Array.from(Array(l).keys());return(0,i.jsx)(Er,{"data-testid":`active_page_index_${s}`,"data-tome-bypass-tap-navigation":!0,children:(0,i.jsx)($o.Z,{placement:"bottom",style:{width:"100%",justifyContent:"center"},children:u.map((e=>{const o=t[e]||`fake_page_id_${e}`,n=!t[e];return(0,i.jsx)(jr,{$active:e<=s,$width:d,$space:0===e?0:c,onClick:()=>{n||a(o)},$interactive:!r,...r?{}:{renderTooltip:()=>`Page ${e+1} of ${l}`},children:(0,i.jsx)(_r,{"data-testid":"progress_segment",$active:e<=s,$withLeftRadius:c>0||0===e,$withRightRadius:c>0||e===l-1})},o)}))})})},Sr=o(24296),Zr=o(46051);const Rr=(0,g.ZP)(d.E.div).withConfig({displayName:"Header.styles__HeaderLeft",componentId:"sc-8d2f5193-0"})`
  display: flex;
  justify-content: flex-start;
  flex: 1;
  min-width: calc(33% - ${e=>{let{$gap:t}=e;return t}}px);
  margin-left: 10px;
  overflow: hidden;
  pointer-events: none;
`,Or=g.ZP.div.withConfig({displayName:"Header.styles__HeaderMiddle",componentId:"sc-8d2f5193-1"})`
  display: flex;
  justify-content: center;
  overflow: hidden;
  flex: 'initial';

  ${e=>{let{$presentMode:t,$gap:o}=e;return t&&g.iv`
      flex: 1;
      margin-left: ${o}px;
      margin-right: ${o}px;
    `}}
`,Mr=(0,g.ZP)(d.E.div).withConfig({displayName:"Header.styles__HeaderRight",componentId:"sc-8d2f5193-2"})`
  position: relative;
  display: flex;
  justify-content: flex-end;
  // using 0 0 auto to give header left the max space it could take
  // but in present mode, we will have header middle so go back to 1
  flex: ${e=>{let{$presentMode:t}=e;return t?"1":"0 0 auto"}};
  margin-right: 10px;
  overflow: hidden;
  min-width: ${205}px;
`,$r=g.ZP.div.withConfig({displayName:"Header.styles__HeaderWrapper",componentId:"sc-8d2f5193-3"})`
  z-index: ${I.bf};
  pointer-events: none;

  &::before {
    background-image: ${e=>{let{$presentMode:t,theme:o}=e;return t?o.gradients.headerGradientPresent:o.gradients.headerGradient}};
    content: '';
    height: ${Zr.Zk}px;
    pointer-events: none;
    position: absolute;
    top: 0;
    width: 100%;
    z-index: -1;
    opacity: ${e=>{let{$showScrim:t}=e;return t?1:0}};
    transition: opacity 0.3s ease;
  }
`,Lr=g.ZP.div.withConfig({displayName:"Header.styles__Header",componentId:"sc-8d2f5193-4"})`
  display: flex;
  width: 100%;
  z-index: ${I.bf};
  cursor: default;
  height: ${e=>{let{theme:t}=e;return t.headerHeight}}px;
  position: relative;
  color: ${e=>{let{theme:t}=e;return t.colors.contrast}};

  ${Rr} *, ${Or} *, ${Mr} * {
    pointer-events: ${e=>{let{$pointerEventsEnabled:t}=e;return t?"all":"none"}};
  }
`,Ar=(0,g.ZP)(d.E.div).withConfig({displayName:"Header.styles__HeaderComponent",componentId:"sc-8d2f5193-5"})`
  display: flex;
  flex-direction: row;
  align-items: center;
  justify-content: center;
  position: relative;
  height: ${e=>{let{theme:t}=e;return t.headerHeight}}px;
`,Nr=(0,g.ZP)(Ar).withConfig({displayName:"Header.styles__HeaderRightHeaderComponent",componentId:"sc-8d2f5193-6"})`
  margin-left: 8px;
`,Dr=(0,g.ZP)(Re.ZP).attrs((e=>({variant:"uncontained",opacity:e.theme.opacity.headerButtonText,iconOpacity:e.theme.opacity.headerButtonIcons}))).withConfig({displayName:"Header.styles__HeaderButton",componentId:"sc-8d2f5193-7"})`
  height: 32px;
  width: 40px;
  pointer-events: all;
`,Br=(0,g.ZP)(d.E.div).withConfig({displayName:"Header.styles__Transition",componentId:"sc-8d2f5193-8"})`
  position: absolute;
  left: 0;
  top: 0;
`,Hr=g.ZP.div.withConfig({displayName:"MobileHeader__MobileHeaderStyles",componentId:"sc-6720889-0"})`
  position: fixed;
  width: 100%;
  z-index: ${I.bf};
`,Vr=g.ZP.div.withConfig({displayName:"MobileHeader__PageProgressIndicatorStyles",componentId:"sc-6720889-1"})`
  padding: 8px ${24}px 0;
  width: 100%;
`,Fr=(0,g.ZP)(d.E.div).withConfig({displayName:"MobileHeader__AttributionRow",componentId:"sc-6720889-2"})`
  display: flex;
  width: 100%;
  padding: 0 ${24}px;

  // This has the effect of making AttributeLeft left-aligned
  // and AttributionRight right-aligned.
  justify-content: space-between;
`,Gr=g.ZP.div.withConfig({displayName:"MobileHeader__AttributionLeft",componentId:"sc-6720889-3"})`
  display: flex;
  align-items: center;
  flex: 1;

  // This will make sure if the text is very long that it gets
  // truncated, rather than pushing the AttributionRight off the
  // screen.
  overflow-x: hidden;
`,Ur=g.ZP.div.withConfig({displayName:"MobileHeader__AttributionRight",componentId:"sc-6720889-4"})`
  display: flex;
  margin-left: 12px;
  align-items: center;
  color: ${e=>{let{theme:t}=e;return t.colors.headerLogo}};
`,zr=g.ZP.span.withConfig({displayName:"MobileHeader__ButtonInner",componentId:"sc-6720889-5"})`
  display: flex;
  align-items: center;
`;var Wr=e=>{let{isInExpandMode:t,tome:o,className:n}=e;var l,s,d,c;const u=(0,Go.Z)(),{apolloClient:p}=(0,L.bp)(),{workspaceUrl:m}=(0,Pr.B)(),[h,g]=(0,r.FV)(A.Vx),f=(0,r.sJ)(Tr.R),x=(0,r.sJ)(A.SM),{user:v,loading:b}=(0,a.useContext)(oi.Z),y=!(!v||!v.id),w=(0,N.yW)(o.pages,h),{t:T}=(0,C.$G)(),I=(0,a.useCallback)((()=>{Ne.ZP.reportTryTomeClickEvent({apolloClient:p,tomeId:o.id,pageId:h})}),[o,h,p]),E=(0,Ir.iR)(void 0,"/signup",{utmMedium:"referral",utmSource:x?"public_tome_embedded":"public_tome",utmCampaign:o.id,utmContent:"public_tome_logo"}),_=(0,Sr.I)(null===(s=o)||void 0===s||null===(l=s.org)||void 0===l?void 0:l.logo),j=(null===(d=o.org)||void 0===d?void 0:d.showTomeBranding)??!0,k=u?window.innerWidth:400;return(0,a.useEffect)((()=>{document.body.style.setProperty("--mobile-header-top-padding",f?"52px":"10px")}),[f]),(0,i.jsxs)(Hr,{className:n,children:[o.pages&&o.pages.length>1&&!t&&(0,i.jsx)(Vr,{children:(0,i.jsx)(kr,{pageIds:o.pages.map((e=>e.id)),activePageId:h,onSegmentClick:g,maxComponentWidthPx:k-48,isMobile:!0,numPages:o.numPages})}),!t&&(0,i.jsxs)(Fr,{animate:{height:f?52:0,opacity:f?1:0},initial:{height:f?52:0,opacity:f?1:0},transition:P.Z2,"data-testid":"mobile_header_attribution",style:{pointerEvents:f?"auto":"none"},children:[(0,i.jsx)(Gr,{children:_&&(0,i.jsx)(Sr.Z,{show:o.showLogo,logo:null===(c=o.org)||void 0===c?void 0:c.logo,theme:w.theme})}),!b&&(0,i.jsxs)(Ur,{"data-tome-bypass-tap-navigation":"MobileHeader__AttributionRight",children:[y&&(0,i.jsx)(yr(),{href:m,children:(0,i.jsx)(wr.Z,{style:{height:24,width:24,opacity:.8}})}),!y&&j&&(0,i.jsx)(yr(),{href:E,children:(0,i.jsxs)(Dr,{onClick:I,variant:"uncontained",style:{width:"unset",padding:"0px"},children:[(0,i.jsx)(wr.Z,{style:{height:18,width:18}}),(0,i.jsxs)(zr,{children:[" ",T("tome.header.mobileHeader.tryTomeButtonLabel")]})]})})]})]})]})},Kr=o(30587),qr=o(74837);const Yr=g.ZP.span.withConfig({displayName:"BadgeChip__StyledComponent",componentId:"sc-1933d7b0-0"})`
  position: relative;
`,Jr=g.ZP.span.withConfig({displayName:"BadgeChip__BadgeIcon",componentId:"sc-1933d7b0-1"})`
  display: flex;
  align-items: center;

  & > svg {
    height: 14px;
    width: 14px;
  }
`,Xr=g.ZP.span.withConfig({displayName:"BadgeChip__BadgeChildren",componentId:"sc-1933d7b0-2"})`
  display: flex;
`,Qr=g.ZP.span.withConfig({displayName:"BadgeChip__BadgeDisplay",componentId:"sc-1933d7b0-3"})`
  // Generic positioning
  display: flex;
  flex-direction: column;
  flex-wrap: wrap;
  justify-content: center;
  align-content: center;
  align-items: center;
  box-sizing: border-box;
  z-index: 1;

  border-radius: ${e=>{let{theme:t}=e;return t.borderRadius.xs}};
  font-size: ${e=>{let{theme:t}=e;return t.fontSizes.sm}};
  font-weight: 400;
  height: 22px;
  min-width: 20px;
  padding: 12px;
  background-color: ${e=>{let{color:t,theme:o}=e;return"destructive"===t?o.colors.redBadgeBackground:"inherit"}};
  color: ${e=>{let{color:t,theme:o}=e;return"destructive"===t?o.colors.redBadge:"inherit"}};
`;var el=(0,a.forwardRef)(((e,t)=>(0,i.jsx)(Yr,{as:e.component,ref:t,children:(0,i.jsx)($o.Z,{content:e.toolTipContent,placement:"bottom",perpendicularOffset:-20,children:(0,i.jsxs)(Qr,{color:e.color,children:[(0,i.jsx)(Jr,{children:e.icon}),(0,i.jsx)(Xr,{children:e.children})]})})}))),tl=o(1653),ol=o(73765),nl=o(76661);var il=nl.Ps`
  mutation DELETE_PERMISSION_MUTATION($id: String!) {
    deletePermission(input: { id: $id }) {
      ... on PermissionSuccess {
        id
        tome {
          id
        }
      }
      ... on PermissionError {
        message
      }
    }
  }
`;var al=nl.Ps`
  mutation UPDATE_PERMISSION_MUTATION($id: String!, $role: TomeRole!) {
    updatePermission(input: { id: $id, role: $role }) {
      ... on Permission {
        ...PermissionFragment
      }
      ... on PermissionError {
        message
      }
    }
  }
  ${G.VJv}
`;function rl(e){const{__typename:t,message:o}=e;return!("PermissionError"!==t||!o)&&((0,A.ak)({message:o}),!0)}var ll=o(86090);const sl={value:"NONE",label:ll.ZP.t("tome.sharingSheetOptions.noAccessMenuItemLabel")},dl={value:"VIEWER",label:ll.ZP.t("tome.sharingSheetOptions.viewerMenuItemLabel"),description:ll.ZP.t("tome.sharingSheetOptions.descriptionOfPlayModeForVisitors")},cl=[dl,{value:"COMMENTER",label:ll.ZP.t("tome.sharingSheetOptions.commenterMenuItemLabel")},{value:"EDITOR",label:ll.ZP.t("tome.sharingSheetOptions.editorMenuItemLabel")},{value:"FULL",label:ll.ZP.t("tome.sharingSheetOptions.fullAccessMenuItemLabel")}],ul=[sl,...cl],pl=[sl,dl];var ml=o(55902);var hl=(0,a.forwardRef)(((e,t)=>(0,i.jsxs)(ye.Z,{ref:t,viewBox:"0 0 64 64",...e,children:[(0,i.jsx)("path",{d:"M8.80235 18.5039C8.94529 18.2101 9.33262 18.161 9.56361 18.392L21.8601 30.6886C22.0473 30.8757 22.0562 31.1764 21.8803 31.3743L9.46525 45.3412C9.23616 45.5989 8.82154 45.5521 8.68189 45.2369C8.24352 44.2472 8 43.1521 8 42V22C8 20.7464 8.28835 19.5601 8.80235 18.5039Z"}),(0,i.jsx)("path",{d:"M12.2693 49.0787C11.9958 48.9342 11.9445 48.5728 12.15 48.3416L24.6745 34.2516C24.8656 34.0366 25.1983 34.0268 25.4018 34.2302L27.7574 36.5858C30.1005 38.9289 33.8995 38.9289 36.2426 36.5858L38.5982 34.2302C38.8017 34.0268 39.1344 34.0366 39.3255 34.2516L51.85 48.3416C52.0555 48.5728 52.0042 48.9342 51.7307 49.0787C50.6168 49.6669 49.3473 50 48 50H16C14.6527 50 13.3832 49.6669 12.2693 49.0787Z"}),(0,i.jsx)("path",{d:"M54.5348 45.3412C54.7638 45.5989 55.1785 45.5521 55.3181 45.2369C55.7565 44.2472 56 43.1521 56 42V22C56 20.7464 55.7116 19.5601 55.1977 18.5039C55.0547 18.2101 54.6674 18.161 54.4364 18.392L42.1399 30.6886C41.9527 30.8757 41.9438 31.1764 42.1197 31.3743L54.5348 45.3412Z"}),(0,i.jsx)("path",{d:"M12.392 15.5636C12.161 15.3326 12.2101 14.9453 12.5039 14.8024C13.5601 14.2884 14.7464 14 16 14H48C49.2536 14 50.4399 14.2884 51.4961 14.8023C51.7899 14.9453 51.839 15.3326 51.608 15.5636L33.4142 33.7574C32.6332 34.5384 31.3668 34.5384 30.5858 33.7574L12.392 15.5636Z"})]})));const gl=g.ZP.div.withConfig({displayName:"SharingSheetRow.styles__Wrapper",componentId:"sc-4e891be4-0"})`
  display: flex;
  flex-direction: row;
  align-items: center;
  height: 32px;
  .control {
    margin-left: auto;
  }
`,Cl=g.ZP.div.withConfig({displayName:"SharingSheetRow.styles__IconStyles",componentId:"sc-4e891be4-1"})`
  svg {
    flex-shrink: 0;
  }
`,fl=g.ZP.div.withConfig({displayName:"SharingSheetRow.styles__MenuItem",componentId:"sc-4e891be4-2"})`
  margin: 0;
  padding-left: 8px;
  flex-grow: 1;
  display: flex;
  align-items: baseline;
  overflow: hidden;
`,xl=g.ZP.div.withConfig({displayName:"SharingSheetRow.styles__MenuItemHeading",componentId:"sc-4e891be4-3"})`
  font-size: ${e=>{let{theme:t}=e;return t.fontSizes.sm}};
  font-weight: 400;
  line-height: 17px;
  ${te.wR}
`,vl=g.ZP.div.withConfig({displayName:"SharingSheetRow.styles__MenuItemPending",componentId:"sc-4e891be4-4"})`
  color: ${e=>{let{theme:t}=e;return t.colors.contrast40}};
  font-size: ${e=>{let{theme:t}=e;return t.fontSizes.sm}};
  padding: 0 0.5em;
  ${te.wR}
`,bl=g.ZP.div.withConfig({displayName:"SharingSheetRow.styles__MenuItemGuest",componentId:"sc-4e891be4-5"})`
  color: ${e=>{let{theme:t}=e;return t.colors.guestBadgeText}};
  font-size: ${e=>{let{theme:t}=e;return t.fontSizes.sm}};
  padding: 0 0.5em;
`,yl=g.ZP.div.withConfig({displayName:"SharingSheetRow.styles__OwnerLabel",componentId:"sc-4e891be4-6"})`
  font-size: 13px;
  min-height: 28px;
  line-height: 16px;
  height: 28px;
  padding: 6px 8px;
  color: ${e=>{let{theme:t}=e;return t.colors.ownerBadgeText}};
`;var wl=e=>{let{icon:t,heading:o,disabled:n,handler:a=(()=>{}),currentValue:r="",options:l=[],pending:s=!1,guest:d=!1}=e;const c=(0,g.Fg)(),{t:u}=(0,C.$G)(),p={control:(e,t)=>({...e,flexWrap:"nowrap",width:t.selectProps.controlWidth,boxSizing:"border-box",border:0,borderRadius:"6px",boxShadow:"none",fontSize:"13px",lineHeight:"16px",height:"28px",minHeight:"28px",padding:"6px 8px",color:t.isDisabled?c.colors.contrast20:c.colors.secondaryUiText,"&:hover":{backgroundColor:c.colors.menuControlHover},backgroundColor:c.colors.sheetBg,cursor:"pointer",whiteSpace:"nowrap"}),dropdownIndicator:(e,t)=>({...e,paddingRight:0,paddingTop:"3px",paddingBottom:"3px",paddingLeft:"6px",color:t.isDisabled?c.colors.contrast20:"currentColor"}),group:()=>({borderTop:`1px solid ${c.colors.contrast8}`}),indicatorsContainer:(e,t)=>({...e,height:"16px",padding:"0",margin:0,display:t.isDisabled?"none":"block",stroke:c.colors.secondaryUiText}),singleValue:()=>({textOverflow:"ellipsis",whiteSpace:"nowrap",overflow:"hidden",display:"flex",flexShrink:0}),valueContainer:e=>({...e,padding:0,flexWrap:"nowrap"}),menu:(e,t)=>({...e,width:t.selectProps.menuWidth,fontSize:"13px",lineHeight:"16px",marginTop:"-28px",padding:"6px",color:c.colors.secondaryUiText,backgroundColor:c.colors.menuBackgroundLayer[0],right:0})},m=(0,i.jsx)(be,{onChange:a,handler:a,styles:p,options:l,disabled:n,currentValue:r??"",menuWidth:"156px",backgroundColor:c.colors.transparent});return(0,i.jsxs)(gl,{children:[(0,i.jsx)(Cl,{children:t}),(0,i.jsxs)(fl,{children:[(0,i.jsx)(xl,{title:o,children:o}),s&&(0,i.jsx)(vl,{children:u("tome.sharingSheetRow.pendingUserMenuItemLabel")}),d&&!s&&(0,i.jsx)(bl,{children:u("tome.sharingSheetRow.guestUserMenuItemLabel")})]}),m]})};const Tl=g.ZP.div.withConfig({displayName:"SharingSheet.styles__SharingSheetWrapper",componentId:"sc-bdda107e-0"})`
  cursor: default;
  position: absolute;
  top: ${e=>e.theme.headerHeight}px;
  right: 12px;
  pointer-events: auto;
  color: ${e=>e.theme.colors.primaryUiText};

  > div {
    background: ${e=>{let{theme:t}=e;return t.colors.sheetBg}};
    box-shadow: ${e=>{let{theme:t}=e;return t.colors.sheetBoxShadow}};
    width: 360px;
    border-radius: 18px;
    padding: 6px 12px 12px 12px;
  }
  z-index: ${I.Ue};
`,Il=g.ZP.div.withConfig({displayName:"SharingSheet.styles__SharingSheetIconWrap",componentId:"sc-bdda107e-1"})`
  height: 20px;
  width: 20px;
  background-color: ${e=>{let{theme:t}=e;return t.colors.iconBg}};
  border-radius: 10px;
  overflow: hidden;
  display: flex;

  & ${ye.K} {
    height: 16px;
    margin: 2px;
    opacity: 0.5;
  }
`,Pl=g.ZP.hr.withConfig({displayName:"SharingSheet.styles__SharingSheetSeparator",componentId:"sc-bdda107e-2"})`
  border: 0;
  height: 1px;
  margin: 4px 0;
  background-color: ${e=>{let{theme:t}=e;return t.colors.separator}};
`;var El=e=>{let{tome:t}=e;var o,n;const{apolloClient:a}=(0,L.bp)(),{data:r}=(0,G.BYn)({variables:{id:t.id},fetchPolicy:"cache-and-network"}),l=(0,g.Fg)(),{t:s}=(0,C.$G)(),{canManage:d}=t.currentUserPermission,c=(e,t)=>{"remove"===t?function(e,t){e.mutate({mutation:il,variables:{id:t},update(e,t){let{data:{deletePermission:o}}=t;rl(o)||function(e,t){e.modify({id:`Tome:${t.tome.id}`,fields:{permissions(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[],{readField:o}=arguments.length>1?arguments[1]:void 0;return e.filter((e=>t.id!==o("id",e)))}}})}(e,o)}})}(a,e):function(e,t,o){e.mutate({mutation:al,variables:{id:t,role:o},update(e,t){let{data:{updatePermission:o}}=t;rl(o)||function(e,t){e.modify({id:e.identify(t),fields:{role(e){return t.role??e}}})}(e,o)}})}(a,e,t)};return(0,i.jsx)(i.Fragment,{children:null===(n=r)||void 0===n||null===(o=n.tome)||void 0===o?void 0:o.permissions.map((e=>(0,i.jsx)(wl,{handler:t=>c(e.id,t),icon:e.user.pending?(0,i.jsx)(Il,{children:(0,i.jsx)(hl,{})}):(0,i.jsx)(ml.Z,{user:e.user,size:20}),pending:e.user.pending,guest:e.isGuest||!1,currentValue:e.role,heading:e.user.name||e.user.email,options:[...cl,{options:[{label:s("tome.sharingSheetIndividuals.removeAccessLabel"),value:"remove",color:l.colors.red,colorHover:l.colors.contrast,backgroundColorHover:l.colors.red}]}],disabled:!d},e.user.id)))})},_l=o(29107);var jl=e=>{const{items:t,isMenuOpen:o,onDismiss:n}=e,[i,r]=(0,a.useState)(0),l=(0,a.useCallback)((e=>i===e),[i]),s=(0,a.useCallback)((e=>{r(e)}),[r]),d=(0,a.useCallback)((e=>{if(!o)return;e.preventDefault();let n=i+1;for(;n<t.length;){const e=t[n],{type:o="option",disabled:i}=e;if(!i&&"option"===o)break;n+=1}n!==t.length&&r(n)}),[i,r,t]),c=(0,a.useCallback)((e=>{if(!o)return;e.preventDefault();let n=i-1;for(;n>=0;){const e=t[n],{type:o="option",disabled:i}=e;if(!i&&"option"===o)break;n-=1}n<0||r(n)}),[i,r,t]),u=(0,a.useCallback)((e=>{var n,a;t.length>0&&o&&(null===(a=t[i])||void 0===a||null===(n=a.action)||void 0===n||n.call(a),e.preventDefault())}),[t,i]),p=(0,a.useCallback)((e=>{o&&(r(0),e.preventDefault()),n()}),[n,r]),m=(0,a.useCallback)((e=>{"ArrowDown"===e.key?d(e):"ArrowUp"===e.key?c(e):"Enter"===e.key?u(e):"Escape"===e.key&&p(e)}),[d,c,u,p]);return(0,a.useMemo)((()=>({isIndexSelected:l,setIndex:s,onKeyPress:m})),[l,s,m])},kl=o(31095);const Sl=g.ZP.div.withConfig({displayName:"SharingSheetInvite.styles__MenuWrapper",componentId:"sc-f48b57f5-0"})`
  position: absolute;
  left: ${e=>e.$left}px;
  top: ${e=>e.$top}px;
  z-index: ${I.m6};
`,Zl=g.ZP.form.withConfig({displayName:"SharingSheetInvite.styles__Form",componentId:"sc-f48b57f5-1"})`
  display: flex;
  margin: 7px 0px;
  input {
    background: ${e=>{let{theme:t}=e;return t.colors.inputBg}};
    margin: 0;
    border-top-right-radius: 0;
    border-bottom-right-radius: 0;
    padding: 0px 12px;
    height: 28px;
    min-height: 28px;
    ${te.wR}
    min-width: 0;
  }

  > div {
    margin: 0;
    display: box;
    width: 150px;
    > div[class*='control'] {
      padding-top: 1px;
      height: 28px;
      background: ${e=>{let{theme:t}=e;return t.colors.inputBg}};
      border-radius: 0 ${e=>{let{theme:t}=e;return t.borderRadius.xs}}
        ${e=>{let{theme:t}=e;return t.borderRadius.xs}} 0;
      > div:first-child {
        height: 28px;
        padding: 0;
        > div {
          text-align: right;
          width: 100%;
          flex: none;
        }
      }
    }
    > div[class*='menu'] {
      margin-top: 8px;
      width: 200px;
      right: 0;
    }
  }
`;var Rl=e=>{let{tome:t}=e;var o,n,r,l,s;const d=(0,a.useRef)(null),[c,u]=(0,a.useState)(""),[p,m]=(0,a.useState)(G.yrp.Full),h=(0,g.Fg)(),{t:f}=(0,C.$G)(),[x,v]=(0,a.useState)(!1),{data:b,loading:y}=(0,G.vj0)(),{user:w,flags:T,loading:I}=(0,a.useContext)(oi.Z);let P=[];y||I||!(null===(r=b)||void 0===r||null===(n=r.me)||void 0===n||null===(o=n.org)||void 0===o?void 0:o.members)||(P=function(e){let{tome:t,members:o,value:n,currentUser:i}=e;return o.filter((e=>{var o,a;return(null===(o=e.name)||void 0===o?void 0:o.toLowerCase().startsWith(n.toLowerCase()))&&!t.permissions.some((t=>t.user.id===e.id))&&e.id!==(null===(a=i)||void 0===a?void 0:a.id)&&e.id!==t.author.id}))}({tome:t,members:b.me.org.members.map((e=>{let{user:t}=e;return t})),value:c,currentUser:w}));const E=_l.G(c),_=E&&0===P.length,{data:j,loading:k}=(0,G.v7f)({skip:!_,variables:{email:c},fetchPolicy:"no-cache"});if(!k&&(null===(l=j)||void 0===l?void 0:l.user)&&P.push(j.user),0===P.length&&E&&(null===(s=T)||void 0===s?void 0:s.externalSharing)){const e={id:"pending",name:c,email:c,pending:!0,profileImage:null,__typename:"User"};P.push(e)}let S,Z;if(d.current){const e=d.current;S=e.offsetTop+e.offsetHeight+6,Z=e.offsetLeft}const R=!y&&c.length>0&&P.length>0&&!x&&!!d.current,O=(0,a.useCallback)((()=>{R?v(!0):d.current&&(d.current.value="")}),[R,v,d]),[M]=(0,G.QKm)({update:(e,o)=>{let{data:n}=o;var i;if(null===(i=n)||void 0===i?void 0:i.createPermissionWithUser){const{__typename:o}=n.createPermissionWithUser;"PermissionError"===o&&n.createPermissionWithUser.message?(0,A.ak)({message:n.createPermissionWithUser.message}):"Permission"===o&&function(e,t,o){const n=e.writeFragment({id:`Permission:${t.id}`,fragment:G.VJv,data:t,fragmentName:"PermissionFragment"});e.modify({id:e.identify(o),fields:{permissions(e){return e.every((e=>{var t;return e.__ref!==(null===(t=n)||void 0===t?void 0:t.__ref)}))?[...e,n]:e}}})}(e,n.createPermissionWithUser,t)}}}),$=P.map((e=>({text:e.name||"",image:e.profileImage&&(0,i.jsx)(ml.Z,{user:e,size:20,delayMs:0,style:{marginRight:8}})||e.pending&&(0,i.jsx)(hl,{style:{width:20,height:20,marginRight:8}})||void 0,action:()=>{(e=>{const o=Rn()();M({variables:{id:o,tomeId:t.id,email:e.email,role:p},optimisticResponse:{createPermissionWithUser:{id:o,tome:{id:t.id},user:{id:e.id,name:e.name,email:e.email,profileImage:e.profileImage,pending:e.pending},role:p,isGuest:!1}}}),d.current&&(d.current.value=""),v(!0)})(e)},id:e.id}))),{isIndexSelected:L,onKeyPress:N,setIndex:D}=jl({items:$,isMenuOpen:R,onDismiss:O}),B=(0,a.useCallback)((e=>({...e,onMouseEnter:()=>{D(e.index)}})),[D]);const H={control:(e,t)=>({...e,width:t.selectProps.controlWidth,border:0,boxShadow:"none",fontSize:"13px",height:"28px",minHeight:"28px",lineHeight:"16px",paddingLeft:"4px",color:h.colors.secondaryUiText,cursor:"pointer","&:hover":{}}),singleValue:()=>({textOverflow:"ellipsis",whiteSpace:"nowrap",overflow:"hidden",color:h.colors.secondaryUiText}),indicatorsContainer:()=>({stroke:h.colors.secondaryUiText}),dropdownIndicator:e=>{let{display:t}=e;return{display:t,padding:"8px 8px 8px 6px"}}};return(0,a.useEffect)((()=>()=>{(0,A.ii)(!1)}),[]),(0,i.jsxs)(i.Fragment,{children:[(0,i.jsxs)(Zl,{onSubmit:e=>{e.preventDefault()},children:[(0,i.jsx)(ee.Z,{ref:d,placeholder:f("tome.sharingSheetInvite.enterEmailsOrNamesPlaceholderText"),onChange:e=>{u(e.target.value),v(!1),D(0)},onKeyDown:N,onFocus:()=>{(0,A.ii)(!0)},onBlur:()=>{(0,A.ii)(!1)}}),(0,i.jsx)(be,{onChange:m,onFocus:function(){v(!0)},onBlur:function(){v(!1)},styles:H,currentValue:p,options:cl})]}),R&&(0,i.jsx)(Sl,{$left:Z,$top:S,children:(0,i.jsx)(kl.ZP,{items:$,width:316,isIndexSelected:L,getItemProps:B})})]})},Ol=o(40304),Ml=o(26202);function $l(e){let{tome:t,sameOrg:o}=e;const{apolloClient:n,clientId:a}=(0,L.bp)(),r=t.org;if(!r)return null;const{canManage:l}=t.currentUserPermission,s=!l||!o,d=(0,i.jsx)(Il,{children:(0,i.jsx)(Ml.Z,{})});return(0,i.jsx)(wl,{heading:r.name,currentValue:t.orgScope,icon:d,disabled:s,handler:e=>{const o={};o.orgScope="NONE"===e?null:e,(0,Ol.W8)(t.id,o,n,a)},options:ul})}var Ll=e=>{let{owner:t}=e;const{t:o}=(0,C.$G)();return(0,i.jsxs)(gl,{children:[(0,i.jsx)(Cl,{children:(0,i.jsx)(ml.Z,{user:t,size:20})}),(0,i.jsx)(fl,{children:(0,i.jsx)(xl,{title:o("tome.ownerRow.OwnerLabel"),children:t.name??o("tome.ownerRow.unknownOwnerName")})}),(0,i.jsx)(yl,{children:o("tome.ownerRow.OwnerLabel")})]})},Al=o(36230);var Nl=e=>{let{tome:t,publicSharing:o}=e;const{t:n}=(0,C.$G)(),{canManage:a}=t.currentUserPermission,{apolloClient:r,clientId:l}=(0,L.bp)();return(0,i.jsx)(wl,{icon:(0,i.jsx)(Il,{children:(0,i.jsx)(Al.Z,{})}),handler:e=>{const o={};o.publicScope="NONE"===e?null:e,(0,Ol.W8)(t.id,o,r,l)},options:pl,heading:n("tome.shareSheetPublic.anyoneWithTheLinkCanViewTomeLabel"),disabled:!a||!o,currentValue:t.publicScope})};var Dl=(0,a.forwardRef)(((e,t)=>(0,i.jsx)(ye.Z,{ref:t,viewBox:"0 0 64 64",...e,children:(0,i.jsx)("path",{fillRule:"evenodd",clipRule:"evenodd",d:"M12.0209 16.0209C12.0209 13.8118 13.8117 12.0209 16.0209 12.0209H20.0209C22.23 12.0209 24.0209 13.8118 24.0209 16.0209V20.0209C24.0209 22.23 22.23 24.0209 20.0209 24.0209H16.0209H16.0209C13.8117 24.0209 12.0209 22.23 12.0209 20.0209V16.0209ZM16.0209 19.0209C16.0209 19.5732 16.4686 20.0209 17.0209 20.0209H19.0209C19.5732 20.0209 20.0209 19.5732 20.0209 19.0209V17.0209C20.0209 16.4686 19.5732 16.0209 19.0209 16.0209H17.0209C16.4686 16.0209 16.0209 16.4686 16.0209 17.0209V19.0209ZM14.0209 32.0209H15.5209C15.797 32.0209 16.0209 31.797 16.0209 31.5209V30.0209C16.0209 28.9163 16.9163 28.0209 18.0209 28.0209C19.1254 28.0209 20.0209 28.9163 20.0209 30.0209V31.5209C20.0209 31.797 20.2447 32.0209 20.5209 32.0209H22.0209C23.1254 32.0209 24.0209 32.9163 24.0209 34.0209C24.0209 35.1255 23.1254 36.0209 22.0209 36.0209H14.0209C12.9163 36.0209 12.0209 35.1255 12.0209 34.0209C12.0209 32.9163 12.9163 32.0209 14.0209 32.0209ZM12.0209 44.0209C12.0209 41.8118 13.8117 40.0209 16.0209 40.0209H20.0209C22.23 40.0209 24.0209 41.8118 24.0209 44.0209V48.0209C24.0209 50.23 22.23 52.0209 20.0209 52.0209H16.0209H16.0209C13.8117 52.0209 12.0209 50.23 12.0209 48.0209V44.0209ZM16.0209 47.0209C16.0209 47.5732 16.4686 48.0209 17.0209 48.0209H19.0209C19.5732 48.0209 20.0209 47.5732 20.0209 47.0209V45.0209C20.0209 44.4686 19.5732 44.0209 19.0209 44.0209H17.0209C16.4686 44.0209 16.0209 44.4686 16.0209 45.0209V47.0209ZM50.0209 52.0209H46.0209C44.9163 52.0209 44.0209 51.1255 44.0209 50.0209C44.0209 48.9163 44.9163 48.0209 46.0209 48.0209H50.0209C51.1254 48.0209 52.0209 48.9163 52.0209 50.0209C52.0209 51.1255 51.1254 52.0209 50.0209 52.0209ZM52.0209 38.0209C52.0209 39.1255 51.1254 40.0209 50.0209 40.0209H48.5209C48.2447 40.0209 48.0209 40.2448 48.0209 40.5209V42.0209C48.0209 43.1255 47.1254 44.0209 46.0209 44.0209C44.9163 44.0209 44.0209 43.1255 44.0209 42.0209V38.0209C44.0209 36.9163 44.9163 36.0209 46.0209 36.0209H47.5209C47.797 36.0209 48.0209 35.797 48.0209 35.5209V32.5209C48.0209 32.2448 47.797 32.0209 47.5209 32.0209H46.0209C44.9163 32.0209 44.0209 31.1255 44.0209 30.0209C44.0209 28.9163 44.9163 28.0209 46.0209 28.0209H50.0209C51.1254 28.0209 52.0209 28.9163 52.0209 30.0209V38.0209ZM44.0209 12.0209H48.0209C50.23 12.0209 52.0209 13.8118 52.0209 16.0209V20.0209C52.0209 22.23 50.23 24.0209 48.0209 24.0209H44.0209C41.8117 24.0209 40.0209 22.23 40.0209 20.0209V16.0209V16.0208C40.0209 13.8117 41.8117 12.0208 44.0209 12.0208V12.0209ZM44.0209 19.0209C44.0209 19.5732 44.4686 20.0209 45.0209 20.0209H47.0209C47.5732 20.0209 48.0209 19.5732 48.0209 19.0209V17.0209C48.0209 16.4686 47.5732 16.0209 47.0209 16.0209H45.0209C44.4686 16.0209 44.0209 16.4686 44.0209 17.0209V19.0209ZM30.0209 16.0209C28.9163 16.0209 28.0209 15.1255 28.0209 14.0209C28.0209 12.9163 28.9163 12.0209 30.0209 12.0209H34.0209C35.1254 12.0209 36.0209 12.9163 36.0209 14.0209V23.5209C36.0209 23.797 36.2447 24.0209 36.5209 24.0209H38.0209C39.1254 24.0209 40.0209 24.9163 40.0209 26.0209C40.0209 27.1255 39.1254 28.0209 38.0209 28.0209H34.0209C32.9163 28.0209 32.0209 27.1255 32.0209 26.0209V24.5209C32.0209 24.2448 31.797 24.0209 31.5209 24.0209H30.0209C28.9163 24.0209 28.0209 23.1255 28.0209 22.0209C28.0209 20.9163 28.9163 20.0209 30.0209 20.0209H31.5209C31.797 20.0209 32.0209 19.797 32.0209 19.5209V16.0209H30.0209ZM28.0209 32.5209C28.0209 32.2448 27.797 32.0209 27.5209 32.0209H26.0209C24.9163 32.0209 24.0209 31.1255 24.0209 30.0209C24.0209 28.9163 24.9163 28.0209 26.0209 28.0209H30.0209C31.1254 28.0209 32.0209 28.9163 32.0209 30.0209V34.0209C32.0209 35.1255 31.1254 36.0209 30.0209 36.0209C28.9163 36.0209 28.0209 35.1255 28.0209 34.0209V32.5209ZM30.0209 40.0209H31.5209C31.797 40.0209 32.0209 39.797 32.0209 39.5209V38.0209C32.0209 36.9163 32.9163 36.0209 34.0209 36.0209H35.5209C35.797 36.0209 36.0209 35.797 36.0209 35.5209V34.0209C36.0209 32.9163 36.9163 32.0209 38.0209 32.0209C39.1254 32.0209 40.0209 32.9163 40.0209 34.0209V38.0209C40.0209 39.1255 39.1254 40.0209 38.0209 40.0209H36.5209C36.2447 40.0209 36.0209 40.2448 36.0209 40.5209V42.0209C36.0209 43.1255 35.1254 44.0209 34.0209 44.0209H30.0209C28.9163 44.0209 28.0209 43.1255 28.0209 42.0209C28.0209 40.9163 28.9163 40.0209 30.0209 40.0209ZM38.0209 44.0209C39.1254 44.0209 40.0209 44.9163 40.0209 46.0209V50.0209C40.0209 51.1255 39.1254 52.0209 38.0209 52.0209H30.0209C28.9163 52.0209 28.0209 51.1255 28.0209 50.0209C28.0209 48.9163 28.9163 48.0209 30.0209 48.0209H35.5209C35.797 48.0209 36.0209 47.797 36.0209 47.5209V46.0209C36.0209 44.9164 36.9162 44.021 38.0208 44.0209H38.0209Z"})})));const Bl="page";var Hl=function(e,t){let o=e;t&&(o=`${o}?${function(e){const t=new URLSearchParams;return t.set(Bl,e),t.toString()}(t)}`),navigator.clipboard.writeText(o)},Vl=o(40920);const Fl=g.ZP.div.withConfig({displayName:"SharingSheetCopyLink__CopyLinkRowWrapper",componentId:"sc-ddba57e-0"})`
  width: 100%;
  height: 28px;
  margin-top: 6px;
  display: flex;
  flex-direction: row;
`,Gl=g.ZP.div.withConfig({displayName:"SharingSheetCopyLink__CurrentPageCheckboxWrapper",componentId:"sc-ddba57e-1"})`
  width: 100%;
  height: 16px;
  margin-left: 3.125px;
  margin-top: 6px;
  display: flex;
  flex-direction: row;
`,Ul=g.ZP.div.withConfig({displayName:"SharingSheetCopyLink__CopyLinkText",componentId:"sc-ddba57e-2"})`
  font-size: ${e=>e.theme.fontSizes.sm};
  color: ${e=>e.theme.colors.contrast40};
  padding-left: 10px;
  cursor: pointer;
`,zl=(0,g.ZP)(Re.ZP).withConfig({displayName:"SharingSheetCopyLink__SharingButton",componentId:"sc-ddba57e-3"})`
  margin-left: 8px;
  width: 90px;
  min-width: 90px;
  padding: 12px;
`,Wl=(0,g.ZP)(zl).withConfig({displayName:"SharingSheetCopyLink__QrCodeButton",componentId:"sc-ddba57e-4"})`
  margin-left: auto;
  width: 36px;
  min-width: 36px;
  padding: 0;
`;var Kl=e=>{let{sharingSheetOpen:t,activePageId:o,toggleQrCode:n,showQrCode:r,canonicalUrl:l}=e;const[s,d]=(0,a.useState)(!1),[c,u]=(0,a.useState)(!1),{t:p}=(0,C.$G)();(0,a.useEffect)((()=>{d(!1)}),[t]);return(0,i.jsxs)(Fl,{children:[(0,i.jsxs)(Gl,{children:[(0,i.jsx)(Vl.Z,{height:13.75,width:13.75,checked:c,onClick:()=>u((e=>!e))}),(0,i.jsx)(Ul,{onClick:()=>u((e=>!e)),children:p("tome.sharingSheetCopyLink.linkToCurrentPageCheckboxText")})]}),(0,i.jsx)(Wl,{onClick:n,selected:r,"aria-label":p("tome.sharingSheetCopyLink.ToggleQRCodeButtonLabel"),children:(0,i.jsx)(Dl,{style:{width:20,height:20}})}),(0,i.jsx)(zl,{onClick:()=>(Hl(l,c&&o?o:void 0),void d(!0)),children:p(s?"tome.sharingSheetCopyLink.copiedLinkButtonLabel":"tome.sharingSheetCopyLink.copyLinkButtonLabel")})]})};const ql=g.ZP.div.withConfig({displayName:"SharingSheet__QRCodeWrapper",componentId:"sc-77e2c809-0"})`
  width: 100%;
  margin-top: 6px;
  padding: 8px 12px 0 12px;
`,Yl=g.ZP.div.withConfig({displayName:"SharingSheet__QRCodeStyles",componentId:"sc-77e2c809-1"})`
  background-color: ${e=>{let{theme:t}=e;return t.colors.sheetBg}};
  width: 100%;
  height: 100%;
  padding: 16px;
  margin: auto;
`;var Jl=e=>{let{sharingSheetOpen:t,setSharingSheetOpen:o,tome:n,shareButtonRef:r,activePageId:l}=e;var s;const d=(0,g.Fg)(),c=(0,a.useRef)(null),[u,p]=(0,a.useState)(!1),m=(0,a.useCallback)((()=>{p((e=>!e))}),[]),h=(0,a.useCallback)((()=>{o(!1)}),[o]);(0,ol.Z)({handleClose:h,enabled:t});const{user:C,flags:f,loading:x,activeMembership:v}=(0,a.useContext)(oi.Z);if(x||!C)return null;const{canManage:b}=n.currentUserPermission,{publicSharing:y}=f||{};let w=!1;var T;(null===(s=v)||void 0===s?void 0:s.org)&&n.author.org&&(w=n.author.org.id===v.org.id||(null===(T=n.org)||void 0===T?void 0:T.id)===v.org.id);return(0,i.jsx)(Tl,{children:t&&(0,i.jsxs)(ni.Z,{exemptContainerRefs:[r,c],onClick:()=>o(!1),children:[b&&(0,i.jsx)(Rl,{tome:n}),(0,i.jsx)(Ll,{owner:n.author}),v&&(0,i.jsx)($l,{tome:n,sameOrg:w}),(0,i.jsx)(El,{tome:n}),(0,i.jsx)(Pl,{}),(0,i.jsx)(Nl,{tome:n,publicSharing:y}),(0,i.jsx)(Kl,{sharingSheetOpen:t,activePageId:l,showQrCode:u,toggleQrCode:m,canonicalUrl:n.canonicalUrl}),u&&(0,i.jsx)(ql,{"data-testid":"qr_code",children:(0,i.jsx)(Yl,{children:(0,i.jsx)(tl.Z,{value:window.location.href,size:278,bgColor:d.colors.sheetBg,fgColor:d.colors.contrast})})})]})})},Xl=o(99261);var Ql=()=>{const[e,t]=(0,r.FV)(A.Fc);return(0,a.useEffect)((()=>{const e=()=>{void 0!==window.document.webkitIsFullScreen?t(window.document.webkitIsFullScreen):t(!!window.document.fullscreenElement)};window.document.onfullscreenchange=e,window.document.onwebkitfullscreenchange=e}),[t]),e};var es=e=>{let{timeout:t,disabled:o}=e;const n=(0,a.useRef)(),[i,r]=(0,a.useState)(!1),l=(0,a.useCallback)((()=>{r(!1)}),[r]),s=(0,a.useCallback)((()=>{r(!0)}),[r]);return(0,a.useEffect)((()=>{const e=()=>{n.current&&clearTimeout(n.current),n.current=setTimeout((()=>{o||r(!0)}),t),r(!1)};return o?(n.current&&clearTimeout(n.current),window.removeEventListener("mousemove",e)):(e(),window.addEventListener("mousemove",e)),()=>window.removeEventListener("mousemove",e)}),[n,t,o]),(0,a.useEffect)((()=>{o&&(n.current&&clearTimeout(n.current),r(!1))}),[o]),(0,a.useEffect)((()=>{i?document.documentElement.classList.add("hideCursor"):document.documentElement.classList.remove("hideCursor")}),[i]),{showCursor:l,hideCursor:s}};const ts=(e,t)=>(0,i.jsx)(ye.Z,{ref:t,width:"6",height:"6",viewBox:"0 0 6 6",fill:"none",xmlns:"http://www.w3.org/2000/svg",...e,children:(0,i.jsx)("circle",{cx:"3",cy:"3",r:"2.5",fill:"#ED00EB"})});var os=(0,a.forwardRef)(ts),ns=o(99691);const is=p()((()=>Promise.all([o.e(2432),o.e(5453),o.e(8080),o.e(7443),o.e(7024),o.e(5169)]).then(o.bind(o,75169))),{loadableGenerated:{webpack:()=>[75169]},loading:e=>{let{error:t}=e;return(0,i.jsx)(ns.ex,{error:t})}}),as=p()((()=>Promise.all([o.e(2432),o.e(5453),o.e(8080),o.e(7443),o.e(7024),o.e(1809)]).then(o.bind(o,41809))),{loadableGenerated:{webpack:()=>[41809]},loading:e=>{let{error:t}=e;return(0,i.jsx)(ns.ex,{error:t})}}),rs=g.ZP.div.withConfig({displayName:"CommentsSheet__CommentsSheetWrapper",componentId:"sc-ced48faf-0"})`
  cursor: default;
  position: absolute;
  top: ${e=>e.theme.headerHeight}px;
  right: 12px;
  pointer-events: auto;

  > div {
    box-shadow: ${e=>{let{theme:t}=e;return t.colors.sheetBoxShadow}};
    background: ${e=>e.theme.colors.sheetBg};
    width: ${340}px;
    border-radius: 18px;
    padding: 12px 0 12px 0;
  }
  z-index: ${I.Ue};
`,ls=(0,g.ZP)(Me).withConfig({displayName:"CommentsSheet__StyledSegmentedControls",componentId:"sc-ced48faf-1"})`
  display: flex;
  & button {
    flex: 1;
    text-transform: capitalize;
    // Prevent buttons from expanding beyond the bounds of the segmented
    // controls container.
    min-width: 0;
  }
`,ss=g.ZP.div.withConfig({displayName:"CommentsSheet__SheetStyles",componentId:"sc-ced48faf-2"})``,ds=g.ZP.div.withConfig({displayName:"CommentsSheet__ToggleContainerStyles",componentId:"sc-ced48faf-3"})`
  padding: 0 16px 0 16px;
  z-index: ${I.tF};
`,cs=g.ZP.div.withConfig({displayName:"CommentsSheet__ContentStyles",componentId:"sc-ced48faf-4"})`
  margin-top: 0px;
`;var us=e=>{let{commentsSheetOpen:t,tome:o}=e;const{t:n}=(0,C.$G)(),l=(0,r.sJ)(A.Vx),[s,d]=(0,a.useState)(n("components.commentsSheet.showCommentsFromCurrentTomePageOnly")),{user:c}=(0,a.useContext)(oi.Z),u=(0,a.useCallback)((()=>{(0,A.k$)(!1)}),[]);(0,ol.Z)({handleClose:u,enabled:t}),(0,a.useEffect)((()=>{d(n("components.commentsSheet.showCommentsFromCurrentTomePageOnly"))}),[t,n]);const{commentsSheetRef:p}=(0,L.TR)(),m=(0,dr.Ti)(o),h=(0,N.yW)(o.pages,l);return(0,i.jsx)(rs,{ref:p,children:c&&t&&(0,i.jsxs)(ss,{"data-testid":"comments_sheet",children:[(0,i.jsx)(ds,{children:(0,i.jsx)(ls,{role:"listbox",children:n("components.commentsSheet.sectionsOfTomeToShowCommentsFrom",{returnObjects:!0}).map((e=>(0,i.jsx)(Re.ZP,{"aria-selected":s===e,onClick:()=>d(e),value:e,isSegment:!0,selected:s===e,iconOpacity:1,endIcon:e===n("components.commentsSheet.showCommentsFromEntireTome")&&m?(0,i.jsx)(os,{style:{width:5,height:5,opacity:1}}):null,children:e},e)))})}),(0,i.jsx)(cs,{children:(0,i.jsx)(i.Fragment,{children:s===n("components.commentsSheet.showCommentsFromCurrentTomePageOnly")?(0,i.jsx)(is,{canCommentOnTome:o.currentUserPermission.canComment,page:h}):(0,i.jsx)(as,{tome:o,setPageView:d})})})]})})};var ps=(0,a.forwardRef)(((e,t)=>(0,i.jsx)(ye.Z,{ref:t,viewBox:"0 0 64 64",...e,children:(0,i.jsx)("path",{fillRule:"evenodd",clipRule:"evenodd",d:"M41.3065 8.52829C40.478 7.79872 39.2149 7.87896 38.4853 8.7075L27.7047 20.7804C27.3471 21.1497 27.2971 21.6497 27.7047 22.0497L41.3766 35.7763C41.7471 36.1496 42.4471 36.1596 42.8123 35.7763L47.4818 30.3496C47.8026 29.9849 47.9797 29.5159 47.98 29.0301C47.9807 27.9256 47.0859 27.0295 45.9813 27.0288H35.857L41.8609 10.7202C42.1468 9.94519 41.9264 9.07418 41.3065 8.52829ZM22.6906 55.5213C23.5191 56.2508 24.7822 56.1706 25.5118 55.3421L36.2924 43.2691C36.65 42.8999 36.7 42.3999 36.2924 41.9999L22.6205 28.2733C22.25 27.8999 21.55 27.8899 21.1847 28.2733L16.5153 33.7C16.1945 34.0647 16.0174 34.5337 16.0171 35.0194C16.0164 36.124 16.9112 37.02 18.0158 37.0208H28.1401L22.1362 53.3294C21.8503 54.1044 22.0706 54.9754 22.6906 55.5213ZM13.4204 10.5506L53.4318 50.5857C54.2136 51.3669 54.2141 52.6339 53.433 53.4157C52.6518 54.1975 51.3847 54.1981 50.6029 53.4169L10.591 13.3818C9.8092 12.6004 9.8088 11.3333 10.5901 10.5515C11.3714 9.76965 12.6386 9.76925 13.4204 10.5506Z",fill:"#D05B41"})}))),ms=o(6990);var hs=o(50456).ZP`
  query tomePresence($id: String!) {
    tome(id: $id) {
      ...TomeViewsFragment
    }
  }
  ${G.CIe}
`,gs=o(44308);var Cs=e=>{let{tomeId:t}=e;var o,n,i,r,l;const{width:s}=(0,B.Z)(),{t:d}=(0,C.$G)(),c=(0,a.useMemo)((()=>(0,gs.tQ)(s??0)),[s]),{data:u}=(0,G.sn6)({variables:{tomeId:t},fetchPolicy:"network-only",nextFetchPolicy:"cache-first"}),p=(0,q.a)(hs,{variables:{id:t},fetchPolicy:"network-only",nextFetchPolicy:"cache-first"});if(p.error)throw p.error;if(p.loading||void 0===p.data)return{seenHeadViewModels:[],overflowViewModels:[],anonymousViewers:0,userOrgName:""};const m=(null===(n=p.data)||void 0===n||null===(o=n.tome)||void 0===o?void 0:o.views)||[],h=p.data.tome.anonymousViews,g=(0,gs.K3)(m).map(gs.Pr);return h&&h>0&&g.push({label:`${h.toLocaleString()}${d("controllers.tomePresenceViewModel.viewers_with_count",{count:h})}`,isActive:!1,activityId:"anonymousCountRow"}),{seenHeadViewModels:(0,gs.UO)(m).map(gs.Pr).splice(0,c),overflowViewModels:g,anonymousViewers:h??0,userOrgName:(null===(l=u)||void 0===l||null===(r=l.tome)||void 0===r||null===(i=r.org)||void 0===i?void 0:i.name)??""}},fs=o(54817);var xs=e=>{let{tomeId:t,navigateToPage:o}=e;const{seenHeadViewModels:n,overflowViewModels:a,anonymousViewers:r,userOrgName:l}=Cs({tomeId:t});return(0,i.jsx)(fs.Z,{seenHeadsViewModels:n,overflowViewModels:a,avatarSize:20,animated:!0,navigateToPage:o,anonymousViewers:r,userOrgName:l})};var vs=function(e){return e.canView&&!e.canEdit&&!e.canComment&&!e.canManage};var bs=()=>{const{titleEditableLabelRef:e}=(0,L.TR)(),t=(0,a.useCallback)((()=>{e.current&&e.current.focus()}),[e]);return{titleEditableLabelRef:e,focusOnTitle:t}},ys=o(57622),ws=o(92875);var Ts=(0,a.forwardRef)(((e,t)=>(0,i.jsx)(ye.Z,{ref:t,viewBox:"0 0 64 64",...e,children:(0,i.jsxs)("g",{children:[(0,i.jsx)("path",{d:"M32 42C37.5228 42 42 37.5228 42 32C42 26.4772 37.5228 22 32 22C26.4772 22 22 26.4772 22 32C22 37.5228 26.4772 42 32 42Z"}),(0,i.jsx)("path",{fillRule:"evenodd",clipRule:"evenodd",d:"M56 32C56 45.2548 45.2548 56 32 56C18.7452 56 8 45.2548 8 32C8 18.7452 18.7452 8 32 8C45.2548 8 56 18.7452 56 32ZM52 32C52 43.0457 43.0457 52 32 52C20.9543 52 12 43.0457 12 32C12 20.9543 20.9543 12 32 12C43.0457 12 52 20.9543 52 32Z"})]})}))),Is=o(33471),Ps=o(79249);const Es=g.ZP.div.withConfig({displayName:"HeaderPermissionsIndicator__StyledIndicator",componentId:"sc-9a82aba3-0"})`
  font-size: 13px;
  line-height: 16px;
  color: ${e=>e.theme.colors.contrast40};
  overflow: hidden;
  text-overflow: ellipsis;
  white-space: nowrap;

  @media ${Ps.Hb.tablet} {
    display: none;
  }
`;var _s=e=>{let{permissions:t}=e;const{t:o}=(0,C.$G)(),n=(0,s.l)(A.Ad),r=(0,a.useCallback)((()=>n.length>0?o("tome.header.headerPermissionsIndicator.readOnlyPermissionIndicatorLabel"):t.isAuthor||t.canEdit?null:t.canComment?o("tome.header.headerPermissionsIndicator.commentOnlyPermissionIndicatorLabel"):t.canView?o("tome.header.headerPermissionsIndicator.viewOnlyPermissionIndicatorLabel"):null),[t,n,o])();return r?(0,i.jsx)(Es,{children:r}):null};const js=(e,t)=>{const{style:o,...n}=e;return(0,i.jsx)(ye.Z,{ref:t,style:{...o},viewBox:"0 0 64 64",...n,children:(0,i.jsx)("path",{d:"M20 46.6906V17.3094C20 14.643 22.8944 12.9835 25.1956 14.3305L50.292 29.021C52.5693 30.3541 52.5693 33.6459 50.292 34.979L25.1956 49.6695C22.8944 51.0165 20 49.357 20 46.6906Z"})})};var ks=(0,a.forwardRef)(js);const Ss=e=>{let{visible:t,children:o,as:n,...a}=e;const r=n||d.E.div;return(0,i.jsx)(c.M,{children:t&&(0,i.jsx)(r,{...a,transition:P.Oo,initial:{opacity:0},animate:{opacity:t?1:0},exit:{opacity:0},children:o})})},Zs=e=>{let{enterPresentMode:t}=e;var o,n;const{t:r}=(0,C.$G)(),{flags:l}=(0,a.useContext)(oi.Z),s=(0,g.Fg)(),d=(null===(o=l)||void 0===o?void 0:o.editorIaUpdates)?s.buttonSize:s.largerButtonSize;return(0,i.jsx)($o.Z,{content:r("tome.header.control.togglePresentMode.enterPresentMode"),shortcuts:[(0,Is.C6)(),"P"],placement:"bottom",perpendicularOffset:-20,children:(0,i.jsx)(Dr,{onClick:t,"aria-label":r("tome.header.control.togglePresentMode.playAriaLabel"),onZ0:!0,icon:(null===(n=l)||void 0===n?void 0:n.editorIaUpdates)?(0,i.jsx)(ks,{style:{width:24,height:24}}):(0,i.jsx)(ks,{style:{width:28,height:28}}),style:{width:d,height:d,minWidth:d}})})},Rs=e=>{let{permission:t,exitPresentMode:o}=e;var n,l;const{workspaceUrl:s}=(0,Pr.B)(),d=(0,r.sJ)(A.SM),{t:c}=(0,C.$G)(),{flags:u}=(0,a.useContext)(oi.Z),p=(0,g.Fg)(),m=(null===(n=u)||void 0===n?void 0:n.editorIaUpdates)?p.buttonSize:p.largerButtonSize;var h;if(t.canEdit||t.canComment)return(0,i.jsx)($o.Z,{content:c("tome.header.control.togglePresentMode.exitPresentMode"),shortcuts:["esc"],placement:"bottom",perpendicularOffset:-10,children:(0,i.jsx)(Dr,{onClick:o,"aria-label":c("tome.header.control.togglePresentMode.exitPlayAriaLabel"),icon:(null===(h=u)||void 0===h?void 0:h.editorIaUpdates)?(0,i.jsx)(ft.Z,{style:{width:24,height:24}}):(0,i.jsx)(ft.Z,{style:{width:28,height:28}}),style:{width:m,height:m,minWidth:m}})});const f=(0,i.jsx)(Dr,{"aria-label":c("tome.header.control.togglePresentMode.exitPlayAriaLabel"),icon:(null===(l=u)||void 0===l?void 0:l.editorIaUpdates)?(0,i.jsx)(ft.Z,{style:{width:24,height:24}}):(0,i.jsx)(ft.Z,{style:{width:28,height:28}}),style:{width:m,height:m,minWidth:m}});return(0,i.jsx)($o.Z,{content:c("tome.header.control.togglePresentMode.exitPresentMode"),shortcuts:["esc"],placement:"bottom",perpendicularOffset:-10,children:(0,i.jsx)("div",{children:d?(0,i.jsx)("a",{href:s,target:"_blank",children:f}):(0,i.jsx)(yr(),{href:s,children:f})})})};var Os=e=>{let{permission:t,presentMode:o,exitPresentMode:n,enterPresentMode:r}=e;var l;const{flags:s}=(0,a.useContext)(oi.Z);return(0,i.jsxs)(Ar,{style:{marginLeft:8,width:(null===(l=s)||void 0===l?void 0:l.editorIaUpdates)?32:40},children:[(0,i.jsx)(Ss,{visible:!o,as:Br,children:(0,i.jsx)(Ar,{children:(0,i.jsx)(Zs,{enterPresentMode:r})})}),(0,i.jsx)(Ss,{visible:o,as:Br,initial:!1,children:(0,i.jsx)(Ar,{children:(0,i.jsx)(Rs,{permission:t,exitPresentMode:n})})})]})},Ms=o(20564),$s=o(67633),Ls=o(27563);const As=(0,g.ZP)(d.E.div).withConfig({displayName:"Attribution__TitleRow",componentId:"sc-fa90b895-0"})`
  display: flex;
  transform-origin: 0% 0% 0px;
`,Ns=(0,g.ZP)(d.E.div).withConfig({displayName:"Attribution__Title",componentId:"sc-fa90b895-1"})`
  font-size: 15px;
  line-height: 20px;
  white-space: nowrap;
  overflow: hidden;
  color: ${e=>{let{$presentMode:t,theme:o}=e;return t?o.colors.attributionTitle:o.colors.attributionTitlePresentMode}};
`,Ds=g.ZP.div.withConfig({displayName:"Attribution__TitleOverflow",componentId:"sc-fa90b895-2"})`
  ${te.wR}
`,Bs=(0,g.ZP)(Re.ZP).withConfig({displayName:"Attribution__UpgradeButton",componentId:"sc-fa90b895-3"})`
  height: 22px;
  padding: 0 6px;
  min-width: 0;
  margin-left: 8px;
`,Hs=(0,g.ZP)(d.E.div).withConfig({displayName:"Attribution__AttributionContent",componentId:"sc-fa90b895-4"})`
  pointer-events: none !important;
  * {
    pointer-events: all;
  }
`,Vs={notPresentMode:{x:40,transitionStart:{overflow:"visible"},width:"100%"},presentMode:{x:10,transitionEnd:{overflow:"hidden"}},mobile:{x:0,transitionEnd:{overflow:"hidden"},width:"100%"}};var Fs=e=>{let{title:t,presentMode:o,renameTome:n=(()=>null),titleEditableLabelRef:r,isEditor:l=!1,isMobile:s,showUpgradeButton:d=!1}=e;const{t:c}=(0,C.$G)(),{openSettings:u}=(0,$s.r)(),{apolloClient:p}=(0,L.bp)(),m=(0,a.useRef)(null),h=[];s?h.push("mobile"):o?h.push("presentMode"):h.push("notPresentMode");const g=(0,a.useCallback)((()=>{Ne.ZP.reportPaymentEvent({apolloClient:p,trackEventType:Ne.nM.CLICK_TOME_UPGRADE_BUTTON}),u(Ls.u.PLANS)}),[p,u]);return(0,i.jsx)(Hs,{ref:m,transition:P.Oo,initial:!1,variants:Vs,animate:h,children:(0,i.jsxs)(As,{id:"HeaderTitle",transition:P.Oo,initial:!1,animate:{y:14,x:0},style:{position:o?"unset":"fixed"},children:[(0,i.jsx)(Ns,{$presentMode:o,children:o?(0,i.jsx)(Ds,{children:t}):(0,i.jsx)(Ms.Z,{labelId:"tome-attribution",dataTestId:"tome_title",ref:r,plainContent:t,disabled:!l||o,onContentChange:n,maxCharacterLimit:128,allowEmptyValue:!1,selectAllOnFocus:!0,shouldSetGlobalState:!0,style:{zIndex:1}})}),d&&(0,i.jsx)(Bs,{"aria-label":c("upgradeButton.ariaLabel"),"data-testid":"tome_upgrade",onClick:g,children:c("upgradeButton.label")})]})})},Gs=o(80882);const Us=g.ZP.div.withConfig({displayName:"CommentsButtonWrapper__ContentStyles",componentId:"sc-1dc15fdd-0"})`
  cursor: pointer;
  display: flex;
`;var zs=e=>{let{tome:t,toggleCommentsPanel:o,...n}=e;const{t:a}=(0,C.$G)();return(0,i.jsx)(i.Fragment,{children:(0,i.jsx)($o.Z,{content:a("components.commentsButtonWrapper.commentsButtonTooltipLabel"),shortcuts:[(0,Is.C6)(),"M"],placement:"bottom",children:(0,i.jsx)(Us,{onClick:o,children:n.children()})})})},Ws=o(8034);const Ks=(0,a.forwardRef)(((e,t)=>{let{visible:o,tome:n,toggleCommentsPanel:a,unreadBadge:r,commentsCount:l,flags:s}=e;var d;const c=(0,g.Fg)(),u=(null===(d=s)||void 0===d?void 0:d.editorIaUpdates)?c.buttonSize:c.largerButtonSize;return(0,i.jsx)(Ss,{visible:o,children:(0,i.jsx)(Nr,{ref:t,children:(0,i.jsx)(zs,{tome:n,toggleCommentsPanel:a,children:()=>{var e;return(0,i.jsx)(Dr,{onZ0:!0,"aria-label":ll.ZP.t("tome.header.control.comments.commentsButtonLabel"),startIcon:(0,i.jsx)(Gs.Z,{$visible:r,children:(null===(e=s)||void 0===e?void 0:e.editorIaUpdates)?(0,i.jsx)(Ws.Z,{style:{height:24,width:24}}):(0,i.jsx)(Ws.Z,{style:{height:28,width:28}})}),iconStyles:{margin:2,marginLeft:-2,marginRight:l>0?4:0},style:{padding:"0 6px",width:u,height:u,minWidth:u},children:l>0&&l})}})})})}));var qs=Ks,Ys=o(30990),Js=o(5372),Xs=o(52554),Qs=o(62081),ed=o(98299);const td=()=>{const e=window.document.documentElement;try{e.requestFullscreen?e.requestFullscreen():e.webkitRequestFullscreen&&e.webkitRequestFullscreen()}catch(e){}};var od=o(12910),nd=o(80389),id=o(84096),ad=(0,a.forwardRef)(((e,t)=>(0,i.jsxs)(ye.Z,{ref:t,viewBox:"0 0 64 64",...e,children:[(0,i.jsx)("path",{d:"M30 20C30 18.8954 30.8954 18 32 18C33.1046 18 34 18.8954 34 20V30H44C45.1046 30 46 30.8954 46 32C46 33.1046 45.1046 34 44 34H34V44C34 45.1046 33.1046 46 32 46C30.8954 46 30 45.1046 30 44V34H20C18.8954 34 18 33.1046 18 32C18 30.8954 18.8954 30 20 30H30V20Z"}),(0,i.jsx)("path",{fillRule:"evenodd",clipRule:"evenodd",d:"M10 18C10 13.5817 13.5817 10 18 10H46C50.4183 10 54 13.5817 54 18V46C54 50.4183 50.4183 54 46 54H18C13.5817 54 10 50.4183 10 46V18ZM14 18C14 15.7909 15.7909 14 18 14H46C48.2091 14 50 15.7909 50 18V46C50 48.2091 48.2091 50 46 50H18C15.7909 50 14 48.2091 14 46V18Z"})]})));var rd=(0,a.forwardRef)(((e,t)=>(0,i.jsx)(ye.Z,{ref:t,viewBox:"0 0 64 64",...e,children:(0,i.jsx)("path",{fillRule:"evenodd",clipRule:"evenodd",d:"M48.6917 41.7479C48.2942 42.0905 47.6999 42.0689 47.3284 41.6984L42.5471 36.9153C42.2705 36.638 42.1817 36.2246 42.32 35.8581V35.8581C44.4445 30.1735 41.5586 23.843 35.874 21.7184C33.3946 20.7918 30.6641 20.7912 28.1844 21.7169C27.8179 21.8551 27.4045 21.7661 27.1273 21.4895L23.9328 18.2937C23.6882 18.0499 23.6876 17.6541 23.9313 17.4095C24.0002 17.3404 24.0844 17.2884 24.177 17.2576H24.177C26.7041 16.4337 29.3463 16.0176 32.0044 16.0249C46.6744 16.0249 53.9603 27.6936 55.7744 31.098V31.098C56.0823 31.6741 56.0823 32.3658 55.7744 32.9419C53.9586 36.2768 51.5597 39.2593 48.6917 41.7479L48.6917 41.7479ZM13.4332 10.6159L53.4256 50.6281C54.2068 51.409 54.2072 52.6753 53.4263 53.4566C52.6455 54.2378 51.3791 54.2382 50.5979 53.4573L10.6055 13.4452C9.82419 12.6644 9.82383 11.398 10.6047 10.6167C11.3855 9.83543 12.6519 9.83507 13.4332 10.6159ZM16.6773 22.344L21.4812 27.15C21.757 27.4267 21.8461 27.8389 21.7092 28.2048C19.5983 33.8955 22.5002 40.22 28.1909 42.3309C30.6555 43.2451 33.3661 43.2457 35.831 42.3325C36.1969 42.1956 36.609 42.2849 36.8856 42.5608L40.0709 45.7476C40.3154 45.9914 40.316 46.3872 40.0723 46.6318C40.0034 46.7009 39.9192 46.7529 39.8266 46.7837C37.301 47.6065 34.6606 48.0221 32.0044 48.0148C17.3344 48.0148 10.0485 36.3462 8.23438 32.9419C7.92627 32.3659 7.92627 31.674 8.23438 31.098L8.23438 31.098C10.0491 27.7642 12.4467 24.7826 15.3134 22.2946C15.711 21.9518 16.3055 21.9734 16.6773 22.344V22.344Z"})})));var ld=(0,a.forwardRef)(((e,t)=>(0,i.jsxs)(ye.Z,{ref:t,viewBox:"0 0 64 64",...e,children:[(0,i.jsx)("path",{d:"M14 21C14 19.8954 14.8954 19 16 19H24C25.1046 19 26 18.1046 26 17C26 15.8954 25.1046 15 24 15H16C12.6863 15 10 17.6863 10 21V27C10 28.1046 10.8954 29 12 29C13.1046 29 14 28.1046 14 27V21Z"}),(0,i.jsx)("path",{d:"M50 21C50 19.8954 49.1046 19 48 19H40C38.8954 19 38 18.1046 38 17C38 15.8954 38.8954 15 40 15H48C51.3137 15 54 17.6863 54 21V27C54 28.1046 53.1046 29 52 29C50.8954 29 50 28.1046 50 27V21Z"}),(0,i.jsx)("path",{d:"M16 45C14.8954 45 14 44.1046 14 43V37C14 35.8954 13.1046 35 12 35C10.8954 35 10 35.8954 10 37V43C10 46.3137 12.6863 49 16 49H24C25.1046 49 26 48.1046 26 47C26 45.8954 25.1046 45 24 45H16Z"}),(0,i.jsx)("path",{d:"M50 43C50 44.1046 49.1046 45 48 45H40C38.8954 45 38 45.8954 38 47C38 48.1046 38.8954 49 40 49H48C51.3137 49 54 46.3137 54 43V37C54 35.8954 53.1046 35 52 35C50.8954 35 50 35.8954 50 37V43Z"})]})));var sd=(0,a.forwardRef)(((e,t)=>(0,i.jsxs)(ye.Z,{ref:t,viewBox:"0 0 64 64",...e,children:[(0,i.jsx)("path",{fillRule:"evenodd",clipRule:"evenodd",d:"M41.9899 31.9792C41.9899 37.5021 37.5146 41.9792 31.9941 41.9792C26.4736 41.9792 21.9984 37.5021 21.9984 31.9792C21.9984 26.4564 26.4736 21.9792 31.9941 21.9792C37.5146 21.9792 41.9899 26.4564 41.9899 31.9792ZM37.9916 31.9792C37.9916 35.293 35.3064 37.9792 31.9941 37.9792C28.6818 37.9792 25.9967 35.293 25.9967 31.9792C25.9967 28.6655 28.6818 25.9792 31.9941 25.9792C35.3064 25.9792 37.9916 28.6655 37.9916 31.9792Z"}),(0,i.jsx)("path",{fillRule:"evenodd",clipRule:"evenodd",d:"M31.9999 14C16.1413 14 8.34537 26.6083 6.46618 30.1363C5.84479 31.3006 5.84461 32.6982 6.46564 33.8627C8.34386 37.3892 16.1398 50 31.9999 50C47.8586 50 55.6545 37.3917 57.5337 33.8637C58.1553 32.6994 58.1554 31.3017 57.5342 30.1373C55.656 26.6108 47.8601 14 31.9999 14ZM31.9999 46C18.5454 46 11.7686 35.3057 10.0041 32C11.7686 28.6943 18.5454 18 31.9999 18C45.4545 18 52.2312 28.6943 53.9958 32C52.2312 35.3057 45.4545 46 31.9999 46Z"})]})));var dd=(0,a.forwardRef)(((e,t)=>(0,i.jsx)(ye.Z,{ref:t,viewBox:"0 0 64 64",...e,children:(0,i.jsx)("path",{fillRule:"evenodd",clipRule:"evenodd",d:"M16 12C16 10.8954 15.1046 10 14 10C12.8954 10 12 10.8954 12 12V22C12 23.1046 12.8954 24 14 24H24C25.1046 24 26 23.1046 26 22C26 20.8954 25.1046 20 24 20H18.5836C20.7681 17.5575 23.5854 15.7502 26.7373 14.7865C30.3725 13.6751 34.2661 13.7431 37.8603 14.9807C41.4544 16.2182 44.5645 18.5618 46.7448 21.6756C48.9251 24.7894 50.0636 28.5135 49.9973 32.3142C49.9309 36.1148 48.6631 39.7969 46.3755 42.8327C44.0878 45.8685 40.8978 48.1021 37.2627 49.2135C33.6276 50.3249 29.7339 50.2569 26.1398 49.0193C23.1785 47.9997 20.5458 46.2292 18.491 43.8957C17.7611 43.0667 16.5218 42.838 15.617 43.4715C14.7122 44.1051 14.4856 45.3591 15.1987 46.2027C17.7503 49.2212 21.0771 51.5066 24.8375 52.8014C29.2303 54.314 33.9892 54.397 38.4322 53.0387C42.8751 51.6804 46.774 48.9504 49.57 45.2399C52.366 41.5295 53.9156 37.0292 53.9967 32.384C54.0778 27.7387 52.6862 23.1871 50.0214 19.3813C47.3566 15.5756 43.5554 12.7112 39.1625 11.1986C34.7697 9.68602 30.0108 9.60295 25.5678 10.9613C21.9042 12.0814 18.6104 14.1342 16 16.9003V12ZM16 19.9431V20H16.0755L16 19.9431Z"})}))),cd=o(61900);var ud=(0,a.forwardRef)(((e,t)=>(0,i.jsxs)(ye.Z,{ref:t,viewBox:"0 0 64 64",...e,children:[(0,i.jsx)("path",{d:"M39 10C38.4477 10 38 10.4477 38 11C38 11.5523 38.4477 12 39 12H44V52H39C38.4477 52 38 52.4477 38 53C38 53.5523 38.4477 54 39 54H51C51.5523 54 52 53.5523 52 53C52 52.4477 51.5523 52 51 52H46V12H51C51.5523 12 52 11.5523 52 11C52 10.4477 51.5523 10 51 10H39Z"}),(0,i.jsx)("path",{d:"M12 19C12 17.8954 12.8954 17 14 17H34C35.1046 17 36 17.8954 36 19C36 20.1046 35.1046 21 34 21H26V45C26 46.1046 25.1046 47 24 47C22.8954 47 22 46.1046 22 45V21H14C12.8954 21 12 20.1046 12 19Z"})]})));var pd=(0,a.forwardRef)(((e,t)=>(0,i.jsx)(ye.Z,{ref:t,viewBox:"0 0 64 64",...e,children:(0,i.jsx)("path",{fillRule:"evenodd",clipRule:"evenodd",d:"M24 19.2171V11C24 7.68629 26.6863 5 30 5H36.4006C38.0591 5 39.6435 5.68645 40.7778 6.89635L52.3772 19.269C52.5923 19.4985 52.7877 19.743 52.9624 20H53V20.056C53.6481 21.0331 54 22.1856 54 23.3727V39C54 42.3137 51.3137 45 48 45H40V53C40 56.3137 37.3137 59 34 59H16C12.6863 59 10 56.3137 10 53V25C10 21.6863 12.6863 19 16 19H22.4006C22.9462 19 23.4838 19.0743 24 19.2171ZM50 39C50 40.1046 49.1046 41 48 41H40V37.3727C40 36.1856 39.6481 35.0331 39 34.056V34H38.9624C38.7877 33.743 38.5923 33.4985 38.3772 33.269L28 22.2V11C28 9.89543 28.8954 9 30 9H35V18C35 21.3137 37.6863 24 41 24H50V39ZM47.5796 20H41C39.8954 20 39 19.1046 39 18V10.8485L47.5796 20ZM34 55C35.1046 55 36 54.1046 36 53V38H27C23.6863 38 21 35.3137 21 32V23H16C14.8954 23 14 23.8954 14 25V53C14 54.1046 14.8954 55 16 55H34ZM27 34H33.5796L25 24.8485V32C25 33.1046 25.8954 34 27 34Z"})})));var md=(0,a.forwardRef)(((e,t)=>(0,i.jsxs)(ye.Z,{ref:t,viewBox:"0 0 64 64",...e,children:[(0,i.jsx)("path",{d:"M48.0049 52H30.0156C26.7046 51.9961 24.0216 49.3119 24.0186 46V39.9717C24.0264 38.8675 24.9276 37.9787 26.0315 37.9865C27.1354 37.9943 28.024 38.8958 28.0162 40V46C28.0175 47.104 28.9119 47.9987 30.0156 48H48.005C49.1085 47.9985 50.0027 47.1039 50.0038 46V18C50.0029 16.896 49.1086 16.0012 48.005 16H30.0159C28.9121 16.001 28.0175 16.8958 28.0165 18V24.0283C28.0087 25.1325 27.1074 26.0213 26.0035 26.0135C24.8996 26.0057 24.0111 25.1042 24.0189 24V18C24.0219 14.6882 26.7047 12.004 30.0156 12H48.005C51.3158 12.0042 53.9983 14.6883 54.0014 18V46C53.9983 49.3117 51.3157 51.9959 48.0049 52Z"}),(0,i.jsx)("path",{d:"M32.5857 24.5858C33.3667 23.8047 34.633 23.8047 35.4141 24.5858L41.4141 30.5858C42.1951 31.3668 42.1951 32.6332 41.4141 33.4142L35.4141 39.4142C34.633 40.1953 33.3667 40.1953 32.5857 39.4142C31.8046 38.6332 31.8046 37.3668 32.5857 36.5858L35.1715 34H11.9999C10.8953 34 9.99988 33.1046 9.99988 32C9.99988 30.8954 10.8953 30 11.9999 30H35.1715L32.5857 27.4142C31.8046 26.6332 31.8046 25.3668 32.5857 24.5858Z"})]}))),hd=o(28410);var gd,Cd=(0,a.forwardRef)(((e,t)=>(0,i.jsxs)(ye.Z,{ref:t,viewBox:"0 0 64 64",...e,children:[(0,i.jsx)("path",{d:"M34 12C34 10.8954 33.1046 10 32 10C30.8954 10 30 10.8954 30 12V35.1716L23.4142 28.5858C22.6332 27.8047 21.3668 27.8047 20.5858 28.5858C19.8047 29.3668 19.8047 30.6332 20.5858 31.4142L30.5858 41.4142C31.3668 42.1953 32.6332 42.1953 33.4142 41.4142L43.4142 31.4142C44.1953 30.6332 44.1953 29.3668 43.4142 28.5858C42.6332 27.8047 41.3668 27.8047 40.5858 28.5858L34 35.1716V12Z"}),(0,i.jsx)("path",{d:"M14 50C12.8954 50 12 50.8954 12 52C12 53.1046 12.8954 54 14 54H50C51.1046 54 52 53.1046 52 52C52 50.8954 51.1046 50 50 50H14Z"})]}))),fd=o(6131),xd=o(31561);!function(e){e[e.DELETE_TOME=0]="DELETE_TOME",e[e.RESTORE_TOME=1]="RESTORE_TOME",e[e.SIGN_IN=2]="SIGN_IN",e[e.TOGGLE_ANNOTATIONS_OVERLAYS=3]="TOGGLE_ANNOTATIONS_OVERLAYS",e[e.ENTER_FULLSCREEN=4]="ENTER_FULLSCREEN",e[e.ADD_LOGO=5]="ADD_LOGO",e[e.SHOW_LOGO=6]="SHOW_LOGO",e[e.HIDE_LOGO=7]="HIDE_LOGO",e[e.RENAME_TOME=8]="RENAME_TOME",e[e.DUPLICATE_TOME=9]="DUPLICATE_TOME",e[e.CREATE_PDF=10]="CREATE_PDF",e[e.OPEN_SETTINGS_PLANS=11]="OPEN_SETTINGS_PLANS",e[e.UNDO=12]="UNDO",e[e.REDO=13]="REDO"}(gd||(gd={}));const vd=ll.ZP.t("tome.header.tomeMenuBuilding.addLogoMenuItemLabel"),bd=ll.ZP.t("tome.header.tomeMenuBuilding.exportToPDFMenuItemLabel");var yd=e=>{let{deleted:t,userIsEditor:o,isLoggedIn:n,presentMode:s,redirectToLogin:d,userCanManage:c,usersOrgId:u,tomeThemeId:p,orgLogoAvailable:h,shouldShowLogo:f,closeOtherPanels:x}=e;var v,b,y;const w=(0,m.useRouter)(),I=(0,fa.j)(),{workspaceUrl:P,changeTab:E}=(0,Pr.B)(),_=(0,a.useRef)(null),[j,k]=(0,r.FV)(Js.t),{openSettings:S}=(0,$s.r)(),[Z]=(0,G.cLM)({update(e,t){let{data:o}=t;var n,i;(null===(n=o)||void 0===n?void 0:n.deleteTome)&&(0,Ol.h6)(e,null===(i=o)||void 0===i?void 0:i.deleteTome)},optimisticResponse:{__typename:"Mutation",deleteTome:{__typename:"Tome",id:I}}}),{t:R}=(0,C.$G)(),O=(0,g.Fg)(),{clientId:M,apolloClient:$}=(0,L.bp)(),N=o&&!s,B=(0,r.sJ)(T.wo),H=(0,D.ye)(D.TT.PDF_GENERATION),V=(0,D.ye)(D.TT.EDITOR_IA_UPDATES),{priceType:F,remainingTomeCreationsForOrg:U}=(0,ys.Z)(),z=null!==F,W=H&&o,K=z&&W,q=!z&&W,Y=0!==U,J=(0,ws.yP)(),{data:X}=(0,G.CHH)({variables:{tomeId:I},fetchPolicy:"cache-and-network",nextFetchPolicy:"cache-first",skip:!N}),Q=(null===(y=X)||void 0===y||null===(b=y.tome)||void 0===b||null===(v=b.org)||void 0===v?void 0:v.themes)??[],ee=V?O.buttonSize:O.largerButtonSize,te=(0,a.useCallback)((()=>{w.push(P,void 0,{shallow:!0}),Z({variables:{tomeId:I}}),(0,A.Sd)({message:R("tome.header.tomeMenu.tomeDeletedToastMessage")})}),[w,Z,I,P,R]),{undo:oe,redo:ne}=(0,nd.C5)(),[ie]=(0,G.APF)({update(e,t){let{data:o}=t;var n,i;(null===(n=o)||void 0===n?void 0:n.restoreTome)&&(0,Qs.W)(e,null===(i=o)||void 0===i?void 0:i.restoreTome)}}),ae=(0,a.useCallback)((()=>{ie({variables:{tomeId:I}}).then((e=>{let{data:t}=e;var o;(null===(o=t)||void 0===o?void 0:o.restoreTome)?(E(id.Kv.RECENT),(0,A.ak)({message:R("tome.header.tomeMenu.tomeRestoredToastMessage")})):(0,A.ak)({message:R("tome.header.tomeMenu.noPermissionToRestoreTomeToastMessage")})})).catch((e=>{(0,A.ak)({message:R("tome.header.tomeMenu.errorOccurredRestoringTomeToastMessage")}),console.error("Error restoring Tome:",e),e.message=`Error restoring Tome: ${e.message}`,l.v.addError(e,{tomeId:I})}))}),[E,ie,I,R]),{duplicateTome:re}=(0,ed.Z)({}),le=(0,a.useCallback)((()=>{u&&re({tomeId:I,orgId:u,onDuplicateComplete:e=>{window.Cypress||window.open(e.canonicalUrl,"_blank")},onDuplicateError:e=>{let t=R("toastMessages.tomeCreationError.permissionDenied");if(e instanceof Ys.cA){e.graphQLErrors.map((e=>{var t;return null===(t=e.extensions)||void 0===t?void 0:t.code})).filter((e=>!!e)).find((e=>e===ed.T))&&(t=R("toastMessages.tomeCreationError.disabledBecauseOutOfFreeTomes"))}(0,A.ak)({message:t})}})}),[u,re,I,R]),se=(0,a.useCallback)((()=>{d(!1)}),[d]),{focusOnTitle:de}=bs(),ce=(0,a.useCallback)((()=>{s&&k((e=>!e))}),[s,k]),ue=(0,a.useCallback)((()=>{x()}),[x]),pe=(0,a.useCallback)((()=>{S(Ls.u.ORGANIZATION)}),[S]),me=(0,a.useCallback)((()=>{const e={showLogo:!0};(0,Ol.W8)(I,e,$,M),(0,A.ak)({message:R("tome.header.tomeMenu.logoAppearanceInPlayModeToastMessage")})}),[$,M,I,R]),he=(0,a.useCallback)((()=>{const e={showLogo:!1};(0,Ol.W8)(I,e,$,M),(0,A.ak)({message:R("tome.header.tomeMenu.logoWillBeHiddenInPlayModeToastMessage")})}),[$,M,I,R]),ge=[],Ce=(e=>{let{userIsEditor:t,presentMode:o,shouldShowLogo:n,orgLogoAvailable:a,desiredRecordingState:r,displayAnnotationsOverlays:l,isLoggedIn:s,userCanManage:d,userCanCreatePdf:c,userCanAddLogo:u,userCanUpgradeToCreatePdf:p,userCanUpgradeToAddLogo:m,userCanDuplicateTome:h,deleted:g,commandFn:C}=e;const f=[],x={width:16,height:16,marginRight:8};if(h&&f.push({text:ll.ZP.t("tome.header.tomeMenuBuilding.duplicateTomeMenuItemLabel"),action:()=>{C(gd.DUPLICATE_TOME)},image:(0,i.jsx)(pd,{style:x})}),t&&!o&&f.push({text:ll.ZP.t("tome.header.tomeMenuBuilding.renameTomeMenuItemLabel"),action:()=>{C(gd.RENAME_TOME)},image:(0,i.jsx)(ud,{style:x})}),c?f.push({id:"export-to-pdf",text:bd,action:()=>{C(gd.CREATE_PDF)},image:(0,i.jsx)(Cd,{style:x})}):p&&f.push({text:bd,action:()=>{C(gd.OPEN_SETTINGS_PLANS)},image:(0,i.jsx)(Cd,{style:x}),tag:hd.O.PRO}),t&&!o&&(a?n?f.push({text:ll.ZP.t("tome.header.tomeMenuBuilding.hideLogoMenuItemLabel"),action:()=>{C(gd.HIDE_LOGO)},image:(0,i.jsx)(rd,{style:x})}):f.push({text:ll.ZP.t("tome.header.tomeMenuBuilding.showLogoMenuItemLabel"),action:()=>{C(gd.SHOW_LOGO)},image:(0,i.jsx)(sd,{style:x})}):u?f.push({text:vd,action:()=>{C(gd.ADD_LOGO)},image:(0,i.jsx)(ad,{style:x})}):m&&f.push({text:vd,action:()=>{C(gd.OPEN_SETTINGS_PLANS)},image:(0,i.jsx)(ad,{style:x}),tag:hd.O.PRO})),o&&!r&&f.push({image:(0,i.jsx)(ld,{style:x}),text:ll.ZP.t("tome.header.tomeMenuBuilding.viewFullscreenMenuItemLabel"),action:()=>{C(gd.ENTER_FULLSCREEN)}}),o){let e=(0,i.jsx)(rd,{style:x}),t=`${ll.ZP.t("tome.header.tomeMenuBuilding.hideOverlaysMenuItemLabel")}`;l||(e=(0,i.jsx)(sd,{style:x}),t=`${ll.ZP.t("tome.header.tomeMenuBuilding.showOverlaysMenuItemLabel")}`),f.push({image:e,text:t,action:()=>{C(gd.TOGGLE_ANNOTATIONS_OVERLAYS)}})}return!s&&o&&(f.push({type:"separator"}),f.push({image:(0,i.jsx)(md,{style:x}),text:ll.ZP.t("tome.header.tomeMenuBuilding.signInMenuItemLabel"),action:()=>{C(gd.SIGN_IN)}})),t&&!o&&(f.push({type:"separator"}),f.push({type:"option",text:ll.ZP.t("tome.header.tomeMenuBuilding.undoMenuItemLabel"),action:()=>{C(gd.UNDO)},image:(0,i.jsx)(fd.Z,{style:x}),shortcut:(0,Is.Ul)(),disabled:!(0,nd.y4)()}),f.push({type:"option",text:ll.ZP.t("tome.header.tomeMenuBuilding.redoMenuItemLabel"),action:()=>{C(gd.REDO)},image:(0,i.jsx)(xd.Z,{style:x}),shortcut:(0,Is.SW)(),disabled:!(0,nd.oC)()})),d&&!o&&(f.push({type:"separator"}),g?f.push({type:"option",text:ll.ZP.t("tome.header.tomeMenuBuilding.restoreMenuItemLabel"),action:()=>{C(gd.RESTORE_TOME)},image:(0,i.jsx)(dd,{style:x})}):f.push({text:ll.ZP.t("tome.header.tomeMenuBuilding.deleteMenuItemLabel"),action:()=>{C(gd.DELETE_TOME)},variant:"destructive",image:(0,i.jsx)(cd.Z,{style:x})})),f})({deleted:t,userCanManage:c,userCanCreatePdf:K,userCanAddLogo:z,userCanUpgradeToCreatePdf:q,userCanUpgradeToAddLogo:!z,userCanDuplicateTome:Y,presentMode:s,isLoggedIn:n,displayAnnotationsOverlays:j,desiredRecordingState:B,shouldShowLogo:f,orgLogoAvailable:h,userIsEditor:o,commandFn:e=>{(e=>{switch(e){case gd.DELETE_TOME:te();break;case gd.RESTORE_TOME:ae();break;case gd.SIGN_IN:se();break;case gd.TOGGLE_ANNOTATIONS_OVERLAYS:ce();break;case gd.ENTER_FULLSCREEN:td();break;case gd.ADD_LOGO:pe();break;case gd.SHOW_LOGO:me();break;case gd.HIDE_LOGO:he();break;case gd.RENAME_TOME:de();break;case gd.DUPLICATE_TOME:n?le():se();break;case gd.CREATE_PDF:J({action:ws.$C.INVOKE_COMMAND,commandId:od.mm.EXPORT_TO_PDF});break;case gd.OPEN_SETTINGS_PLANS:S(Ls.u.PLANS);break;case gd.UNDO:oe();break;case gd.REDO:ne()}})(e)}});return ge.push(...Ce),ge.length<1?null:(0,i.jsx)(Yi.Z,{menuWidth:220,menuPosition:"below",menuAlign:"right",itemsOrFn:ge,styles:{display:"flex"},onOpenDropdown:ue,exemptContainerClickRefs:[_],rebuildMenuTrigger:Q.map((e=>e.id)).join("-").concat(`-active-${p}`),children:(0,i.jsx)(Ar,{style:{marginLeft:8,width:V?32:40},children:(0,i.jsx)(Dr,{"aria-label":R("tome.header.tomeMenu.ariaLabelSettingsButtonText"),variant:"uncontained",style:{padding:"0 6px",width:ee,height:ee,minWidth:ee},onZ0:!s,icon:V?(0,i.jsx)(Xs.Z,{style:{width:24,height:24}}):(0,i.jsx)(Xs.Z,{style:{width:28,height:28}})})})})};const wd=g.ZP.span.withConfig({displayName:"TryTomeButton__ButtonInner",componentId:"sc-3da307f7-0"})`
  display: flex;
  align-items: center;
`;var Td=e=>{let{tomeId:t}=e;const{apolloClient:o}=(0,L.bp)(),n=(0,r.sJ)(A.SM),l=(0,r.sJ)(A.Vx),{t:s}=(0,C.$G)(),d=(0,a.useCallback)((()=>{Ne.ZP.reportTryTomeClickEvent({apolloClient:o,tomeId:t,pageId:l})}),[o,t,l]),c=(0,i.jsx)(Ar,{style:{marginLeft:8},children:(0,i.jsxs)(Dr,{variant:"uncontained",style:{width:"unset",padding:"0 6px"},onClick:d,children:[(0,i.jsx)(wr.Z,{style:{height:18,width:18}}),(0,i.jsxs)(wd,{children:[" ",s("tome.header.tryTomeButton.tryTomeButtonLabel")]})]})}),u=(0,Ir.iR)(void 0,"/signup",{utmMedium:"referral",utmSource:n?"public_tome_embedded":"public_tome",utmCampaign:t,utmContent:"public_tome_logo"});return n?(0,i.jsx)("a",{href:u,target:"_blank",children:c}):(0,i.jsx)(yr(),{href:u,children:c})};var Id=e=>{let{tome:t,presentMode:o,expandMode:n,enterPresentMode:l,exitPresentMode:d}=e;var u,p,h,g,f,x,b,y,w,I;const[j,k]=(0,r.FV)(A.Vx),S=(0,m.useRouter)(),{apolloClient:Z,clientId:R}=(0,L.bp)(),{workspaceUrl:O}=(0,Pr.B)(),M=(0,E.t2)(),$=(0,E.f3)(),{t:D}=(0,C.$G)(),{deselectAllTiles:B}=(0,V.N4)(),H=(0,Sr.I)(null===(p=t)||void 0===p||null===(u=p.org)||void 0===u?void 0:u.logo),F=(0,r.sJ)(A.SM),U=Ql(),z=(0,r.sJ)(A.GP),W=(0,r.sJ)(T.wo),K=(0,ws.yP)(),q=(0,a.useCallback)((e=>e.clientY<108),[]),{isHidden:Y,show:J}=Cr({visibilityBasedOnMouseEvent:q,timeout:3e3,disabled:!o}),{showCursor:X}=es({timeout:3e3,disabled:!U}),Q=(0,qr.Z)(),[ee,te]=(0,r.FV)(A.B8),oe=(0,a.useRef)(null),ne=(0,s.l)(A.k$),ie=(0,a.useRef)(null),{headerBackButtonRef:ae}=(0,L.TR)(),{loading:re,user:le,flags:se,activeMembership:de}=(0,a.useContext)(oi.Z),ce=!z&&(null===(h=se)||void 0===h?void 0:h.offlineReadOnly);(0,a.useEffect)((()=>{ce?(0,A.ak)({message:D("tome.header.tomeHeader.offlineConnectivityMessage"),key:"offline"}):(0,A.V_)("offline")}),[ce,D]),(0,a.useEffect)((()=>{o&&ne&&(0,A.k$)(!1)}),[o,ne]);const ue=!(!le||!le.id),{titleEditableLabelRef:pe}=bs(),me=(0,a.useCallback)((e=>(0,Ol.NW)(t.id,e,Z,R)),[Z,R,t.id]),he=(0,N.yW)(t.pages,j),[ge,Ce]=(0,a.useState)((0,dr.zh)(he)),fe=he&&(null===(g=he.comments)||void 0===g?void 0:g.length)||0;(0,a.useEffect)((()=>{Ce((0,dr.zh)((0,N.yW)(t.pages,j)))}),[j,t.pages]);const xe=(0,a.useCallback)((e=>{(0,Xl.rf)(S,{pageId:j,showComments:e,openInNewTab:F})}),[j,S,F]),ve=(0,a.useCallback)((e=>{e!==j&&"string"==typeof e&&k(e)}),[j,k]),be=t.currentUserPermission.isAuthor||t.currentUserPermission.canEdit,ye=(0,a.useCallback)((()=>ue?((0,A.k$)(!ne),M.closePropertyPanel(),ne?null:Ce(!1)):(xe(!0),null)),[ne,ue,M,xe]),we=(0,a.useCallback)((()=>{ue||xe(!1),te(!ee),M.closePropertyPanel(),ne&&(0,A.k$)(!1)}),[ne,ue,M,xe,ee,te]),Te=(0,a.useCallback)((()=>{(0,A.k$)(!1),te(!1),M.closePropertyPanel()}),[te,M]);(0,a.useEffect)((()=>{o||(J(),X())}),[o,J,X]);const Ie=window.innerWidth,Pe=(0,Kr.ZP)("(max-width: 1024px)")?32:48,Ee=(Ie-2*Pe)/3,_e=Y||U||W,je=(0,a.useMemo)((()=>({animate:{opacity:_e?0:1},transition:P.Z2,initial:{opacity:1},exit:{opacity:0}})),[_e]),ke=(0,r.sJ)(A.$s),Se=(0,v.s)(),Ze=(0,r._8)((e=>{let{snapshot:t}=e;return()=>{t.getLoadable($e.z1).getValue().size>0||(0,ms.r)()?Se.open():(M.closePropertyPanel(),(0,A.k$)(!1),S.push(O,void 0,{shallow:!0}).then((()=>K({action:ws.$C.CLOSE}))))}}),[K,Se,M,S,O]),Re=(0,a.useCallback)((e=>{$===e?((0,A.PS)(!1),M.closePropertyPanel()):M.setPropertyPanel(e)}),[$,M]),Oe=(0,i.jsx)(Ss,{visible:!o,children:(0,i.jsx)(Nr,{children:(0,i.jsx)($o.Z,{content:D("tome.header.control.recordNarration.tooltipLabel"),shortcuts:[(0,Is.C6)(),"R"],placement:"bottom",perpendicularOffset:-20,children:(0,i.jsx)(Dr,{onZ0:!0,"aria-label":D("tome.header.control.recordNarration.label"),startIcon:(0,i.jsx)(Ts,{"data-testid":"record_toolbar_icon",style:{height:24,width:24}}),iconStyles:{margin:0},style:{minWidth:32,width:32},onClick:()=>{Re(_.Z.RECORD),B()}})})})}),Me=(0,i.jsx)(Nr,{ref:oe,children:(0,i.jsx)(Dr,{variant:"uncontained",onClick:we,style:{width:"unset",padding:"0 6px"},onZ0:!o,children:D("tome.header.tomeHeader.headerShareButtonLabel")})}),Le=(0,i.jsx)(Nr,{children:(0,i.jsx)(Dr,{variant:"uncontained",onClick:()=>{Hl(t.canonicalUrl),(0,A.ak)({message:D("tome.header.tomeHeader.linkCopiedToastMessage")})},style:{width:"unset",padding:"0 6px"},onZ0:!o,children:D("tome.header.tomeHeader.copyTomeLinkButtonLabel")})}),Ae=(()=>{var e,o,n,i,a;if(t.currentUserPermission.how!==G.TSR.Public&&!vs(t.currentUserPermission))return Me;if(!0===re||void 0===le||void 0===de)return Q?Le:null;return(null===(o=de)||void 0===o||null===(e=o.org)||void 0===e?void 0:e.id)===(null===(a=t)||void 0===a||null===(i=a.author)||void 0===i||null===(n=i.org)||void 0===n?void 0:n.id)?Me:Q?Le:null})(),Ne=(null===(f=t.org)||void 0===f?void 0:f.showTomeBranding)??!0,{priceType:De}=(0,ys.Z)();return(0,i.jsx)($r,{$showScrim:!U&&ke,$presentMode:o,children:(0,i.jsxs)(Lr,{"data-testid":"tome_header",$pointerEventsEnabled:!W||!o,children:[(0,i.jsx)(c.M,{children:!n&&!U&&(0,i.jsxs)(Rr,{$gap:Pe,...je,children:[!o&&ue&&(0,i.jsxs)(Ar,{initial:{opacity:0},animate:{opacity:1},exit:{opacity:0},transition:P.Oo,style:{position:"absolute",left:10,zIndex:1},"data-testid":"tome_header_workspace_button",children:[(0,i.jsx)(Dr,{"aria-label":D("tome.header.tomeHeader.navigateToWorkspaceButtonLabel"),"data-testid":"navigate_to_workspace",onClick:Ze,style:{padding:"2px 6px",width:"32px",minWidth:"32px"},onZ0:!0,icon:(null===(x=se)||void 0===x?void 0:x.editorIaUpdates)?(0,i.jsx)(Ct.Z,{style:{width:24,height:24}}):(0,i.jsx)(Ct.Z,{style:{width:28,height:28}}),ref:ae}),(0,i.jsx)(v.Z,{ref:Se.ref,title:D("tome.header.tomeHeader.leaveThisTomeConfirmationModalTitle"),subtitle:D("tome.header.tomeHeader.ChangesMayNotBeSavedMessageConfirmationModalSubtitle"),dismissible:!0,buttonColor:"default",cancelButtonText:D("tome.header.tomeHeader.leavingTomeCancelButtonLabel"),cancelButtonAction:()=>Se.close(),primaryButtonContent:D("tome.header.tomeHeader.leavingTomeOkButtonLabel"),primaryButtonAction:()=>{M.closePropertyPanel(),(0,A.k$)(!1),S.push(O,void 0,{shallow:!0})}})]},"header_component_for_buttons"),!o&&(0,i.jsx)(Fs,{title:t.title,presentMode:o,isEditor:be,renameTome:me,titleEditableLabelRef:pe,showUpgradeButton:be&&null===De},"attribution"),H&&o&&(0,i.jsx)(Ar,{style:{marginLeft:6},children:(0,i.jsx)(Sr.Z,{show:t.showLogo,logo:null===(b=t.org)||void 0===b?void 0:b.logo,theme:he.theme})}),!o&&(0,i.jsx)(Ar,{style:{marginLeft:8},children:(0,i.jsx)(_s,{permissions:t.currentUserPermission})}),ce&&(0,i.jsx)(Ar,{style:{marginLeft:8},children:(0,i.jsx)(el,{icon:(0,i.jsx)(ps,{}),color:"destructive",toolTipContent:D("tome.header.tomeHeader.tooltipReadOnlyMessage"),children:D("tome.header.tomeHeader.offlineConnectivityBadgeLabel")})})]})}),(0,i.jsx)(c.M,{children:!U&&(0,i.jsx)(Or,{$presentMode:o,$gap:Pe,children:t.pages&&o&&!n&&t.pages.length>1&&(0,i.jsx)(Ar,{style:{width:"100%"},initial:{opacity:0},animate:{opacity:1},exit:{opacity:0},transition:P.Oo,children:(0,i.jsx)(kr,{pageIds:t.pages.map((e=>e.id)),maxComponentWidthPx:Ee,activePageId:j,onSegmentClick:k,isMobile:!1,numPages:t.numPages})})})}),(0,i.jsx)(c.M,{children:!n&&!U&&(0,i.jsxs)(Mr,{$presentMode:o,...je,children:[(0,i.jsx)(Ss,{visible:!o,as:Nr,children:(0,i.jsx)(xs,{tomeId:t.id,navigateToPage:ve})}),(0,i.jsx)(qs,{ref:ie,visible:!o,tome:t,toggleCommentsPanel:ye,unreadBadge:ge,commentsCount:fe,flags:se}),(null===(y=se)||void 0===y?void 0:y.editorIaUpdates)&&Oe,Ae,(0,i.jsx)(yd,{deleted:t.deleted,userIsEditor:be,isLoggedIn:ue,presentMode:o,redirectToLogin:xe,userCanManage:t.currentUserPermission.canManage,usersOrgId:null===(I=de)||void 0===I||null===(w=I.org)||void 0===w?void 0:w.id,tomeThemeId:t.theme.id,orgLogoAvailable:H,shouldShowLogo:t.showLogo,closeOtherPanels:Te}),ue&&(0,i.jsx)(Os,{presentMode:o,exitPresentMode:d,enterPresentMode:l,permission:t.currentUserPermission}),!ue&&Ne&&(0,i.jsx)(Td,{tomeId:t.id})]})}),(0,i.jsx)(Jl,{sharingSheetOpen:ee,setSharingSheetOpen:te,tome:t,shareButtonRef:oe,activePageId:j}),(0,i.jsx)(us,{commentsSheetOpen:ne,tome:t})]})})},Pd=o(9008),Ed=o.n(Pd),_d=o(93408);var jd=e=>{let{tome:t}=e;const o=t.canonicalUrl,n=t.published&&t.description||`by ${t.author.name}`,a={"@context":"https://schema.org","@type":"CreativeWork",name:t.title,...t.author.name?{author:{name:t.author.name}}:{},...t.author.org?{publisher:{name:t.author.org.name}}:{},...t.published&&t.description?{abstract:t.description}:{},...t.previewImageUrl?{thumbnailUrl:t.previewImageUrl}:{},url:o};return(0,i.jsxs)(Ed(),{children:[(0,i.jsx)("title",{children:t.title}),!t.published&&(0,i.jsx)(i.Fragment,{children:(0,i.jsx)("meta",{name:"robots",content:"nofollow, noindex"})}),(0,i.jsx)("meta",{name:"description",content:n}),t.author.name&&(0,i.jsx)("meta",{name:"author",content:t.author.name}),(0,i.jsx)("meta",{property:"og:site_name",content:"Tome"}),(0,i.jsx)("meta",{property:"og:title",content:t.title}),(0,i.jsx)("meta",{property:"og:description",content:n}),(0,i.jsx)("meta",{property:"og:url",content:o}),(0,i.jsx)("link",{rel:"canonical",href:o}),(0,i.jsx)("link",{rel:"preconnect",href:_d.z}),(0,i.jsx)("link",{rel:"preconnect",href:"https://rum.browser-intake-datadoghq.com/"}),(0,i.jsx)("link",{rel:"preconnect",href:"https://api.segment.io"}),(0,i.jsx)("link",{rel:"preconnect",href:"https://cdn.segment.com"}),(0,i.jsx)("link",{rel:"preconnect",href:_d.n}),(0,i.jsx)("link",{rel:"preconnect",href:"https://vitals.vercel-insights.com/v1/vitals"}),(0,i.jsx)("link",{rel:"dns-prefetch",href:_d.z}),(0,i.jsx)("link",{rel:"dns-prefetch",href:"https://rum.browser-intake-datadoghq.com/"}),(0,i.jsx)("link",{rel:"dns-prefetch",href:"https://api.segment.io"}),(0,i.jsx)("link",{rel:"dns-prefetch",href:"https://cdn.segment.com"}),(0,i.jsx)("link",{rel:"dns-prefetch",href:_d.n}),(0,i.jsx)("link",{rel:"dns-prefetch",href:"https://vitals.vercel-insights.com/v1/vitals"}),(0,i.jsx)("link",{rel:"dns-prefetch",href:"https://media.giphy.com"}),t.previewImageUrl&&(0,i.jsxs)(i.Fragment,{children:[(0,i.jsx)("meta",{property:"og:image",content:t.previewImageUrl}),(0,i.jsx)("meta",{name:"twitter:card",content:"summary_large_image"})]}),(0,i.jsx)("script",{type:"application/ld+json",dangerouslySetInnerHTML:{__html:JSON.stringify(a)}})]})},kd=o(32490);var Sd=e=>{let{pages:t,presentMode:o,isMobile:n}=e;var i,r;const{loading:l,user:s}=(0,a.useContext)(oi.Z),{t:d}=(0,C.$G)(),c=(0,a.useRef)(!1),u=(null===(r=t[0])||void 0===r||null===(i=r.overlay)||void 0===i?void 0:i.videoStatus)===G.Kwn.Ready;(0,kd.G)((()=>{l||o&&!s&&!c.current&&t.length>1&&!u&&(n?(0,A.ak)({message:d("tome.usePageBasedTriggers.tapToLeftAndRightToNavigateToastMessage"),duration:3e3,delay:1e3}):(0,A.ak)({message:d("tome.usePageBasedTriggers.useArrowKeysToNavigateToastMessage"),duration:3e3,delay:1e3}),c.current=!0)}),[o,n,l,s,t.length,u,d])};const Zd="ACTIVE_PAGE:";var Rd=e=>{const t=(0,a.useRef)();(0,a.useEffect)((()=>{t.current=t=>{var o;return null===(o=e)||void 0===o||o(t),!t.defaultPrevented||(t.returnValue="","")}}),[e]),(0,a.useEffect)((()=>{const e=e=>!t.current||t.current(e);return window.addEventListener("beforeunload",e),()=>{window.removeEventListener("beforeunload",e)}}),[])};var Od=function(e){let{id:t,tome:o}=e;const n=(0,r.Zl)(A.Vx),s=(0,r.Zl)(A.pt),d=o.numPages>0?o.pages[0].id:null,c=(0,a.useRef)(""),u=(0,a.useRef)(o.pages);u.current=o.pages;const p=(0,r._8)((e=>{let{snapshot:t}=e;return()=>{var e;const o=t.getLoadable(A.Vx).getValue(),i=null===(e=u.current[0])||void 0===e?void 0:e.id;o&&i&&!u.current.some((e=>e.id===o))&&n(i)}}),[n]);(0,a.useEffect)((()=>{p()}),[p,o.pages.length]),(0,a.useEffect)((()=>{if(c.current===t)return;const e=(o=window.location.search,new URLSearchParams(o).get(Bl));var o;if(null!==e)n(e),c.current=t;else{const e=function(e){const t=Zd+e;let o=localStorage.getItem(t);if(o){localStorage.removeItem(t);try{o=JSON.parse(o)}catch{o={}}o=o.expiry>=(new Date).getTime()?o.pageId:""}else o="";return o}(t);e?(n(e),c.current=t):d&&(n(d),c.current=t)}new URLSearchParams(window.location.search).has("showComments")&&(0,A.k$)(!0),function(e){const t=window.location,o=new URLSearchParams(t.search);let n=!1;if(e.forEach((e=>{o.has(e)&&(o.delete(e),n=!0)})),n){const e=[`${t.origin}${t.pathname}`,o.toString()].filter(Boolean).join("?");h().replace(e,void 0,{shallow:!0})}}(["page","showComments"])}),[t,d,c,n]),(0,a.useEffect)((()=>()=>{n("")}),[n]);const m=(0,r._8)((e=>{let{snapshot:o}=e;return()=>{const e=o.getLoadable(A.Vx).getValue();!function(e,t){const o=Zd+e,n={pageId:t,expiry:(new Date).getTime()+1e4};localStorage.setItem(o,JSON.stringify(n))}(t,e)}}),[t]);(0,a.useEffect)((()=>{s([])}),[s]);const g=(0,r._8)((e=>{let{snapshot:t}=e;return e=>{const o=t.getLoadable($e.z1).getValue();o.size>0&&(l.v.addAction("promptBeforeLeaving",{type:"mediaUpload",operations:Array.from(o).join(", ")}),e.preventDefault()),(0,ms.r)()&&(l.v.addAction("promptBeforeLeaving",{type:"mutations"}),e.preventDefault()),m()}}),[m]);return Rd(g),(0,i.jsx)(i.Fragment,{})},Md=o(12887),$d=o(91292),Ld=o(79227);var Ad=()=>{const e=(0,r.sJ)(V.$y),t=(0,r.rb)(A.uz);return(0,a.useEffect)((()=>{e||t()}),[t,e]),null};function Nd(e,t){if(e<Math.ceil(t/2))return[0,t];const o=Math.floor(t/2);return[e-o+1,e+o+1]}var Dd=e=>{let{activePageIndex:t,windowSize:o,data:n,itemSize:a,renderItem:r}=e;const[l,s]=Nd(t,o),d=[];for(let e=l;e<Math.min(s,n.length);e++)d.push(r(n[e],e,e*a));return(0,i.jsx)(i.Fragment,{children:d})},Bd=o(23610),Hd=o(10987),Vd=o(37511),Fd=o(7056),Gd=o(16247),Ud=o(97712),zd=o(16834),Wd=o(67591),Kd=o(32011),qd=o(28773),Yd=o(17051);const Jd=g.ZP.div.withConfig({displayName:"MobilePage__MobilePageContainerScroller",componentId:"sc-41981245-0"})`
  flex-grow: 1;
  overflow: ${e=>{let{$isInExpandMode:t}=e;return t?"hidden":"auto"}};
  width: 100%;

  ${Yd.f} {
    // Mobile needs the ThemeWrapper to expand with the children content.
    height: auto;
  }
`,Xd=g.ZP.div.withConfig({displayName:"MobilePage__StackedPage",componentId:"sc-41981245-1"})`
  position: relative;
  height: fit-content;
  width: 100%;
  overflow-y: scroll;
`,Qd=g.ZP.div.withConfig({displayName:"MobilePage__StackedPageGradient",componentId:"sc-41981245-2"})`
  background-image: ${e=>{let{theme:t}=e;return t.gradients.headerGradientPresent}};
  height: ${160}px;
  pointer-events: none;
  position: fixed;
  top: 0;
  width: 100%;
  z-index: ${I.bf};
`,ec=g.ZP.div.withConfig({displayName:"MobilePage__PageStyles",componentId:"sc-41981245-3"})`
  height: 100%;

  // Necessary to make sure that the expanded tile can appear in the
  // center of the viewport. Otherwise, the PageStyles container may be too
  // short and clip the expanded content.
  ${e=>{let{$isInExpandMode:t}=e;return t&&g.iv`
      min-height: 100vh;
    `}}
  overflow: auto;
  width: 100%;
  // leave space for mobile header
  padding-top: ${e=>{let{$globalTomeOverlay:t}=e;return t?110:62}}px;
  // safe padding at the bottom for avoid rendering content under
  // browser chrome and leave space for side swipe.
  padding-bottom: 160px;

  // If we're displaying a single text or media tile. Apply bottom padding equal to top padding
  // and center vertically
  ${e=>{let{$isSingleTextTilePage:t,$isSingleMediaTilePage:o}=e;return(o||t)&&g.iv`
      padding-top: ${62}px;
      min-height: 100vh;
      display: flex;
      flex-direction: column;
      justify-content: center;
      align-items: flex-start;
    `}};
`,tc=g.ZP.div.withConfig({displayName:"MobilePage__Wrapper",componentId:"sc-41981245-4"})`
  margin: ${e=>`${e.$padding}px 0`};
  padding: ${e=>`0 ${e.$padding}px`};
  width: 100%;
`,oc=(e,t)=>{let{pageId:o,pageTiles:n,pageLayout:l,pageTheme:s,pageOverlay:d,preview:c,isActive:u,isBot:p=!1,isInExpandMode:m,canEdit:h,tomeId:g,sizes:C,pageKind:f}=e;var x,v,b;const{apolloClient:y,clientId:w}=(0,L.bp)();(0,Gd.L)(s),(0,a.useEffect)((()=>{!c&&u&&cr.z.reportViewPresence(y,w,g,o)}),[u,c,y,w,g,o]);const T=(0,qd.Z)({tomeId:g,pageId:o,pageKind:f,layout:l,tiles:n,pixelsPerHeightUnit:C.rowSizes.unitRowHeight,rowPadding:C.pageSizes.padding,persistToBackend:!c}),{frontendPageLayout:I}=T,P=1===(null===(x=n)||void 0===x?void 0:x.length)&&n[0].type===G.YUT.Text,E=1===(null===(v=n)||void 0===v?void 0:v.length)&&[G.YUT.Image,G.YUT.Video,G.YUT.Giphy].includes(null===(b=n)||void 0===b?void 0:b[0].type),_=(0,r.Zl)(Tr.R),j=(0,a.useRef)(0),k=(0,a.useRef)(null),S=(0,r.sJ)((0,Hd.J)(g)),Z=(0,Vd.Z)(C.pageSizes.height);(0,a.useEffect)((()=>{j.current=0,k.current&&(k.current.scrollTop=0)}),[u]);let R=null;if(k.current){const e=k.current.getBoundingClientRect().height,t=k.current.scrollHeight;R=t-e}const O=(0,a.useCallback)((e=>{var t;const o=null===(t=e.currentTarget)||void 0===t?void 0:t.scrollTop;null!==R&&o<=R&&o>=0&&(o>=j.current?_(!1):_(!0),j.current=o)}),[R,_]);(0,a.useEffect)((()=>{var e;const t=k.current;return null===(e=t)||void 0===e||e.addEventListener("scroll",O,{passive:!0}),()=>{var e;null===(e=t)||void 0===e||e.removeEventListener("scroll",O,{passive:!0})}}),[O,k]);const M=(0,a.useMemo)((()=>(0,Bd.Z)(s.id,s.colors)),[s.id,s.colors]),$=(0,a.useRef)(new Map);(0,a.useMemo)((()=>{const e=new Map;if(Array.isArray(n))for(const t of n)e.set(t.id,t);$.current=e}),[n]);const A=(0,r._8)((e=>{let{set:t}=e;return(e,o,n,i)=>{t((0,V.pq)({tileId:e,tileType:o}),{rowIdx:n,tileIdx:i})}}),[]),N=I.orderedTileRowData;return(0,a.useEffect)((()=>{N.forEach((e=>{let{tileId:t,tileIndexInPage:o}=e;const n=$.current.get(t);n&&A(t,n.type,o,0)}))}),[N,A]),(0,i.jsx)(Jd,{...u?{"data-testid":"active_page"}:{},$isInExpandMode:m,ref:k,style:{backgroundColor:M.colors.page},children:(0,i.jsxs)(Yd.Z,{theme:s,loadFonts:!0,children:[u&&!S&&(0,i.jsx)(zd.Z,{overlayData:d,pageId:o,canEdit:h,tomeId:g,display:!0,pageHeight:C.pageSizes.height,pageWidth:C.pageSizes.width,isMobile:!0,playMode:!1}),u&&(0,i.jsx)(Ud.Z,{frontendPageLayout:I,tiles:n}),(0,i.jsxs)(Xd,{ref:t,children:[(0,i.jsx)(Qd,{}),(0,i.jsx)(ec,{$isInExpandMode:m,$isSingleMediaTilePage:P,$isSingleTextTilePage:E,$globalTomeOverlay:S,style:{transition:"opacity 0.5s cubic-bezier(0.33, 1, 0.68, 1)",opacity:p||Z?1:0},children:N.map((e=>{let{tileId:t,row:n}=e;const r=$.current.get(t);if(!r)return null;const l=z.Zp.includes(r.type);let d;d=l?Wd.bS:n.row.relativeHeight?n.row.relativeHeight:1;const u=d*Wd.Cj*C.rowSizes.unitRowHeight,p=n.isSingleTile()||l?u:2*u;return(0,i.jsx)(a.Fragment,{children:(0,i.jsx)(tc,{style:{height:(0,Kd.g)(r.type)!==Kd.Y.FIXED?p:"auto"},$padding:C.pageSizes.padding,children:(0,i.jsx)(Fd.n,{canEdit:h,isMobile:!0,preview:c,tile:r,tomeId:g,sizes:C,pageId:o,pageTheme:s,isTileEndpoint:!1,rowHeight:p,pageKind:f})})},r.id)}))})]})]})})};var nc=(0,a.memo)((0,a.forwardRef)(oc)),ic=o(42708);var ac=e=>{let{children:t,shouldObserve:o,threshold:n,onChange:a}=e;return o?(0,i.jsx)(ic.df,{as:"div",threshold:n,onChange:e=>a(e),children:t}):(0,i.jsx)(i.Fragment,{children:t})};var rc=(e,t)=>{const{prevPage:o,nextPage:n,hasPrevPage:i,hasNextPage:r}=gr(e),{scrollingPageRef:l}=(0,a.useContext)(Z.Z),{currentPageRef:s}=(0,L.TR)();(0,a.useEffect)((()=>{var e;!t&&(null===(e=l)||void 0===e?void 0:e.current)&&(l.current.style.cursor="initial")}),[t,l]);const d=(0,a.useCallback)((e=>{var t,i,a,r;const d=null===(t=s.current)||void 0===t?void 0:t.getBoundingClientRect();e.clientX<((null===(i=d)||void 0===i?void 0:i.left)??0)&&o(),e.clientX>((null===(a=d)||void 0===a?void 0:a.right)??0)&&n(),(null===(r=l)||void 0===r?void 0:r.current)&&(l.current.style.cursor="initial")}),[s,n,o,l]),c=(0,a.useCallback)((e=>{var t,o,n,a;const d=null===(t=s.current)||void 0===t?void 0:t.getBoundingClientRect();(null===(o=l)||void 0===o?void 0:o.current)&&(e.clientX<((null===(n=d)||void 0===n?void 0:n.left)??0)&&i?l.current.style.cursor="w-resize":e.clientX>((null===(a=d)||void 0===a?void 0:a.right)??0)&&r?l.current.style.cursor="e-resize":l.current.style.cursor="initial")}),[s,r,i,l]),u=(0,a.useCallback)((()=>{var e;(null===(e=l)||void 0===e?void 0:e.current)&&(l.current.style.cursor="initial")}),[l]);return(0,a.useMemo)((()=>({handlePageContainerClick:d,handlePageContainerMouseMove:c,handlePageContainerMouseLeave:u})),[d,u,c])},lc=o(85518),sc=o(30862);var dc=g.vJ`
body, body * {
  user-select: none !important;
}
`,cc=o(72988);const uc=g.ZP.div.attrs({"data-testid":"dragarea"}).withConfig({displayName:"DragArea__DragAreaRectangle",componentId:"sc-23554419-0"})`
  width: 0;
  height: 0;
  display: none;
  background-color: ${e=>{let{theme:t}=e;return t.colors.dragAreaBackground}};
  border: ${e=>{let{theme:t}=e;return`1px solid ${t.colors.dragAreaBorder}`}};
  position: absolute;
  z-index: ${I.C8};
`;var pc=(0,a.forwardRef)(((e,t)=>{const o=(0,cc.Oy)();return(0,i.jsxs)(i.Fragment,{children:[(0,i.jsx)(uc,{ref:t}),o&&(0,i.jsx)(dc,{})]})}));var mc=e=>{let{pageVerticalMargin:t}=e;const o=(0,r.Zl)(R.kt),n=(0,a.useRef)(!1),l=(0,a.useRef)(!1),s=(0,a.useRef)({clientX:0,clientY:0}),d=(0,a.useRef)(0),c=(0,a.useRef)(null),{getActiveController:u}=(0,a.useContext)(X.Z),{scrollingPageRef:p}=(0,a.useContext)(Z.Z),{currentPageRef:m}=(0,L.TR)(),h=(0,D.ye)(D.TT.MULTISELECT_DRAG_TO_SELECT),g=(0,r.Zl)(V.py),[C,f]=(0,a.useState)(new Set),{scrollContainerIfNeeded:x,cancelAnyScrolling:v}=(0,Un.Z)({delayMs:100}),b=(0,a.useRef)(),y=(0,a.useRef)(new Map),w=(0,a.useCallback)((()=>{var e;y.current.clear();null===(e=u())||void 0===e||e.getTileElements().forEach(((e,t)=>{const o=e.getBoundingClientRect();y.current.set(t,{...o,top:o.top+d.current,right:o.right,bottom:o.bottom+d.current,left:o.left})}))}),[u]),T=(0,a.useCallback)((()=>{c.current&&(c.current.style.width="0px",c.current.style.height="0px",c.current.style.display="none")}),[]),I=(0,a.useCallback)((e=>{const t=new Set;y.current.forEach(((o,n)=>{(0,sc.B)(e,o)&&t.add(n)}));for(const e of C)t.has(e)?t.delete(e):t.add(e);g((e=>(0,At.Z)(e,t)?e:t))}),[C,g,y]),P=(0,a.useCallback)((()=>{var e,o;if(!b.current)return;if(!l.current)return;const{clientX:n,clientY:i}=b.current,a=((null===(e=p.current)||void 0===e?void 0:e.scrollTop)||0)-d.current;x(b.current);const r=Math.min(s.current.clientX,n),u=Math.abs(i-s.current.clientY+a),h=2*t,g=(null===(o=m.current)||void 0===o?void 0:o.clientHeight)||0;let C=u;const f=Math.max(g-s.current.clientY+h,window.innerHeight-s.current.clientY);s.current.clientY<i&&(C=Math.min(u,f));const v=s.current.clientX<n;let y=Math.abs(n-s.current.clientX);v&&(y=Math.min(Math.abs(n-s.current.clientX),window.innerWidth-s.current.clientX));const w=Math.min(s.current.clientY+d.current,i+d.current+a);c.current&&(c.current.style.width=`${y}px`,c.current.style.height=`${C}px`,c.current.style.left=`${r}px`,c.current.style.top=`${w}px`,c.current.style.display="block");I({top:w,left:r,bottom:w+C,right:r+y})}),[I,m,t,x,p]),E=(0,a.useCallback)((e=>{l.current&&(b.current=e,P())}),[P]),_=(0,r._8)((e=>{let{snapshot:t}=e;return e=>{var i;n.current&&(l.current||Math.abs(e.clientX-s.current.clientX)+Math.abs(e.clientY-s.current.clientY)<3||(0===e.button&&(l.current=!0),e.shiftKey||(0,Is.ZP)(e)?f(t.getLoadable(V.py).getValue()):f((e=>0===e.size?e:new Set)),o(!0),d.current=(null===(i=p.current)||void 0===i?void 0:i.scrollTop)||0,w(),T()))}}),[w,T,p,o]),j=(0,a.useCallback)((e=>h&&!lc.tq&&!e.defaultPrevented),[h]),k=(0,a.useCallback)((()=>{var e;document.addEventListener("mousemove",_),document.addEventListener("mousemove",E),null===(e=p.current)||void 0===e||e.addEventListener("scroll",P)}),[E,P,p,_]),S=(0,a.useCallback)((()=>{var e;document.removeEventListener("mousemove",_),document.removeEventListener("mousemove",E),null===(e=p.current)||void 0===e||e.removeEventListener("scroll",P)}),[E,P,p,_]),O=(0,a.useCallback)((e=>{l.current&&(v(),o(!1),l.current=!1,T()),S(),0===e.button&&(n.current=!1)}),[v,T,S,o]),M=(0,a.useCallback)((e=>{if(!j)return;if(e.target!==p.current&&e.target!==m.current)return;k(),0===e.button&&(n.current=!0);const{clientX:t,clientY:o}=e;s.current={clientX:t,clientY:o}}),[k,m,j,p]),$=(0,a.useMemo)((()=>(0,i.jsx)(pc,{ref:c})),[]);return(0,a.useEffect)((()=>(document.addEventListener("mouseup",O),document.addEventListener("mousedown",M),()=>{document.removeEventListener("mouseup",O),document.removeEventListener("mousedown",M)})),[M,O]),{dragAreaComponent:$}},hc=o(43644);const gc=g.ZP.div.withConfig({displayName:"TomeSlider__MobileSliderContainer",componentId:"sc-75c127e5-0"})`
  display: flex;
  outline: none;
  overflow-x: scroll;
  overflow-y: hidden;
  scroll-snap-type: x mandatory;

  // Never show horizontal scrollbars on mobile.
  ::-webkit-scrollbar:horizontal {
    display: none;
  }
`,Cc=(0,g.ZP)(d.E.div).withConfig({displayName:"TomeSlider__SliderContainer",componentId:"sc-75c127e5-1"})`
  outline: none;
  display: grid;
  position: absolute;
`,fc=g.iv`
  display: flex;
  align-items: center;
  // We only need to scroll vertically
  overflow-y: ${e=>{let{$isInExpandMode:t}=e;return t?"hidden":"scroll"}};
`,xc=g.ZP.div.withConfig({displayName:"TomeSlider__MobilePageContainer",componentId:"sc-75c127e5-2"})`
  ${fc}
  display: flex;
  flex-direction: column;
  height: 100vh;
  min-width: 100vw;
  overflow-y: hidden;
  scroll-snap-align: start;
  scroll-snap-stop: always;
  width: 100vw;
`,vc=g.ZP.div.withConfig({displayName:"TomeSlider__DesktopPageContainer",componentId:"sc-75c127e5-3"})`
  ${fc}
  flex-direction: column;
  position: absolute;
  display: ${e=>e.$active?"inherit":"none"};
  justify-content: center;
  height: 100vh;

  // This is very important to prevent a Safari bug that:
  // - dom elements entire the hierarchy underneight this element
  // - and the page is scaled, Safari incorrectly positions the top of this element.
  // The effect being in Safari when dragging a new tile in, it shifts the page layout down.
  top: 0;
  bottom: 0;
`,bc=a.forwardRef(((e,t)=>{let{tome:o,canEdit:n,useEditablePage:l,presentMode:d,isBot:c,isMobile:u,isInExpandMode:p,width:m,pageVerticalMargin:h,pageContainerWidth:C,pageContainerHeight:f,fullscreenMode:x}=e;const[v,b]=(0,r.FV)(A.Vx),y=(0,r.sJ)(T.wo),w=(0,r.Zl)(A.$s),I=(0,s.l)(A.k6),P=(0,a.useRef)(0),E=(0,N.xh)(o.pages,v)??P.current;P.current=E;const _=m,j=(0,a.useMemo)((()=>Zr._C.fromPageAndWindowDimension(C,f,u)),[C,f,u]),k=(0,a.useRef)(null),S=(0,g.Fg)(),R=(0,a.useRef)(null),O=(0,H.Z)(v);(0,a.useEffect)((()=>{if(u&&k.current){const e=E*_-k.current.scrollLeft;if(Math.abs(e)<_/2)return void(R.current=null);k.current.scrollLeft=E*_,O!==v&&(R.current=v)}}),[k,u,v,E,_,O]);let M=-1;if(u&&k.current){const e=k.current.scrollLeft,t=Math.round(e/_);Math.abs(t*_-e)<.1*_&&(M=t)}const $=(0,a.useCallback)((e=>u?{}:{style:{width:"100vw",height:"100vh",transformOrigin:"top",transform:`translate3d(${e}px, 0px, 0px)`,padding:`${h}px 0`}}),[u,h]),D=u?xc:vc,B=u?nc:Ld.T3,{currentPageRef:V}=(0,L.TR)(),[F,G]=(0,a.useState)(u?{height:"100%",width:"100%"}:{alignItems:"center",flexDirection:"row",height:"100vh",width:"100vw"});(0,kd.G)((()=>{if(u)G({height:"100%",width:"100%"});else{G({alignItems:"center",flexDirection:"row",height:"100vh",transform:`translate3d(${-E*_-_/2}px, -${S.headerHeight}px, 0px)`})}}),[S.headerHeight,u,E,_]);const U=(0,a.useRef)(new Map),z=(0,Xt.Z)(((e,t)=>o=>{null!==o?U.current.set(e,o):U.current.delete(e),t&&!V.current&&(V.current=o)}),[V]);(0,a.useEffect)((()=>{V.current=U.current.get(v)||null}),[v,V]);const{setScrollingPageRef:W}=(0,a.useContext)(Z.Z),K=u?gc:Cc,q=(0,a.useCallback)((e=>{e.target.scrollTop>=h*I-S.headerHeight?w(!0):w(!1)}),[w,h,I,S.headerHeight]);(0,a.useEffect)((()=>{w(!1)}),[v,w]);const{handlePageContainerClick:Y,handlePageContainerMouseMove:J,handlePageContainerMouseLeave:X}=rc(o.pages,d),Q=d&&!p&&!x&&!u&&!y,ee=Nd(E,10),{dragAreaComponent:te}=mc({pageVerticalMargin:h});(0,hc.Z)();const oe=(0,r.Zl)(A.Yo);return(0,a.useEffect)((()=>{o.pages&&oe(o.pages[0].id)}),[oe,o.pages]),(0,i.jsxs)(i.Fragment,{children:[(0,i.jsx)(K,{"data-testid":"slider_container",style:F,ref:(0,$d.l)([t,k]),children:(0,i.jsx)(Dd,{activePageIndex:E,windowSize:u?Number.MAX_SAFE_INTEGER:10,data:o.pages,itemSize:_,renderItem:(e,t,a)=>{return(0,i.jsx)(ac,{shouldObserve:u,threshold:[.6],onChange:o=>{o&&t!==M&&(R.current===e.id?R.current=null:R.current||b(e.id))},children:(0,i.jsxs)(D,{"data-testid":"page_container",$active:t===E,$isInExpandMode:p,ref:t!==E||u?void 0:W,onClick:Q?Y:void 0,onMouseMove:Q?J:void 0,onMouseEnter:Q?J:void 0,onMouseLeave:Q?X:void 0,...$(a),onScroll:u?void 0:q,children:[!d&&t===E&&te,!u||(r=t,r>=ee[0]&&r<ee[1])?(0,i.jsx)(B,{isActive:t===E,isBot:c,isVisible:!!u||t===E,isInExpandMode:p,ref:z(e.id,t===E),pageId:e.id,pageTiles:e.tiles,pageTheme:e.theme,pageLayout:e.layout,pageOverlay:e.overlay,canEdit:!u&&n,useEditablePage:!u&&l,tomeId:o.id,sizes:j,preview:!1,pageVerticalMargin:h,pageKind:Md.sb.MAIN}):null]},e.id)},e.id);var r}})}),(0,i.jsx)(Ad,{})]})}));var yc,wc=bc;function Tc(){return Tc=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var o=arguments[t];for(var n in o)Object.prototype.hasOwnProperty.call(o,n)&&(e[n]=o[n])}return e},Tc.apply(this,arguments)}var Ic,Pc,Ec=function(e){return a.createElement("svg",Tc({width:28,height:28,fill:"none",xmlns:"http://www.w3.org/2000/svg"},e),yc||(yc=a.createElement("path",{d:"M15.094 6.125a1.094 1.094 0 00-2.188 0v6.781H6.125a1.094 1.094 0 000 2.188h6.781v6.781a1.094 1.094 0 102.188 0v-6.781h6.781a1.094 1.094 0 100-2.188h-6.781V6.125z",fill:"#fff"})))};function _c(){return _c=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var o=arguments[t];for(var n in o)Object.prototype.hasOwnProperty.call(o,n)&&(e[n]=o[n])}return e},_c.apply(this,arguments)}var jc,kc=function(e){return a.createElement("svg",_c({width:28,height:28,fill:"none",xmlns:"http://www.w3.org/2000/svg"},e),Ic||(Ic=a.createElement("path",{d:"M14 18.375a4.375 4.375 0 100-8.75 4.375 4.375 0 000 8.75z",fill:"#fff"})),Pc||(Pc=a.createElement("path",{fillRule:"evenodd",clipRule:"evenodd",d:"M24.5 14c0 5.799-4.701 10.5-10.5 10.5S3.5 19.799 3.5 14 8.201 3.5 14 3.5 24.5 8.201 24.5 14zm-1.75 0a8.75 8.75 0 11-17.5 0 8.75 8.75 0 0117.5 0z",fill:"#fff"})))};function Sc(){return Sc=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var o=arguments[t];for(var n in o)Object.prototype.hasOwnProperty.call(o,n)&&(e[n]=o[n])}return e},Sc.apply(this,arguments)}var Zc=function(e){return a.createElement("svg",Sc({width:24,height:24,viewBox:"0 0 64 64",fill:"none",xmlns:"http://www.w3.org/2000/svg"},e),jc||(jc=a.createElement("path",{d:"M32 8c13.255 0 24 10.745 24 24 0 6.617-5.98 11-13 11h-5c-1.768 0-4 .323-4 3 0 2.627 2 4.28 2 7 0 1.616-1.273 3-4 3C18.745 56 8 45.255 8 32S18.745 8 32 8zm13.5 27a4.5 4.5 0 10-4.5-4.5 4.5 4.5 0 004.5 4.5zm-7-11a4.5 4.5 0 10-4.5-4.5 4.5 4.5 0 004.5 4.5zm-13 0a4.5 4.5 0 10-4.5-4.5 4.5 4.5 0 004.5 4.5zM14 30.5a4.5 4.5 0 109.003.002 4.5 4.5 0 00-9.004-.003l.002.001z",fill:"#fff"})))};const Rc=g.ZP.div.withConfig({displayName:"OldToolbar.styles__ToolbarStyles",componentId:"sc-7c2e29fd-0"})`
  margin-right: ${e=>e.theme.panelSpacing}px;
  width: ${e=>e.$width}px;
  overflow: hidden;
  z-index: ${I.Mf};

  position: absolute;
  top: ${e=>-e.theme.headerHeight}px;
  right: 0;

  display: flex;
  justify-content: center;
  pointer-events: none;
`,Oc=g.ZP.div.withConfig({displayName:"OldToolbar.styles__ToolbarInner",componentId:"sc-7c2e29fd-1"})`
  display: flex;
  flex-direction: column;
  justify-content: center;
`,Mc=g.ZP.div.withConfig({displayName:"OldToolbar.styles__IconStyleActiveArea",componentId:"sc-7c2e29fd-2"})`
  padding: 6px;
  display: flex;
  align-self: center;
  background: ${e=>{let{selected:t,theme:o}=e;return t?o.colors.iconSelectedBg:"transparent"}};
  border-radius: 6px;
  cursor: pointer;

  svg {
    height: 28px;
    width: 28px;
  }

  svg path {
    opacity: ${e=>{let{selected:t}=e;return t?1:.5}};
  }

  svg path:not(.ignore-fill) {
    fill: ${e=>e.selected?e.theme.colors.iconSelected:e.theme.colors.icon};
  }
`,$c=g.ZP.button.attrs((()=>({type:"button"}))).withConfig({displayName:"OldToolbar.styles__IconStyleContainer",componentId:"sc-7c2e29fd-3"})`
  border: none;
  background-color: transparent;
  padding: 4px 0;
  & :hover {
    ${Mc} {
      background: ${e=>{let{selected:t,theme:o}=e;return t?o.colors.iconHoverSeletedBg:o.colors.iconHoverBg}};
    }
  }
`,Lc=e=>{let{children:t,selected:o,Component:n=$c,...a}=e;return(0,i.jsx)(n,{selected:o,...a,children:(0,i.jsx)(Mc,{selected:o,children:t})})},Ac=(0,g.ZP)($c).withConfig({displayName:"OldToolbar.styles__TileIconStyles",componentId:"sc-7c2e29fd-4"})`
  svg path:not(.ignore-fill) {
    fill: ${e=>e.selected?e.theme.colors.contentAccent:e.theme.colors.icon};
  }

  & :hover {
    ${Mc} {
      background: ${e=>!e.selected&&e.theme.colors.iconHoverBg};
    }
  }
`;var Nc=e=>{let{width:t,height:o}=e;const n=(0,E.t2)(),l=(0,E.f3)(),s=(0,E.xs)(),d=(0,a.useCallback)((e=>{l===e?((0,A.PS)(!1),n.closePropertyPanel()):n.setPropertyPanel(e)}),[l,n]),{t:c}=(0,C.$G)(),{toolbarRef:u}=(0,L.TR)(),p=(0,r.sJ)(R.kt),m=J({skip:p}),[h]=m?(0,z.An)(m.type):[null],g=(0,r.sJ)(A.uz),f=(0,a.useCallback)((()=>{d(_.Z.TILE),g()}),[d,g]),x=m&&h&&(0,i.jsx)(Lc,{"data-testid":`${h.label.toLowerCase()}_tile_icon_button`,selected:s(_.Z.TILE),onClick:f,renderTooltip:()=>{var e;return c("components.toolbar.tileTypeTooltipLabel",{tileTypeLabel:`${null===(e=h)||void 0===e?void 0:e.label}`})},disableTooltip:!!l,Component:Ac,role:"tab","aria-label":c("components.toolbar.tileTypeLabelText",{tileTypeLabel:`${h.label}`}),"aria-selected":l===_.Z.TILE,children:(0,i.jsx)(h.icon,{style:{width:28,height:28}})},h.label.toLowerCase()),{deselectAllTiles:v}=(0,V.N4)();return(0,i.jsx)(Rc,{$width:t,"data-testid":"toolbar",style:"number"==typeof o?{height:o}:{},children:(0,i.jsx)(Oc,{ref:u,role:"tablist",children:(0,i.jsxs)($o.Z,{offset:9,placement:"left",style:{pointerEvents:"all"},children:[x,(0,i.jsx)(Lc,{selected:l===_.Z.ADD_TILE,onClick:()=>{d(_.Z.ADD_TILE),v()},disableTooltip:!!l,renderTooltip:()=>c("components.toolbar.addTileTooltipLabel"),tooltipShortcuts:[(0,Is.C6)(),"T"],role:"tab","aria-selected":l===_.Z.ADD_TILE,children:(0,i.jsx)(Ec,{"data-testid":"add_tile_toolbar_icon"})},"add_tile"),(0,i.jsx)(Lc,{selected:l===_.Z.RECORD,onClick:()=>{d(_.Z.RECORD),v()},disableTooltip:!!l,renderTooltip:()=>c("components.toolbar.recordNarrationTooltipLabel"),tooltipShortcuts:[(0,Is.C6)(),"R"],role:"tab","aria-selected":l===_.Z.RECORD,children:(0,i.jsx)(kc,{"data-testid":"record_toolbar_icon"})},"record"),(0,i.jsx)(Lc,{selected:l===_.Z.CUSTOMIZE,onClick:()=>{d(_.Z.CUSTOMIZE),v()},disableTooltip:!!l,renderTooltip:()=>c("components.toolbar.setThemeTooltipLabel"),tooltipShortcuts:[(0,Is.C6)(),"O"],role:"tab","aria-selected":l===_.Z.CUSTOMIZE,children:(0,i.jsx)(Zc,{"data-testid":"color_palette_icon"})},"customize")]})})})},Dc=o(12128),Bc=o(95831);const Hc=e=>{var t;return!!(null===(t=e.target.closest("[data-tome-bypass-tap-navigation]"))||void 0===t?void 0:t.getAttribute("data-tome-bypass-tap-navigation"))};var Vc=e=>{let{enabled:t=!1,pages:o}=e;const n=(0,r.sJ)(A.Vx),[i,l]=(0,a.useState)(!1),[s,d]=(0,a.useState)(!1),{nextPage:c,prevPage:u}=gr(o);(0,a.useEffect)((()=>{if(window.Cypress)return l(!0),()=>{};l(!1),d(!1);const e=setTimeout((()=>{l(!0)}),300);return()=>{clearTimeout(e)}}),[n]);const p=(0,a.useCallback)((e=>{const t=e/window.innerWidth*100;return{leftTap:t<40,rightTap:t>=40}}),[]),m=(0,a.useCallback)((e=>{if(i||(e.preventDefault(),e.stopPropagation()),Hc(e)&&i)return;e.stopPropagation();const{leftTap:t,rightTap:o}=p(e.pageX);t&&u(),o&&c()}),[i,p,u,c]),h=(0,a.useCallback)((e=>{if(Hc(e))return;const{leftTap:t}=p(e.pageX),i=(0,N.xh)(o,n)||0;d(t&&i>0)}),[p,o,n]),g=(0,a.useCallback)((()=>{d(!1)}),[]);return t?{handleTap:m,handlePointerDown:h,handlePointerUp:g,isHoldingLeft:s}:{handleTap:void 0,handlePointerDown:void 0,handlePointerUp:void 0,isHoldingLeft:!1}},Fc=o(60243),Gc=o(85361),Uc=o(54991),zc=o(93505),Wc=o(61949);var Kc=(0,a.forwardRef)(((e,t)=>(0,i.jsxs)(ye.Z,{ref:t,style:{width:64,height:64},viewBox:"0 0 64 64",...e,children:[(0,i.jsx)("path",{fillRule:"evenodd",clipRule:"evenodd",d:"M12 16C12 13.7909 13.7909 12 16 12H25C27.2091 12 29 13.7909 29 16V25C29 27.2091 27.2091 29 25 29H16C13.7909 29 12 27.2091 12 25V16ZM16 17C16 16.4477 16.4477 16 17 16H24C24.5523 16 25 16.4477 25 17V24C25 24.5523 24.5523 25 24 25H17C16.4477 25 16 24.5523 16 24V17Z"}),(0,i.jsx)("path",{fillRule:"evenodd",clipRule:"evenodd",d:"M12 39C12 36.7909 13.7909 35 16 35H25C27.2091 35 29 36.7909 29 39V48C29 50.2091 27.2091 52 25 52H16C13.7909 52 12 50.2091 12 48V39ZM16 40C16 39.4477 16.4477 39 17 39H24C24.5523 39 25 39.4477 25 40V47C25 47.5523 24.5523 48 24 48H17C16.4477 48 16 47.5523 16 47V40Z"}),(0,i.jsx)("path",{fillRule:"evenodd",clipRule:"evenodd",d:"M39 12C36.7909 12 35 13.7909 35 16V25C35 27.2091 36.7909 29 39 29H48C50.2091 29 52 27.2091 52 25V16C52 13.7909 50.2091 12 48 12H39ZM40 16C39.4477 16 39 16.4477 39 17V24C39 24.5523 39.4477 25 40 25H47C47.5523 25 48 24.5523 48 24V17C48 16.4477 47.5523 16 47 16H40Z"}),(0,i.jsx)("path",{fillRule:"evenodd",clipRule:"evenodd",d:"M35 39C35 36.7909 36.7909 35 39 35H48C50.2091 35 52 36.7909 52 39V48C52 50.2091 50.2091 52 48 52H39C36.7909 52 35 50.2091 35 48V39ZM39 40C39 39.4477 39.4477 39 40 39H47C47.5523 39 48 39.4477 48 40V47C48 47.5523 47.5523 48 47 48H40C39.4477 48 39 47.5523 39 47V40Z"})]})));var qc=(0,a.forwardRef)(((e,t)=>(0,i.jsxs)(ye.Z,{ref:t,style:{width:64,height:64},viewBox:"0 0 64 64",...e,children:[(0,i.jsx)("path",{d:"M26 24.7145V39.2855C26 40.6079 27.4472 41.4309 28.5978 40.7629L41.146 33.4774C42.2847 32.8162 42.2847 31.1838 41.146 30.5226L28.5978 23.2371C27.4472 22.5691 26 23.3921 26 24.7145Z"}),(0,i.jsx)("path",{fillRule:"evenodd",clipRule:"evenodd",d:"M8 20C8 15.5817 11.5817 12 16 12H48C52.4183 12 56 15.5817 56 20V44C56 48.4183 52.4183 52 48 52H16C11.5817 52 8 48.4183 8 44V20ZM16 16H48C50.2091 16 52 17.7909 52 20V44C52 46.2091 50.2091 48 48 48H16C13.7909 48 12 46.2091 12 44V20C12 17.7909 13.7909 16 16 16Z"})]})));var Yc,Jc,Xc=(0,a.forwardRef)(((e,t)=>(0,i.jsx)(ye.Z,{ref:t,style:{width:64,height:64},viewBox:"0 0 64 64",...e,children:(0,i.jsx)("path",{fillRule:"evenodd",clipRule:"evenodd",d:"M42 48V38C50.8366 38 58 30.8366 58 22C58 13.1634 50.8366 6 42 6C33.1634 6 26 13.1634 26 22H16C12.6863 22 10 24.6863 10 28V48C10 51.3137 12.6863 54 16 54H36C39.3137 54 42 51.3137 42 48ZM54 22C54 28.6274 48.6274 34 42 34V28C42 24.6863 39.3137 22 36 22H30C30 15.3726 35.3726 10 42 10C48.6274 10 54 15.3726 54 22ZM36 50C37.1046 50 38 49.1046 38 48V28C38 26.8954 37.1046 26 36 26H16C14.8954 26 14 26.8954 14 28V48C14 49.1046 14.8954 50 16 50H36Z"})})));function Qc(){return Qc=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var o=arguments[t];for(var n in o)Object.prototype.hasOwnProperty.call(o,n)&&(e[n]=o[n])}return e},Qc.apply(this,arguments)}var eu,tu,ou=function(e){return a.createElement("svg",Qc({width:24,height:24,viewBox:"0 0 64 64",fill:"none",xmlns:"http://www.w3.org/2000/svg"},e),Yc||(Yc=a.createElement("path",{d:"M28 27a5 5 0 11-10 0 5 5 0 0110 0z",fill:"#fff"})),Jc||(Jc=a.createElement("path",{fillRule:"evenodd",clipRule:"evenodd",d:"M16 12a8 8 0 00-8 8v24a8 8 0 008 8h32a8 8 0 008-8V20a8 8 0 00-8-8H16zm32 4H16a4 4 0 00-4 4v24a4 4 0 004 4h4.141l16.014-16.856a6 6 0 017.837-.75L52 36.114V20a4 4 0 00-4-4zm4 25.03l-10.333-7.381a2 2 0 00-2.612.25L25.659 48H48a4 4 0 004-4v-2.97z",fill:"#fff"})))};function nu(){return nu=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var o=arguments[t];for(var n in o)Object.prototype.hasOwnProperty.call(o,n)&&(e[n]=o[n])}return e},nu.apply(this,arguments)}var iu=function(e){return a.createElement("svg",nu({width:24,height:24,viewBox:"0 0 64 64",xmlns:"http://www.w3.org/2000/svg"},e),eu||(eu=a.createElement("path",{d:"M42 34a4 4 0 100-8 4 4 0 000 8zM36 22a4 4 0 11-8 0 4 4 0 018 0zM22 34a4 4 0 100-8 4 4 0 000 8z",fill:"#fff"})),tu||(tu=a.createElement("path",{fill:"#fff",d:"M32 8C18.745 8 8 18.745 8 32c0 12.15 9.026 22.187 20.738 23.78C31.763 56.191 34 53.677 34 51v-3.315c0-2.535 2.504-4.77 5.499-4.622 3.278.161 7.27-.046 10.518-1.534 1.657-.759 3.18-1.878 4.282-3.502C55.407 36.395 56 34.384 56 32 56 18.904 45.264 8 32 8zM12 32c0-11.046 8.954-20 20-20 11.037 0 20 9.096 20 20 0 1.698-.413 2.9-1.01 3.78-.605.892-1.49 1.587-2.64 2.113-2.362 1.082-5.572 1.327-8.654 1.175C34.894 38.83 30 42.413 30 47.684V51a.914.914 0 01-.265.66.526.526 0 01-.458.156C19.52 50.49 12 42.121 12 32z"})))};const au=g.ZP.div.withConfig({displayName:"Toolbar.styles__ToolbarStyles",componentId:"sc-94d92f39-0"})`
  margin-right: ${e=>e.theme.tightPanelSpacing}px;
  width: 32px;
  overflow: hidden;
  z-index: ${I.Mf};

  position: absolute;
  top: ${e=>-e.theme.headerHeight}px;
  right: 0;

  display: flex;
  justify-content: center;
  pointer-events: none;
`,ru=g.ZP.div.withConfig({displayName:"Toolbar.styles__ToolbarInner",componentId:"sc-94d92f39-1"})`
  display: flex;
  flex-direction: column;
  justify-content: center;
`,lu=g.ZP.div.withConfig({displayName:"Toolbar.styles__IconStyleActiveArea",componentId:"sc-94d92f39-2"})`
  padding: 4px;
  display: flex;
  align-self: center;
  background: ${e=>{let{selected:t,theme:o}=e;return t?o.colors.iconSelectedStateBg:"transparent"}};
  border-radius: 6px;
  cursor: pointer;

  svg {
    height: 24px;
    width: 24px;
  }

  svg path {
    opacity: ${e=>{let{selected:t}=e;return t?1:.5}};
  }

  svg path:not(.ignore-fill) {
    fill: ${e=>e.selected?e.theme.colors.iconSelectedState:e.theme.colors.icon};
  }
`,su=g.ZP.button.attrs((()=>({type:"button"}))).withConfig({displayName:"Toolbar.styles__IconStyleContainer",componentId:"sc-94d92f39-3"})`
  border: none;
  background-color: transparent;
  padding: 4px 0;
  & :hover {
    ${lu} {
      background: ${e=>{let{selected:t,theme:o}=e;return t?o.colors.iconHoverSeletedBg:o.colors.iconHoverBg}};
    }
  }
`,du=e=>{let{children:t,selected:o,Component:n=su,...a}=e;return(0,i.jsx)(n,{selected:o,...a,children:(0,i.jsx)(lu,{selected:o,children:t})})},cu=(0,g.ZP)(su).withConfig({displayName:"Toolbar.styles__TileIconStyles",componentId:"sc-94d92f39-4"})`
  svg path:not(.ignore-fill) {
    fill: ${e=>e.selected?e.theme.colors.iconSelectedState:e.theme.colors.icon};
  }

  & :hover {
    ${lu} {
      background: ${e=>!e.selected&&e.theme.colors.iconHoverSeletedBg};
    }
  }
`;var uu=e=>{let{width:t,height:o,tomeId:n}=e;const r=(0,E.t2)(),l=(0,E.f3)(),s=(0,D.ye)(D.TT.DRAWING_TILE),d=(0,a.useCallback)((e=>{l===e?((0,A.PS)(!1),r.closePropertyPanel()):r.setPropertyPanel(e)}),[l,r]),{t:c}=(0,C.$G)(),{toolbarRef:u}=(0,L.TR)(),{deselectAllTiles:p}=(0,V.N4)(),m=ti({tomeId:n,shouldSetPropertyPanel:!0});return(0,i.jsx)(au,{$width:t,"data-testid":"toolbar",style:"number"==typeof o?{height:o}:{},children:(0,i.jsx)(ru,{ref:u,role:"tablist",children:(0,i.jsxs)($o.Z,{offset:9,placement:"left",style:{pointerEvents:"all"},children:[(0,i.jsx)(du,{"data-testid":"add_text_tile_icon_button",selected:l===_.Z.ADD_TEXT_TILE,onClick:()=>{d(_.Z.ADD_TEXT_TILE)},renderTooltip:()=>c("components.toolbar.addTextTileTooltipLabel"),disableTooltip:!!l,Component:cu,role:"tab","aria-label":c("components.toolbar.addTextTileTooltipLabel"),"aria-selected":l===_.Z.ADD_TEXT_TILE,children:(0,i.jsx)(zc.Z,{style:{height:24,width:24}})},"add_text_tile_icon_button"),(0,i.jsx)(du,{"data-testid":"add_image_tile_icon_button",selected:l===_.Z.ADD_MEDIA_TILE,onClick:()=>{d(_.Z.ADD_MEDIA_TILE)},renderTooltip:()=>c("components.toolbar.addImageTileTooltipLabel"),disableTooltip:!!l,Component:cu,role:"tab","aria-label":c("components.toolbar.addImageTileTooltipLabel"),"aria-selected":l===_.Z.ADD_MEDIA_TILE,children:(0,i.jsx)(ou,{style:{height:24,width:24},"data-testid":"add_media_tile_toolbar_icon"})},"add_image_tile_icon_button"),(0,i.jsx)(du,{"data-testid":"add_video_tile_icon_button",selected:!1,onClick:()=>{m({tileType:G.YUT.Video,afterAddTileAction:zn.B.NONE})},renderTooltip:()=>c("components.toolbar.addVideoTileTooltipLabel"),disableTooltip:!!l,Component:cu,role:"tab","aria-label":c("components.toolbar.addVideoTileTooltipLabel"),children:(0,i.jsx)(qc,{style:{height:24,width:24}})},"add_video_tile_icon_button"),s&&(0,i.jsx)(du,{selected:!1,onClick:()=>{m({tileType:G.YUT.Drawing,afterAddTileAction:zn.B.NONE})},renderTooltip:()=>c("components.toolbar.addDrawingTileTooltipLabel"),disableTooltip:!!l,Component:cu,role:"tab","aria-label":c("components.toolbar.addDrawingTileTooltipLabel"),children:(0,i.jsx)(Xc,{style:{height:24,width:24}})},"add_drawing_tile_icon_button"),(0,i.jsx)(du,{"data-testid":"add_table_tile_icon_button",selected:!1,onClick:()=>{m({tileType:G.YUT.Table,afterAddTileAction:zn.B.NONE})},renderTooltip:()=>c("components.toolbar.addTableTileTooltipLabel"),disableTooltip:!!l,Component:cu,role:"tab","aria-label":c("components.toolbar.addTableTileTooltipLabel"),children:(0,i.jsx)(Wc.Z,{style:{height:24,width:24}})},"add_table_tile_icon_button"),(0,i.jsx)(du,{"data-testid":"add_integration_tile_icon_button",selected:l===_.Z.ADD_MORE_TILES,onClick:()=>{d(_.Z.ADD_MORE_TILES),p()},renderTooltip:()=>c("components.toolbar.moreTilesTooltipLabel"),disableTooltip:!!l,Component:cu,role:"tab","aria-label":c("components.toolbar.moreTilesTooltipLabel"),children:(0,i.jsx)(Kc,{style:{height:24,width:24}})},"add_integrationstile_icon_button"),(0,i.jsx)(du,{selected:l===_.Z.CUSTOMIZE,onClick:()=>{d(_.Z.CUSTOMIZE),p()},disableTooltip:!!l,renderTooltip:()=>c("components.toolbar.setThemeTooltipLabel"),Component:cu,tooltipShortcuts:[(0,Is.C6)(),"O"],role:"tab","aria-selected":l===_.Z.CUSTOMIZE,children:(0,i.jsx)(iu,{"data-testid":"color_palette_icon",style:{height:24,width:24}})},"customize")]})})})},pu=o(51430),mu=o(19352);const hu=g.ZP.div.withConfig({displayName:"OnboardingAutotomeModalContent__ScrimOverlay",componentId:"sc-c6c63c6f-0"})`
  position: fixed;
  pointer-events: none;
  inset: 0;
  background-color: ${e=>{let{theme:t}=e;return t.colors.onboardingAutotomeScrim}};
  width: 100vw;
  height: 100vh;
`,gu=g.ZP.div.withConfig({displayName:"OnboardingAutotomeModalContent__SpecialModalContent",componentId:"sc-c6c63c6f-1"})`
  position: fixed;
  width: 100%;
  height: 100%;
  overflow: hidden;
`,Cu=g.ZP.div.withConfig({displayName:"OnboardingAutotomeModalContent__DialogBackground",componentId:"sc-c6c63c6f-2"})`
  position: fixed;
  top: 50%;
  left: 50%;
  transform: translate(-50%, -50%);
  width: 340px;
  box-shadow: ${e=>{let{theme:t}=e;return t.colors.panelBoxShadow}};

  background: ${e=>{let{theme:t}=e;return t.colors.dialogBackground}};
  border-radius: 12px;
  padding: 24px;
`,fu=g.ZP.div.withConfig({displayName:"OnboardingAutotomeModalContent__HStack",componentId:"sc-c6c63c6f-3"})`
  display: flex;
  flex-direction: row;
  height: 24px;
  align-items: end;
  justify-content: space-between;
  margin-bottom: 6px;
  margin-right: -12px; // This allows to position the close image visually aligned with the "lets go" button.
`,xu=g.ZP.div.withConfig({displayName:"OnboardingAutotomeModalContent__TextAndButtonsContainer",componentId:"sc-c6c63c6f-4"})`
  flex-direction: column;
  display: flex;
`,vu=g.ZP.h3.withConfig({displayName:"OnboardingAutotomeModalContent__Heading",componentId:"sc-c6c63c6f-5"})`
  font-family: ${e=>{let{theme:t}=e;return t.fonts.ui}};
  font-weight: 700;
  font-size: 20px;
  line-height: 24px;
  color: ${e=>{let{theme:t}=e;return t.colors.primaryUiText}};
  margin-block-end: 8px;
  margin-top: 0px;
  margin-bottom: 3px;
`,bu=g.ZP.p.withConfig({displayName:"OnboardingAutotomeModalContent__Text",componentId:"sc-c6c63c6f-6"})`
  font-family: ${e=>{let{theme:t}=e;return t.fonts.ui}};
  font-size: 16px;
  margin-top: 0px;
  line-height: 130%;
  margin-block-end: 12px;
  margin-bottom: 12px;
  text-align: left;

  color: ${e=>{let{theme:t}=e;return t.colors.confirmationModalSubtitle}};
`,yu=g.ZP.div.withConfig({displayName:"OnboardingAutotomeModalContent__TextContainer",componentId:"sc-c6c63c6f-7"})`
  margin-bottom: 12px;
`;var wu=e=>{let{close:t}=e;const{t:o}=(0,C.$G)();return(0,i.jsxs)(i.Fragment,{children:[(0,i.jsx)(hu,{}),(0,i.jsx)(gu,{"data-testid":"autotome_onboarding_modal",children:(0,i.jsx)(Cu,{children:(0,i.jsxs)(xu,{children:[(0,i.jsxs)(fu,{children:[(0,i.jsx)(vu,{children:o("components.onboardingAutotomeModalContent.welcomeModalTitle")}),(0,i.jsx)(Dr,{"aria-label":o("components.onboardingAutotomeModalContent.closeButtonLabel"),onClick:t,icon:(0,i.jsx)(ft.Z,{style:{width:28,height:28,opacity:.4}})})]}),(0,i.jsxs)(yu,{children:[(0,i.jsx)(bu,{children:o("components.onboardingAutotomeModalContent.toolsAndGeneratingAIContentGuideText")}),(0,i.jsx)(bu,{children:o("components.onboardingAutotomeModalContent.toCheckoutYourWorkspaceGuideText")})]}),(0,i.jsx)(Re.ZP,{"data-testid":"nux_start_button",size:"large",color:"primary",variant:"contained",onClick:t,children:o("components.onboardingAutotomeModalContent.letsGoButtonLabel")})]})})})]})};const Tu=(0,g.ZP)(mu.fC).withConfig({displayName:"OnboardingAutotomeModal__DialogPortal",componentId:"sc-88c4865f-0"})`
  width: 100%;
  height: 100%;
  display: flex;
  justify-content: center;
  padding: 72px;
  align-items: flex-end;
`,Iu=(e,t)=>{const[o]=(0,G.H8S)(),{user:n}=(0,a.useContext)(oi.Z),[l,s]=(0,r.FV)(A.e7),[d,c]=(0,a.useState)(!1),u=(0,a.useCallback)((()=>{c(!0),n&&n.id&&o({variables:{userId:n.id,newUserOnboardingTaskProgress:G.lnN.End},update(e,t){let{data:o}=t;var i;(null===(i=o)||void 0===i?void 0:i.updateUserAttributes)&&e.modify({id:e.identify(n),fields:{attributes(e){var t,n;return{...e,...null===(n=o)||void 0===n||null===(t=n.updateUserAttributes)||void 0===t?void 0:t.attributes}}}})}})}),[o,n]);(0,a.useEffect)((()=>{l||u()}),[l,u]);const p=(0,a.useCallback)((async()=>{c(!1),s(!0)}),[s]);return d?(0,i.jsx)(Tu,{style:{zIndex:I.IT-1},ref:t,children:(0,i.jsx)(wu,{close:p})}):(0,i.jsx)(i.Fragment,{})};var Pu=(0,a.forwardRef)(Iu);const Eu=g.ZP.div.withConfig({displayName:"TapToNavigateFeedback.styles__TapToNavigateFeedback",componentId:"sc-131bd6ae-0"})`
  position: fixed;
  left: 0;
  top: 0;
  bottom: 0;
  right: 0;
  z-index: ${I.y$};
  pointer-events: none;
  height: 100vh;
  width: 40%;
  opacity: ${e=>{let{visible:t,theme:o}=e;return t?o.colors.tapToNavigateBackOpacity:0}};
  transition: opacity 0.2s ease;
  background: radial-gradient(
    86.92% 43.15% at 0% 50%,
    rgba(0, 0, 0, 1) 0%,
    rgba(0, 0, 0, 0) 100%
  );
`;var _u=o(10158);var ju=e=>{let{tomeId:t}=e;const o=(0,v.s)(),[n,l]=(0,r.FV)((0,_u.$)(t));return(0,a.useEffect)((()=>{n&&o.open()}),[n,o]),(0,i.jsx)(v.Z,{ref:o.ref,title:n?n.title:"",subtitle:n?n.subtitle:"",primaryButtonContent:"OK",primaryButtonAction:()=>{l(null),o.close()},buttonColor:"primary",dismissible:!1})},ku=o(41243);var Su=e=>{let{triggerTomeRefetch:t}=e;const o=(0,r.sJ)(A.GP),n=(0,H.Z)(o),{documentVisibility:s}=(0,ku.Z)();return(0,a.useEffect)((()=>{o&&s&&!n&&void 0!==n&&(t(),l.v.addAction("networkReconnectTomeRefetch"))}),[o,n,t,s]),(0,i.jsx)(i.Fragment,{})},Zu=o(82175),Ru=o(87258);const Ou=(0,g.ZP)(d.E.div).withConfig({displayName:"TomePlaybackOverlay__OverlayWrapper",componentId:"sc-b46b7f02-0"})`
  z-index: ${I.y$};
  position: absolute;
  top: ${e=>{let{$isMobile:t}=e;return t?"62px":"24px"}};
  right: ${e=>{let{$isMobile:t}=e;return t?"12px":"56px"}};
  cursor: pointer;
`;function Mu(e){if(!e)return e;const t=new URL(e);return t.search="",t.href}var $u=e=>{let{overlayData:t,isMobile:o,pages:n,tomeId:l,sliderRef:s}=e;const[d,c]=(0,r.FV)(A.Vx),u=(0,a.useRef)(null),[p,m]=(0,a.useState)([]),[h,g]=(0,a.useState)(!1),f=(0,a.useRef)(),x=(0,a.useRef)();(0,a.useEffect)((()=>{const e=(0,N.xh)(n,d);if(p&&null!==e){var t;const n=p.find((t=>t.pageIndex===e));if(!n)return;const i=n.from/1e3;var o;if(u.current&&Math.abs((null===(t=u.current)||void 0===t?void 0:t.currentTime())-i)>1)h&&(u.current.toggleVideo(),g(!1)),null===(o=u.current)||void 0===o||o.setCurrentTime(i),(h||f.current&&x.current!==e)&&(f.current&&clearTimeout(f.current),x.current=e,f.current=setTimeout((()=>{var e;null===(e=u.current)||void 0===e||e.toggleVideo(),f.current=void 0,x.current=void 0}),500))}}),[d,h,n,p]),(0,a.useEffect)((()=>{fetch("/assets/ymrtyt.vtt").then((e=>e.text())).then((e=>{const t=(0,Zu.Q)(e).entries.map(((e,t)=>({...e,pageIndex:t+1})));m(t)})).catch((e=>{console.error(e)}))}),[]);const v={onTimeUpdate:(0,a.useCallback)((e=>{var t,i;const a=null===(t=e.target)||void 0===t?void 0:t.currentTime;if(!h)return;const r=null===(i=p)||void 0===i?void 0:i.find((e=>{const t=e.from/1e3,o=e.to/1e3;return a>=t&&a<=o}));if(r){const e=(0,N.Bb)(n,r.pageIndex);var l;if(e&&e!==d)if(o)null===(l=s.current)||void 0===l||l.scroll({left:window.innerWidth*r.pageIndex});else c(e)}}),[h,n,p,c,s,o,d])},b=(0,a.useCallback)((()=>{var e;null===(e=u.current)||void 0===e||e.toggleVideo()}),[]),y=(0,a.useCallback)((e=>{g(e)}),[g]),w=(0,a.useMemo)((()=>function(e){return{...e,videoThumbnailUrl:Mu(e.videoThumbnailUrl)}}(t)),[t]),{t:T}=(0,C.$G)();return(0,i.jsx)(Ou,{$isMobile:o,onTap:b,children:(0,i.jsx)(Ru.Z,{ref:u,overlayData:w,setPlaybackPlaying:y,isMobile:o,isInRecordMode:!1,shouldBeVisible:!0,shouldAnimateIn:!0,tooltipCopy:T(o?"tome.tomePlaybackOverlay.tapToAutoPlayWithAudioTooltip":"tome.tomePlaybackOverlay.clickToAutoplayWithAudioTooltip"),shouldScaleTooltip:!1,videoProps:v,size:o?Ru.f.SMALL:Ru.f.NORMAL,tomeId:l,forceLoad:o})})},Lu=o(111);var Au=()=>{const{getActiveController:e}=(0,a.useContext)(X.Z),t=(0,r.sJ)(V.zO),{exclusiveSelectTiles:o}=(0,V.N4)();(0,a.useEffect)((()=>{null===t&&(0,A.WC)(null)}),[t]);return{navigateTileByDirection:(0,r._8)((n=>{let{set:i}=n;return n=>{const a=e();if(t&&a){const e=(0,A.WC)(),{tileId:r,lastIntentionalColumnIdx:l}=a.tileNeighborByDirection(t,n,e);r&&(o([r]),i((0,A.Eq)(r),!0)),(0,A.WC)(l)}}}),[e,o,t])}},Nu=o(9955),Du=o(68343);var Bu=e=>{let{isInExpandMode:t,enterPresentMode:o,exitPresentMode:n,exitExpandMode:l,tome:d,canEdit:c,presentMode:u,setShowLayoutSelection:p}=e;const{apolloClient:m,clientId:h}=(0,L.bp)(),[g,f]=(0,r.FV)(A.Vx),[x,v]=(0,r.FV)(A.pt),{t:b}=(0,C.$G)(),y=(0,E.t2)(),w=(0,E.f3)(),I=(0,r.sJ)(V.zO),{deselectAllTiles:P}=(0,V.N4)(),j=(0,r.sJ)(V.$y),k=(0,s.l)(A.k$),S=(0,r.sJ)(T.wo),[R,O]=(0,r.FV)(ke.cm),[M,$]=(0,r.FV)(ke.s5),D=(0,s.l)(A.pm),B=(0,ws.yP)(),{getActiveController:H}=(0,a.useContext)(X.Z),{navigateTileByDirection:F}=Au(),G=(()=>{const{scrollingPageRef:e,pageScrollTopAnimatedToRef:t,pageScrollAnimationStopRef:o}=(0,a.useContext)(Z.Z),n=tr();return(0,a.useCallback)((i=>{if(e.current){var a,r;null===(a=(r=o).current)||void 0===a||a.call(r);const s=e.current.scrollTop;let d;d=null!=t.current&&t.current<s?t.current:s;const c=(0,A.k6)(),u=.5*window.innerHeight/c,p=Math.floor(Math.max(d-u,0));var l;0===d||s<=p?null===(l=i)||void 0===l||l():n(p)}}),[e,o,t,n])})(),U=nr(),{undo:z,redo:K}=(0,nd.C5)(),q=(0,a.useCallback)(((e,o)=>{if(t)return;const n=(0,N.xh)(d.pages,g);if(n-1>=0){const e=(0,N.Bb)(d.pages,n-1);f(e),v(o?[n-1]:[])}e.preventDefault()}),[g,t,f,d.pages,v]),Y=(0,a.useCallback)(((e,o)=>{var n;if(t)return;const i=(0,N.xh)(d.pages,g);if(i+1<((null===(n=d.pages)||void 0===n?void 0:n.length)||0)){const e=(0,N.Bb)(d.pages,i+1);f(e),v(o?[i+1]:[])}e.preventDefault()}),[g,t,f,d.pages,v]),{deleteTilesAction:J}=(0,Ve.Z)(),Q=(0,a.useMemo)((()=>(0,N.yW)(d.pages,g)),[g]),ee=(0,r._8)((e=>{let{snapshot:t}=e;return()=>{const e=H();if(j&&e){const o=t.getLoadable(V.py).getValue();J(Array.from(o),Q.id,e,y,d.id,m,h)}else x.length>0&&(0,N.sc)(d,x,m,h,v,f)}}),[H,j,x,J,Q.id,y,d,m,h,v,f]),te=(0,a.useCallback)((()=>{(0,N.tv)(d,x,m,h,v,f)}),[d,m,h,x,v,f]),oe=(0,a.useCallback)((e=>{e.preventDefault(),R||M||(n(),l(),null!==w&&y.closePropertyPanel(),j&&P(),v((e=>e.length>0?[]:e)))}),[R,M,n,l,w,j,v,y,P]),ne=(0,a.useMemo)((()=>(0,Lu.Z)((()=>{(0,A.ak)({message:b("throttledToastMessage.workSaved")})}),2e3)),[b]),ie=(0,a.useCallback)((e=>{e.preventDefault(),ne()}),[ne]),ae=(0,r._8)((e=>{let{snapshot:t}=e;return e=>{if(j){var o;const c=null===(o=d.pages)||void 0===o?void 0:o.flatMap((e=>e.tiles)).find((e=>{var t;return(null===(t=e)||void 0===t?void 0:t.id)===I}));if(R||!c||"IMAGE"!==c.type&&"GIPHY"!==c.type)if(!M&&I&&c&&"VIDEO"===c.type){var n,i,a;const o=t.getLoadable((0,qe.M)({tileId:I,url:(null===(i=c)||void 0===i||null===(n=i.videoTileData)||void 0===n?void 0:n.url)||""})).getValue();(0,Ke.M)(null===(a=c)||void 0===a?void 0:a.mediaTileData,o)||$(!0),e.preventDefault()}else c&&"BLANK"===c.type&&(y.setPropertyPanel(_.Z.ADD_TILE),e.preventDefault());else{var r,l,s;(0,W.Gj)(null===(r=c)||void 0===r?void 0:r.imageAttributes,null===(s=c)||void 0===s||null===(l=s.mediaTileData)||void 0===l?void 0:l.mediaStatus)||O(!0),e.preventDefault()}}}}),[j,d.pages,R,M,I,O,$,y]),re=(0,a.useCallback)((e=>{e.preventDefault(),S||D||t||(j?F(Du.y.DOWN):x.length>0?Y(e,!0):U((()=>Y(e,!1))))}),[S,D,t,j,x.length,F,Y,U]),le=(0,a.useCallback)((e=>{S||D||t||(e.preventDefault(),j?F(Du.y.UP):x.length>0?q(e,!0):G((()=>q(e,!1))))}),[S,D,t,j,x.length,F,q,G]),se=(0,a.useCallback)((e=>{if(!S&&!D)if(e.preventDefault(),j)F(Du.y.RIGHT);else if(w!==_.Z.ADD_TILE){if(j)return;Y(e,!1)}}),[w,S,j,D,Y,F]),de=(0,a.useCallback)((e=>{if(!S&&!D)if(e.preventDefault(),j)F(Du.y.LEFT);else if(w!==_.Z.ADD_TILE){if(j)return;e.preventDefault(),q(e,!1)}}),[w,S,j,D,q,F]),ce=(0,a.useCallback)((e=>{e.preventDefault(),v((e=>{var t;const o=Math.min(...e),n=Math.max(...e);if(n<0)return e;const i=[...e];return o<(0,N.xh)(d.pages,g)?i.splice(i.indexOf(o),1):n+1<((null===(t=d.pages)||void 0===t?void 0:t.length)||0)&&i.push(n+1),i.concat()}))}),[g,v,d.pages]),ue=(0,a.useCallback)((e=>{e.preventDefault(),v((e=>{const t=Math.min(...e),o=Math.max(...e);if(t<0||0===o)return e;const n=[...e];return o>(0,N.xh)(d.pages,g)?n.splice(n.indexOf(o),1):n.splice(n.indexOf(t),0,t-1),n.concat()}))}),[g,v,d.pages]),pe=(0,a.useCallback)((e=>{e.preventDefault(),B({action:ws.$C.TOGGLE_IF_AVAILABLE})}),[B]),me=(0,a.useCallback)((()=>{u||t||(0,A.k$)(!k)}),[k,u,t]),he=(0,a.useCallback)((()=>{p(!0)}),[p]),ge=(0,a.useCallback)((()=>{u&&td()}),[u]),Ce=(0,a.useCallback)((()=>{!c||u||t||y.setPropertyPanel((e=>e===_.Z.RECORD?null:_.Z.RECORD))}),[c,t,u,y]),fe=(0,a.useCallback)((()=>{!c||u||t||y.setPropertyPanel((e=>e===_.Z.CUSTOMIZE?null:_.Z.CUSTOMIZE))}),[c,t,u,y]),xe=(0,a.useCallback)((e=>{!c||u||t||(e.preventDefault(),w===_.Z.ADD_TILE?y.closePropertyPanel():(y.setPropertyPanel(_.Z.ADD_TILE),P()))}),[c,u,t,w,y,P]),ve=(0,a.useMemo)((()=>{const e=new Map;return e.set("down",{callback:re,enableKeybindingInEditableElements:!1}),e.set("up",{callback:le,enableKeybindingInEditableElements:!1}),e.set("right",{callback:se,enableKeybindingInEditableElements:!1}),e.set("left",{callback:de,enableKeybindingInEditableElements:!1}),e.set("esc",{callback:oe,enableKeybindingInEditableElements:!1}),c&&(e.set(["backspace","del"],{callback:ee,enableKeybindingInEditableElements:!1}),e.set("mod+k",{callback:pe,enableKeybindingInEditableElements:!0}),e.set("mod+d",{callback:e=>{e.preventDefault(),te()},enableKeybindingInEditableElements:!0}),e.set("mod+z",{callback:e=>{e.preventDefault(),z()},enableKeybindingInEditableElements:!1}),e.set("shift+mod+z",{callback:e=>{e.preventDefault(),K()},enableKeybindingInEditableElements:!1}),e.set("shift+mod+r",{callback:e=>{e.preventDefault()},enableKeybindingInEditableElements:!1}),e.set("mod+s",{callback:ie,enableKeybindingInEditableElements:!0}),e.set("enter",{callback:ae,enableKeybindingInEditableElements:!1}),e.set(["shift+down","shift+right"],{callback:ce,enableKeybindingInEditableElements:!1}),e.set(["shift+up","shift+left"],{callback:ue,enableKeybindingInEditableElements:!1}),e.set("alt+m",{callback:me,enableKeybindingInEditableElements:!0}),e.set("alt+n",{callback:he,enableKeybindingInEditableElements:!0}),e.set("alt+p",{callback:o,enableKeybindingInEditableElements:!0}),e.set("alt+f",{callback:ge,enableKeybindingInEditableElements:!0}),e.set("alt+r",{callback:Ce,enableKeybindingInEditableElements:!0}),e.set("alt+t",{callback:xe,enableKeybindingInEditableElements:!0}),e.set("alt+o",{callback:fe,enableKeybindingInEditableElements:!0})),e}),[re,le,se,de,oe,c,ee,pe,ie,ae,ce,ue,me,he,o,ge,Ce,xe,fe,te,z,K]);return(0,i.jsx)(Nu.a,{bindings:ve})},Hu=o(83305),Vu=o(41228),Fu=o(76382),Gu=o(30378),Uu=o(88845),zu=o(89250),Wu=o(93280),Ku=o(79573),qu=o(31940),Yu=o(60595);var Ju=(0,a.forwardRef)(((e,t)=>(0,i.jsx)(ye.Z,{ref:t,viewBox:"0 0 64 64",...e,children:(0,i.jsx)("path",{fillRule:"evenodd",clipRule:"evenodd",d:"M32 8H32C45.2548 8 56 18.7452 56 32C56 38.6167 50.0207 43 43 43H38C36.2316 43 34 43.3231 34 46C34 48.6266 36 50.28 36 53C36 54.6164 34.7273 56 32 56C18.7452 56 8 45.2548 8 32C8 18.7452 18.7452 8 32 8H32ZM45.5 35C47.9853 35 50 32.9853 50 30.5C50 28.0147 47.9853 26 45.5 26C43.0147 26 41 28.0147 41 30.5V30.4999C41 32.9849 43.0143 34.9995 45.4993 34.9999L45.5 35ZM38.5005 24C40.9858 24 43.0005 21.9853 43.0005 19.5C43.0005 17.0147 40.9858 15 38.5005 15C36.0152 15 34.0005 17.0147 34.0005 19.5V19.4999C34.0005 21.985 36.0149 23.9996 38.5 23.9999L38.5005 24ZM25.5005 24H25.5005C27.9858 24 30.0005 21.9853 30.0005 19.5C30.0005 17.0147 27.9858 15 25.5005 15C23.0152 15 21.0005 17.0147 21.0005 19.5V19.4999C21.0005 21.9849 23.0148 23.9995 25.4998 23.9999L25.5005 24ZM14.0005 30.5C14.0005 32.9853 16.0152 35 18.5005 35C20.9858 35 23.0005 32.9853 23.0005 30.5C23.0005 28.0147 20.9858 26 18.5005 26C16.0152 25.9994 14 28.0136 13.9994 30.4989C13.9994 30.4992 13.9994 30.4995 13.9994 30.4998L14.0005 30.5Z"})}))),Xu=o(90036),Qu=o(47612),ep=o(33720);var tp=e=>{let{onClick:t,debounceDurationMs:o=1e3*ep.jy}=e;const n=(0,a.useRef)(!1);return()=>{var e;n.current||(null===(e=t)||void 0===e||e(),n.current=!0,setTimeout((()=>{n.current=!1}),o))}};const op=24,np=(0,g.ZP)(d.E.div).withConfig({displayName:"CommandTitle__IconContainer",componentId:"sc-1be448e7-0"})`
  flex-shrink: 0;
  display: flex;
  align-items: center;
  justify-content: end;
  width: ${e=>{let{$viewAs:t}=e;return t!==cp.SCOPED?38:26}}px;
`,ip=(0,g.ZP)(np).withConfig({displayName:"CommandTitle__ActionIconContainer",componentId:"sc-1be448e7-1"})`
  // Absolute positioning ensures that the icon stays on the right side
  // of the list item during the ROOT <-> SCOPED transition.
  // CommandTitleContainer shrinks from full-width if the SCOPED mode
  // of the command has a set of CommandControls on the right side.
  position: absolute;
  right: ${10}px;
  // This is needed to ensure that mousing over the list causes the action
  // icon to immediately appear and disappear. The icon fade/rotate
  // animation that occurs between ROOT <-> SCOPED mode runs on the icon
  // within this container. This structure prevents the icon from fading
  // during mouseover in ROOT mode.
  opacity: ${e=>{let{$viewAs:t,$isFocusedInRootMode:o}=e;return t!==cp.ROOT||o?1:0}};
`,ap=g.ZP.span.withConfig({displayName:"CommandTitle__FallbackText",componentId:"sc-1be448e7-2"})`
  color: ${e=>{let{theme:t}=e;return t.colors.commandPromptControlTextFallback}};
  font-weight: 500;
`,rp=(0,g.ZP)(d.E.div).withConfig({displayName:"CommandTitle__CommandTitleContainer",componentId:"sc-1be448e7-3"})`
  line-height: 20px;
  display: flex;
  align-items: center;
  width: 100%;
  height: 100%;
  color: ${e=>{let{theme:t}=e;return t.colors.commandPromptListCommandLabel}};
  cursor: ${e=>{let{$viewAs:t}=e;return t!==cp.ROOT?"pointer":void 0}};
  gap: ${12}px;

  border-radius: ${e=>{let{$viewAs:t,$isFocusedInRootMode:o,theme:n}=e;return t===cp.ROOT&&o?n.borderRadius.xs:0}};
  background-color: ${e=>{let{$viewAs:t,$isFocusedInRootMode:o,theme:n}=e;return t===cp.ROOT&&o?n.colors.commandPromptFocusedListItem:"transparent"}};

  &:hover {
    color: ${e=>{let{theme:t,$viewAs:o}=e;return o!==cp.ROOT?t.colors.commandPromptListCommandLabelHover:t.colors.commandPromptListCommandLabel}};
  }

  & > ${np} > svg {
    width: ${op}px;
    height: ${op}px;
    fill: ${e=>{let{theme:t}=e;return t.colors.commandPromptListCommandLabel}};
  }

  &:hover > ${np} > svg {
    fill: ${e=>{let{theme:t,$viewAs:o}=e;return o!==cp.ROOT?t.colors.commandPromptListCommandLabelHover:t.colors.commandPromptListCommandLabel}};
  }
`,lp=(0,g.ZP)(d.E.div).withConfig({displayName:"CommandTitle__TitleContainer",componentId:"sc-1be448e7-4"})`
  ${te.wR}
  font-size: ${15}px;
`,sp=(0,g.ZP)(d.E.div).withConfig({displayName:"CommandTitle__TitleAndTagContainer",componentId:"sc-1be448e7-5"})`
  display: flex;
  gap: ${6}px;
  align-items: center;

  max-width: calc(
    100% - 2 * ${38}px - ${12}px -
      ${10}px
  );
`;var dp,cp;!function(e){e[e.NONE=0]="NONE",e[e.BETA=1]="BETA",e[e.PRO=2]="PRO",e[e.NEW=3]="NEW"}(dp||(dp={})),function(e){e[e.ROOT=0]="ROOT",e[e.SCOPED=1]="SCOPED",e[e.DELEGATE_BOTTOM_BAR=2]="DELEGATE_BOTTOM_BAR"}(cp||(cp={}));var up=e=>{let{Icon:t,ActionIcon:o,title:n,viewAs:r,isFocusedInRootMode:l,tag:s,disableTitleAnimations:c=!1,fallbackString:u="",showEllipsis:p=!1,onClick:m}=e;const h=(0,a.useMemo)((()=>(0,d.E)(t)),[t]),g=(0,a.useMemo)((()=>o?(0,d.E)(o):null),[o]),C=r===cp.ROOT,f=r===cp.SCOPED,x=r===cp.DELEGATE_BOTTOM_BAR;let v="12px";f?v="4px":x&&(v="0px");const b={width:C?"24px":"20.808px",height:C?"24px":"20.808px"},y=C?"auto":"none",w={fontSize:C?"15px":"13.004999999999999px"},T={gap:C?"6px":"4px"},I={opacity:f?0:1,rotate:f?90:0,scale:f?.4166666666666667:1,x:f?6:0},P=p?"...":"",E=u&&C?(0,i.jsxs)(ap,{children:[" ",u]}):null,_=(0,i.jsxs)(i.Fragment,{children:[n,E,P]}),j=tp({onClick:m}),k=(e=>{switch(e){case dp.BETA:return(0,i.jsx)(ut.Ur,{});case dp.PRO:return(0,i.jsx)(ut.gQ,{});case dp.NEW:return(0,i.jsx)(ut.PS,{});default:return null}})(s);return(0,i.jsxs)(rp,{initial:!1,animate:{gap:v},transition:c?ep.YB:ep.TP,onClick:j||void 0,$viewAs:r,$isFocusedInRootMode:l,children:[(0,i.jsx)(np,{$viewAs:r,style:{pointerEvents:y},children:(0,i.jsx)(h,{transition:c?ep.YB:ep.TP,initial:!1,animate:b})}),(0,i.jsxs)(sp,{initial:!1,animate:T,transition:c?ep.YB:ep.TP,children:[(0,i.jsx)(lp,{transition:c?ep.YB:ep.TP,initial:!1,animate:w,children:_}),k]}),g&&(0,i.jsx)(ip,{$isFocusedInRootMode:l,$viewAs:r,style:{pointerEvents:y},children:(0,i.jsx)(g,{transition:ep.b4,initial:!1,animate:I})})]})};const pp=(0,g.ZP)(d.E.div).withConfig({displayName:"CommandLayout__CommandLayoutContainer",componentId:"sc-6f768bcc-0"})`
  width: 100%;
  height: ${e=>{let{$viewAs:t}=e;return t===cp.ROOT?ep.xJ:ep.BY}}px;
  // Separating this from the inner container allows the cursor to remain a
  // pointer between rows even though the focused command highlight does not
  // extend all the way to the top and bottom of the row.
  cursor: ${e=>{let{$pointerCursor:t}=e;return t?"pointer":void 0}};
`,mp=(0,g.ZP)(d.E.div).withConfig({displayName:"CommandLayout__CommandLayoutInnerContainer",componentId:"sc-6f768bcc-1"})`
  display: flex;
  flex-direction: row;
  align-items: center;
  // CommandPromptListItem renders 6px of padding on the left and right.
  // The 2px padding on the top and bottom allow the focused command to render
  // a background highlight that does not consume the full height of the row.
  padding: 2px 0;
  position: relative;
  height: 100%;
`;var hp=e=>{let{onClick:t,children:o,viewAs:n}=e;const a=tp({onClick:t});return(0,i.jsx)(pp,{$pointerCursor:!!t,$viewAs:n,onClick:t?a:void 0,children:(0,i.jsx)(mp,{children:o})})},gp=o(20940);var Cp=(0,a.forwardRef)(((e,t)=>(0,i.jsx)(ye.Z,{ref:t,viewBox:"0 0 64 64",...e,children:(0,i.jsx)("path",{fillRule:"evenodd",clipRule:"evenodd",d:"M32.0208 56.021H32.0208C18.766 56.021 8.02081 45.2758 8.02081 32.021C8.02081 18.7662 18.766 8.021 32.0208 8.021C45.2756 8.021 56.0208 18.7662 56.0208 32.021V32.021C56.0208 45.2758 45.2756 56.021 32.0208 56.021H32.0208ZM32.0208 12.021H32.0208C20.9751 12.021 12.0208 20.9753 12.0208 32.021C12.0208 43.0667 20.9751 52.021 32.0208 52.021C43.0665 52.021 52.0208 43.0667 52.0208 32.021V32.0211C52.0208 20.9754 43.0666 12.0212 32.0209 12.0211L32.0208 12.021ZM33.0985 37.021H30.9492C30.4113 37.0265 29.9629 36.6105 29.9281 36.0736L29.0135 19.0736V19.0736C28.99 18.5163 29.4226 18.0454 29.9799 18.0218C29.9981 18.0211 30.0162 18.0208 30.0343 18.021H34.0134C34.5712 18.0145 35.0286 18.4614 35.0351 19.0191C35.0354 19.0373 35.0351 19.0554 35.0343 19.0736L34.1196 36.0736C34.0848 36.6104 33.6364 37.0264 33.0985 37.021V37.021ZM32.0148 40.021C33.6717 40.021 35.0148 41.3641 35.0148 43.021C35.0148 44.6778 33.6717 46.021 32.0148 46.021C30.358 46.021 29.0148 44.6778 29.0148 43.021C29.0148 41.3641 30.358 40.021 32.0148 40.021Z"})}))),fp=o(67157);const xp=2e3,vp=(0,g.ZP)(d.E.span).withConfig({displayName:"CommandStatus__StatusWrapper",componentId:"sc-c21b76d8-0"})`
  flex: 1 1 auto;
  white-space: nowrap;
  text-overflow: ellipsis;
  overflow: hidden;
  // spacing between the text and the spinner
  margin-right: 48px;
  color: ${e=>{let{theme:t}=e;return t.colors.commandPromptStatusText}};
`,bp=(0,g.ZP)(d.E.div).withConfig({displayName:"CommandStatus__Background",componentId:"sc-c21b76d8-1"})`
  display: flex;
  flex-direction: row;
  justify-content: space-between;
  align-items: center;
  min-width: 320px;
  max-width: max-content;
  font-size: 17px;
  line-height: 26px;
  padding: 20px 24px;
`;var yp=e=>{let{content:t,status:o,action:n,style:a}=e;const r=function(e,t,o){let n;switch(t){case gp.z.PROGRESS:case gp.z.COMPLETE:n=(0,i.jsx)(fp.Z,{status:t});break;case gp.z.ERROR:n=(0,i.jsx)(Cp,{style:{fill:e.colors.commandStatusErrorIcon,height:28,width:28}});break;case gp.z.ACTION:n=o;break;case gp.z.NONE:n=null}return n}((0,g.Fg)(),o,n),l=o===gp.z.ACTION;return(0,i.jsxs)(bp,{layout:!0,style:{...a??{},paddingRight:l?12:24},transition:ep.TP,children:[(0,i.jsx)(vp,{layout:"position",children:t}),r]})};var wp=(0,a.forwardRef)(((e,t)=>(0,i.jsx)(ye.Z,{ref:t,viewBox:"0 0 64 64",...e,children:(0,i.jsx)("path",{fillRule:"evenodd",clipRule:"evenodd",d:"M32 12C32 10.8954 32.8954 10 34 10H46C50.4183 10 54 13.5817 54 18V31C54 35.4183 50.4183 39 46 39H16.8284L24.4142 46.5858C25.1953 47.3668 25.1953 48.6332 24.4142 49.4142C23.6332 50.1953 22.3668 50.1953 21.5858 49.4142L10.5858 38.4142C9.80474 37.6332 9.80474 36.3668 10.5858 35.5858L21.5858 24.5858C22.3668 23.8047 23.6332 23.8047 24.4142 24.5858C25.1953 25.3668 25.1953 26.6332 24.4142 27.4142L16.8284 35H46C48.2091 35 50 33.2091 50 31V18C50 15.7909 48.2091 14 46 14H34C32.8954 14 32 13.1046 32 12Z"})}))),Tp=o(99517);var Ip=e=>{let{subscriptionId:t,onComplete:o,onError:n}=e;return(0,G.s9r)({variables:{subscriptionId:t},onData(e){let{data:t}=e;var i,a;const r=null===(a=t)||void 0===a||null===(i=a.data)||void 0===i?void 0:i.pdfGenerationStatus;if(r)if("PdfGenerationProgress"===r.__typename){if(r.progressType===G.e1y.Complete)o(r)}else"PdfGenerationError"===r.__typename&&n()}}),(0,i.jsx)(i.Fragment,{})};const Pp=(e,t)=>{let o;switch(e){case gp.z.PROGRESS:o=ll.ZP.t("commandPrompt.exportToPdf.generationProgress");break;case gp.z.COMPLETE:o=ll.ZP.t("commandPrompt.exportToPdf.generationComplete");break;case gp.z.ACTION:case gp.z.ERROR:case gp.z.NONE:o=t?ll.ZP.t("commandPrompt.exportToPdf.generationError"):""}return o};var Ep={id:od.mm.EXPORT_TO_PDF,title:ll.ZP.t("commandPrompt.exportToPdf.commandTitle").toString(),Component:e=>{let{title:t,mode:o,changePromptMode:n,contributeCommandHandler:r,tomeId:l,isFocusedInRootMode:s,onComplete:d,setCommandState:c,generationStatus:u,errorHappened:p,subscriptionId:m,setBlockCommandPromptToggle:h}=e;const{apolloClient:g}=(0,L.bp)(),{priceType:C}=(0,ys.Z)(),f=null===C,x=()=>{c({generationStatus:gp.z.NONE,errorHappened:!0,subscriptionId:void 0}),setTimeout((()=>{d()}),xp)},v=e=>{(0,ca.L)(!!e,"No downloadUrl provided for create PDF",{tomeId:l}),e&&function(e){const t=document.createElement("a");t.href=e,document.body.appendChild(t),t.click(),document.body.removeChild(t)}(e),c({generationStatus:gp.z.COMPLETE,subscriptionId:void 0}),setTimeout((()=>{d()}),xp)},[b]=(0,G.Rv8)({onError:x}),{openSettings:y}=(0,$s.r)(),w=(0,a.useCallback)((e=>{let{wasDirectlyInvoked:t}=e;if(f)return y(Ls.u.PLANS),void d();Ne.ZP.reportPdfGeneration({apolloClient:g,initiator:t?Ne.RM.TOME_MENU:Ne.RM.COMMAND_PROMPT,tomeId:l}),h(!0);const o=Rn()();c({generationStatus:gp.z.PROGRESS,errorHappened:!1,subscriptionId:o}),b({variables:{subscriptionId:o,tomeId:l}}),n(Tp.q.DELEGATE)}),[g,n,f,d,y,b,h,c,l]);(0,a.useEffect)((()=>{r(w)}),[r,w]);let T=null;switch(o){case Tp.q.ROOT:T=(0,i.jsx)(hp,{onClick:()=>w({stringValue:"",jsonValue:Hu.yS,wasDirectlyInvoked:!1}),viewAs:cp.ROOT,children:(0,i.jsx)(up,{Icon:Cd,ActionIcon:wp,title:t,viewAs:cp.ROOT,isFocusedInRootMode:s,tag:f?dp.PRO:dp.NONE})});break;case Tp.q.SCOPED:T=null;break;case Tp.q.DELEGATE:T=(0,i.jsxs)(i.Fragment,{children:[m&&(0,i.jsx)(Ip,{onError:x,onComplete:e=>{const t=e.downloadUrl;v(t)},subscriptionId:m}),(0,i.jsx)(yp,{content:Pp(u??gp.z.NONE,p??!1),status:u??gp.z.NONE})]})}return T},featureFlag:D.TT.PDF_GENERATION};const _p=e=>{switch(e){case Tp.B.OUT_OF_MODERATION_ERROR:return{message:ll.ZP.t("tomeGenerationError.outOfModerationPolicy"),retryable:!1};case Tp.B.RATE_LIMIT_ERROR:return{message:ll.ZP.t("tomeGenerationError.rateLimit"),retryable:!1};case Tp.B.GENERIC_ERROR:default:return{message:ll.ZP.t("tomeGenerationError.generic"),retryable:!0}}},jp=e=>{switch(e){case Tp.q.ROOT:return cp.ROOT;case Tp.q.SCOPED:return cp.SCOPED;default:throw new Error("convertModeToCommandTitleViewAs should only \n        be used to convert ROOT and SCOPED modes to \n        their corresponding CommandTitleViewAs values. \n        Since each delegate mode can render arbitrary \n        content, callsites should specify the appropriate \n        CommandTitleViewAs type.")}};var kp;!function(e){e.NONE="NONE",e.IN_PROGRESS="IN_PROGRESS",e.NO_REFERENCES="NO_REFERENCES",e.USER_REVIEW="USER_REVIEW",e.ERROR="ERROR"}(kp||(kp={}));const Sp=g.ZP.div.withConfig({displayName:"FindReferencesCommandStatus__TwoLineStatus",componentId:"sc-bb9e749b-0"})`
  display: flex;
  flex-direction: column;
  gap: 2px;
`,Zp=g.ZP.div.withConfig({displayName:"FindReferencesCommandStatus__LineTitle",componentId:"sc-bb9e749b-1"})`
  height: 21px;
  white-space: nowrap;
  text-overflow: ellipsis;
  overflow: hidden;
  line-height: normal;
`,Rp=g.ZP.div.withConfig({displayName:"FindReferencesCommandStatus__LineDescription",componentId:"sc-bb9e749b-2"})`
  height: 21px;
  color: ${e=>{let{theme:t}=e;return t.colors.commandPromptControlText}};
  white-space: nowrap;
  text-overflow: ellipsis;
  overflow: hidden;
  line-height: normal;
`,Op=e=>{let t,o,n,{statusState:i}=e;switch(i.status){case kp.IN_PROGRESS:switch(i.step){case G.CTH.ClaimExtraction:t=ll.ZP.t("commandPrompt.findReferences.generationProgress_stepClaimExtraction");break;case G.CTH.Query:t=ll.ZP.t("commandPrompt.findReferences.generationProgress_stepQuery");break;case G.CTH.Download:t=ll.ZP.t("commandPrompt.findReferences.generationProgress_stepDownload");break;case G.CTH.Substantiation:t=ll.ZP.t("commandPrompt.findReferences.generationProgress_stepSubstantiation");break;case null:t=ll.ZP.t("commandPrompt.findReferences.generationProgress")}n=gp.z.PROGRESS;break;case kp.NO_REFERENCES:t=ll.ZP.t("commandPrompt.findReferences.noReferencesFoundTitle"),o=ll.ZP.t("commandPrompt.findReferences.noReferencesFoundDescription"),n=gp.z.ERROR;break;case kp.ERROR:t=_p(i.errorCode).message,n=gp.z.ERROR;break}return{statusText:t,statusDescription:o,statusIndicator:n}};var Mp=e=>{let{state:t}=e;const{statusText:o,statusDescription:n,statusIndicator:r}=Op({statusState:t}),l=(0,a.useCallback)((e=>{e.preventDefault()}),[]);(0,a.useEffect)((()=>(t.status===kp.IN_PROGRESS&&document.addEventListener("keydown",l),()=>{document.removeEventListener("keydown",l)})),[l,t.status]);const s=n?(0,i.jsxs)(Sp,{children:[(0,i.jsx)(Zp,{children:o}),(0,i.jsx)(Rp,{children:n})]}):o;return(0,i.jsx)(yp,{style:{minWidth:370},content:s,status:r})};const $p=e=>{let{requestId:t,onComplete:o,onError:n,setStep:a}=e;return(0,G.Lk9)({variables:{requestId:t},onError:()=>{n(G.pSg.ApiError)},onData(e){let{data:t}=e;var i,r;const l=null===(r=t)||void 0===r||null===(i=r.data)||void 0===i?void 0:i.referencesGenerationStatus;if(l&&l.__typename)switch(l.__typename){case"ReferencesGenerationError":n(l.errorCode);break;case"ReferencesGenerationProgress":switch(l.progressType){case G.H14.Started:break;case G.H14.InProgress:a(l.step);break;case G.H14.Complete:{const e=l.references??[];o(e);break}}}}}),(0,i.jsx)(i.Fragment,{})};var Lp=o(93778);const Ap=g.ZP.div.withConfig({displayName:"ReferenceItemComponent__StyledContent",componentId:"sc-af429761-0"})`
  display: flex;
  flex-direction: row;
  gap: 20px;
  align-items: center;
`,Np=g.ZP.div.withConfig({displayName:"ReferenceItemComponent__Left",componentId:"sc-af429761-1"})`
  display: flex;
  flex-direction: column;
  gap: 4px;
  flex: 1 1 auto;
  // allow text to overflow without breaking the flex layout
  min-width: 0;
`,Dp=g.ZP.div.withConfig({displayName:"ReferenceItemComponent__ReferenceIconAndSource",componentId:"sc-af429761-2"})`
  display: flex;
  gap: 8px;
  align-items: center;
`,Bp=g.ZP.div.withConfig({displayName:"ReferenceItemComponent__ReferenceIcon",componentId:"sc-af429761-3"})`
  flex: 0 0 16px;
  height: 16px;
  border-radius: 8px;
  overflow: hidden;
`,Hp=g.ZP.div.withConfig({displayName:"ReferenceItemComponent__ReferenceSource",componentId:"sc-af429761-4"})`
  flex: 1 1 auto;
  font-size: ${e=>{let{theme:t}=e;return t.fontSizes.sm}};
  font-weight: 400;
  line-height: 16px;
  color: ${e=>{let{theme:t}=e;return t.colors.referenceItemSource}};
  ${te.wR}
`,Vp=g.ZP.div.withConfig({displayName:"ReferenceItemComponent__ReferenceTitle",componentId:"sc-af429761-5"})`
  font-size: ${e=>{let{theme:t}=e;return t.fontSizes.xxs}};
  font-weight: 400;
  line-height: 14px;
  color: ${e=>{let{theme:t}=e;return t.colors.referenceItemTitle}};
  ${te.wR}
`,Fp=g.ZP.div.withConfig({displayName:"ReferenceItemComponent__ReferenceBody",componentId:"sc-af429761-6"})`
  color: ${e=>{let{theme:t}=e;return t.colors.referenceItemBody}};
  font-size: ${e=>{let{theme:t}=e;return t.fontSizes.smmd}};
  font-weight: 400;
  line-height: ${20}px;
  color: ${e=>{let{theme:t}=e;return t.colors.referenceItemBody}};
  ${(0,te.pi)({numLines:3,lineHeight:20})};
`,Gp=g.ZP.div.withConfig({displayName:"ReferenceItemComponent__Right",componentId:"sc-af429761-7"})`
  display: flex;
  flex-direction: row;
  gap: 8px;
  flex: 0 0 auto;
`,Up=(0,g.ZP)(Re.ZP).withConfig({displayName:"ReferenceItemComponent__StyledButton",componentId:"sc-af429761-8"})`
  height: 28px;
  min-width: 20px;
  padding: 6px 8px;
  ${Re.e9} {
    border-radius: ${e=>{let{theme:t}=e;return t.borderRadius.xs}};
  }
  font-size: ${e=>{let{theme:t}=e;return t.fontSizes.sm}};
  font-weight: 400;
`;var zp=e=>{let{source:t,icon:o,title:n,body:s,url:d,tomeId:c,requestId:u,onClickAdd:p}=e;const{t:m}=(0,C.$G)(),{apolloClient:h}=(0,L.bp)(),g=(0,r.sJ)(A.Vx),f=(0,a.useCallback)((e=>{e.stopPropagation();const i={tomeId:c,operationId:u,pageId:g,url:d,source:t,icon:o,title:n,body:s};l.v.addAction("reference_interstitial_open",i),Ne.ZP.reportReferenceEvent({apolloClient:h,trackEventType:Ne.l_.REFERENCE_INTERSTITAL_OPEN,properties:i}),window.open(d,"_blank")}),[g,h,s,o,u,t,n,c,d]);return(0,i.jsxs)(Ap,{"data-testid":"reference_item",children:[(0,i.jsxs)(Np,{children:[(0,i.jsxs)(Dp,{children:[o&&(0,i.jsx)(Bp,{children:(0,i.jsx)(vo(),{src:o,width:"16",height:"16",unoptimized:!0})}),(0,i.jsx)(Hp,{children:t})]}),(0,i.jsx)(Fp,{children:s}),(0,i.jsx)(Vp,{children:n})]}),(0,i.jsxs)(Gp,{children:[(0,i.jsx)(Up,{"data-testid":"open_reference",onClick:f,children:m("reference.referenceItem.openButton")}),(0,i.jsx)(Up,{"data-testid":"add_reference",onClick:p,children:m("reference.referenceItem.addButton")})]})]})},Wp=o(78843);const Kp=g.ZP.div.withConfig({displayName:"ReferencesDisclaimer__Container",componentId:"sc-bab35d1b-0"})`
  align-self: stretch;
  display: flex;
  align-items: center;
  justify-content: flex-start;
  background-color: ${e=>{let{theme:t}=e;return t.colors.referencesDisclaimerBackground}};
  border-radius: ${e=>{let{theme:t}=e;return t.borderRadius.sm}};
  padding: 12px;
  gap: 8px;
`,qp=g.ZP.div.withConfig({displayName:"ReferencesDisclaimer__BodyText",componentId:"sc-bab35d1b-1"})`
  font-size: ${e=>{let{theme:t}=e;return t.fontSizes.sm}};
  color: ${e=>{let{theme:t}=e;return t.colors.referencesDisclaimerContent}};
  font-style: normal;
  font-weight: 400;
  font-family: Inter;
`,Yp=(0,g.ZP)(Wp.Z).withConfig({displayName:"ReferencesDisclaimer__StyledInfoIcon",componentId:"sc-bab35d1b-2"})`
  fill: ${e=>{let{theme:t}=e;return t.colors.referencesDisclaimerContent}};
  width: 22px;
  height: 22px;
`;var Jp=()=>{const{t:e}=(0,C.$G)();return(0,i.jsxs)(Kp,{children:[(0,i.jsx)(Yp,{}),(0,i.jsx)(qp,{children:e("commandPrompt.findReferences.disclaimer")})]})};const Xp=g.ZP.div.withConfig({displayName:"SuggestedReferences__Container",componentId:"sc-2b38bcda-0"})`
  width: 680px;
  padding: 24px;
`,Qp=g.ZP.div.withConfig({displayName:"SuggestedReferences__HeaderHStack",componentId:"sc-2b38bcda-1"})`
  display: flex;
  flex-direction: row;
  align-items: center;
  justify-content: flex-start;
  gap: 8px;
  margin-bottom: 12px;
`,em=g.ZP.div.withConfig({displayName:"SuggestedReferences__HeadingText",componentId:"sc-2b38bcda-2"})`
  color: ${e=>{let{theme:t}=e;return t.colors.commandPromptControlTextActive}};
  font-size: ${e=>{let{theme:t}=e;return t.fontSizes.md}};
  font-style: ${e=>{let{theme:t}=e;return t.fonts.content.baseline.heading.name}};
  font-weight: ${e=>{let{theme:t}=e;return t.fonts.content.baseline.heading.weight}};
`,tm=g.ZP.div.withConfig({displayName:"SuggestedReferences__VStack",componentId:"sc-2b38bcda-3"})`
  display: flex;
  flex-direction: column;
  align-items: stretch;
  justify-content: flex-start;
  gap: 8px;
`,om=(0,g.ZP)(tm).withConfig({displayName:"SuggestedReferences__StretchVStack",componentId:"sc-2b38bcda-4"})`
  align-items: stretch;
  gap: 20px;
`;var nm=e=>{let{tomeId:t,requestId:o,referencesData:n,backgroundRef:r,onClickOutside:l,onClickAdd:s}=e;const{t:d}=(0,C.$G)();(0,Lp.Z)(r,l,{preventDefault:!0});const c=n.map(((e,n)=>(0,i.jsx)(zp,{tomeId:t,requestId:o,body:e.snippet,source:e.source,icon:e.icon,title:e.pageTitle,url:e.referenceUrl,onClickAdd:()=>s(e)},n))),u=(0,a.useCallback)((e=>{e.preventDefault(),e.stopPropagation()}),[]);return(0,i.jsx)(Xp,{onPointerDown:u,children:(0,i.jsxs)(tm,{children:[(0,i.jsxs)(Qp,{children:[(0,i.jsx)(em,{children:d("commandPrompt.findReferences.resultsHeading")}),(0,i.jsx)(ut.Ur,{})]}),(0,i.jsxs)(om,{children:[c,(0,i.jsx)(Jp,{})]})]})})},im=o(77493);var am=function(){const{apolloClient:e}=(0,L.bp)();return(0,a.useCallback)((t=>e.readFragment({id:`Page:${t}`,fragment:G.bsn,fragmentName:"PageWithTilesFragment",variables:{fetchFullPage:!0,prefetchPreviewImage:!1}})),[e])},rm=o(85677),lm=o(60348);const sm=[Vt.JB,Vt.uX,Vt.Oo,Vt.pL],dm="​";function cm(e){const t=[{node:e,currentPath:[],nodeIndex:0}];let o="";for(;t.length>0;){const{node:n,currentPath:i,nodeIndex:a}=t.pop();if("text"in n)for(let t=0;t<n.text.length;t+=1){o+=im.NB.string(im.NB.get(e,[...i,a].slice(1)))[t]}else{const e=n.children.slice().reverse();e.forEach(((o,n)=>{t.push({node:o,currentPath:[...i,a],nodeIndex:e.length-1-n})}))}"type"in n&&sm.find((e=>e===n.type))&&o.length>0&&(o+="\n")}return o}function um(e){return{type:"reference",url:e.referenceUrl,source:e.source,title:e.pageTitle,body:e.snippet,favIconUrl:e.icon,children:[{text:""}]}}function pm(e){let{editor:t,onTextNodeChar:o,onBlockNode:n}=e;const i=[{node:t,currentPath:[],nodeIndex:0}];let a=-1,r=!1;const l=e=>{r=e};for(;!r&&i.length>0;){const{node:e,currentPath:t,nodeIndex:s}=i.pop();if("text"in e)for(let n=0;n<e.text.length;n+=1){a+=1;if(o({currentIndex:a,currentPoint:{path:[...t,s].slice(1),offset:n},node:e,currentPath:t,nodeIndex:s,endTraversing:l}),r)break}else{const o=e.children.slice().reverse();o.forEach(((e,n)=>{i.push({node:e,currentPath:[...t,s],nodeIndex:o.length-1-n})}))}"type"in e&&sm.find((t=>t===e.type))&&a>=0&&(a+=1,n({currentIndex:a,currentPath:t,nodeIndex:s,node:e,endTraversing:l}))}}function mm(e){let{editor:t,point:o}=e,n=-1;return pm({editor:t,onTextNodeChar:e=>{let{currentIndex:t,currentPoint:i,endTraversing:a,node:r}=e;if(!(0,At.Z)(i.path,o.path))return;const l=r;0===o.offset&&(a(!0),n=t),l.text.length===o.offset?(a(!0),n=t+l.text.length):(0,At.Z)(i,o)&&(a(!0),n=t)},onBlockNode:lm.Z}),n}function hm(e,t){for(const o of e){if(o.type!==Vt.gk){if((0,nn.GsE)(o)&&o.text===dm)continue;break}if(o.url===t.url)return!0}return!1}function gm(e){let{editor:t,referenceInsertionPoints:o}=e;o.slice().reverse().filter((e=>!function(e){let{editor:t,referenceElement:o,point:n}=e;const[,i]=im.ML.node(t,n),[a]=im.ML.parent(t,n),r=i[i.length-1];return!!hm(a.children.slice(0,r).reverse(),o)||!!hm(a.children.slice(r),o)}({editor:t,referenceElement:e.referenceElement,point:e.point}))).forEach((e=>{let{referenceElement:o,point:n}=e;!function(e){let{editor:t,referenceElement:o,point:n}=e;const i=n,[a,r]=im.ML.node(t,i);if("text"in a){const e=im.y$.parent(r),n=1===e.length&&0===e[0],l=a.text.slice(0,i.offset);let s=a.text.slice(i.offset);n&&0===l.length?a.text=dm:a.text=l,0===s.length&&(s=" ");const d={...a,text:s},c=[...r];c[c.length-1]+=1,(0,nn.s2K)(t,[o,d],{at:c})}}({editor:t,referenceElement:o,point:n})}))}function Cm(e){let{editor:t,references:o}=e;const n=function(e){let{editor:t,references:o}=e;const n=[];let i;const a=(0,rm.Z)(o);for(a.sort(((e,t)=>e.location-t.location)),pm({editor:t,onTextNodeChar:e=>{let{currentIndex:t,currentPoint:o}=e;if(a.length>0&&(i=(0,rm.Z)(o),t===a[0].location)){const e=a.shift();n.push({referenceElement:um(e),point:(0,rm.Z)(i)})}},onBlockNode:e=>{let{currentIndex:t,currentPath:o,nodeIndex:r}=e;if(a.length>0&&(i?i.offset+=1:i={path:[...o,r].slice(1),offset:-1},t===a[0].location)){const e=a.shift();n.push({referenceElement:um(e),point:(0,rm.Z)(i)})}}});a.length>0;){const e=a.shift();i={path:i.path,offset:i.offset+1},n.push({referenceElement:um(e),point:(0,rm.Z)(i)})}return n}({editor:t,references:o});gm({editor:t,referenceInsertionPoints:n})}var fm=o(50571);const xm=(e,t)=>e.frontendPageLayout.tiles.filter((e=>{var o;return"TEXT"===(null===(o=t.get(e.tileId))||void 0===o?void 0:o.type)})).map((e=>e.tileId));var vm=o(46659);const bm=e=>{const{getMainController:t}=(0,a.useContext)(X.Z),o=am();return(0,r._8)((n=>{let{snapshot:i}=n;return()=>{var n,a,r,l;const s=i.getLoadable(A.Vx).getValue(),d=t(s),c=ym(wm(s,d,o));let u=0,p=c.length;const m=i.getLoadable(vm.w).getValue(),h=null===(n=m)||void 0===n?void 0:n.selection,g=null===(a=m)||void 0===a?void 0:a.tileId,C=o(s);if(!C||!g||!h)return{plainTextContent:c,selection:{start:u,end:p}};const f=(0,fm.tB)(C).get(g);if(!f)return{plainTextContent:c,selection:{start:u,end:p}};const x=(0,U.R)(f,e);if(!(null===(l=x)||void 0===l||null===(r=l.textTileData)||void 0===r?void 0:r.content))return{plainTextContent:c,selection:{start:u,end:p}};const v=(0,im.Jh)();v.children=JSON.parse(x.textTileData.content);const b=function(e){let{editor:t,selection:o}=e;const[n,i]=im.e6.edges(o);return{start:mm({editor:t,point:n}),end:mm({editor:t,point:i})}}({editor:v,selection:h});u=b.start,p=b.end;const y=ym(wm(s,d,o,g)).length,w=y>0?fm.zG.length:0;if(p<=0)throw new Error(`Invalid selection. Command prompt input: ${JSON.stringify(m)}`);return{plainTextContent:c,selection:{start:u+y+w,end:p+y+w}}}}),[o,t,e])};function ym(e){if(0===e.length)return"";const t=e.map((e=>JSON.parse(e??""))),o=(0,im.Jh)();return t.map((e=>(o.children=e,cm(o)))).join(fm.zG)}function wm(e,t,o,n){if(!t)return[];const i=o(e);if(!i)return[];const a=(0,fm.tB)(i),r=t.frontendPageLayout.tiles.filter((e=>{var t;return"TEXT"===(null===(t=a.get(e.tileId))||void 0===t?void 0:t.type)}));let l=-1;if(n){l=0;for(const e of r){if(e.tileId===n)break;l+=1}}const s=r.map((e=>{var t,o;return null===(o=a.get(e.tileId))||void 0===o||null===(t=o.textTileData)||void 0===t?void 0:t.content}));return-1===l?s:s.slice(0,l)}const Tm={id:od.mm.FIND_REFERENCES,title:ll.ZP.t("commandPrompt.findReferences.commandTitle").toString(),Component:e=>{let{tomeId:t,changePromptMode:o,contributeCommandHandler:n,setShowOverlayAndBlockKeys:s,onComplete:d,setCommandState:c,generationState:u,promptBackgroundRef:p}=e;const{apolloClient:m}=(0,L.bp)(),h=(0,r.sJ)(A.Vx),g=(0,a.useRef)((0,da.Z)()),{attemptToPerformCreditsOperation:C}=(0,Oo.KW)(),f=(0,r.sJ)(vm.w),x=(0,a.useCallback)((e=>{if(e){const t=(0,fm.$e)(e);c({generationState:{status:kp.ERROR,errorCode:t}})}else c({generationState:{status:kp.NO_REFERENCES}});s(!1),setTimeout((()=>{d()}),3e3)}),[d,c,s]),v=((e,t)=>{const{apolloClient:o,clientId:n}=(0,L.bp)(),i=am(),l=(0,r.sJ)(A.Vx),{getMainController:s}=(0,a.useContext)(X.Z),d=(0,a.useMemo)((()=>s(l)),[l,s]);return(0,a.useCallback)((a=>{const r=i(l);if(!r)return void t();if(!d)return;const s=(0,fm.tB)(r),c=xm(d,s);let u=0;const p=[...a];c.forEach(((i,a)=>{var r;const l=s.get(i);if(!l)return void t();const d=(0,U.R)(l,e);if(!(null===(r=d.textTileData)||void 0===r?void 0:r.content))return void t();const c=(0,im.Jh)();c.children=JSON.parse(d.textTileData.content);const m=cm(c).length;let h=0;const g=[];for(const e of p){const t=a*fm.zG.length,o=e.location-u-t;if(!(o<=m))break;{const t={...e,location:o};g.push(t)}}g.length>0&&im.ML.withoutNormalizing(c,(()=>{Cm({editor:c,references:g}),h+=g.length,d.textTileData&&(d.textTileData.content=JSON.stringify(c.children),(0,K.Gs)(d,o,n))})),p.splice(0,h),u+=m}))}),[l,o,n,d,i,t,e])})(t,x),[b,y]=(0,a.useState)([]),w=(0,a.useCallback)((e=>{if(e)if(0===e.length){c({generationState:{status:kp.NO_REFERENCES}});const e={tomeId:t,pageId:h,operationId:g.current};l.v.addAction("no_references_found",e),Ne.ZP.reportReferenceEvent({apolloClient:m,trackEventType:Ne.l_.REFERENCE_NO_FOUND,properties:e}),s(!1),setTimeout((()=>{d()}),4e3)}else y(e),s(!1),c({generationState:{status:kp.USER_REVIEW,references:e}})}),[c,t,h,m,s,d]),T=(0,a.useCallback)((e=>{c({generationState:{status:kp.IN_PROGRESS,step:e}})}),[c]),I=(0,a.useCallback)((()=>{var e;d();const t=null===(e=f)||void 0===e?void 0:e.resetSelection;var o;t&&(null===(o=t)||void 0===o||o())}),[d,f]),[P]=(0,G.YP$)({onError:()=>{x(G.pSg.ApiError)},onCompleted:e=>{var t,o;const n=null===(o=e)||void 0===o||null===(t=o.findPageReferences)||void 0===t?void 0:t.errorCode;n&&x(n)}}),E=bm(t),_=(0,a.useCallback)((()=>{const e={tomeId:t,pageId:h,operationId:g.current};l.v.addAction("reference_triggered",e),Ne.ZP.reportReferenceEvent({apolloClient:m,trackEventType:Ne.l_.REFERENCE_TRIGGERED,properties:e});C(Oo.Cw.FIND_REFERENCES,(()=>{s(!0),c({generationState:{status:kp.IN_PROGRESS,step:null}});const{plainTextContent:e,selection:n}=E(),i=Math.max(0,n.end-fm.Xy),a=n.end,r=e.slice(i,a+1).trimEnd();P({variables:{tomeId:t,pageText:r,requestId:g.current,selectionStart:n.start,selectionEnd:n.end}}),o(Tp.q.DELEGATE)}))||d()}),[h,m,C,o,P,E,d,c,s,t]);(0,a.useEffect)((()=>{n(_)}),[n,_]);const j=(0,a.useCallback)((e=>{const o={operationId:g.current,tomeId:t,pageId:h,url:e.referenceUrl,source:e.source,title:e.pageTitle,body:e.snippet};l.v.addAction("reference_interstitial_add",o),Ne.ZP.reportReferenceEvent({apolloClient:m,trackEventType:Ne.l_.REFERENCE_INTERSTITAL_ADD,properties:o}),v([e]),d(),s(!1),y([])}),[h,m,v,d,s,t]);let k;const S=u??{status:kp.NONE};switch(S.status){case kp.NONE:k=null;break;case kp.IN_PROGRESS:case kp.NO_REFERENCES:case kp.ERROR:k=(0,i.jsx)(Mp,{state:S});break;case kp.USER_REVIEW:k=(0,i.jsx)(nm,{tomeId:t,requestId:g.current,referencesData:b,backgroundRef:p,onClickOutside:I,onClickAdd:j})}return(0,i.jsxs)(i.Fragment,{children:[g.current&&(0,i.jsx)($p,{requestId:g.current,onComplete:w,onError:x,setStep:T}),k]})},hideInRootMode:!0,featureFlag:D.TT.REFERENCES};var Im=Tm,Pm=o(64147);const Em=(0,a.createContext)(null);function _m(e){let{children:t,value:o}=e;return(0,i.jsx)(Em.Provider,{value:o,children:t})}function jm(){const e=(0,a.useContext)(Em);if(void 0===e)throw new Error("useCommandContext must be used within a CommandContextProvider");return e}var km=e=>{let{Icon:t,ActionIcon:o=wp,commandHandler:n}=e;const{contributeCommandHandler:r,isFocusedInRootMode:l,onComplete:s,title:d,mode:c}=jm(),u=(0,a.useCallback)((()=>{n(),s()}),[n,s]);(0,a.useEffect)((()=>{r(u)}),[r,u]);const p=jp(c);return(0,i.jsx)(hp,{onClick:u,viewAs:p,children:(0,i.jsx)(up,{Icon:t,ActionIcon:o,title:d,viewAs:p,isFocusedInRootMode:l,tag:dp.NONE})})};var Sm={id:od.mm.NEW_PAGE,title:ll.ZP.t("commandPrompt.addPage.commandTitle"),Component:()=>{const e=(0,r.Zl)(A.xi),t=(0,r.Zl)(A.RE),o=(0,a.useCallback)((()=>{e(!0),t(!0)}),[t,e]);return(0,i.jsx)(km,{Icon:Pm.Z,commandHandler:o})},keywords:ll.ZP.t("commandPrompt.addPage.keywords",{returnObjects:!0})},Zm=o(8794);var Rm=(0,a.forwardRef)(((e,t)=>(0,i.jsx)(ye.Z,{ref:t,viewBox:"0 0 64 64",...e,children:(0,i.jsx)("path",{fillRule:"evenodd",clipRule:"evenodd",d:"M14 13C10.6863 13 8 15.6863 8 19V35C8 38.3137 10.6863 41 14 41H18V45C18 48.3137 20.6863 51 24 51H50C53.3137 51 56 48.3137 56 45V29C56 25.6863 53.3137 23 50 23H46V19C46 15.6863 43.3137 13 40 13H14ZM42 23V19C42 17.8954 41.1046 17 40 17H14C12.8954 17 12 17.8954 12 19V35C12 36.1046 12.8954 37 14 37H18V29C18 25.6863 20.6863 23 24 23H42ZM24 27C22.8954 27 22 27.8954 22 29V45C22 46.1046 22.8954 47 24 47H50C51.1046 47 52 46.1046 52 45V29C52 27.8954 51.1046 27 50 27H24Z"})})));class Om{static getValues(){return Om.values}getWireArtifactType(){return this.wireArtifactType}getText(){return this.text}getTextTitleCase(){return this.textTitleCase}constructor(e,t,o){this.wireArtifactType=e,this.text=t,this.textTitleCase=o,Om.values.push(this)}}Om.values=[],Om.PRESENTATION=new Om(G.BzI.Presentation,"presentation",ll.ZP.t("commandPrompt.clientArtifactType.presentationArtifactTypeLabel")),Om.OUTLINE=new Om(G.BzI.Outline,"outline",ll.ZP.t("commandPrompt.clientArtifactType.outlineArtifactTypeLabel")),Om.STORY=new Om(G.BzI.Story,"story",ll.ZP.t("commandPrompt.clientArtifactType.storyArtifactTypeLabel"));var Mm=(0,a.forwardRef)(((e,t)=>(0,i.jsx)(ye.Z,{ref:t,viewBox:"0 0 64 64",...e,children:(0,i.jsx)("path",{fillRule:"evenodd",clipRule:"evenodd",d:"M15 9C11.6863 9 9 11.6863 9 15V39C9 42.3137 11.6863 45 15 45H19V49C19 52.3137 21.6863 55 25 55H49C52.3137 55 55 52.3137 55 49V25C55 21.6863 52.3137 19 49 19H45V15C45 11.6863 42.3137 9 39 9H15ZM41 19V15C41 13.8954 40.1046 13 39 13H15C13.8954 13 13 13.8954 13 15V39C13 40.1046 13.8954 41 15 41H19V25C19 21.6863 21.6863 19 25 19H41ZM25 23C23.8954 23 23 23.8954 23 25V49C23 50.1046 23.8954 51 25 51H49C50.1046 51 51 50.1046 51 49V25C51 23.8954 50.1046 23 49 23H25Z"})})));var $m=e=>{let{pageGenerationSubscriptionId:t,setNumPagesGenerated:o,onComplete:n,onError:a,onProgress:l}=e;const s=(0,r.Zl)(A.Vx),d=(0,r.Zl)(A.pt),{deselectAllTiles:c}=(0,V.N4)();return(0,G.RlJ)({variables:{requestId:t},onData(e){let{data:t}=e;var i,r;const u=null===(r=t)||void 0===r||null===(i=r.data)||void 0===i?void 0:i.tomeGenerationStatus;if(u)if("TomeGenerationProgress"===u.__typename)switch(u.progressType){case G.xGj.Started:o(0);break;case G.xGj.InProgress:var p;null===(p=l)||void 0===p||p(u),null!==u.numPagesGenerated&&void 0!==u.numPagesGenerated&&o(u.numPagesGenerated),u.currentPageId&&(s(u.currentPageId),c(),d((e=>e.length>0?[]:e)));break;case G.xGj.Complete:n()}else"TomeGenerationError"===u.__typename&&a(u.errorCode)}}),(0,i.jsx)(i.Fragment,{})};var Lm=e=>{let{action:t,completionState:o,getStatusContent:n,onError:r,onProgress:l,pageGenerationSubscriptionId:s,onDismiss:d,onGenerationComplete:c}=e;const[u,p]=(0,a.useState)(gp.z.PROGRESS),[m,h]=(0,a.useState)(0);return(0,i.jsxs)(i.Fragment,{children:[s&&(0,i.jsx)($m,{pageGenerationSubscriptionId:s,setNumPagesGenerated:h,onComplete:()=>{c(),p(gp.z.COMPLETE),setTimeout((()=>{var e;(h(0),p(o),o===gp.z.NONE)&&(null===(e=d)||void 0===e||e())}),xp)},onError:e=>{r(e,m)&&(h(0),p(gp.z.ACTION))},onProgress:l}),(0,i.jsx)(yp,{action:t,content:n({numPagesGenerated:m,status:u}),status:u})]})},Am=o(10956);var Nm=e=>{let{text:t}=e;return(0,i.jsxs)("div",{children:[(0,i.jsx)("div",{children:t}),(0,i.jsx)(Am.Z,{})]})};const Dm=(0,g.ZP)(d.E.div).withConfig({displayName:"GenerationStatusRetry__ButtonGroup",componentId:"sc-7ec40af7-0"})`
  display: flex;
  flex-direction: row;
  gap: 12px;
`,Bm=(0,g.ZP)(Re.ZP).withConfig({displayName:"GenerationStatusRetry__Button",componentId:"sc-7ec40af7-1"})`
  height: 44px;
  width: 104px;
  font-size: ${e=>{let{theme:t}=e;return t.fontSizes.smmd}};
  padding: 12px;
`;var Hm=e=>{let{backgroundRef:t,onDismiss:o,onRetry:n,shouldEnableOutlineClicks:r}=e;const{outlineRef:l}=(0,L.TR)(),{t:s}=(0,C.$G)();(0,a.useEffect)((()=>{const e=e=>{"Escape"!==e.key&&"Enter"!==e.key||o()};return document.addEventListener("keydown",e),()=>{document.removeEventListener("keydown",e)}}),[o]);const d=r?[l]:[];return(0,Lp.Z)(t,o,{exemptRefs:d}),(0,i.jsx)(i.Fragment,{children:(0,i.jsxs)(Dm,{initial:{opacity:0},animate:{opacity:1},transition:ep.TP,children:[(0,i.jsx)(Bm,{onClick:n,children:s("commandPrompt.generationStatusRetry.tryAgainButtonLabel")}),(0,i.jsx)(Bm,{onClick:o,children:s("commandPrompt.generationStatusRetry.keepButtonLabel")})]})})},Vm=o(47227);class Fm{static getValues(){return Fm.values}getWireImageStyle(){return this.wireImageStyle}getMenuText(){return this.menuText}getActiveText(){return this.activeText}constructor(e,t,o){this.wireImageStyle=e,this.menuText=t,this.activeText=o??t,Fm.values.push(this)}}function Gm(){const{apolloClient:e,clientId:t}=(0,L.bp)(),o=(0,Vm.Z)(),n=(0,r.Zl)(A.Vx),i=(0,r.Zl)(A.pt);return(0,a.useCallback)(((a,r)=>{var l,s;const d=o(a);d&&!(0,Ol.$Q)(d)&&d.pages&&(0,N.Gi)(d,(null===(l=r)||void 0===l?void 0:l.pageIdsToDelete)??d.pages.map((e=>e.id)),e,t,i,n,!1,null===(s=r)||void 0===s?void 0:s.shouldDecrementSelectedPageIndex)}),[e,t,o,n,i])}Fm.values=[],Fm.AUTO=new Fm(G.Hnc.Auto,ll.ZP.t("commandPrompt.clientImageStyle.autoImageStyleLabel"),ll.ZP.t("commandPrompt.clientImageStyle.imagesStyleButtonLabel")),Fm.CYBERPUNK=new Fm(G.Hnc.Cyberpunk,ll.ZP.t("commandPrompt.clientImageStyle.cyberpunkImageStyleLabel")),Fm.EPIC=new Fm(G.Hnc.Epic,ll.ZP.t("commandPrompt.clientImageStyle.epicImageStyleLabel")),Fm.FANTASY=new Fm(G.Hnc.Fantasy,ll.ZP.t("commandPrompt.clientImageStyle.fantasyImageStyleLabel")),Fm.NEO_IMPRESSIONIST=new Fm(G.Hnc.NeoImpressionist,ll.ZP.t("commandPrompt.clientImageStyle.neoImpressionistImageStyleLabel")),Fm.POP_ART=new Fm(G.Hnc.PopArt,ll.ZP.t("commandPrompt.clientImageStyle.popArtImageStyleLabel")),Fm.WATERCOLOR=new Fm(G.Hnc.Watercolor,ll.ZP.t("commandPrompt.clientImageStyle.watercolorImageStyleLabel")),Fm.NONE=new Fm(G.Hnc.None,ll.ZP.t("commandPrompt.clientImageStyle.noImagesStyleLabel"));var Um=function(e){let{pageIdsToClearOnRetry:t,setCommandState:o,creditsOperation:n,clearTomeOptions:i}=e;const{changePromptMode:r,resetCommandPromptAfterClose:l,setErrorCode:s,setShowOverlayAndBlockKeys:d,tomeId:c}=jm(),{displayInsufficientCredits:u,attemptToPerformCreditsOperation:p}=(0,Oo.KW)(),m=(t??[]).length>0,h=(0,a.useCallback)((e=>{o({pageGenerationSubscriptionId:e})}),[o]),g=(0,a.useCallback)((e=>{o({pageIdsToClearOnRetry:e})}),[o]),C=(0,a.useCallback)((e=>{h(e),s(null)}),[h,s]),f=(0,a.useCallback)((e=>{if(h(void 0),e===G.EaV.InsufficientCredit)u();else{const t=(e=>{switch(e){case G.EaV.ModerationFlagged:return Tp.B.OUT_OF_MODERATION_ERROR;case G.EaV.OpenAiOutage:case G.EaV.RateLimit:return Tp.B.RATE_LIMIT_ERROR;case G.EaV.ApiError:default:return Tp.B.GENERIC_ERROR}})(e);s(t)}return d(!1),r(Tp.q.SCOPED),!0}),[h,s,d,r,u]),x=(0,a.useCallback)((e=>{const{currentPageId:o}=e;null!=o&&g([...t??[],o])}),[t,g]),v=Gm(),b=(0,Xt.Z)((e=>o=>{p(n,(()=>{m&&(v(c,{pageIdsToDelete:t,...i}),g([])),e(o),d(!0),r(Tp.q.DELEGATE)}))}),[p,n,m,d,r,v,t,i,g,c]);return{onError:f,onProgress:x,onRetry:(0,a.useCallback)((()=>{h(void 0),r(Tp.q.SCOPED)}),[r,h]),onSubscriptionStart:C,onGenerationComplete:(0,a.useCallback)((()=>{l(),d(!1)}),[l,d]),makeCommandHandler:b}};const zm=500;var Wm=(0,a.forwardRef)(((e,t)=>(0,i.jsx)(ye.Z,{ref:t,viewBox:"0 0 64 64",...e,children:(0,i.jsx)("path",{fillRule:"evenodd",clipRule:"evenodd",d:"M28.4276 48.4568C27.6464 49.239 26.379 49.2398 25.5969 48.4585C24.8147 47.6773 24.814 46.41 25.5952 45.6278L39.2016 32.0378L25.5952 18.4478C24.814 17.6657 24.8147 16.3984 25.5969 15.6171C26.379 14.8359 27.6464 14.8367 28.4276 15.6188L43.45 30.6233C44.2312 31.403 44.2325 32.6683 43.4529 33.4495C43.4519 33.4505 43.451 33.4515 43.45 33.4524L28.4276 48.4568Z"})})));var Km=e=>{let{getNewState:t}=e;const{addInputChangeListener:o,removeInputChangeListener:n,getInputString:i}=jm(),[r,l]=(0,a.useState)(t(i())),s=(0,a.useCallback)((()=>{l(t(i()))}),[t,i]);return(0,a.useEffect)((()=>(o(s),()=>{n(s)})),[o,s,n]),r};function qm(e){const t=(0,a.isValidElement)(e);return!!(e&&!t||e&&t&&e.type!==a.Fragment||e&&t&&e.type===a.Fragment&&a.Children.toArray(e.props.children).filter((e=>qm(e))).length>0)}const Ym=(0,g.ZP)(d.E.div).withConfig({displayName:"CommandControls__CommandControlsGroup",componentId:"sc-920e975e-0"})`
  display: flex;
  flex-direction: row;
  justify-content: space-between;
  align-items: center;
  gap: 10px;
  // The container (CommandLayout) has an inset of 6px, so
  // this is really 12px to the right edge of the prompt bar.
  padding-right: 6px;
`;var Jm=e=>{let{children:t}=e;return(0,i.jsx)(Ym,{initial:{opacity:0},animate:{opacity:1},transition:ep.TP,children:t})};const Xm=g.ZP.div.withConfig({displayName:"ScopeableCommandContainer__ScopedModeTopRowContentWrapper",componentId:"sc-55d628a0-0"})`
  // compensate for the spacer shown at the start of the list
  margin-top: ${ep.EW}px;
  // together, two properties below compensate for the translation to bring the title closer to the input
  margin-bottom: -${ep.d1}px;
  transform: translateY(-${ep.d1}px);
`;var Qm=e=>{let{Icon:t,scopedModeTitleRowAdditionalContent:o,scopedModeTopRowContent:n,commandHandler:r,confirmExitScoped:l=!1,tag:s=dp.NONE}=e;const{contributeCommandHandler:d,changePromptMode:c,isFocusedInRootMode:u,clearInput:p,clearCommandState:m,getInputJSON:h,getInputString:g,disableTitleAnimations:f,title:x,mode:b,fallbackString:y}=jm(),w=null!=y&&y.length>0,T=(0,v.s)(),{t:I}=(0,C.$G)(),P=(0,a.useCallback)((e=>e.length>0),[]),E=Km({getNewState:P}),_=(0,a.useCallback)((()=>{switch(b){case Tp.q.ROOT:p(),c(Tp.q.SCOPED);break;case Tp.q.SCOPED:l&&E?T.open():(m(),c(Tp.q.ROOT))}}),[c,p,m,b,E,l,T]),j=(0,a.useCallback)((e=>{switch(b){case Tp.q.ROOT:w?r(e):_();break;case Tp.q.SCOPED:r(e)}}),[r,w,b,_]);(0,a.useEffect)((()=>{d(j)}),[d,j]);const k=b===Tp.q.ROOT,S=b===Tp.q.SCOPED,Z=w?wp:Wm,R=jp(b),O=qm(n);return(0,i.jsxs)(i.Fragment,{children:[S&&O&&(0,i.jsx)(Xm,{children:n}),(0,i.jsxs)(hp,{onClick:k?()=>{j({stringValue:g(),jsonValue:h(),wasDirectlyInvoked:!1})}:void 0,viewAs:R,children:[(0,i.jsx)(up,{Icon:S?Ct.Z:t,ActionIcon:Z,title:x,viewAs:R,isFocusedInRootMode:u,onClick:S?_:void 0,fallbackString:y,disableTitleAnimations:f,tag:s,showEllipsis:!0}),S&&(0,i.jsx)(Jm,{children:o})]}),l&&(0,i.jsx)(v.Z,{ref:T.ref,title:I("commandPrompt.confirmExitScopedModeModal.title"),subtitle:I("commandPrompt.confirmExitScopedModeModal.subtitle"),primaryButtonContent:I("commandPrompt.confirmExitScopedModeModal.confirmButton"),primaryButtonAction:()=>{m(),c(Tp.q.ROOT),T.close()},cancelButtonText:I("cancel"),cancelButtonAction:()=>{T.close()},buttonColor:"destructive",dismissible:!0})]})},eh=o(89163);var th=(0,a.forwardRef)(((e,t)=>(0,i.jsx)(ye.Z,{ref:t,viewBox:"0 0 64 64",...e,children:(0,i.jsx)("path",{fillRule:"evenodd",clipRule:"evenodd",d:"M8.3874 28.7406C8.36474 29.2899 8.7917 29.7536 9.34103 29.7763C9.46128 29.7812 9.58142 29.7643 9.69564 29.7264L21.2798 25.9666C21.8206 25.7953 22.1201 25.2179 21.9488 24.677C21.8862 24.4795 21.7653 24.3055 21.602 24.1779L17.622 21.1787C23.6108 13.2426 34.8989 11.6645 42.835 17.6533C46.1357 20.1442 48.4783 23.6954 49.469 27.71C49.7113 28.788 50.7817 29.4653 51.8596 29.223C52.9375 28.9806 53.6149 27.9103 53.3725 26.8323C50.5055 15.0237 38.6085 7.7751 26.7998 10.6421C21.8605 11.8414 17.4886 14.7137 14.4272 18.7712L10.4392 15.766C9.98008 15.4326 9.3376 15.5345 9.00421 15.9937C8.8825 16.1613 8.81429 16.3618 8.80853 16.5688L8.3874 28.7406ZM54.2882 34.3152L42.7041 38.075C42.1632 38.2463 41.8637 38.8236 42.035 39.3645C42.0976 39.5619 42.2184 39.7359 42.3816 39.8635L46.3612 42.8623C40.3724 50.7983 29.084 52.3771 21.148 46.3884C17.8471 43.8973 15.5044 40.3458 14.5139 36.3307C14.2714 35.2528 13.2009 34.5756 12.1231 34.8182C11.0452 35.0607 10.368 36.1312 10.6105 37.209C13.4775 49.0175 25.3743 56.2661 37.1828 53.3992C42.1222 52.1999 46.4941 49.3275 49.5555 45.2699L53.5445 48.2758C54.0036 48.6092 54.6461 48.5072 54.9795 48.0481C55.1011 47.8805 55.1693 47.6801 55.1751 47.4731L55.5962 35.3014C55.619 34.7521 55.1921 34.2883 54.6428 34.2655C54.5225 34.2606 54.4024 34.2773 54.2882 34.3152Z"})})));const oh=(0,g.ZP)(d.E.div).withConfig({displayName:"AnimatedEllipsis__Wrapper",componentId:"sc-8ce782da-0"})`
  display: flex;
  flex-direction: row;
  gap: ${e=>e.$gap}px;
  pointer-events: none;

  div {
    animation: blink 1.75s infinite;
    animation-fill-mode: both;
    height: ${e=>{let{$size:t}=e;return t}}px;
    width: ${e=>{let{$size:t}=e;return t}}px;
    background-color: ${e=>{let{theme:t}=e;return t.colors.animatedEllipsisBackground}};
    border-radius: 50%;

    &:nth-child(2) {
      animation-delay: 0.25s;
    }

    &:nth-child(3) {
      animation-delay: 0.5s;
    }
  }

  @keyframes blink {
    0% {
      opacity: 0.1;
    }
    20% {
      opacity: 1;
    }
    100% {
      opacity: 0.1;
    }
  }
`;function nh(e){let{gap:t,size:o}=e;return(0,i.jsxs)(oh,{$size:o,$gap:t,children:[(0,i.jsx)("div",{}),(0,i.jsx)("div",{}),(0,i.jsx)("div",{})]})}const ih=12,ah=(0,g.ZP)(d.E.div).withConfig({displayName:"CommandBottomBar__BottomBar",componentId:"sc-7fc7c5f2-0"})`
  display: flex;
  justify-content: flex-end;
  align-items: center;
  width: 100%;
  padding: ${ih}px 0;
  height: ${52}px;
`;function rh(e){let{onClick:t,rightContent:o,title:n}=e;return(0,i.jsxs)(i.Fragment,{children:[(0,i.jsx)(ep.iz,{layout:!0,transition:ep.c}),(0,i.jsxs)(ah,{layout:!0,transition:ep.c,children:[(0,i.jsx)(up,{Icon:Ct.Z,viewAs:cp.DELEGATE_BOTTOM_BAR,title:n,isFocusedInRootMode:!1,tag:dp.NONE,onClick:t}),o]})]})}function lh(e,t){return t.findIndex((t=>t===e))}const sh=["INPUT","TEXTAREA"];function dh(e){let{orderedInputIds:t}=e;const o=(0,a.useRef)(null),n=(0,a.useCallback)((()=>{var e;null===(e=o.current)||void 0===e||e.focus()}),[]),i=(0,a.useCallback)((e=>{o.current=e,n()}),[n]),r=(0,a.useRef)(new Map),l=(0,Xt.Z)(((e,t)=>{r.current.set(e,t)}),[]),s=(0,a.useCallback)((e=>{let{relatedTarget:t}=e;if(!(t instanceof Element))return;const o=t.nodeName;sh.includes(o)||n()}),[n]),d=(0,a.useCallback)((e=>{let{target:t}=e;const o=t.value.length;setTimeout((()=>{t.setSelectionRange(o,o)}),0)}),[]),c=(0,a.useCallback)((e=>{var o;const n=t[e];null===(o=r.current.get(n))||void 0===o||o.focus()}),[t]),u=(0,a.useCallback)((e=>{const o=lh(e,t),n=0===o?t.length-1:o-1;c(n)}),[c,t]),p=(0,a.useCallback)((e=>{const o=lh(e,t),n=o===t.length-1?0:o+1;c(n)}),[c,t]);return{setGlobalKeyBindingsRef:i,setInputByIdRef:l,focusFirstInput:(0,a.useCallback)((()=>{c(0)}),[c]),focusGlobalKeybindings:n,focusNextInput:p,focusPreviousInput:u,onInputBlur:s,onInputFocus:d}}const ch=(e,t)=>(0,i.jsxs)(ye.Z,{ref:t,viewBox:"0 0 64 64",...e,children:[(0,i.jsx)("path",{d:"M15.2731 27.6365C17.2814 27.6365 18.9094 26.0084 18.9094 24.0001C18.9094 21.9918 17.2814 20.3638 15.2731 20.3638C13.2648 20.3638 11.6367 21.9918 11.6367 24.0001C11.6367 26.0084 13.2648 27.6365 15.2731 27.6365Z"}),(0,i.jsx)("path",{d:"M31.2731 27.6365C33.2814 27.6365 34.9094 26.0084 34.9094 24.0001C34.9094 21.9918 33.2814 20.3638 31.2731 20.3638C29.2648 20.3638 27.6367 21.9918 27.6367 24.0001C27.6367 26.0084 29.2648 27.6365 31.2731 27.6365Z"}),(0,i.jsx)("path",{d:"M50.9094 24.0001C50.9094 26.0084 49.2814 27.6365 47.2731 27.6365C45.2648 27.6365 43.6367 26.0084 43.6367 24.0001C43.6367 21.9918 45.2648 20.3638 47.2731 20.3638C49.2814 20.3638 50.9094 21.9918 50.9094 24.0001Z"}),(0,i.jsx)("path",{d:"M15.2731 43.6365C17.2814 43.6365 18.9094 42.0084 18.9094 40.0001C18.9094 37.9918 17.2814 36.3638 15.2731 36.3638C13.2648 36.3638 11.6367 37.9918 11.6367 40.0001C11.6367 42.0084 13.2648 43.6365 15.2731 43.6365Z"}),(0,i.jsx)("path",{d:"M34.9094 40.0001C34.9094 42.0084 33.2814 43.6365 31.2731 43.6365C29.2648 43.6365 27.6367 42.0084 27.6367 40.0001C27.6367 37.9918 29.2648 36.3638 31.2731 36.3638C33.2814 36.3638 34.9094 37.9918 34.9094 40.0001Z"}),(0,i.jsx)("path",{d:"M47.2731 43.6365C49.2814 43.6365 50.9094 42.0084 50.9094 40.0001C50.9094 37.9918 49.2814 36.3638 47.2731 36.3638C45.2648 36.3638 43.6367 37.9918 43.6367 40.0001C43.6367 42.0084 45.2648 43.6365 47.2731 43.6365Z"})]});var uh=(0,a.forwardRef)(ch);const ph=g.ZP.div.withConfig({displayName:"ReorderableOutlineItem__OutlineItemNumberLabel",componentId:"sc-412cb8fe-0"})`
  color: ${e=>{let{theme:t}=e;return t.colors.numberTextColor}};
  font-size: ${e=>{let{theme:t}=e;return t.fontSizes.xxs}};
  width: 28px;
  text-align: center;
  flex-shrink: 0;
`,mh=(0,g.ZP)(d.E.div).withConfig({displayName:"ReorderableOutlineItem__OutlineItem",componentId:"sc-412cb8fe-1"})`
  background-color: ${e=>{let{theme:t}=e;return t.colors.outlineEditorFieldBackgroundColor}};
  border-radius: ${e=>{let{theme:t}=e;return t.borderRadius.sm}};
  display: flex;
  align-items: center;
  padding: 2px 0;
  height: ${44}px;
  z-index: ${e=>{let{$isDragging:t}=e;return t?1:0}};
  box-shadow: ${e=>{let{$isDragging:t,theme:o}=e;return t?o.colors.outlineEditorItemDraggingBoxShadow:o.colors.outlineEditorItemBoxShadow}};

  transition: box-shadow 0.2s ease;

  &:hover button {
    // when outline item is hovered and outline item isn't being dragged, show child buttons
    opacity: ${e=>{let{$isDragging:t}=e;return t?0:1}};
  }
`,hh=(0,g.ZP)(d.E.input).withConfig({displayName:"ReorderableOutlineItem__OutlineItemInput",componentId:"sc-412cb8fe-2"})`
  appearance: none;
  border: none;
  box-shadow: none;
  outline: none;
  caret-color: ${e=>{let{theme:t,$atMaxLength:o}=e;return o?t.colors.errorText:t.colors.uiAccent}};
  background-color: transparent;
  width: 100%;
  font-size: ${e=>{let{theme:t}=e;return t.fontSizes.smmd}};
  color: ${e=>{let{theme:t}=e;return t.colors.outlineEditorTextColorBlurred}};
  text-rendering: optimizeLegibility;
  -webkit-font-smoothing: antialiased;

  &:focus {
    color: ${e=>{let{theme:t}=e;return t.colors.outlineEditorTextColorFocused}};
  }

  ::selection {
    background-color: ${e=>e.theme.colors.textSelection};
  }
`,gh=(0,g.ZP)((0,d.E)(Ie.Z)).withConfig({displayName:"ReorderableOutlineItem__AddDeleteButton",componentId:"sc-412cb8fe-3"})`
  border-radius: ${e=>{let{theme:t}=e;return t.borderRadius.xs}};
  display: flex;
  align-items: center;
  justify-content: center;
  width: ${26}px;
  height: ${26}px;
  opacity: 0;
  transition: opacity 0.2s ease, background-color 0.2s ease;
  margin-right: 6px;

  & > svg {
    fill: ${e=>{let{theme:t}=e;return t.colors.outlineEditorAddDeleteSVGFill}};
    width: ${22}px;
    height: ${22}px;
    transition: fill 0.2s ease;
  }

  &:hover > svg {
    fill: ${e=>{let{theme:t}=e;return t.colors.outlineEditorAddDeleteSVGHoverFill}};
  }

  &:hover {
    background-color: ${e=>{let{theme:t}=e;return t.colors.outlineEditorAddDeleteHoverBackground}};
  }
`,Ch=(0,g.ZP)(d.E.div).withConfig({displayName:"ReorderableOutlineItem__OutlineDraggableHandleWrapper",componentId:"sc-412cb8fe-4"})`
  width: ${30}px;
  height: ${44}px;
  // center OutlineDraggableHandle within OutlineDraggableHandleWrapper
  display: flex;
  justify-content: flex-start;
  align-items: center;
  cursor: grab;
`,fh=(0,g.ZP)(uh).withConfig({displayName:"ReorderableOutlineItem__OutlineDraggableHandle",componentId:"sc-412cb8fe-5"})`
  width: ${22}px;
  height: ${22}px;
  fill: ${e=>{let{theme:t}=e;return t.colors.outlineContentDraggableHandleColor}};
`,xh=(0,g.ZP)(d.E.div).withConfig({displayName:"ReorderableOutlineItem__UserControlsWrapper",componentId:"sc-412cb8fe-6"})`
  display: flex;
  align-items: center;
  margin-left: auto;
`;var vh=(0,a.forwardRef)(((e,t)=>{let{value:o,index:n,dragConstraintsRef:r,setOutlineContent:l,outlineContent:s,isLoading:d,canAddOutlineItem:c,maxInputLength:u,showMaxLengthToastIfNecessary:p,onBlur:m,onFocus:h,makeOnKeyDown:g,reportTomeAnalytics:C}=e;const f=(0,O.o)(),[x,v]=(0,a.useState)(!1),b=s.length>1,y=()=>{if(!b)return;const e=[...s];e.splice(n,1),l(e),C(Ne.vg.CLICK_DELETE)},w=g({currentId:o.id,onDeleteCurrent:y}),T=(0,H.Z)(d)&&!d,I=.1*n;let P=0;d?P=.1+I:T&&(P=.2+I);let E=0;d?E=.1+I:T&&(E=.3+I);const _={duration:.2,delay:P},j={duration:.2,delay:E},k=n===s.length-1,S=!d&&k?{opacity:0,y:"-52px"}:{opacity:0,y:0},Z=d?{opacity:.75,y:0}:{opacity:1,y:0},R=d?{opacity:0}:{opacity:1},M=k?0:"8px";return(0,i.jsx)(eh.t.Item,{value:o,dragListener:!1,dragControls:f,dragConstraints:r,dragElastic:.2,onDragStart:()=>{v(!0)},onDragEnd:()=>{v(!1)},style:{position:"relative",marginBottom:M},whileDrag:{zIndex:1},children:(0,i.jsxs)(mh,{$isDragging:x,initial:S,animate:Z,transition:j,children:[(0,i.jsx)(ph,{children:n+1}),(0,i.jsx)(hh,{autoFocus:!0,$atMaxLength:o.pageTitle.length===u,maxLength:u,disabled:d,value:o.pageTitle,onChange:e=>{const t=e.target.value,o=[...s],i={id:o[n].id,pageGoal:o[n].pageGoal,pageTitle:t};o[n]=i,l(o),C(Ne.vg.EDIT_ITEM),p(t.length)},onFocus:h,initial:!1,animate:R,transition:_,onBlur:m,onKeyDown:w,ref:t,"data-testid":`outline_item_${n}_input`}),(0,i.jsxs)(xh,{initial:!1,animate:R,transition:_,children:[b&&(0,i.jsx)(gh,{onClick:y,whileTap:{scale:.9},"data-testid":`outline_item_${n}_delete_button`,children:(0,i.jsx)(Qe,{})}),c&&(0,i.jsx)(gh,{onClick:()=>{const e=[...s];e.splice(n+1,0,{pageTitle:"",id:(0,da.Z)()}),l(e),C(Ne.vg.CLICK_ADD)},whileTap:{scale:.9},children:(0,i.jsx)(Xe.Z,{})}),b&&(0,i.jsxs)(Ch,{onPointerDown:e=>f.start(e),children:[(0,i.jsx)(fh,{}),x&&(0,i.jsx)(xt.Z,{})]})]})]})})}));const bh={listStyle:"none",padding:0,margin:0},yh={type:"tween",ease:"easeOut",duration:.3},wh="titleInput",Th=g.ZP.div.withConfig({displayName:"GenerativeOutlineEditor__Container",componentId:"sc-18e9967d-0"})`
  width: ${ep.Wu}px;
`,Ih=(0,g.ZP)(d.E.div).withConfig({displayName:"GenerativeOutlineEditor__EditorFields",componentId:"sc-18e9967d-1"})`
  display: flex;
  flex-direction: column;
  width: 100%;
  padding: ${ih}px;
  max-height: calc(
    100vh - 2 * ${ep.Pq}px - ${52}px
  );
  overflow-y: auto;
  position: relative;
`,Ph=(0,g.ZP)(d.E.div).withConfig({displayName:"GenerativeOutlineEditor__TitleWrapper",componentId:"sc-18e9967d-2"})`
  background-color: ${e=>{let{theme:t}=e;return t.colors.outlineEditorFieldBackgroundColor}};
  border-radius: ${e=>{let{theme:t}=e;return t.borderRadius.sm}};
  height: 98px;
  padding: 12px;
  padding-top: 8px;
  margin-bottom: 8px;
`,Eh=(0,g.ZP)(d.E.div).withConfig({displayName:"GenerativeOutlineEditor__TitlePlaceholder",componentId:"sc-18e9967d-3"})`
  font-size: ${20}px;
  line-height: ${28}px;
  color: ${e=>{let{theme:t}=e;return t.colors.outlineEditorTextColorPlaceholder}};
  display: flex;
  gap: 2px;
  align-items: baseline;
`,_h=(0,g.ZP)(d.E.div).withConfig({displayName:"GenerativeOutlineEditor__TitleLabel",componentId:"sc-18e9967d-4"})`
  margin-bottom: ${6}px;
  font-size: ${e=>{let{theme:t}=e;return t.fontSizes.sm}};
  line-height: ${16}px;
  color: ${e=>{let{theme:t}=e;return t.colors.outlineEditorTitleLabel}};
`,jh=(0,g.ZP)(d.E.textarea).withConfig({displayName:"GenerativeOutlineEditor__TitleInput",componentId:"sc-18e9967d-5"})`
  appearance: none;
  border: none;
  box-shadow: none;
  outline: none;
  resize: none;
  caret-color: ${e=>{let{theme:t,$atMaxLength:o}=e;return o?t.colors.errorText:t.colors.uiAccent}};
  background-color: transparent;
  width: 100%;
  font-size: ${20}px;
  line-height: ${28}px;
  color: ${e=>{let{theme:t}=e;return t.colors.outlineEditorTextColorBlurred}};
  text-rendering: optimizeLegibility;
  -webkit-font-smoothing: antialiased;

  &:focus {
    color: ${e=>{let{theme:t}=e;return t.colors.outlineEditorTextColorFocused}};
  }

  ::selection {
    background-color: ${e=>e.theme.colors.textSelection};
  }
`,kh=(0,g.ZP)((0,d.E)(Re.ZP)).withConfig({displayName:"GenerativeOutlineEditor__RegenerateButton",componentId:"sc-18e9967d-6"})`
  margin-right: 8px;
  min-width: 28px;
  width: 28px;
  height: 28px;
  padding: 0;
`,Sh=(0,g.ZP)(Re.ZP).withConfig({displayName:"GenerativeOutlineEditor__SubmitButton",componentId:"sc-18e9967d-7"})`
  margin-right: ${ih}px;
`;function Zh(e){let{changePromptMode:t,isLoading:o,onSubmit:n,onRegenerate:r,outlineContent:l,setOutlineContent:s,setTomeTitle:d,tomeTitle:c,backgroundRef:u,onClickOutside:p,reportTomeAnalytics:m,maxContentLength:h}=e;var g;const{t:f}=(0,C.$G)();(0,Lp.Z)(u,p);const x=null!=l&&l.some((e=>{let{pageTitle:t}=e;return t&&t.length>0})),v=null!=c&&c.length>0,b=!o&&v&&x,y=(0,a.useRef)(null),w=o?{opacity:.75}:{opacity:1},T=o?{opacity:1}:{opacity:0},I=o?{opacity:0}:{opacity:1},P=(0,D.W9)(D.TT.GENERATIVE_OUTLINE_EDITOR_INPUT_MAX_LENGTH),E=((null===(g=c)||void 0===g?void 0:g.length)??0)===P,_=e=>{e===P&&(0,A.ak)({message:f("commandPrompt.outlineEditor.maxLengthToast",{maxLength:P})})},{setGlobalKeyBindingsRef:j,setInputByIdRef:k,focusFirstInput:S,focusGlobalKeybindings:Z,focusNextInput:R,focusPreviousInput:O,onInputBlur:M,onInputFocus:$}=dh({orderedInputIds:[wh,...(l??[]).map((e=>e.id))]}),L=(0,Xt.Z)(((e,t)=>{let{currentId:o,onDeleteCurrent:n}=e;if("Enter"===t.key)Z();else if("Escape"===t.key)Z();else if("Tab"===t.key&&t.shiftKey)t.preventDefault(),O(o);else if("Tab"!==t.key||t.shiftKey){if(("Del"===t.key||"Backspace"===t.key)&&n){0===t.target.value.length&&(n(),Z())}}else t.preventDefault(),R(o)}),[Z,R,O]),N=(0,a.useCallback)((()=>{b&&n()}),[b,n]),B=(0,a.useCallback)((()=>{m(Ne.vg.ESCAPE_BACK),t(Tp.q.SCOPED)}),[t,m]),H=(0,a.useCallback)((e=>{e.preventDefault(),S()}),[S]),V=(0,a.useMemo)((()=>{const e=new Map;return e.set("enter",N),e.set("escape",B),e.set("tab",H),e}),[N,B,H]),F=(0,a.useCallback)((()=>{m(Ne.vg.CLICK_BACK),t(Tp.q.SCOPED)}),[t,m]),G=(0,a.useCallback)((e=>{s(e),m(Ne.vg.REORDER_ITEM)}),[m,s]),U=(0,a.useCallback)((()=>{r();try{var e;null===(e=y.current)||void 0===e||e.scrollTo({behavior:"smooth",top:0})}catch{var t;null===(t=y.current)||void 0===t||t.scrollTo({top:0})}}),[r]),z=f("commandPrompt.outlineEditor.regenerateButtonTooltip");return(0,i.jsx)(Nu.G,{bindings:V,ref:j,children:(0,i.jsxs)(Th,{children:[(0,i.jsxs)(Ih,{layoutScroll:!0,children:[(0,i.jsxs)(Ph,{initial:{opacity:0},animate:w,transition:ep.c,layout:!0,children:[(0,i.jsxs)(Eh,{"aria-hidden":!o,initial:!1,animate:T,transition:yh,children:[f("commandPrompt.outlineEditor.titlePlaceholder"),(0,i.jsx)(nh,{gap:4,size:3})]}),(0,i.jsx)(_h,{"aria-hidden":o,initial:!1,animate:I,style:{y:-28},transition:yh,children:f("commandPrompt.outlineEditor.titleLabel")}),(0,i.jsx)(jh,{"aria-hidden":o,ref:k(wh),maxLength:P,disabled:o,rows:2,onChange:e=>{const t=e.target.value;d(t),m(Ne.vg.EDIT_TITLE),_(t.length)},"data-testid":"outline_editor_title_input",onBlur:M,onFocus:$,onKeyDown:L({currentId:wh}),value:c,$atMaxLength:E,initial:!1,animate:I,style:{y:-28},transition:yh})]}),(0,i.jsx)("div",{ref:y,children:l&&(0,i.jsx)(eh.t.Group,{as:"ol",axis:"y",onReorder:G,values:l,style:bh,transition:ep.c,children:l.map(((e,t)=>(0,i.jsx)(vh,{ref:k(e.id),value:e,index:t,dragConstraintsRef:y,setOutlineContent:s,outlineContent:l,isLoading:o,canAddOutlineItem:l.length<h,onBlur:M,onFocus:$,makeOnKeyDown:L,maxInputLength:P,showMaxLengthToastIfNecessary:_,reportTomeAnalytics:m},e.id)))})})]}),(0,i.jsx)(rh,{title:f("commandPrompt.autotome.commandTitle"),onClick:F,rightContent:(0,i.jsxs)(i.Fragment,{children:[(0,i.jsx)($o.Z,{content:z,placement:"top",children:(0,i.jsx)(kh,{"aria-label":z,size:"smallMedium",disabled:!b,onClick:U,children:(0,i.jsx)(th,{style:{width:"20px",height:"20px"}})})}),(0,i.jsx)(Sh,{color:"primary",disabled:!b,onClick:n,"data-testid":"outline_editor_submit_button",size:"smallMedium",children:f("commandPrompt.outlineEditor.submitButton")})]})})]})})}const Rh=(0,g.ZP)(mu.fC).withConfig({displayName:"BaseCommandControl__OutsidePanelClickBlockingOverlay",componentId:"sc-19b4f257-0"})`
  position: absolute;
  inset: 0;
  // Capture all clicks on the overlay.
  pointer-events: auto;
  width: 100%;
  height: 100%;
`;var Oh=e=>{let{controlRenderer:t,focusInput:o,useClickBlockingOverlay:n}=e;const[r,l]=(0,a.useState)(!1),s=(0,a.useCallback)((()=>{l(!0)}),[l]),d=(0,a.useCallback)((()=>{l(!1),setTimeout((()=>o()),200)}),[l,o]);return(0,i.jsxs)(i.Fragment,{children:[r&&n&&(0,i.jsx)(Rh,{"data-testid":"dropdown_overlay",style:{zIndex:I.bf}}),(0,i.jsx)(t,{isOpen:r,setOpen:s,setClose:d,panelZIndex:I.m6})]})},Mh=g.iv`
  cursor: pointer;
  background: ${e=>{let{theme:t}=e;return t.colors.commandPromptControlBackground}};
  color: ${e=>{let{theme:t,$isOpen:o}=e;return o?t.colors.commandPromptControlTextActive:t.colors.commandPromptControlText}};
  border-radius: ${e=>{let{theme:t}=e;return t.borderRadius.xs}};
  width: 100%;
  flex: 0;
  gap: 4px;
  padding: 6px 6px 6px 8px;
  transition: background 0.2s ease-out, color 0.2s ease-out;

  & > svg {
    fill: ${e=>{let{theme:t,$isOpen:o}=e;return o?t.colors.commandPromptControlTextActive:t.colors.commandPromptControlText}};
    transition: fill 0.2s ease-out;
  }

  &:hover {
    background: ${e=>{let{theme:t}=e;return t.colors.commandPromptControlBackgroundHover}};
    color: ${e=>{let{theme:t,$isOpen:o}=e;return o?t.colors.commandPromptControlTextActive:t.colors.commandPromptControlTextHover}};

    & > svg {
      fill: ${e=>{let{theme:t,$isOpen:o}=e;return o?t.colors.commandPromptControlTextActive:t.colors.commandPromptControlTextHover}};
    }
  }
`,$h=o(32261);const Lh=70,Ah=184,Nh=16,Dh=(0,g.ZP)($h.e6).withConfig({displayName:"CommandControlSliderPanel__SliderRange",componentId:"sc-aaa70f40-0"})`
  height: ${Nh}px;
  background-color: ${e=>{let{theme:t}=e;return t.colors.commandPromptSliderTrackSelectedBackground}};
  position: absolute;
`,Bh=(0,g.ZP)($h.fQ).withConfig({displayName:"CommandControlSliderPanel__SliderTrack",componentId:"sc-aaa70f40-1"})`
  height: ${Nh}px;
  position: relative;
  flex-grow: 1;
  border-radius: ${Nh}px;
  background-color: ${e=>{let{theme:t}=e;return t.colors.commandPromptSliderTrackBackground}};
  cursor: pointer;
  overflow: hidden;
`,Hh=(0,g.ZP)($h.bU).withConfig({displayName:"CommandControlSliderPanel__SliderThumb",componentId:"sc-aaa70f40-2"})`
  display: block;
  height: ${Nh}px;
  width: ${Nh}px;
  border-radius: ${Nh}px;
  cursor: grab;
  background-color: ${e=>{let{theme:t}=e;return t.colors.commandPromptSliderThumbBackground}};
  box-shadow: ${e=>{let{theme:t}=e;return t.colors.commandPromptSliderThumbShadow}};
  border: ${e=>{let{theme:t}=e;return`1px solid ${t.colors.commandPromptSliderThumbBorder}`}};

  &:focus-visible {
    outline: none;
  }
`,Vh=(0,g.ZP)($h.fC).withConfig({displayName:"CommandControlSliderPanel__SliderRoot",componentId:"sc-aaa70f40-3"})`
  width: 100%;
  height: ${Nh}px;
  position: relative;
  display: flex;
  align-items: center;
  user-select: none;
  touch-action: none;
`,Fh=g.ZP.div.withConfig({displayName:"CommandControlSliderPanel__Panel",componentId:"sc-aaa70f40-4"})`
  box-shadow: ${e=>{let{theme:t}=e;return t.colors.panelBoxShadow}};
  border-radius: 8px;
  background: ${e=>{let{theme:t}=e;return t.colors.commandPromptControlPanelBackground}};
  width: ${Ah}px;
  height: ${Lh}px;
  padding: 12px;
  padding-top: 8px;
`,Gh=g.ZP.div.withConfig({displayName:"CommandControlSliderPanel__TextContainer",componentId:"sc-aaa70f40-5"})`
  display: flex;
  justify-content: space-between;
  width: 100%;
  margin-bottom: 12px;
`,Uh=g.ZP.span.withConfig({displayName:"CommandControlSliderPanel__LengthLabel",componentId:"sc-aaa70f40-6"})`
  font-size: ${e=>{let{theme:t}=e;return t.fontSizes.sm}};
  line-height: 20px;
  color: ${e=>{let{theme:t}=e;return t.colors.commandPromptControlText}};
`,zh=g.ZP.span.withConfig({displayName:"CommandControlSliderPanel__Count",componentId:"sc-aaa70f40-7"})`
  font-size: ${e=>{let{theme:t}=e;return t.fontSizes.sm}};
  line-height: 20px;
  color: ${e=>{let{theme:t}=e;return t.colors.commandPromptControlAccentText}};
`;function Wh(e){let{buttonRef:t,count:o,getCountLabel:n,max:r,min:l,setCount:s,setClose:d,withPortal:c=!0,zIndex:u}=e;const{t:p}=(0,C.$G)(),[m,h]=(0,a.useState)(o),[g,f]=(0,a.useState)(!1),[x,v]=(0,a.useState)(),b=(0,a.useRef)(m);b.current=m;const y=(0,a.useCallback)((()=>{s(b.current),d()}),[b,d,s]);(0,a.useEffect)((()=>{var e;const o=null===(e=t.current)||void 0===e?void 0:e.getBoundingClientRect();if(o){const{left:e,top:t,width:n}=o;v({left:e+n/2-Ah/2,top:t-8-Lh})}}),[t]);const w=(0,a.useCallback)((e=>{"Escape"===e.key||"Enter"===e.key?(e.stopPropagation(),y()):"ArrowLeft"===e.key?(e.stopPropagation(),h((e=>e>l?e-1:e))):"ArrowRight"===e.key&&(e.stopPropagation(),h((e=>e<r?e+1:e)))}),[r,l,y]);(0,a.useEffect)((()=>(document.addEventListener("keydown",w,{capture:!0}),()=>{document.removeEventListener("keydown",w,{capture:!0})})),[w]);const T=(0,i.jsxs)(Fh,{children:[g&&(0,i.jsx)(xt.Z,{}),(0,i.jsxs)(ni.Z,{onClick:y,listenerOptions:{capture:!0},exemptContainerRefs:[t],children:[(0,i.jsxs)(Gh,{children:[(0,i.jsx)(Uh,{children:p("commandPrompt.slider.lengthLabel")}),(0,i.jsx)(zh,{children:n(m)})]}),(0,i.jsxs)(Vh,{min:l,max:r,value:[m],onValueChange:e=>{let[t]=e;h(t)},onPointerDown:()=>{f(!0)},onPointerUp:y,children:[(0,i.jsx)(Bh,{children:(0,i.jsx)(Dh,{})}),(0,i.jsx)(Hh,{})]})]})]});return c?(0,i.jsx)(mu.fC,{style:{zIndex:u,...x},children:T}):T}const Kh=(0,g.ZP)(Ie.Z).withConfig({displayName:"CommandControlSlider__StyledButton",componentId:"sc-c17e8b20-0"})`
  ${Mh}
  padding: 3px 8px 3px 5px;
  white-space: nowrap;
`,qh=(0,a.forwardRef)(((e,t)=>{let{Icon:o,count:n,getCountLabel:a,isOpen:r,setClose:l,setOpen:s}=e;return(0,i.jsxs)(Kh,{ref:t,$isOpen:r,onClick:()=>{r?l():s()},children:[(0,i.jsx)(o,{style:{height:20,width:20}}),a(n)]})}));function Yh(e){let{Icon:t,count:o,getCountLabel:n,isOpen:r,max:l,min:s,setOpen:d,setClose:c,setCount:u,zIndex:p}=e;const m=(0,a.useRef)(null);return(0,i.jsxs)(i.Fragment,{children:[r&&(0,i.jsx)(Wh,{buttonRef:m,count:o,getCountLabel:n,max:l,min:s,setCount:u,setClose:c,zIndex:p}),(0,i.jsx)(qh,{Icon:t,count:o,getCountLabel:n,isOpen:r,ref:m,setOpen:d,setClose:c})]})}function Jh(e){let{Icon:t,count:o,focusInput:n,getCountLabel:r,max:l,min:s,setCount:d}=e;const c=(0,a.useMemo)((()=>e=>{let{isOpen:n,setOpen:a,setClose:c,panelZIndex:u}=e;return(0,i.jsx)(Yh,{Icon:t,count:o,getCountLabel:r,isOpen:n,max:l,min:s,setCount:d,setClose:c,setOpen:a,zIndex:u})}),[t,o,r,l,s,d]);return(0,i.jsx)(Oh,{controlRenderer:c,focusInput:n,useClickBlockingOverlay:!0})}var Xh;!function(e){e.PUBLIC_TURBO="PUBLIC_TURBO",e.FOUNDRY_TURBO="FOUNDRY_TURBO",e.PARALLEL_PAGES_PUBLIC_TURBO="PARALLEL_PAGES_PUBLIC_TURBO",e.PARALLEL_PAGES_FOUNDRY_TURBO="PARALLEL_PAGES_FOUNDRY_TURBO"}(Xh||(Xh={}));const Qh=new Set([Xh.PARALLEL_PAGES_FOUNDRY_TURBO,Xh.PARALLEL_PAGES_PUBLIC_TURBO]),eg=new Set([Ne.vg.EDIT_TITLE,Ne.vg.EDIT_ITEM,Ne.vg.REORDER_ITEM,Ne.vg.CLICK_ADD,Ne.vg.CLICK_DELETE]);const tg={id:od.mm.AUTOTOME_V2,title:ll.ZP.t("commandPrompt.autotome.commandTitle"),featureFlag:D.TT.AUTOTOME_V2,placeholder:ll.ZP.t("commandPrompt.autotome.commandPlaceholder"),contentDependency:od.oq.EMPTY,Component:e=>{let{tomeId:t,getInputString:o,setCommandState:n,pageGenerationSubscriptionId:r,pageIdsToClearOnRetry:l,mode:s,promptBackgroundRef:d,onComplete:c,localOutlineContent:u,outlineResponse:p,analyticsAlreadyReported:m,tomeTitle:h,changePromptMode:g,isLoadingOutline:C,closeCommandPrompt:f,setShowOverlayAndBlockKeys:x,pageCount:v}=e;var b,y;const{apolloClient:w}=(0,L.bp)(),{priceType:T}=(0,ys.Z)(),I=(l??[]).length>0,P=Gm(),{attemptToPerformCreditsOperation:E,checkForSufficientCreditsOperation:_}=(0,Oo.KW)(),j=(0,a.useCallback)((e=>{n({localOutlineContent:e})}),[n]),k=(0,a.useCallback)((e=>{n({tomeTitle:e})}),[n]),S=(0,a.useCallback)((e=>{n({pageIdsToClearOnRetry:e})}),[n]),{onError:Z,onProgress:R,onRetry:O,onSubscriptionStart:M,onGenerationComplete:$}=Um({pageIdsToClearOnRetry:l,setCommandState:n,creditsOperation:Oo.Cw.AUTO_TOME}),A=(0,a.useCallback)((function(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;return!(t<1)||Z(e,t)}),[Z]),N=(0,a.useCallback)(((e,o)=>{var i;const[a,r]=function(e,t){var o;if(!eg.has(e))return[!1,void 0];const n={reportedNamesSet:(null===(o=t)||void 0===o?void 0:o.reportedNamesSet)??new Set};return n.reportedNamesSet.has(e)?[!0,void 0]:(n.reportedNamesSet.add(e),[!1,n])}(e,m);a||(r&&n({analyticsAlreadyReported:r}),Ne.ZP.reportOutlineEditorEvent({apolloClient:w,trackEventType:e,properties:{tomeId:t,operationId:o??(null===(i=p)||void 0===i?void 0:i.operationId)??"operaionId undefined"}}))}),[m,w,null===(b=p)||void 0===b?void 0:b.operationId,n,t]),D=function(e){let{onError:t,onComplete:o}=e;const[n]=(0,G.HXg)({onCompleted:e=>{var n;switch(null===(n=e.generateOutline)||void 0===n?void 0:n.__typename){case"GenerateOutlineSuccessResponse":o(e.generateOutline);break;case"GenerateOutlineError":{const o=e.generateOutline.errorCode;t(o||G.EaV.ApiError);break}default:t(G.EaV.ApiError)}},onError:()=>{t(G.EaV.ApiError)}}),i=(0,a.useCallback)((e=>{let{inputPrompt:t,numberOfPagesRequested:o,tomeId:i}=e;return n({variables:{inputPrompt:t,numberOfPagesRequested:o,tomeId:i}})}),[n]);return i}({onError:A,onComplete:(0,a.useCallback)((e=>{const t=(o=u,e.outlineContent.map(((e,t)=>{var n,i;return{...e,id:(null===(i=o)||void 0===i||null===(n=i[t])||void 0===n?void 0:n.id)??(0,da.Z)()}})));var o;N(Ne.vg.OUTLINE_GENERATED,e.operationId),n({localOutlineContent:t,outlineResponse:{desiredArtStyleType:e.detectedArtStyle,desiredLanguage:e.detectedLanguage,operationId:e.operationId,originalTomeTitle:e.tomeTitle,originalOutlineContent:t},analyticsAlreadyReported:{reportedNamesSet:new Set},tomeTitle:e.tomeTitle,isLoadingOutline:!1})}),[u,N,n])}),B=(0,a.useCallback)((e=>{_(Oo.Cw.AUTO_TOME,(()=>{var o;n({localOutlineContent:(o=v??6,Array.from(Array(o)).map((()=>({id:(0,da.Z)(),pageTitle:""})))),isLoadingOutline:!0}),D({inputPrompt:e.stringValue,numberOfPagesRequested:v??6,tomeId:t}),g(Tp.q.DELEGATE)}))}),[_,n,v,D,t,g]),H=(0,a.useCallback)((()=>_(Oo.Cw.AUTO_TOME,(()=>{var e;n({isLoadingOutline:!0}),N(Ne.vg.CLICK_REGENERATE),D({inputPrompt:o(),numberOfPagesRequested:(null===(e=u)||void 0===e?void 0:e.length)??6,tomeId:t})}))),[_,n,N,D,o,null===(y=u)||void 0===y?void 0:y.length,t]),V=function(e){let{onError:t,onSubscriptionStart:o}=e;const[n]=(0,G.GdE)({onCompleted:e=>{var o,n;const i=null===(n=e)||void 0===n||null===(o=n.generateTomeFromOutline)||void 0===o?void 0:o.errorCode;i&&t(i)},onError:()=>{t(G.EaV.ApiError)}}),i=(0,a.useCallback)((e=>{let{operationId:t,tomeId:i,tomeTitle:a,inputPrompt:r,desiredLanguage:l,desiredArtStyleType:s,outlineContent:d}=e;const c=(0,da.Z)();o(c),n({variables:{operationId:t,progressSubscriptionId:c,tomeId:i,tomeTitle:a,inputPrompt:r,desiredLanguage:l,desiredArtStyleType:s,outlineContent:d}})}),[n,o]);return i}({onError:A,onSubscriptionStart:M}),F=(0,a.useCallback)((()=>{E(Oo.Cw.AUTO_TOME,(()=>{if(!p||!u||!h)return;I&&(P(t,{pageIdsToDelete:l}),S([]));const{desiredArtStyleType:e,desiredLanguage:n,operationId:i,originalOutlineContent:a}=p,r=function(e,t){const o=e.filter((e=>e.pageTitle.trim().length>0)),n=new Map(t.map((e=>{let{id:t,...o}=e;return[t,o]})));return function(e){return e.map((e=>{let{id:t,...o}=e;return o}))}(o.map((e=>{var t;return e.pageTitle.trim()===(null===(t=n.get(e.id))||void 0===t?void 0:t.pageTitle)?e:{id:e.id,pageTitle:e.pageTitle,pageGoal:null}})))}(u,a);N(Ne.vg.CLICK_GENERATE_TOME),V({desiredArtStyleType:e,desiredLanguage:n,operationId:i,tomeId:t,tomeTitle:h,inputPrompt:o(),outlineContent:r}),x(!0)}))}),[E,p,u,h,I,N,V,t,o,x,P,l,S]),U=(z=Om.PRESENTATION,W=null===T,e=>{let{numPagesGenerated:t,status:o}=e;switch(o){case gp.z.PROGRESS:return t<2?ll.ZP.t("commandPrompt.autotome.generationProgress",{artifactType:z.getText()}):ll.ZP.t("commandPrompt.autotome.generationProgress",{pageIndex:t+1,context:"pageIndex"});case gp.z.COMPLETE:case gp.z.ACTION:{const e=ll.ZP.t("commandPrompt.autotome.generationComplete",{artifactType:(0,Zm.Z)(z.getText())});return W?(0,i.jsx)(Nm,{text:e}):e}default:return""}});var z,W;switch(s){case Tp.q.DELEGATE:return r?(0,i.jsx)(Lm,{action:(0,i.jsx)(Hm,{onDismiss:c,onRetry:O,backgroundRef:d,shouldEnableOutlineClicks:!0}),completionState:gp.z.ACTION,getStatusContent:U,onGenerationComplete:$,onError:A,onProgress:R,pageGenerationSubscriptionId:r,"data-testid":"generative_command_generation_status"}):(0,i.jsx)(Zh,{changePromptMode:g,onSubmit:F,onRegenerate:H,outlineContent:u,setOutlineContent:j,setTomeTitle:k,tomeTitle:h,isLoading:C??!0,onClickOutside:f,backgroundRef:d,reportTomeAnalytics:N,maxContentLength:10});case Tp.q.ROOT:case Tp.q.SCOPED:default:return(0,i.jsx)(Qm,{Icon:Rm,commandHandler:B})}},ControlStripComponent:e=>{let{focusInput:t,setCommandState:o,pageCount:n}=e;const r=(0,D.W9)(D.TT.GENERATE_TOME_FROM_OUTLINE_ENGINE),l=Qh.has(r),{t:s}=(0,C.$G)(),d=(0,a.useCallback)((e=>s("commandPrompt.autotome.pageCount",{count:e})),[s]),c=(0,a.useCallback)((e=>{o({pageCount:e})}),[o]),u=(0,D.W9)(D.TT.AUTOTOME_MAX_NUMBER_OF_PAGES),p=l&&u?u:10;return(0,i.jsx)(ep.oG,{children:l&&(0,i.jsx)(Jh,{Icon:Mm,getCountLabel:d,focusInput:t,setCount:c,count:n??6,min:1,max:p})})},hasFallbackMode(e){let{input:t}=e;return t.length<zm},keywords:ll.ZP.t("commandPrompt.autotome.keywords",{returnObjects:!0})};var og=tg;var ng=(0,a.forwardRef)(((e,t)=>(0,i.jsxs)(ye.Z,{ref:t,viewBox:"0 0 64 64",...e,children:[(0,i.jsx)("path",{d:"M18 26C16.8954 26 16 26.8954 16 28C16 29.1046 16.8954 30 18 30H30C31.1046 30 32 29.1046 32 28C32 26.8954 31.1046 26 30 26H18Z"}),(0,i.jsx)("path",{d:"M16 36C16 34.8954 16.8954 34 18 34H26C27.1046 34 28 34.8954 28 36C28 37.1046 27.1046 38 26 38H18C16.8954 38 16 37.1046 16 36Z"}),(0,i.jsx)("path",{d:"M38 24C36.8954 24 36 24.8954 36 26V38C36 39.1046 36.8954 40 38 40H46C47.1046 40 48 39.1046 48 38V26C48 24.8954 47.1046 24 46 24H38Z"}),(0,i.jsx)("path",{fillRule:"evenodd",clipRule:"evenodd",d:"M16 50C11.5817 50 8 46.4183 8 42V22C8 17.5817 11.5817 14 16 14H48C52.4183 14 56 17.5817 56 22V42C56 46.4183 52.4183 50 48 50H16ZM16 46C13.7909 46 12 44.2091 12 42V22C12 19.7909 13.7909 18 16 18H48C50.2091 18 52 19.7909 52 22V42C52 44.2091 50.2091 46 48 46H16Z"})]})));var ig=e=>{const t=(0,a.useRef)(e);return(0,kd.G)((()=>{t.current=e})),(0,a.useCallback)((function(){for(var e=arguments.length,o=new Array(e),n=0;n<e;n++)o[n]=arguments[n];const{current:i}=t;return i(...o)}),[])},ag=o(22173);const rg=Zr.tw.longSide,lg=Zr.tw.shortSide,sg=Zr.tw.radius,dg=(0,g.ZP)(d.E.div).withConfig({displayName:"VisualResults__SelectableItem",componentId:"sc-f2a2840-0"})`
  grid-area: 1 / 1;
  width: ${rg}px;
  height: ${lg}px;
  display: flex;
  justify-content: center;
  align-items: center;
  border-radius: ${sg}px;
  background: ${e=>{let{theme:t}=e;return t.colors.visualResultsContentItemBackground}};
  box-shadow: ${e=>{let{theme:t,$isFocused:o,$boxShadowColor:n}=e;return o?t.colors.visualResultsContentItemFocusedBoxShadow:`0 0 0 1px ${n}`}};
  cursor: pointer;
  transition: box-shadow 0.1s;
  &:hover {
    box-shadow: ${e=>{let{theme:t,$isFocused:o}=e;return o?t.colors.visualResultsContentItemFocusedBoxShadow:t.colors.visualResultsContentItemOnHoverBoxShadow}};
  }
`,cg=(0,g.ZP)(d.E.div).withConfig({displayName:"VisualResults__LoadingItem",componentId:"sc-f2a2840-1"})`
  grid-area: 1 / 1;
  width: ${rg}px;
  height: ${lg}px;
  display: flex;
  justify-content: center;
  align-items: center;
  border-radius: ${sg}px;
  background: ${e=>{let{theme:t}=e;return t.colors.visualResultsContentItemBackground}};
  box-shadow: ${e=>{let{theme:t}=e;return t.colors.visualResultsContentItemBoxShadow}};
`,ug=(0,g.ZP)(d.E.div).withConfig({displayName:"VisualResults__ErrorItem",componentId:"sc-f2a2840-2"})`
  grid-area: 1 / 1;
  width: ${rg}px;
  height: ${lg}px;
  display: flex;
  justify-content: center;
  align-items: center;
  border-radius: ${sg}px;
  border: 1px solid ${e=>{let{theme:t}=e;return t.colors.visualResultsErrorBorder}};
`,pg=e=>{let{label:t,fadeProps:o}=e;const n=(0,g.Fg)();return(0,i.jsx)(ug,{...o,children:(0,i.jsx)(Cp,{"aria-label":t,style:{fill:n.colors.visualResultsErrorIcon,height:32,width:32}})})},mg=e=>{let{label:t,fadeProps:o}=e;const n=(0,g.Fg)();return(0,i.jsx)(cg,{...o,children:(0,i.jsx)(ag.Z,{ariaLabel:t,size:21,stroke:1.5,rotationDuration:3,background:n.colors.visualResultsLoadingBackground,foreground:n.colors.visualResultsLoadingForeground})})},hg=e=>{let{children:t,selectCandidate:o,$isFocused:n,$boxShadowColor:a,fadeProps:r,dataTestId:l}=e;return(0,i.jsx)(dg,{"data-testid":l,onClick:o,$isFocused:n,$boxShadowColor:a,whileTap:{scale:.99},"aria-selected":n,...r,children:t})},gg=g.ZP.div.withConfig({displayName:"VisualResults__ItemContainerDiv",componentId:"sc-f2a2840-3"})`
  display: grid;
`,Cg=e=>{let{children:t}=e;return(0,i.jsx)(gg,{children:(0,i.jsx)(c.M,{children:t})})},fg=g.ZP.div.withConfig({displayName:"VisualResults__SelectorContainer",componentId:"sc-f2a2840-4"})`
  display: flex;
  gap: ${12}px;
  padding: ${6}px;
  padding-top: ${12}px;
`,xg=e=>{let{children:t,onEnter:o,onEscape:n,onArrowLeft:r,onArrowRight:l,dataTestid:s}=e;const{getIsInputFocused:d}=jm(),c=(0,a.useCallback)((e=>{d()||("Enter"===e.key?(e.stopPropagation(),o()):"Escape"===e.key?(e.stopPropagation(),n()):"ArrowUp"===e.key||"ArrowDown"===e.key?e.stopPropagation():"ArrowLeft"===e.key?(e.stopPropagation(),r()):"ArrowRight"===e.key&&(e.stopPropagation(),l()))}),[d,r,l,o,n]);return(0,a.useEffect)((()=>(document.addEventListener("keydown",c,{capture:!0}),()=>{document.removeEventListener("keydown",c,{capture:!0})})),[c]),(0,i.jsx)(fg,{"data-testid":s,children:t})};var vg,bg;function yg(e){let{noFade:t=!1,stagger:o=vg.None,index:n=0}=e;if(t)return{};const i={type:"easeOut",duration:.35},a={...i,delay:.1*n};return{initial:{opacity:0},animate:{opacity:1,transition:o===vg.Enter?a:i},exit:{opacity:0,transition:o===vg.Exit?a:i}}}!function(e){e.Enter="Enter",e.Exit="Exit",e.None="None"}(vg||(vg={})),function(e){e.LOADING="LOADING",e.ERROR="ERROR",e.COMPLETE="COMPLETE"}(bg||(bg={}));const wg={status:bg.LOADING},Tg={status:bg.ERROR},Ig=g.ZP.div.withConfig({displayName:"CandidateDisplay__PageWrapper",componentId:"sc-5eba1757-0"})`
  // Disable all child pointer events, otherwise tapping on tiles does not produce scale effect.
  & * {
    pointer-events: none !important;
  }
`;var Pg=e=>{let{tomeId:t,activePageTheme:o,page:n,tooltipContent:a,isFocused:r,selectCandidate:l,fadeProps:s,tooltipEnabled:d}=e;const c=(0,g.Fg)(),u=o?{...n,theme:o}:n,p=(0,Ji.A8)({foregroundColorHex:u.theme.colors.pageColor,backgroundColorHex:c.RAW_VALUES_LEGACY.commandPaletteBackground});return(0,i.jsx)(hg,{selectCandidate:l,$isFocused:r,$boxShadowColor:p,dataTestId:`candidate_display_${n.id}`,fadeProps:s,children:(0,i.jsx)($o.Z,{content:a,placement:"top",offset:8,tooltipDisabled:!d,tooltipStyle:{maxWidth:312,whiteSpace:"normal"},children:(0,i.jsx)(Ig,{children:(0,i.jsx)(Ld.T3,{preview:!0,pageId:u.id,pageTiles:u.tiles,pageTheme:u.theme,pageLayout:u.layout,pageOverlay:u.overlay,tomeId:t,sizes:Zr._C.fromStaticSizes(Zr.tw,!1),pageKind:Md.sb.COMMAND_PROMPT_PREVIEW,isActive:!1,isVisible:!0,canEdit:!1,useEditablePage:!1,pageVerticalMargin:0})})})},"selectable")};var Eg=e=>{let{tomeId:t,index:o,activePageTheme:n,pageCandidate:r,isFocused:l,selectCandidate:s,onCandidateLoaded:d,noFade:c,tooltipEnabled:u}=e;const p=r.status===bg.COMPLETE&&r.pageId,m=(0,a.useRef)(!0),h=(0,a.useRef)(p);m.current||h.current===p||(m.current=!0,h.current=p);const{data:g,loading:f}=(0,G.v$F)({variables:{id:p||""},skip:!p,onCompleted:e=>{var t;m.current&&(null===(t=e)||void 0===t?void 0:t.page)&&(m.current=!1,d())}}),{t:x}=(0,C.$G)();let v;if(r.status===bg.ERROR){const e=yg({noFade:c,stagger:vg.Exit,index:o});v=(0,i.jsx)(pg,{label:x("commandPrompt.createPageV2.candidateErrorStatusAriaLabel"),fadeProps:e},"error")}if(r.status===bg.LOADING||r.status===bg.COMPLETE&&f){const e=yg({noFade:c,stagger:vg.Enter,index:o});v=(0,i.jsx)(mg,{label:x("commandPrompt.createPageV2.candidateLoadingStatusAriaLabel"),fadeProps:e},"loading")}if(r.status===bg.COMPLETE&&!f){var b;if(!(null===(b=g)||void 0===b?void 0:b.page))throw new Error("Page candidate status is complete, but no page data was returned.");const e=yg({noFade:c,stagger:vg.Exit,index:o});v=(0,i.jsx)(Pg,{tomeId:t,activePageTheme:n,page:g.page,tooltipContent:r.pageGoal,tooltipEnabled:u,isFocused:l,selectCandidate:s,fadeProps:e})}return(0,i.jsx)(Cg,{children:v})};function _g(e){return e?e.map((e=>e.status===bg.COMPLETE?e.pageId:null)).filter((e=>null!==e)):[]}function jg(e,t){return e<t?e+1:0}function kg(e,t){return e>0?e-1:t}function Sg(e,t,o,n){let i=n(t,o),a=e[i];for(;a.status!==bg.COMPLETE;)i=n(i,o),a=e[i];return a}var Zg=e=>{let{onEnter:t,onEscape:o,pageCandidates:n,focusedPageId:l,onSelectCandidate:s,tomeId:d,focusCommandPromptInput:c,shouldAutoSelectFirstCandidate:u,resultsIdForAutoSelect:p,noFade:m,tooltipEnabled:h}=e;var g,C;const f=function(e,t){if(!e||!t)return;const o=e.findIndex((e=>e.status===bg.COMPLETE&&e.pageId===t));return o>-1?o:void 0}(n,l),x=(0,a.useRef)(!1),v=(0,a.useRef)(p);x.current&&v.current!==p&&(x.current=!1,v.current=p);const[b]=(0,r.FV)(A.Vx),{data:y}=(0,G.v$F)({variables:{id:b},skip:!b,fetchPolicy:"cache-only"}),w=n.length-1,T=(0,a.useCallback)((()=>{if(null==f)return;const e=Sg(n,f,w,kg);s(e.pageId)}),[f,w,s,n]),I=(0,a.useCallback)((()=>{if(null==f)return;const e=Sg(n,f,w,jg);s(e.pageId)}),[f,w,s,n]),P=null===(C=y)||void 0===C||null===(g=C.page)||void 0===g?void 0:g.theme;return(0,i.jsx)(xg,{onEnter:t,onEscape:o,onArrowLeft:T,onArrowRight:I,dataTestid:"candidate_picker",children:n.map(((e,t)=>{const o=e.status===bg.COMPLETE?e.pageId:void 0,n=()=>{o&&s(o)};return(0,i.jsx)(Eg,{tomeId:d,index:t,isFocused:f===t,pageCandidate:e,selectCandidate:n,onCandidateLoaded:()=>{u&&!x.current&&(x.current=!0,n())},activePageTheme:P,noFade:m,tooltipEnabled:h},t)}))})};var Rg=e=>{let{subscriptionId:t,expectedUpdateCount:o,onUpdate:n,onError:r,onAllUpdatesReceived:l}=e;const s=(0,a.useRef)(0),d=(0,a.useRef)(0),c=(0,a.useRef)([]);return(0,G.Ro7)({variables:{subscriptionId:t},onData(e){let{client:t,data:i}=e;var a,u;const p=null===(u=i)||void 0===u||null===(a=u.data)||void 0===a?void 0:a.generatePageCandidatesStatus;p&&("PageCandidate"===p.__typename?(s.current+=1,c.current.push({pageId:p.candidate,pageGoal:p.pageGoal}),n({status:bg.COMPLETE,pageId:p.candidate,pageGoal:p.pageGoal})):"GeneratePageCandidatesErrorStatus"===p.__typename&&(d.current+=1,r(p.errorCode)),s.current+d.current===o&&l({client:t,successCount:s.current,succeededCandidates:c.current}))}}),(0,i.jsx)(i.Fragment,{})};var Og=e=>{let{tomeId:t}=e;const{apolloClient:o,clientId:n}=(0,L.bp)(),i=(0,Vm.Z)(),a=(0,r._8)((e=>{let{set:a,snapshot:r}=e;return e=>{let{lastSelectedCandidatePageId:l,candidatePageIds:s,pageId:d,initialOperationInput:c}=e;const u=r.getLoadable(A.Vx).getValue();if(!d||!u)return;if(d===u)return;const p=i(t);if(!p)return;const{pages:m}=p;if(!m)return;const h=m.findIndex((e=>e.id===u));if(-1===h)return;const g=m[h],C=s.includes(u)||l===u||(0,Md.yj)(g),f=C?g.order:(0,Fc.pp)(h+1,m),x=[...c];x.push({operation:G.C8.UpdatePage,id:d,page:{order:f,themeId:g.theme.id},tome:{id:t}}),C&&x.push({operation:G.C8.DeletePage,id:u,tome:{id:t}});const v={id:(0,da.Z)(),tomeId:t,clientId:n,apply:x,revert:[]};ua.Q.submitMutation(o,v,null,!0),a(A.Vx,d)}}),[o,n,i,t]);return{selectGeneratedPage:a}};var Mg=e=>{let{tomeId:t}=e;const{selectGeneratedPage:o}=Og({tomeId:t}),n=(0,a.useCallback)((e=>{let{lastSelectedCandidatePageId:n,candidatePageIds:i,pageId:a}=e;if(!a)return;const r=[{operation:G.C8.RecoverPage,id:a,tome:{id:t}}];o({lastSelectedCandidatePageId:n,candidatePageIds:i,pageId:a,initialOperationInput:r})}),[o,t]);return{selectCandidate:n}};const $g=5;var Lg=e=>{let{themeId:t,tomeId:o}=e;const{selectGeneratedPage:n}=Og({tomeId:o}),i=(0,a.useCallback)((e=>{let{historyPages:i,lastSelectedCandidatePageId:a,selectedIndex:r}=e;if(!t)return null;if(r<0||r>=i.length)return null;const l=i[r];if(!l)return null;const s=Rn()(),d=(0,Fc.oX)(o,l,s,0,t);return n({lastSelectedCandidatePageId:a,candidatePageIds:[s],pageId:s,initialOperationInput:d}),s}),[n,t,o]);return{selectHistoryPreview:i}};const Ag=(0,g.ZP)(d.E.div).withConfig({displayName:"History__Container",componentId:"sc-72eb6815-0"})`
  display: flex;
  flex-direction: column-reverse;
  width: 100%;
  max-height: ${344}px;
  overflow: auto;
`,Ng=(0,g.ZP)(d.E.div).withConfig({displayName:"History__HistoryRecordContainer",componentId:"sc-72eb6815-1"})`
  display: flex;
  flex-direction: column;
  gap: ${6}px;
  width: 100%;
  padding: ${ih}px
    ${6}px;
  ${e=>{let{$paddingBottomOverride:t}=e;return t&&`padding-bottom: ${t}px`}}
`,Dg=(0,g.ZP)(d.E.div).withConfig({displayName:"History__HistoryPreviewRow",componentId:"sc-72eb6815-2"})`
  display: flex;
  align-items: center;
  gap: ${12}px;
  width: 100%;
`,Bg=g.ZP.div.withConfig({displayName:"History__PromptLoadingPlaceholder",componentId:"sc-72eb6815-3"})`
  height: ${16}px;
  width: 1px;
`,Hg=g.ZP.div.withConfig({displayName:"History__PromptText",componentId:"sc-72eb6815-4"})`
  ${te.wR};
  color: ${e=>{let{theme:t}=e;return t.colors.createPageHistoryPromptText}};
`,Vg=g.ZP.div.withConfig({displayName:"History__PromptErrorText",componentId:"sc-72eb6815-5"})`
  ${te.wR};
  color: ${e=>{let{theme:t}=e;return t.colors.errorText}};
`,Fg=(0,g.ZP)(d.E.div).withConfig({displayName:"History__PromptTextContainer",componentId:"sc-72eb6815-6"})`
  font-size: ${e=>{let{theme:t}=e;return t.fontSizes.sm}};
  line-height: ${16}px;
  margin: 0;
  width: fit-content;
  max-width: 100%;

  // Take into account the width of the prompt - the container edge padding for both sides
  max-width: ${ep.Wu-24}px;
`,Gg=e=>{let{shownWithCandidates:t}=e;const{t:o}=(0,C.$G)();return(0,i.jsxs)(Ng,{$paddingBottomOverride:t?void 0:6,children:[(0,i.jsx)(Dg,{children:Array.from(Array(4)).map(((e,t)=>{const n=yg({stagger:vg.None,index:t});return(0,i.jsx)(mg,{label:o("commandPrompt.createPageV2.historyLoadingStatusAriaLabel"),fadeProps:n},`historyPagePreviewLoading${t}`)}))}),t&&(0,i.jsx)(Bg,{})]})},Ug=()=>{const{t:e}=(0,C.$G)();return(0,i.jsxs)(Ng,{children:[(0,i.jsx)(Dg,{children:Array.from(Array(4)).map(((t,o)=>{const n=yg({stagger:vg.None,index:o});return(0,i.jsx)(pg,{label:e("commandPrompt.createPageV2.candidateErrorStatusAriaLabel"),fadeProps:n},`historyPagePreviewError${o}`)}))}),(0,i.jsx)(Fg,{children:(0,i.jsx)(Vg,{children:e("tomeGenerationError.generic")})})]})},zg=e=>{let{activePageTheme:t,focusedPageId:o,onHistoryPreviewClick:n,pageGenerationRecord:a,tomeId:r}=e;return(0,i.jsxs)(Ng,{children:[(0,i.jsx)(Dg,{children:a.pageCandidates.map(((e,l)=>{if(!e)return null;const s=yg({noFade:!0});return(0,i.jsx)(Pg,{tomeId:r,activePageTheme:t,page:e,isFocused:o===e.id,selectCandidate:()=>n({historyPages:a.pageCandidates,selectedIndex:l,newFocusedPageId:e.id}),fadeProps:s},e.id)}))}),(0,i.jsx)(Fg,{initial:{opacity:0},animate:{opacity:1},transition:{delay:.15},children:(0,i.jsx)(Hg,{children:a.userPrompt})})]})};var Wg=e=>{let{historyData:t,focusedPageId:o,lastInsertedPageId:n,setCommandState:l}=e;var s,d,c,u,p,m;const{apolloClient:h}=(0,L.bp)(),{closeCommandPrompt:g,promptBackgroundRef:C,getIsInputFocused:f}=jm(),x=(0,fa.j)();(0,Lp.Z)(C,g);const v=(0,r.sJ)(A.Vx),{data:b}=(0,G.v$F)({variables:{id:v},skip:!v,fetchPolicy:"cache-only"}),y=null===(d=b)||void 0===d||null===(s=d.page)||void 0===s?void 0:s.theme,w=(0,a.useCallback)(((e,t)=>{Ne.ZP.reportCreatePageCandidatesEvent({apolloClient:h,trackEventType:e,properties:{tomeId:x,pageId:t}})}),[h,x]),{selectHistoryPreview:T}=Lg({themeId:null===(c=y)||void 0===c?void 0:c.id,tomeId:x}),I=ig((e=>{let{historyPages:t,newFocusedPageId:i,selectedIndex:a}=e;i!==o&&(l({pageCandidates:void 0,focusedPageId:i}),setTimeout((()=>{const e=T({historyPages:t,lastSelectedCandidatePageId:n,selectedIndex:a});e&&l({lastInsertedPageId:e})}),1),w(Ne.oX.CLICK_SELECT_HISTORY_CANDIDATE,i))})),P=(0,a.useMemo)((()=>(0,F.Z)(I,300,{leading:!0})),[I]);let E;if((null===(m=t)||void 0===m||null===(p=m.tome)||void 0===p||null===(u=p.pageGenerationRecords)||void 0===u?void 0:u.nodes)&&0!==t.tome.pageGenerationRecords.nodes.length){var _,j,k;E=((null===(k=t)||void 0===k||null===(j=k.tome)||void 0===j||null===(_=j.pageGenerationRecords)||void 0===_?void 0:_.nodes)??[]).map((e=>e?(0,i.jsx)(zg,{activePageTheme:y,focusedPageId:o,onHistoryPreviewClick:P,pageGenerationRecord:e,tomeId:x},e.id):null))}else E=(0,i.jsx)(Ug,{});const S=(0,a.useCallback)((e=>{f()||("Escape"===e.key?(e.stopPropagation(),l((e=>({...e,isHistoryShown:!e.isHistoryShown})))):"ArrowUp"!==e.key&&"ArrowDown"!==e.key&&"ArrowLeft"!==e.key&&"ArrowRight"!==e.key||e.stopPropagation())}),[f,l]);return(0,a.useEffect)((()=>(document.addEventListener("keydown",S,{capture:!0}),()=>{document.removeEventListener("keydown",S,{capture:!0})})),[S]),(0,i.jsx)(Ag,{layout:!0,initial:{y:28},animate:{y:0},transition:ep.c,"data-testid":"create_page_history",children:E})};function Kg(e){let{client:t,inputString:o,succeededCandidates:n,tomeId:i,subscriptionId:a}=e;const r=function(e){let{client:t,succeededCandidates:o,subscriptionId:n,inputString:i}=e;const a=o.map((e=>{let{pageId:o}=e;return function(e){let{id:t,fragment:o,fragmentName:n,client:i,data:a}=e;return i.readFragment({id:t,fragment:o,fragmentName:n})||(i.writeFragment({id:t,fragment:o,fragmentName:n,data:a}),i.readFragment({id:t,fragment:o,fragmentName:n}))}({id:`Page:${o}`,fragment:G.bsn,fragmentName:"PageWithTilesFragment",client:t,data:{__typename:"Page",id:o,layout:{rows:[]},theme:{},overlay:{},order:0,autoThemeColor:null,tiles:[]}})})),r=t.cache.writeFragment({id:`PageGenerationRecord:${n}`,fragment:G.HS5,fragmentName:"PageGenerationRecordFragment",data:{__typename:"PageGenerationRecord",id:n,userPrompt:i,pageGoals:o.map((e=>{let{pageGoal:t}=e;return t})),pageCandidates:a}});return r}({client:t,inputString:o,subscriptionId:a,succeededCandidates:n});!function(e){let{client:t,tomeId:o}=e;var n,i;(null===(i=t.cache.readQuery({query:G.WYn,variables:{id:o}}))||void 0===i||null===(n=i.tome)||void 0===n?void 0:n.hasPageGenerationRecords)||t.cache.writeQuery({query:G.mYR,variables:{id:o,limit:$g},data:{tome:{__typename:"Tome",id:o,pageGenerationRecords:{__typename:"PageGenerationRecordConnection",nodes:[],pageInfo:{__typename:"PageInfo",hasNextPage:!1,endCursor:"unusedEndCursor"}}}}})}({client:t,tomeId:i}),t.cache.modify({id:`Tome:${i}`,fields:{hasPageGenerationRecords:()=>!0,pageGenerationRecords(e){if(e)return{...e,nodes:[r,...e.nodes]}}}})}const qg=e=>{let{tomeId:t,lastInsertedPageId:o,subscriptionId:n,pageCandidates:i,setCommandState:r,setErrorCode:l,blurInput:s,imageSource:d}=e;var c;const{apolloClient:u}=(0,L.bp)(),p=(0,a.useCallback)((e=>{t?Ne.ZP.reportCreatePageCandidatesEvent({apolloClient:u,trackEventType:e,properties:{tomeId:t,pageId:o,operationId:n}}):(0,ca.i)(new Error("Attempted to report create page candidates event without a tomeId in context."))}),[u,o,n,t]),{attemptToPerformCreditsOperation:m}=(0,Oo.KW)(),[h]=(0,G.kXP)(),g=(null===(c=i)||void 0===c?void 0:c.every((e=>e.status===bg.LOADING)))??!1,C=(0,a.useCallback)((()=>{var e;const t=Rn()();null===(e=r)||void 0===e||e({pageCandidates:[...Array(4)].map((()=>Tg)),subscriptionId:t})}),[r]),f=(0,a.useCallback)((e=>{switch(e){case G.Flr.InsufficientCredits:var t;null===(t=l)||void 0===t||t(Tp.B.GENERIC_ERROR);break;case G.Flr.FlaggedByModeration:var o;null===(o=l)||void 0===o||o(Tp.B.OUT_OF_MODERATION_ERROR);break;default:var n;null===(n=l)||void 0===n||n(Tp.B.GENERIC_ERROR)}C()}),[C,l]),x=(0,a.useCallback)((e=>{var t,o;const{generatePageCandidates:n}=e;(null===(t=n)||void 0===t?void 0:t.__typename)?"GeneratePageCandidatesErrorResponse"===(null===(o=n)||void 0===o?void 0:o.__typename)&&f(n.errorCode):(0,ca.i)(new Error("generatePageCandidates mutation completed with unexpected data"),n||{})}),[f]),v=(0,D.ye)(D.TT.CREATE_PAGE_ENABLE_WEB_IMAGE);return{reportTomeAnalytics:p,initiatePageCandidateGenerationRequest:(0,a.useCallback)((e=>{g||m(Oo.Cw.TOME_PAGE,(()=>{var o,n;if(!t)return void(0,ca.i)(new Error("Attempted to request page candidates without a tomeId in context."));const i=Rn()();null===(o=r)||void 0===o||o({pageCandidates:new Array(4).fill(wg),subscriptionId:i}),h({variables:{tomeId:t,subscriptionId:i,numCandidates:4,userPrompt:e,imageSource:v?d??G.jU$.Web:G.jU$.Ai},onCompleted:x}),null===(n=s)||void 0===n||n()}))}),[g,m,s,d,x,h,r,v,t])}};var Yg=e=>{let{dataTestId:t,onClick:o,children:n,disabled:a}=e;return(0,i.jsx)(Re.ZP,{"data-testid":t,onClick:o,color:"primary",size:"small",disabled:a,children:n})};const Jg=(0,g.ZP)(d.E.div).withConfig({displayName:"CommandActionButton__ButtonLabel",componentId:"sc-a285df3c-0"})`
  margin-left: 4px;
`,Xg=(0,g.ZP)(d.E.div).withConfig({displayName:"CommandActionButton__ButtonContent",componentId:"sc-a285df3c-1"})`
  display: flex;
  max-width: 100%;
  align-items: center;
`,Qg=(0,g.ZP)(Re.ZP).withConfig({displayName:"CommandActionButton__ActionButton",componentId:"sc-a285df3c-2"})`
  min-height: 26px;
  height: 26px;
  padding-left: 5px;
  padding-right: 8px;
`,eC=(0,a.forwardRef)(((e,t)=>{let{icon:o,children:n,...a}=e;const r=(0,g.Fg)();return(0,i.jsx)(Qg,{...a,size:"small",opacity:r.opacity.commandPromptActionButton,ref:t,children:(0,i.jsxs)(Xg,{children:[o,(0,i.jsx)(Jg,{children:n})]})})}));var tC=eC;const oC="20px",nC={width:oC,height:oC},iC=(0,g.ZP)((0,d.E)(Re.ZP)).withConfig({displayName:"HistoryButton__StyledButton",componentId:"sc-5e3952af-0"})`
  height: 26px;
  padding-left: 0;
  padding-right: 0;
  min-width: 32px;
  margin-right: 0;
  border-radius: 6px;
  ${e=>{let{$backgroundOverwrite:t}=e;return t?`background: ${t}`:""}}
`;var aC=function(e){let{disabled:t,inHistoryView:o,onClick:n}=e;const a=(0,g.Fg)();return(0,i.jsx)(iC,{size:"small",disabled:t,opacity:o?a.opacity.createPageInHistoryViewButton:a.opacity.commandPromptActionButton,$backgroundOverwrite:o?a.colors.createPageInHistoryViewButtonBackground:void 0,onClick:n,"data-testid":"create_page_history_button",children:(0,i.jsx)(Mo,{style:nC})})},rC=o(44101),lC=o(58757);const sC=(0,g.ZP)(rC.VY).withConfig({displayName:"Select__StyledContent",componentId:"sc-d1b11f20-0"})`
  ${lC.D}
  z-index: ${I.m6};
`;var dC=e=>{let{children:t,trigger:o,...n}=e;return(0,i.jsxs)(rC.fC,{...n,children:[o,(0,i.jsx)(rC.h_,{children:(0,i.jsx)(sC,{position:"popper",sideOffset:4,children:(0,i.jsx)(rC.l_,{children:t})})})]})};const cC=(0,g.ZP)(rC.ck).withConfig({displayName:"Item__StyledItem",componentId:"sc-d28cd3a0-0"})`
  ${lC.s}
  cursor: pointer;
  gap: 8;
  justify-content: space-between;

  &[data-highlighted] {
    background-color: ${e=>{let{theme:t}=e;return t.colors.menuControlHover}};
  }
`,uC=g.ZP.span.withConfig({displayName:"Item__Subtitle",componentId:"sc-d28cd3a0-1"})`
  color: ${e=>{let{theme:t}=e;return t.colors.menuTextSubtitle}};
  font-size: ${e=>e.theme.fontSizes.xxs};
  line-height: 14px;
`,pC=g.ZP.div.withConfig({displayName:"Item__TextContainer",componentId:"sc-d28cd3a0-2"})`
  display: flex;
  align-items: flex-start;
  flex-direction: column;
`,mC={width:16,height:16};var hC=(0,a.forwardRef)(((e,t)=>{let{subtitle:o,textValue:n,...a}=e;return(0,i.jsxs)(cC,{...a,ref:t,children:[(0,i.jsxs)(pC,{children:[(0,i.jsx)(rC.eT,{children:n}),o&&(0,i.jsx)(uC,{children:o})]}),(0,i.jsx)(rC.wU,{children:(0,i.jsx)(Fo.Z,{style:mC})})]})}));var gC=(0,a.forwardRef)(((e,t)=>(0,i.jsxs)(ye.Z,{ref:t,viewBox:"0 0 64 64",...e,children:[(0,i.jsx)("path",{d:"M24.5434 21.4617L25.0711 24.6281C25.2677 25.808 26.1923 26.7326 27.3722 26.9294L30.5386 27.457C30.7717 27.4953 30.9544 27.678 30.9926 27.911C31.0419 28.2111 30.8386 28.4943 30.5386 28.5436L27.3722 29.0714C26.1923 29.2681 25.2678 30.1927 25.0711 31.3726L24.5434 34.5389C24.5052 34.7722 24.3224 34.9551 24.089 34.9933C23.789 35.0424 23.5059 34.839 23.4568 34.5389L22.929 31.3726C22.7324 30.1926 21.8077 29.268 20.6278 29.0714L17.4614 28.5436C17.2283 28.5053 17.0456 28.3226 17.0074 28.0895C16.9581 27.7895 17.1614 27.5063 17.4614 27.457L20.6278 26.9294C21.8078 26.7327 22.7324 25.8081 22.929 24.6281L23.4568 21.4617C23.495 21.2284 23.6778 21.0455 23.9111 21.0073C24.2112 20.9582 24.4943 21.1616 24.5434 21.4617Z"}),(0,i.jsx)("path",{fillRule:"evenodd",d:"M16 12C11.5817 12 8 15.5817 8 20V44C8 48.4183 11.5817 52 16 52H48C52.4183 52 56 48.4183 56 44V20C56 15.5817 52.4183 12 48 12H16ZM48 16H16C13.7909 16 12 17.7909 12 20V44C12 46.2091 13.7909 48 16 48H20.1414L36.1548 31.1437C38.2151 28.975 41.5581 28.6551 43.9923 30.3938L52 36.1136V20C52 17.7909 50.2091 16 48 16ZM48 48H25.6586L39.0548 33.8987C39.7416 33.1758 40.8559 33.0692 41.6673 33.6487L52 41.0292V44C52 46.2091 50.2091 48 48 48Z"})]})));const CC={height:"20px",width:"20px"};var fC=e=>{let{disabled:t,focusInput:o,imageSource:n,onImageSourceChange:r}=e;const{t:l}=(0,C.$G)(),s=(0,a.useMemo)((()=>e=>{let{isOpen:o,setOpen:a,setClose:s}=e;return(0,i.jsxs)(dC,{open:o,onOpenChange:e=>e?a():s(),trigger:(0,i.jsx)(rC.xz,{asChild:!0,children:(0,i.jsx)(tC,{disabled:t,icon:(0,i.jsx)(gC,{style:CC}),onPointerDown:()=>o?s():a(),"data-testid":"image_source_selector_button",children:(0,i.jsx)(rC.B4,{})})}),value:n,onValueChange:r,children:[(0,i.jsx)(hC,{textValue:l("commandPrompt.createPageV2.webImageLabel"),value:G.jU$.Web,"data-testid":"image_source_selector_web_option"}),(0,i.jsx)(hC,{textValue:l("commandPrompt.createPageV2.aiImageLabel"),value:G.jU$.Ai,"data-testid":"image_source_selector_ai_option"})]})}),[t,n,r,l]);return(0,i.jsx)(Oh,{controlRenderer:s,focusInput:o,useClickBlockingOverlay:!1})};const xC={height:"16px",width:"16px"},vC=e=>e.length<1;var bC=e=>{let{mode:t,setCommandState:o,pageCandidates:n,tomeId:r,onComplete:l,getInputString:s,isHistoryShown:d,lastInsertedPageId:c,subscriptionId:u,setErrorCode:p,blurInput:m,imageSource:h,focusInput:g}=e;var f,x,v,b;const{reportTomeAnalytics:y,initiatePageCandidateGenerationRequest:w}=qg({tomeId:r,lastInsertedPageId:c,subscriptionId:u,pageCandidates:n,setCommandState:o,setErrorCode:p,blurInput:m,imageSource:h}),{t:T}=(0,C.$G)(),I=(null===(f=n)||void 0===f?void 0:f.some((e=>e.status===bg.COMPLETE)))??!1,P=(null===(x=n)||void 0===x?void 0:x.some((e=>e.status===bg.LOADING)))??!1,E=(0,a.useCallback)((()=>{var e,t;null===(e=w)||void 0===e||e(s()),null===(t=y)||void 0===t||t(Ne.oX.CLICK_GENERATE)}),[w,s,y]),_=(0,a.useCallback)((()=>{var e,t;null===(e=w)||void 0===e||e(s()),null===(t=y)||void 0===t||t(Ne.oX.CLICK_REGENERATE)}),[w,s,y]),j=(0,a.useCallback)((()=>{var e;l(),null===(e=y)||void 0===e||e(Ne.oX.CLICK_KEEP)}),[l,y]),{data:k}=(0,G.ate)({variables:{id:r},skip:t!==Tp.q.SCOPED}),S=!!(null===(b=k)||void 0===b||null===(v=b.tome)||void 0===v?void 0:v.hasPageGenerationRecords),Z=(0,a.useMemo)((()=>P?"":T(d?"commandPrompt.createPageV2.historyButtonTooltipHideHistory":S?"commandPrompt.createPageV2.historyButtonTooltipHasHistory":"commandPrompt.createPageV2.historyButtonTooltipHasNoHistory")),[S,P,d,T]),R=(0,i.jsx)($o.Z,{content:Z,placement:"top",offset:8,children:(0,i.jsx)("div",{children:(0,i.jsx)(aC,{disabled:!S||P,onClick:()=>{var e;o((e=>({...e,isHistoryShown:!e.isHistoryShown}))),null===(e=y)||void 0===e||e(d?Ne.oX.CLICK_HIDE_HISTORY:Ne.oX.CLICK_SHOW_HISTORY)},inHistoryView:d})})}),O=(0,D.ye)(D.TT.CREATE_PAGE_ENABLE_WEB_IMAGE),M=(0,a.useCallback)((e=>{o({imageSource:e})}),[o]),$=null!=n&&n.length>0&&n.every((e=>e.status===bg.LOADING)),L=O&&(0,i.jsx)(fC,{disabled:$,focusInput:g,imageSource:h??G.jU$.Web,onImageSourceChange:M}),A=Km({getNewState:vC});return(0,i.jsxs)(ep.oG,{children:[(0,i.jsxs)(ep.aK,{children:[R,L]}),!n&&(0,i.jsx)(Yg,{onClick:E,disabled:A,dataTestId:"create_page_v2_generate_button",children:T("commandPrompt.createPageV2.generateButtonLabel")}),n&&!d&&(0,i.jsxs)(i.Fragment,{children:[(0,i.jsx)(tC,{disabled:!I,icon:(0,i.jsx)(th,{style:xC}),onClick:_,style:{marginLeft:"auto",marginRight:8},children:T("commandPrompt.createPageV2.regenerateButtonLabel")}),(0,i.jsx)(tC,{icon:(0,i.jsx)(Fo.Z,{style:xC}),onClick:j,disabled:!I,children:T("commandPrompt.createPageV2.keepButtonLabel")})]})]})};var yC={id:od.mm.CREATE_PAGE_V2,title:ll.ZP.t("commandPrompt.createPageV2.commandTitle"),placeholder:ll.ZP.t("commandPrompt.createPageV2.commandPlaceholder"),contentDependency:od.oq.ALWAYS_PRIORITY,Component:e=>{let{blurInput:t,focusInput:o,changePromptMode:n,mode:r,setCommandState:l,setErrorCode:s,pageCandidates:c,lastInsertedPageId:u,focusedPageId:p,subscriptionId:m,tomeId:h,onComplete:g,getInputString:C,isHistoryShown:f,imageSource:x}=e;const{reportTomeAnalytics:v,initiatePageCandidateGenerationRequest:b}=qg({tomeId:h,lastInsertedPageId:u,subscriptionId:m,pageCandidates:c,setCommandState:l,setErrorCode:s,blurInput:t,imageSource:x}),y=(0,a.useCallback)((()=>{const e=Rn()();l({pageCandidates:[...Array(4)].map((()=>Tg)),subscriptionId:e})}),[l]),{selectCandidate:w}=Mg({tomeId:h}),T=ig((e=>{l({lastInsertedPageId:e,focusedPageId:e}),setTimeout((()=>{w({lastSelectedCandidatePageId:u,candidatePageIds:_g(c),pageId:e})}),1)})),I=(0,a.useMemo)((()=>(0,F.Z)((e=>T(e)),300,{leading:!0})),[T]),P=(0,a.useCallback)((e=>{n(Tp.q.SCOPED),b(e.stringValue),l((e=>({...e,isHistoryShown:!1})))}),[n,b,l]),E=(0,a.useCallback)((()=>{g(),v(Ne.oX.KEYBOARD_ENTER)}),[g,v]),_=(0,a.useCallback)((()=>{g(),v(Ne.oX.KEYBOARD_ESCAPE)}),[g,v]),j=(0,a.useCallback)((()=>{l((e=>{const t=e.pageCandidates;if(!t)return(0,ca.i)(new Error("Got page candidate subscription error with uninitialized local pageCandidates array.")),e;const o=[...t],n=o.findIndex((e=>e.status===bg.LOADING));return-1===n?((0,ca.i)(new Error("Got page candidate subscription error with fully populated local pageCandidates array.")),e):(o[n]=Tg,{...e,pageCandidates:o})}))}),[l]),k=(0,a.useCallback)((e=>{l((t=>{const o=t.pageCandidates;if(!o)return(0,ca.i)(new Error("Got page candidate subscription update with uninitialized local pageCandidates array.")),t;const n=[...o],i=n.findIndex((e=>e.status===bg.LOADING));return-1===i?((0,ca.i)(new Error("Got page candidate subscription update with fully populated local pageCandidates array.")),t):(n[i]=e,{...t,pageCandidates:n})}))}),[l]),S=(0,a.useCallback)((e=>{switch(e){case G.w_2.Fatal:y(),s(Tp.B.GENERIC_ERROR);break;case G.w_2.PageCandidateGeneration:j();break;default:s(Tp.B.GENERIC_ERROR)}}),[y,s,j]),Z=(0,a.useCallback)((e=>{let{client:t,successCount:o,succeededCandidates:n}=e;0!==o&&Kg({client:t,inputString:C(),subscriptionId:m??Rn()(),succeededCandidates:n,tomeId:h})}),[C,m,h]),{data:R,loading:O}=(0,G.PfG)({variables:{limit:$g,id:h},skip:r!==Tp.q.SCOPED||!f}),M=(0,H.Z)(f)&&!f;let $;switch(r){case Tp.q.DELEGATE:return null;case Tp.q.ROOT:case Tp.q.SCOPED:$=(0,i.jsx)(Qm,{Icon:ng,commandHandler:P,scopedModeTopRowContent:(0,i.jsxs)(i.Fragment,{children:[m&&(0,i.jsx)(Rg,{subscriptionId:m,expectedUpdateCount:4,onError:S,onUpdate:k,onAllUpdatesReceived:Z},m),f&&!O&&(0,i.jsx)(Wg,{historyData:R,focusedPageId:p,lastInsertedPageId:u,setCommandState:l}),O&&(0,i.jsx)(Gg,{shownWithCandidates:!!c}),c&&(!f||O)&&(0,i.jsx)(d.E.div,{initial:{y:M?-28:0},animate:{y:0},transition:ep.c,children:(0,i.jsx)(Zg,{tomeId:h,pageCandidates:c,onEnter:E,onEscape:_,focusedPageId:p,onSelectCandidate:I,focusCommandPromptInput:o,shouldAutoSelectFirstCandidate:!p,resultsIdForAutoSelect:"",noFade:M,tooltipEnabled:!0})})]})})}return $},ControlStripComponent:bC,PassiveComponent:e=>{let{resetCommandPrompt:t,getCommandState:o}=e;const n=(0,r.sJ)(A.Vx),i=(0,a.useRef)(n),{apolloClient:l}=(0,L.bp)(),s=(0,fa.j)();return(0,a.useEffect)((()=>{if(n!==i.current){const e=o(od.mm.CREATE_PAGE_V2);t(),Ne.ZP.reportCreatePageCandidatesEvent({apolloClient:l,trackEventType:Ne.oX.PROMPT_RESET_ON_ACTIVE_PAGE_CHANGE,properties:{tomeId:s,pageId:i.current,operationId:e.subscriptionId}})}}),[n,l,o,t,s]),null},hasFallbackMode(e){let{input:t}=e;return t.length<zm},keywords:ll.ZP.t("commandPrompt.createPageV2.keywords",{returnObjects:!0})};var wC=(0,a.forwardRef)(((e,t)=>(0,i.jsxs)(ye.Z,{ref:t,viewBox:"0 0 64 64",...e,children:[(0,i.jsx)("path",{d:"M24 20C22.8954 20 22 20.8954 22 22C22 23.1046 22.8954 24 24 24H40C41.1046 24 42 23.1046 42 22C42 20.8954 41.1046 20 40 20H24Z"}),(0,i.jsx)("path",{d:"M22 30C22 28.8954 22.8954 28 24 28H40C41.1046 28 42 28.8954 42 30C42 31.1046 41.1046 32 40 32H24C22.8954 32 22 31.1046 22 30Z"}),(0,i.jsx)("path",{d:"M24 36C22.8954 36 22 36.8954 22 38C22 39.1046 22.8954 40 24 40H32C33.1046 40 34 39.1046 34 38C34 36.8954 33.1046 36 32 36H24Z"}),(0,i.jsx)("path",{fillRule:"evenodd",clipRule:"evenodd",d:"M22 8C17.5817 8 14 11.5817 14 16V48C14 52.4183 17.5817 56 22 56H42C46.4183 56 50 52.4183 50 48V16C50 11.5817 46.4183 8 42 8H22ZM22 12C19.7909 12 18 13.7909 18 16V48C18 50.2091 19.7909 52 22 52H42C44.2091 52 46 50.2091 46 48V16C46 13.7909 44.2091 12 42 12H22Z"})]})));var TC=e=>{let{Icon:t,onError:o,onProgress:n,onRetry:a,pageGenerationSubscriptionId:r,onGenerationComplete:l,commandHandler:s,scopedModeTitleRowAdditionalContent:d,getStatusContent:c,confirmExitScoped:u,tag:p}=e;const{mode:m,promptBackgroundRef:h,onComplete:g}=jm();switch(m){case Tp.q.DELEGATE:return(0,i.jsx)(Lm,{action:(0,i.jsx)(Hm,{onDismiss:g,onRetry:a,backgroundRef:h,shouldEnableOutlineClicks:!0}),completionState:gp.z.ACTION,getStatusContent:c,onGenerationComplete:l,onError:o,onProgress:n,pageGenerationSubscriptionId:r,"data-testid":"generative_command_generation_status"});case Tp.q.ROOT:case Tp.q.SCOPED:default:return(0,i.jsx)(Qm,{Icon:t,commandHandler:s,scopedModeTitleRowAdditionalContent:d,confirmExitScoped:u,tag:p})}};var IC=e=>{let{children:t,disabled:o}=e;const{t:n}=(0,C.$G)();return(0,i.jsx)($o.Z,{content:n("commandPrompt.docToTome.characterLimitNotReached",{min_chars_limit:zm}),placement:"top",delay:0,tooltipDisabled:o,children:(0,i.jsx)("div",{children:t})})};const PC=e=>{let{onError:t,onSubscriptionStart:o,makeCommandHandler:n,changePromptMode:i,tomeId:r}=e;const l=function(e){let{onError:t,onSubscriptionStart:o}=e;const[n]=(0,G.c_h)({onCompleted:e=>{var o,n;const i=null===(n=e)||void 0===n||null===(o=n.generateTomePagesFromDocument)||void 0===o?void 0:o.errorCode;i&&t(i)},onError:()=>{t(G.EaV.ApiError)}}),i=(0,a.useCallback)((e=>{let{prompt:t,tomeId:i}=e;const a=(0,da.Z)();o(a),n({variables:{artifactType:Om.PRESENTATION.getWireArtifactType(),prompt:t,imageStyle:Fm.AUTO.getWireImageStyle(),tomeId:i,requestId:a}})}),[n,o]);return i}({onSubscriptionStart:o,onError:t}),s=(0,a.useCallback)((e=>{let{jsonValue:t}=e;i(Tp.q.DELEGATE),l({prompt:JSON.stringify(t),tomeId:r})}),[i,l,r]),d=n(s);return{wrappedCommandHandler:(0,a.useCallback)((e=>{e.stringValue.length<zm||d(e)}),[d])}};var EC={id:od.mm.DOC_TO_TOME,title:ll.ZP.t("commandPrompt.docToTome.commandTitle"),placeholder:ll.ZP.t("commandPrompt.docToTome.commandPlaceholder"),Component:e=>{let{changePromptMode:t,tomeId:o,pageGenerationSubscriptionId:n,setCommandState:a,pageIdsToClearOnRetry:r}=e;const{onError:l,onProgress:s,onRetry:d,onSubscriptionStart:c,onGenerationComplete:u,makeCommandHandler:p}=Um({pageIdsToClearOnRetry:r,setCommandState:a,creditsOperation:Oo.Cw.DOC_TO_TOME}),{priceType:m}=(0,ys.Z)(),{wrappedCommandHandler:h}=PC({onError:l,onSubscriptionStart:c,makeCommandHandler:p,changePromptMode:t,tomeId:o}),g=(e=>{let{shouldShowBalance:t}=e;return e=>{let{numPagesGenerated:o,status:n}=e;switch(n){case gp.z.PROGRESS:return o<2?ll.ZP.t("commandPrompt.docToTome.generationProgress"):ll.ZP.t("commandPrompt.docToTome.generationProgress",{pageIndex:o+1,context:"pageIndex"});case gp.z.COMPLETE:case gp.z.ACTION:{const e=ll.ZP.t("commandPrompt.docToTome.generationComplete");return t?(0,i.jsx)(Nm,{text:e}):e}default:return""}}})({shouldShowBalance:null===m});return(0,i.jsx)(TC,{Icon:wC,getStatusContent:g,pageIdsToClearOnRetry:r,pageGenerationSubscriptionId:n,commandHandler:h,onError:l,onGenerationComplete:u,onProgress:s,onRetry:d,confirmExitScoped:!0,tag:dp.BETA})},hasFallbackMode(e){let{input:t}=e;return t.length>=zm},contentDependency:od.oq.EMPTY,ControlStripComponent:e=>{let{getInputJSON:t,getInputString:o,changePromptMode:n,setCommandState:r,pageIdsToClearOnRetry:l,tomeId:s}=e;const{t:d}=(0,C.$G)(),{onSubscriptionStart:c,makeCommandHandler:u,onError:p}=Um({pageIdsToClearOnRetry:l,setCommandState:r,creditsOperation:Oo.Cw.DOC_TO_TOME}),m=(0,a.useCallback)((e=>e.length<zm),[]),h=Km({getNewState:m}),{wrappedCommandHandler:g}=PC({onError:p,onSubscriptionStart:c,makeCommandHandler:u,changePromptMode:n,tomeId:s}),f=(0,a.useCallback)((()=>{g({jsonValue:t(),stringValue:o(),wasDirectlyInvoked:!1})}),[t,o,g]);return(0,i.jsx)(i.Fragment,{children:(0,i.jsx)(ep.oG,{style:{paddingTop:12,justifyContent:"flex-end"},children:(0,i.jsx)(IC,{disabled:!h,children:(0,i.jsx)(Yg,{dataTestId:"generate",onClick:f,disabled:h,children:d("commandPrompt.docToTome.generateButton")})})})})},featureFlag:D.TT.DOC_TO_TOME,keywords:ll.ZP.t("commandPrompt.docToTome.keywords",{returnObjects:!0})};var _C=(0,a.forwardRef)(((e,t)=>(0,i.jsxs)(ye.Z,{ref:t,viewBox:"0 0 64 64",...e,children:[(0,i.jsx)("path",{d:"M33.4142 8.58579C32.6332 7.80474 31.3668 7.80474 30.5858 8.58579L24.5858 14.5858C23.8047 15.3668 23.8047 16.6332 24.5858 17.4142C25.3668 18.1953 26.6332 18.1953 27.4142 17.4142L30 14.8284V34C30 35.1046 30.8954 36 32 36C33.1046 36 34 35.1046 34 34V14.8284L36.5858 17.4142C37.3668 18.1953 38.6332 18.1953 39.4142 17.4142C40.1953 16.6332 40.1953 15.3668 39.4142 14.5858L33.4142 8.58579Z"}),(0,i.jsx)("path",{d:"M22 22C17.5817 22 14 25.5817 14 30V46C14 50.4183 17.5817 54 22 54H42C46.4183 54 50 50.4183 50 46V30C50 25.5817 46.4183 22 42 22H40C38.8954 22 38 22.8954 38 24C38 25.1046 38.8954 26 40 26H42C44.2091 26 46 27.7909 46 30V46C46 48.2091 44.2091 50 42 50H22C19.7909 50 18 48.2091 18 46V30C18 27.7909 19.7909 26 22 26H24C25.1046 26 26 25.1046 26 24C26 22.8954 25.1046 22 24 22H22Z"})]})));var jC={id:od.mm.COPY_LINK,title:ll.ZP.t("commandPrompt.copyLink.commandTitle"),Component:e=>{let{tomeId:t}=e;const{t:o}=(0,C.$G)(),n=(0,Vm.Z)(),r=(0,a.useCallback)((()=>{var e;const i=null===(e=n(t))||void 0===e?void 0:e.canonicalUrl;if(i)try{Hl(i),(0,A.ak)({message:o("commandPrompt.copyLink.toastTextSuccess")})}catch{(0,A.ak)({message:o("commandPrompt.copyLink.toastTextFailure")})}}),[n,o,t]);return(0,i.jsx)(km,{Icon:_C,commandHandler:r})},keywords:ll.ZP.t("commandPrompt.copyLink.keywords",{returnObjects:!0})};var kC={id:od.mm.RENAME_TOME,title:ll.ZP.t("commandPrompt.renameTome.commandTitle"),Component:()=>{const{focusOnTitle:e}=bs();return(0,i.jsx)(km,{Icon:ud,commandHandler:e})},keywords:ll.ZP.t("commandPrompt.renameTome.keywords",{returnObjects:!0})};var SC={id:od.mm.UNDO,title:ll.ZP.t("commandPrompt.undo.commandTitle"),Component:()=>{const{undo:e}=(0,nd.C5)();return(0,i.jsx)(km,{Icon:fd.Z,commandHandler:e})},keywords:ll.ZP.t("commandPrompt.undo.keywords",{returnObjects:!0}),userContextFilter:()=>(0,nd.y4)()};const ZC=ll.ZP.t("commandPrompt.tiles.keywords",{returnObjects:!0});var RC=e=>{let{id:t,icon:o,title:n,tileType:r,keywords:l=[],additionalTileData:s={},afterAddTileAction:d=zn.B.NONE,featureFlag:c}=e;const u=z.qj.includes(r);return{id:t,title:n,Component:e=>{let{tomeId:t}=e;const n=ti({tomeId:t,shouldFocusInput:u,shouldSetPropertyPanel:!1}),l=(0,a.useCallback)((()=>{n({tileType:r,additionalTileData:s,afterAddTileAction:d})}),[n]);return(0,i.jsx)(km,{Icon:o,commandHandler:l})},keywords:l.concat(ZC),featureFlag:c}};var OC=function(e,t,o,n){return{id:e,title:o,Component:()=>{const e=(0,E.t2)(),o=(0,a.useCallback)((()=>{e.setPropertyPanel(n)}),[e]);return(0,i.jsx)(km,{Icon:t,commandHandler:o})},keywords:arguments.length>4&&void 0!==arguments[4]?arguments[4]:[]}},MC=o(28201);const $C=ll.ZP.t("commandPrompt.help.keywords",{returnObjects:!0});var LC=function(e,t,o,n){return{id:e,title:o,Component:()=>{const e=(0,a.useCallback)((()=>{window.open(n,"_blank")}),[]);return(0,i.jsx)(km,{ActionIcon:MC.Z,Icon:t,commandHandler:e})},keywords:(arguments.length>4&&void 0!==arguments[4]?arguments[4]:[]).concat($C)}};var AC={id:od.mm.SHARE,title:ll.ZP.t("commandPrompt.share.commandTitle"),Component:()=>{const e=(0,r.Zl)(A.B8),t=(0,a.useCallback)((()=>{e(!0)}),[e]);return(0,i.jsx)(km,{Icon:_C,commandHandler:t})},keywords:ll.ZP.t("commandPrompt.share.keywords",{returnObjects:!0})};var NC={id:od.mm.CHAT,title:ll.ZP.t("commandPrompt.help.chat.commandTitle"),Component:()=>{const e=(0,a.useCallback)((()=>{var e,t;null===(e=(t=window).Intercom)||void 0===e||e.call(t,"show")}),[]);return(0,i.jsx)(km,{Icon:Ws.Z,commandHandler:e})},keywords:ll.ZP.t("commandPrompt.help.chat.keywords",{returnObjects:!0})};var DC={id:od.mm.REDO,title:ll.ZP.t("commandPrompt.redo.commandTitle"),Component:()=>{const{redo:e}=(0,nd.C5)();return(0,i.jsx)(km,{Icon:xd.Z,commandHandler:e})},keywords:ll.ZP.t("commandPrompt.redo.keywords",{returnObjects:!0}),userContextFilter:()=>(0,nd.oC)()};function BC(e){return[{id:(0,da.Z)(),title:"",pageTypes:[],pageGoal:""},...Array.from(Array(e)).map((()=>({id:(0,da.Z)(),title:"",pageTypes:[],pageGoal:""})))]}const HC=g.ZP.div.withConfig({displayName:"ReorderableOutlineItem__OutlineItemNumberLabel",componentId:"sc-732fcc33-0"})`
  color: ${e=>{let{theme:t}=e;return t.colors.numberTextColor}};
  font-size: ${e=>{let{theme:t}=e;return t.fontSizes.xxs}};
  width: 28px;
  text-align: center;
  flex-shrink: 0;
`,VC=(0,g.ZP)(d.E.div).withConfig({displayName:"ReorderableOutlineItem__OutlineItem",componentId:"sc-732fcc33-1"})`
  background-color: ${e=>{let{theme:t}=e;return t.colors.outlineEditorFieldBackgroundColor}};
  border-radius: ${e=>{let{theme:t}=e;return t.borderRadius.sm}};
  display: flex;
  align-items: center;
  padding: 2px 0;
  height: ${44}px;
  z-index: ${e=>{let{$isDragging:t}=e;return t?1:0}};
  box-shadow: ${e=>{let{$isDragging:t,theme:o}=e;return t?o.colors.outlineEditorItemDraggingBoxShadow:o.colors.outlineEditorItemBoxShadow}};

  transition: box-shadow 0.2s ease;

  &:hover button {
    // when outline item is hovered and outline item isn't being dragged, show child buttons
    opacity: ${e=>{let{$isDragging:t}=e;return t?0:1}};
  }
`,FC=(0,g.ZP)(d.E.input).withConfig({displayName:"ReorderableOutlineItem__OutlineItemInput",componentId:"sc-732fcc33-2"})`
  appearance: none;
  border: none;
  box-shadow: none;
  outline: none;
  caret-color: ${e=>{let{theme:t,$atMaxLength:o}=e;return o?t.colors.errorText:t.colors.uiAccent}};
  background-color: transparent;
  width: 100%;
  font-size: ${e=>{let{theme:t}=e;return t.fontSizes.smmd}};
  color: ${e=>{let{theme:t}=e;return t.colors.outlineEditorTextColorBlurred}};
  text-rendering: optimizeLegibility;
  -webkit-font-smoothing: antialiased;

  &:focus {
    color: ${e=>{let{theme:t}=e;return t.colors.outlineEditorTextColorFocused}};
  }

  ::selection {
    background-color: ${e=>e.theme.colors.textSelection};
  }
`,GC=(0,g.ZP)((0,d.E)(Ie.Z)).withConfig({displayName:"ReorderableOutlineItem__AddDeleteButton",componentId:"sc-732fcc33-3"})`
  border-radius: ${e=>{let{theme:t}=e;return t.borderRadius.xs}};
  display: flex;
  align-items: center;
  justify-content: center;
  width: ${26}px;
  height: ${26}px;
  opacity: 0;
  transition: opacity 0.2s ease, background-color 0.2s ease;
  margin-right: 6px;

  & > svg {
    fill: ${e=>{let{theme:t}=e;return t.colors.outlineEditorAddDeleteSVGFill}};
    width: ${22}px;
    height: ${22}px;
    transition: fill 0.2s ease;
  }

  &:hover > svg {
    fill: ${e=>{let{theme:t}=e;return t.colors.outlineEditorAddDeleteSVGHoverFill}};
  }

  &:hover {
    background-color: ${e=>{let{theme:t}=e;return t.colors.outlineEditorAddDeleteHoverBackground}};
  }
`,UC=(0,g.ZP)(d.E.div).withConfig({displayName:"ReorderableOutlineItem__OutlineDraggableHandleWrapper",componentId:"sc-732fcc33-4"})`
  width: ${30}px;
  height: ${44}px;
  // center OutlineDraggableHandle within OutlineDraggableHandleWrapper
  display: flex;
  justify-content: flex-start;
  align-items: center;
  cursor: grab;
`,zC=(0,g.ZP)(uh).withConfig({displayName:"ReorderableOutlineItem__OutlineDraggableHandle",componentId:"sc-732fcc33-5"})`
  width: ${22}px;
  height: ${22}px;
  fill: ${e=>{let{theme:t}=e;return t.colors.outlineContentDraggableHandleColor}};
`,WC=(0,g.ZP)(d.E.div).withConfig({displayName:"ReorderableOutlineItem__UserControlsWrapper",componentId:"sc-732fcc33-6"})`
  display: flex;
  align-items: center;
  margin-left: auto;
`;var KC=(0,a.forwardRef)(((e,t)=>{let{value:o,index:n,dragConstraintsRef:r,setOutlineContent:l,outlineContent:s,isLoading:d,canAddOutlineItem:c,maxInputLength:u,showMaxLengthToastIfNecessary:p,onBlur:m,onFocus:h,makeOnKeyDown:g,reportTomeAnalytics:C}=e;const f=(0,O.o)(),[x,v]=(0,a.useState)(!1),b=s.length>1,y=()=>{if(!b)return;const e=[...s];e.splice(n,1),l(e),C(Ne.vg.CLICK_DELETE)},w=g({currentId:o.id,onDeleteCurrent:y}),T=(0,H.Z)(d)&&!d,I=.1*n;let P=0;d?P=.1+I:T&&(P=.2+I);let E=0;d?E=.1+I:T&&(E=.3+I);const _={duration:.2,delay:P},j={duration:.2,delay:E},k=n===s.length-1,S=!d&&k?{opacity:0,y:"-52px"}:{opacity:0,y:0},Z=d?{opacity:.75,y:0}:{opacity:1,y:0},R=d?{opacity:0}:{opacity:1},M=k?0:"8px";return(0,i.jsx)(eh.t.Item,{value:o,dragListener:!1,dragControls:f,dragConstraints:r,dragElastic:.2,onDragStart:()=>{v(!0)},onDragEnd:()=>{v(!1)},style:{position:"relative",marginBottom:M},whileDrag:{zIndex:1},children:(0,i.jsxs)(VC,{$isDragging:x,initial:S,animate:Z,transition:j,children:[(0,i.jsx)(HC,{children:n+1}),(0,i.jsx)(FC,{autoFocus:!0,$atMaxLength:o.title.length===u,maxLength:u,disabled:d,value:o.title,onChange:e=>{const t=e.target.value,o=[...s],i={id:o[n].id,pageTypes:o[n].pageTypes,title:t,pageGoal:o[n].pageGoal};o[n]=i,l(o),C(Ne.vg.EDIT_ITEM),p(t.length)},onFocus:h,initial:!1,animate:R,transition:_,onBlur:m,onKeyDown:w,ref:t,"data-testid":`outline_item_${n}_input`}),(0,i.jsxs)(WC,{initial:!1,animate:R,transition:_,children:[b&&(0,i.jsx)(GC,{onClick:y,whileTap:{scale:.9},"data-testid":`outline_item_${n}_delete_button`,children:(0,i.jsx)(Qe,{})}),c&&(0,i.jsx)(GC,{onClick:()=>{const e=[...s];e.splice(n+1,0,{title:"",id:(0,da.Z)(),pageTypes:[],pageGoal:""}),l(e),C(Ne.vg.CLICK_ADD)},whileTap:{scale:.9},children:(0,i.jsx)(Xe.Z,{})}),b&&(0,i.jsxs)(UC,{onPointerDown:e=>f.start(e),children:[(0,i.jsx)(zC,{}),x&&(0,i.jsx)(xt.Z,{})]})]})]})})}));const qC={listStyle:"none",padding:0,margin:0},YC={type:"tween",ease:"easeOut",duration:.3},JC="titleInput",XC=g.ZP.div.withConfig({displayName:"GenerativeOutlineEditor__Container",componentId:"sc-1279fad4-0"})`
  width: ${ep.Wu}px;
`,QC=(0,g.ZP)(d.E.div).withConfig({displayName:"GenerativeOutlineEditor__EditorFields",componentId:"sc-1279fad4-1"})`
  display: flex;
  flex-direction: column;
  width: 100%;
  padding: ${ih}px;
  max-height: calc(
    100vh - 2 * ${ep.Pq}px - ${52}px
  );
  overflow-y: auto;
  position: relative;
`,ef=(0,g.ZP)(d.E.div).withConfig({displayName:"GenerativeOutlineEditor__TitleWrapper",componentId:"sc-1279fad4-2"})`
  background-color: ${e=>{let{theme:t}=e;return t.colors.outlineEditorFieldBackgroundColor}};
  border-radius: ${e=>{let{theme:t}=e;return t.borderRadius.sm}};
  height: 98px;
  padding: 12px;
  padding-top: 8px;
  margin-bottom: 8px;
`,tf=(0,g.ZP)(d.E.div).withConfig({displayName:"GenerativeOutlineEditor__TitlePlaceholder",componentId:"sc-1279fad4-3"})`
  font-size: ${20}px;
  line-height: ${28}px;
  color: ${e=>{let{theme:t}=e;return t.colors.outlineEditorTextColorPlaceholder}};
  display: flex;
  gap: 2px;
  align-items: baseline;
`,of=(0,g.ZP)(d.E.div).withConfig({displayName:"GenerativeOutlineEditor__TitleLabel",componentId:"sc-1279fad4-4"})`
  margin-bottom: ${6}px;
  font-size: ${e=>{let{theme:t}=e;return t.fontSizes.sm}};
  line-height: ${16}px;
  color: ${e=>{let{theme:t}=e;return t.colors.outlineEditorTitleLabel}};
`,nf=(0,g.ZP)(d.E.textarea).withConfig({displayName:"GenerativeOutlineEditor__TitleInput",componentId:"sc-1279fad4-5"})`
  appearance: none;
  border: none;
  box-shadow: none;
  outline: none;
  resize: none;
  caret-color: ${e=>{let{theme:t,$atMaxLength:o}=e;return o?t.colors.errorText:t.colors.uiAccent}};
  background-color: transparent;
  width: 100%;
  font-size: ${20}px;
  line-height: ${28}px;
  color: ${e=>{let{theme:t}=e;return t.colors.outlineEditorTextColorBlurred}};
  text-rendering: optimizeLegibility;
  -webkit-font-smoothing: antialiased;

  &:focus {
    color: ${e=>{let{theme:t}=e;return t.colors.outlineEditorTextColorFocused}};
  }

  ::selection {
    background-color: ${e=>e.theme.colors.textSelection};
  }
`,af=(0,g.ZP)((0,d.E)(Re.ZP)).withConfig({displayName:"GenerativeOutlineEditor__RegenerateButton",componentId:"sc-1279fad4-6"})`
  margin-right: 8px;
  min-width: 28px;
  width: 28px;
  height: 28px;
  padding: 0;
`,rf=(0,g.ZP)(Re.ZP).withConfig({displayName:"GenerativeOutlineEditor__SubmitButton",componentId:"sc-1279fad4-7"})`
  margin-right: ${ih}px;
`;function lf(e){let{changePromptMode:t,isLoading:o,onSubmit:n,onRegenerate:r,titleAndOutlineContent:l,setTitleAndOutlineContent:s,setTomeTitle:d,tomeTitle:c,backgroundRef:u,onClickOutside:p,reportTomeAnalytics:m,maxContentLength:h}=e;var g;const{t:f}=(0,C.$G)();(0,Lp.Z)(u,p);const x=null!=l&&l.some((e=>{let{title:t}=e;return t&&t.length>0})),v=null!=c&&c.length>0,b=!o&&v&&x,y=(0,a.useRef)(null),w=o?{opacity:.75}:{opacity:1},T=o?{opacity:1}:{opacity:0},I=o?{opacity:0}:{opacity:1},P=(0,D.W9)(D.TT.GENERATIVE_OUTLINE_EDITOR_INPUT_MAX_LENGTH),E=((null===(g=c)||void 0===g?void 0:g.length)??0)===P,_=e=>{e===P&&(0,A.ak)({message:f("commandPrompt.outlineEditor.maxLengthToast",{maxLength:P})})},[j,...k]=l??BC(0),{setGlobalKeyBindingsRef:S,setInputByIdRef:Z,focusFirstInput:R,focusGlobalKeybindings:O,focusNextInput:M,focusPreviousInput:$,onInputBlur:L,onInputFocus:N}=dh({orderedInputIds:[JC,...(k??[]).map((e=>e.id))]}),B=(0,Xt.Z)(((e,t)=>{let{currentId:o,onDeleteCurrent:n}=e;if("Enter"===t.key)O();else if("Escape"===t.key)O();else if("Tab"===t.key&&t.shiftKey)t.preventDefault(),$(o);else if("Tab"!==t.key||t.shiftKey){if(("Del"===t.key||"Backspace"===t.key)&&n){0===t.target.value.length&&(n(),O())}}else t.preventDefault(),M(o)}),[O,M,$]),H=(0,a.useCallback)((()=>{b&&n()}),[b,n]),V=(0,a.useCallback)((()=>{m(Ne.vg.ESCAPE_BACK),t(Tp.q.SCOPED)}),[t,m]),F=(0,a.useCallback)((e=>{e.preventDefault(),R()}),[R]),G=(0,a.useMemo)((()=>{const e=new Map;return e.set("enter",H),e.set("escape",V),e.set("tab",F),e}),[H,V,F]),U=(0,a.useCallback)((()=>{m(Ne.vg.CLICK_BACK),t(Tp.q.SCOPED)}),[t,m]),z=(0,a.useCallback)((e=>{s([j,...e])}),[s,j]),W=(0,a.useCallback)((e=>{z(e),m(Ne.vg.REORDER_ITEM)}),[m,z]),K=(0,a.useCallback)((()=>{r();try{var e;null===(e=y.current)||void 0===e||e.scrollTo({behavior:"smooth",top:0})}catch{var t;null===(t=y.current)||void 0===t||t.scrollTo({top:0})}}),[r]),q=f("commandPrompt.outlineEditor.regenerateButtonTooltip");return(0,i.jsx)(Nu.G,{bindings:G,ref:S,children:(0,i.jsxs)(XC,{children:[(0,i.jsxs)(QC,{layoutScroll:!0,children:[(0,i.jsxs)(ef,{initial:{opacity:0},animate:w,transition:ep.c,layout:!0,children:[(0,i.jsxs)(tf,{"aria-hidden":!o,initial:!1,animate:T,transition:YC,children:[f("commandPrompt.outlineEditor.titlePlaceholder"),(0,i.jsx)(nh,{gap:4,size:3})]}),(0,i.jsx)(of,{"aria-hidden":o,initial:!1,animate:I,style:{y:-28},transition:YC,children:f("commandPrompt.outlineEditor.titleLabel")}),(0,i.jsx)(nf,{"aria-hidden":o,ref:Z(JC),maxLength:P,disabled:o,rows:2,onChange:e=>{const t=e.target.value;d(t),m(Ne.vg.EDIT_TITLE),_(t.length)},"data-testid":"outline_editor_title_input",onBlur:L,onFocus:N,onKeyDown:B({currentId:JC}),value:c,$atMaxLength:E,initial:!1,animate:I,style:{y:-28},transition:YC})]}),(0,i.jsx)("div",{ref:y,children:k&&(0,i.jsx)(eh.t.Group,{as:"ol",axis:"y",onReorder:W,values:k,style:qC,transition:ep.c,children:k.map(((e,t)=>(0,i.jsx)(KC,{ref:Z(e.id),value:e,index:t,dragConstraintsRef:y,setOutlineContent:z,outlineContent:k,isLoading:o,canAddOutlineItem:k.length<h,onBlur:L,onFocus:N,makeOnKeyDown:B,maxInputLength:P,showMaxLengthToastIfNecessary:_,reportTomeAnalytics:m},e.id)))})})]}),(0,i.jsx)(rh,{title:f("commandPrompt.autotome.commandTitle"),onClick:U,rightContent:(0,i.jsxs)(i.Fragment,{children:[(0,i.jsx)($o.Z,{content:q,placement:"top",children:(0,i.jsx)(af,{"aria-label":q,size:"smallMedium",disabled:!b,onClick:K,children:(0,i.jsx)(th,{style:{width:"20px",height:"20px"}})})}),(0,i.jsx)(rf,{color:"primary",disabled:!b,onClick:n,"data-testid":"outline_editor_submit_button",size:"smallMedium",children:f("commandPrompt.outlineEditor.submitButton")})]})})]})})}const sf="NOT IMPLEMENTED";var df=e=>{let{subscriptionId:t,expectedUpdateCount:o,onUpdate:n,onError:r,onAllUpdatesReceived:l}=e;const s=(0,a.useRef)(0),d=(0,a.useRef)(0),c=(0,a.useRef)([]);return(0,G.Wqq)({variables:{subscriptionId:t},onData(e){let{client:t,data:i}=e;var a,u;const p=null===(u=i)||void 0===u||null===(a=u.data)||void 0===a?void 0:a.generateAutotomePageCandidatesStatus;p&&("AutotomePageCandidate"===p.__typename?(s.current+=1,c.current.push({pageId:p.candidate,pageGoal:sf}),n({status:bg.COMPLETE,pageId:p.candidate,pageGoal:sf})):"GenerateAutotomePageCandidatesErrorStatus"===p.__typename&&(d.current+=1,r(p.errorCode)),s.current+d.current===o&&l({client:t,successCount:s.current,succeededCandidates:c.current}))}}),(0,i.jsx)(i.Fragment,{})};const cf=new Set([Ne.vg.EDIT_TITLE,Ne.vg.EDIT_ITEM,Ne.vg.REORDER_ITEM,Ne.vg.CLICK_ADD,Ne.vg.CLICK_DELETE]);var uf=e=>{let{tomeId:t,setCommandState:o,analyticsAlreadyReported:n,outlineResponse:i,localTitleAndOutlineContent:r,pageCount:l,changePromptMode:s,setErrorCode:d,setShowOverlayAndBlockKeys:c}=e;var u;const{apolloClient:p}=(0,L.bp)(),{checkForSufficientCreditsOperation:m}=(0,Oo.KW)(),h=(0,a.useCallback)(((e,a)=>{var r;const[l,s]=function(e,t){var o;if(!cf.has(e))return[!1,void 0];const n={reportedNamesSet:(null===(o=t)||void 0===o?void 0:o.reportedNamesSet)??new Set};return n.reportedNamesSet.has(e)?[!0,void 0]:(n.reportedNamesSet.add(e),[!1,n])}(e,n);l||(s&&o({analyticsAlreadyReported:s}),Ne.ZP.reportOutlineEditorEvent({apolloClient:p,trackEventType:e,properties:{tomeId:t,operationId:a??(null===(r=i)||void 0===r?void 0:r.operationId)??"operationId undefined"}}))}),[n,p,null===(u=i)||void 0===u?void 0:u.operationId,o,t]),g=(0,a.useCallback)((e=>{const t=[{id:0,title:e.tomeTitle,pageTypes:e.tomeTitlePageTypes,pageGoal:"Provide a cover page for the presentation"},...e.outlineContent],n=function(e,t){var o,n;const[i,...a]=t;return[{...i,id:(null===(n=e)||void 0===n||null===(o=n[0])||void 0===o?void 0:o.id)??(0,da.Z)()},...a.map(((t,o)=>{var n,i;return{...t,id:(null===(i=e)||void 0===i||null===(n=i[o+1])||void 0===n?void 0:n.id)??(0,da.Z)()}}))]}(r,t);h(Ne.vg.OUTLINE_GENERATED,e.operationId),o({localTitleAndOutlineContent:n,outlineResponse:{operationId:e.operationId,tomeSummary:e.tomeSummary,originalTitleAndOutlineContent:n},analyticsAlreadyReported:{reportedNamesSet:new Set},tomeTitle:e.tomeTitle,isLoadingOutline:!1})}),[r,h,o]),C=(0,a.useCallback)((e=>{switch(e){case G.PAN.InsufficientCredits:var t;null===(t=d)||void 0===t||t(Tp.B.GENERIC_ERROR);break;case G.PAN.FlaggedByModeration:var o;null===(o=d)||void 0===o||o(Tp.B.OUT_OF_MODERATION_ERROR);break;default:var n;null===(n=d)||void 0===n||n(Tp.B.GENERIC_ERROR)}c(!1),s(Tp.q.SCOPED)}),[s,d,c]),[f]=(0,G.Fel)({onCompleted:e=>{var t;switch(null===(t=e.generateOutlineV3)||void 0===t?void 0:t.__typename){case"GenerateOutlineV3SuccessResponse":g(e.generateOutlineV3);break;case"GenerateOutlineV3ErrorResponse":C(e.generateOutlineV3.errorCode);break;default:C(void 0)}},onError:()=>{C(void 0)}}),x=(0,a.useCallback)((e=>{let{inputPrompt:o,numberOfPagesRequested:n}=e;const i=Rn()();return f({variables:{inputPrompt:o,numberOfPagesRequested:n,tomeId:t,operationId:i}})}),[f,t]);return{submitPrompt:(0,a.useCallback)((e=>{m(Oo.Cw.AUTO_TOME,(()=>{o({localTitleAndOutlineContent:BC(l??6),isLoadingOutline:!0}),x({inputPrompt:e.stringValue,numberOfPagesRequested:l??6,tomeId:t}),s(Tp.q.DELEGATE)}))}),[m,o,l,x,t,s]),generateOutline:x,reportTomeAnalytics:h,checkForSufficientCreditsOperation:m}};const pf=e=>e.length<1;var mf=e=>{let{tomeId:t,setCommandState:o,outlineResponse:n,localTitleAndOutlineContent:r,pageCount:l,changePromptMode:s,focusInput:d,getInputString:c,getInputJSON:u,setErrorCode:p,setShowOverlayAndBlockKeys:m}=e;const{t:h}=(0,C.$G)(),{submitPrompt:g}=uf({tomeId:t,setCommandState:o,outlineResponse:n,localTitleAndOutlineContent:r,pageCount:l,changePromptMode:s,setErrorCode:p,setShowOverlayAndBlockKeys:m}),f=(0,a.useCallback)((()=>{const e={stringValue:c(),jsonValue:u(),wasDirectlyInvoked:!1};g(e)}),[u,c,g]),x=Km({getNewState:pf}),v=(0,a.useCallback)((e=>h("commandPrompt.autotome.pageCount",{count:e})),[h]),b=(0,a.useCallback)((e=>{o({pageCount:e})}),[o]);return(0,i.jsxs)(ep.oG,{children:[(0,i.jsx)(Jh,{Icon:Mm,getCountLabel:v,focusInput:d,setCount:b,count:l??6,min:1,max:25}),(0,i.jsx)(Yg,{onClick:f,disabled:x,dataTestId:"autotome_v3_generate_button",children:h("commandPrompt.createPageV2.generateButtonLabel")})]})};const hf=(0,g.ZP)(d.E.div).withConfig({displayName:"CandidateNavigation__ButtonLabel",componentId:"sc-bdc3900d-0"})``,gf=(0,g.ZP)(d.E.div).withConfig({displayName:"CandidateNavigation__ButtonContent",componentId:"sc-bdc3900d-1"})`
  display: flex;
  max-width: 100%;
  align-items: center;
`,Cf=(0,g.ZP)((0,d.E)(Re.ZP)).withConfig({displayName:"CandidateNavigation__CloseButton",componentId:"sc-bdc3900d-2"})`
  min-height: 24px;
  min-width: 24px;
  height: 24px;
  width: 24px;
  padding: 0;
  margin: 0;
`,ff=(0,g.ZP)((0,d.E)(Re.ZP)).withConfig({displayName:"CandidateNavigation__NextPageButton",componentId:"sc-bdc3900d-3"})`
  min-height: 26px;
  height: 26px;
  padding-right: 6px;
`,xf=(0,g.ZP)((0,d.E)(Re.ZP)).withConfig({displayName:"CandidateNavigation__DoneButton",componentId:"sc-bdc3900d-4"})`
  min-height: 26px;
  height: 26px;
  padding-right: 6px;
`,vf=(0,g.ZP)(d.E.div).withConfig({displayName:"CandidateNavigation__CommandTopControlsGroup",componentId:"sc-bdc3900d-5"})`
  width: 100%;
  display: flex;
  flex-direction: row;
  justify-content: space-between;
  gap: 10px;
  padding: 8px 12px;
`,bf=(0,g.ZP)(d.E.div).withConfig({displayName:"CandidateNavigation__ControlStripInDelegateMode",componentId:"sc-bdc3900d-6"})`
  width: 100%;
  display: flex;
  flex-direction: row;
  justify-content: space-between;
  gap: 10px;
  padding: 12px;
`,yf=g.ZP.div.withConfig({displayName:"CandidateNavigation__CustomCandidatePicker",componentId:"sc-bdc3900d-7"})`
  ${fg} {
    padding: 0 12px;
  }
`,wf=(0,g.ZP)(d.E.div).withConfig({displayName:"CandidateNavigation__ChooseLayoutLabel",componentId:"sc-bdc3900d-8"})`
  display: flex;
  align-items: center;
  font-size: ${e=>{let{theme:t}=e;return t.fontSizes.sm}};
  color: ${e=>{let{theme:t}=e;return t.colors.pageLabel}};
`,Tf=(0,g.ZP)(d.E.div).withConfig({displayName:"CandidateNavigation__PageLabel",componentId:"sc-bdc3900d-9"})`
  display: flex;
  align-items: center;
  justify-content: center;
  font-size: ${e=>{let{theme:t}=e;return t.fontSizes.sm}};
  color: ${e=>{let{theme:t}=e;return t.colors.pageLabel}};
  white-space: nowrap;
`,If=g.ZP.div.withConfig({displayName:"CandidateNavigation__PageTitleContainer",componentId:"sc-bdc3900d-10"})`
  display: flex;
  align-items: center;
`,Pf=g.ZP.div.withConfig({displayName:"CandidateNavigation__PageTitle",componentId:"sc-bdc3900d-11"})`
  // Width must be set here to allow for truncation
  width: 475px;

  color: ${e=>{let{theme:t}=e;return t.colors.candidatePickerPageTitle}};
  font-size: ${e=>{let{theme:t}=e;return t.fontSizes.sm}};
  ${te.wR};
`,Ef=g.ZP.div.withConfig({displayName:"CandidateNavigation__LeftControlGroup",componentId:"sc-bdc3900d-12"})`
  display: flex;
  gap: 10px;
`,_f=g.ZP.div.withConfig({displayName:"CandidateNavigation__TwoLineStatus",componentId:"sc-bdc3900d-13"})`
  display: flex;
  flex-direction: column;
  gap: 2px;
`,jf=g.ZP.div.withConfig({displayName:"CandidateNavigation__LineTitle",componentId:"sc-bdc3900d-14"})`
  height: 21px;
  white-space: nowrap;
  text-overflow: ellipsis;
  overflow: hidden;
  line-height: normal;
`,kf=g.ZP.div.withConfig({displayName:"CandidateNavigation__LineDescription",componentId:"sc-bdc3900d-15"})`
  height: 21px;
  color: ${e=>{let{theme:t}=e;return t.colors.commandPromptControlText}};
  white-space: nowrap;
  text-overflow: ellipsis;
  overflow: hidden;
  line-height: normal;
`;var Sf,Zf=e=>{let{onCloseBehavior:t,promptBackgroundRef:o,onDoneButtonClick:n,setShowOverlayAndBlockKeys:l,onSelectCandidate:s,tomeId:d,outlinePageIndex:c,pageCandidates:u,focusedPageId:p,focusInput:m,titleAndOutlineContent:h,submitOutlineIndexToGeneratePage:g,resultsIdForAutoSelectRef:f,backgroundRef:x,onClickOutside:v}=e;var b,y,w;const{apolloClient:T,clientId:I}=(0,L.bp)(),{t:P}=(0,C.$G)();(0,Lp.Z)(x,v);const E=(null===(b=u)||void 0===b?void 0:b.some((e=>e.status===bg.COMPLETE)))??!1,_=P("commandPrompt.autotomeV3.currentPageNumberLabel",{pageNumber:c,pageCount:((null===(y=h)||void 0===y?void 0:y.length)??0)-1}),j=P("commandPrompt.autotomeV3.titlePageLabel"),k=c>0?_:j,S=(0,r.Zl)(A.Vx),Z=(0,Vm.Z)(),R=(0,r._8)((e=>{let{snapshot:t}=e;return()=>{const e=Z(d);if(e){var o;const n=t.getLoadable(A.Vx).getValue(),i=(0,N.xh)(e.pages,n),a=null===i?(null===(o=e.pages)||void 0===o?void 0:o.length)||0:i+1,{pageId:r}=(0,Fc.Vy)(e,a,T,I);S(r)}g(c+1)()}}),[T,I,Z,c,S,g,d]),O=!!(h&&c+1>=h.length),M=(0,a.useCallback)((()=>{O?n():t()}),[O,t,n]),$=(0,a.useCallback)((e=>{"Escape"===e.key&&(e.preventDefault(),e.stopPropagation(),M())}),[M]);(0,a.useEffect)((()=>(document.addEventListener("keydown",$,{capture:!0}),()=>{document.removeEventListener("keydown",$,{capture:!0})})),[$]);const{outlineRef:D,addPageRef:B}=(0,L.TR)(),H=(0,a.useCallback)((e=>{var t,o;e.target instanceof HTMLElement&&((null===(t=D.current)||void 0===t?void 0:t.contains(e.target))||(null===(o=B.current)||void 0===o?void 0:o.contains(e.target)))&&(e.preventDefault(),e.stopPropagation(),M())}),[D,B,M]);(0,Lp.Z)(o,H,{addListenerOptions:{capture:!0}});const{exclusiveSelectTiles:F}=(0,V.N4)(),{getActiveController:G}=(0,a.useContext)(X.Z),[U,z]=(0,a.useState)(!1),W=(0,a.useCallback)((()=>{const e=G();if(e){var t;const o=e.orderedTileIDs;(null===(t=o)||void 0===t?void 0:t.length)>0&&F([o[0]])}l(!0),z(!0),setTimeout((()=>{l(!1),n(),z(!1)}),3e3)}),[F,G,n,l]),K=!p||!u||!u.find((e=>e.status===bg.COMPLETE&&e.pageId===p)),q=null===(w=h)||void 0===w?void 0:w[c],Y=!E||O;return U?(0,i.jsx)(yp,{content:(0,i.jsxs)(_f,{children:[(0,i.jsx)(jf,{children:P("commandPrompt.autotomeV3.doneStatusTitle")}),(0,i.jsx)(kf,{children:P("commandPrompt.autotomeV3.doneStatusDescription")})]}),status:gp.z.COMPLETE}):(0,i.jsxs)(i.Fragment,{children:[(0,i.jsxs)(vf,{children:[(0,i.jsx)(wf,{children:P("commandPrompt.autotomeV3.chooseLayoutLabel")}),(0,i.jsx)(Cf,{onClick:M,size:"small",variant:"uncontained",children:(0,i.jsx)(ft.Z,{style:{width:22,height:22}})})]}),u&&(0,i.jsx)(yf,{children:(0,i.jsx)(Zg,{tomeId:d,pageCandidates:u,onEnter:lm.Z,onEscape:lm.Z,focusedPageId:p,onSelectCandidate:s,focusCommandPromptInput:m,shouldAutoSelectFirstCandidate:K,resultsIdForAutoSelect:f.current,tooltipEnabled:!1})}),(0,i.jsxs)(bf,{children:[(0,i.jsxs)(Ef,{children:[(0,i.jsx)(Tf,{children:k}),q&&q.title.length>0&&(0,i.jsx)(If,{children:(0,i.jsx)(Pf,{children:q.title})})]}),!O&&(0,i.jsx)(ff,{onClick:R,color:"primary",size:"small",disabled:Y,endIcon:(0,i.jsx)(hr.Z,{style:{width:18,height:18,fill:"currentcolor"}}),iconOpacity:Y?Re.qX:1,children:(0,i.jsx)(gf,{children:(0,i.jsx)(hf,{children:P("commandPrompt.autotomeV3.nextPageButtonLabel")})})}),O&&(0,i.jsx)(xf,{onClick:W,color:"primary",size:"small",disabled:!E,endIcon:(0,i.jsx)(Fo.Z,{style:{width:18,height:18,fill:"currentcolor"}}),iconOpacity:E?1:Re.qX,children:(0,i.jsx)(gf,{children:(0,i.jsx)(hf,{children:P("commandPrompt.autotomeV3.doneButtonLabel")})})})]})]})};!function(e){e.PUBLIC_TURBO="PUBLIC_TURBO",e.FOUNDRY_TURBO="FOUNDRY_TURBO",e.PARALLEL_PAGES_PUBLIC_TURBO="PARALLEL_PAGES_PUBLIC_TURBO",e.PARALLEL_PAGES_FOUNDRY_TURBO="PARALLEL_PAGES_FOUNDRY_TURBO"}(Sf||(Sf={}));const Rf=new Set([Sf.PARALLEL_PAGES_FOUNDRY_TURBO,Sf.PARALLEL_PAGES_PUBLIC_TURBO]);var Of={id:od.mm.AUTOTOME_V3,title:ll.ZP.t("commandPrompt.autotomeV3.commandTitle"),featureFlag:D.TT.AUTOTOME_V3,placeholder:ll.ZP.t("commandPrompt.autotome.commandPlaceholder"),contentDependency:od.oq.EMPTY,Component:e=>{let{tomeId:t,getInputString:o,setCommandState:n,mode:r,promptBackgroundRef:l,localTitleAndOutlineContent:s,outlineResponse:d,analyticsAlreadyReported:c,tomeTitle:u,changePromptMode:p,onComplete:m,isLoadingOutline:h,closeCommandPrompt:g,focusInput:C,pageCount:f,outlinePageIndex:x,subscriptionId:b,pageCandidates:y,lastInsertedPageId:w,focusedPageId:T,setErrorCode:I,setShowOverlayAndBlockKeys:P}=e;var E,_;const j=(0,a.useCallback)((e=>{n({localTitleAndOutlineContent:e})}),[n]),k=(0,a.useCallback)((e=>{n((t=>{const o={...t,tomeTitle:e};if(!t.localTitleAndOutlineContent)return o;const[n,...i]=t.localTitleAndOutlineContent;return{...o,localTitleAndOutlineContent:[{...n,title:e},...i]}}))}),[n]),{submitPrompt:S,generateOutline:Z,reportTomeAnalytics:R,checkForSufficientCreditsOperation:O}=uf({tomeId:t,setCommandState:n,analyticsAlreadyReported:c,outlineResponse:d,localTitleAndOutlineContent:s,pageCount:f,changePromptMode:p,setErrorCode:I,setShowOverlayAndBlockKeys:P}),M=(0,a.useCallback)((()=>O(Oo.Cw.AUTO_TOME,(()=>{var e;n({isLoadingOutline:!0}),R(Ne.vg.CLICK_REGENERATE),Z({inputPrompt:o(),numberOfPagesRequested:(null===(e=s)||void 0===e?void 0:e.length)?s.length-1:6,tomeId:t})}))),[O,n,R,Z,o,null===(E=s)||void 0===E?void 0:E.length,t]),{selectCandidate:$}=Mg({tomeId:t}),L=ig((e=>{n({lastInsertedPageId:e,focusedPageId:e}),setTimeout((()=>{$({lastSelectedCandidatePageId:w,candidatePageIds:_g(y),pageId:e})}),1)})),A=(0,a.useMemo)((()=>(0,F.Z)((e=>L(e)),300,{leading:!0})),[L]),[N]=(0,G._me)(),B=(0,a.useCallback)((()=>{const e=Rn()();n({pageCandidates:[...Array(4)].map((()=>Tg)),subscriptionId:e})}),[n]),H=(0,a.useCallback)((e=>{switch(e){case G.jWh.InsufficientCredits:I(Tp.B.GENERIC_ERROR);break;case G.jWh.FlaggedByModeration:I(Tp.B.OUT_OF_MODERATION_ERROR);break;default:I(Tp.B.GENERIC_ERROR)}B()}),[B,I]),V=(0,a.useCallback)((e=>{var t,o;const{generateTomeFromOutlineV3:n}=e;(null===(t=n)||void 0===t?void 0:t.__typename)?"GenerateTomeFromOutlineV3ErrorResponse"===(null===(o=n)||void 0===o?void 0:o.__typename)&&H(n.errorCode):(0,ca.i)(new Error("generateAutotomePageCandidates mutation completed with unexpected data"),n||{})}),[H]),U=(null===(_=y)||void 0===_?void 0:_.every((e=>e.status===bg.LOADING)))??!1,z=(0,a.useCallback)((e=>{let{inputPrompt:o,outlineContent:i,pageIndex:a,tomeSummary:r}=e;if(U||!u)return;const l=Rn()();n({outlinePageIndex:a,pageCandidates:new Array(4).fill(wg),subscriptionId:l,lastInsertedPageId:void 0}),N({variables:{tomeId:t,tomeTitle:u,tomeSummary:r,inputPrompt:o,outlineContent:i,numCandidates:4,pageIndex:a,subscriptionId:l},onCompleted:V})}),[U,V,N,n,t,u]),W=(0,a.useCallback)((e=>{n((t=>{const o=t.pageCandidates;if(!o)return(0,ca.i)(new Error("Got page candidate subscription update with uninitialized local pageCandidates array.")),t;const n=[...o],i=n.findIndex((e=>e.status===bg.LOADING));return-1===i?((0,ca.i)(new Error("Got page candidate subscription update with fully populated local pageCandidates array.")),t):(n[i]=e,{...t,pageCandidates:n})}))}),[n]),K=(0,a.useCallback)((()=>{n((e=>{const t=e.pageCandidates;if(!t)return(0,ca.i)(new Error("Got page candidate subscription error with uninitialized local pageCandidates array.")),e;const o=[...t],n=o.findIndex((e=>e.status===bg.LOADING));return-1===n?((0,ca.i)(new Error("Got page candidate subscription error with fully populated local pageCandidates array.")),e):(o[n]=Tg,{...e,pageCandidates:o})}))}),[n]),q=(0,a.useCallback)((e=>{switch(e){case G.TxF.Fatal:B(),I(Tp.B.GENERIC_ERROR);break;case G.TxF.PageCandidateGeneration:K();break;default:I(Tp.B.GENERIC_ERROR)}}),[B,I,K]),Y=(0,a.useCallback)((e=>{let{client:n,successCount:i,succeededCandidates:a}=e;0!==i&&Kg({client:n,inputString:o(),subscriptionId:b??Rn()(),succeededCandidates:a,tomeId:t})}),[o,b,t]),J=(0,a.useRef)(""),X=(0,Xt.Z)((e=>()=>{if(!d||!s)return;const{originalTitleAndOutlineContent:t,tomeSummary:n}=d,i=function(e,t){const o=e.filter((e=>e.title.trim().length>0)),n=new Map(t.map((e=>{let{id:t,...o}=e;return[t,o]})));return function(e){return e.map((e=>{let{id:t,...o}=e;return o}))}(o.map((e=>{var t;return e.title.trim()===(null===(t=n.get(e.id))||void 0===t?void 0:t.title)?e:{id:e.id,title:e.title,pageTypes:[],pageGoal:""}})))}(s,t);R(Ne.vg.CLICK_GENERATE_TOME),J.current=Rn()(),z({inputPrompt:o(),outlineContent:i,pageIndex:e,tomeSummary:n})}),[d,s,R,z,o]),Q=!!b,ee=(0,v.s)(),te=(0,a.useCallback)((()=>{ee.close(),m()}),[ee,m]),oe=(0,D.W9)(D.TT.GENERATE_TOME_FROM_OUTLINE_ENGINE),ne=Rf.has(oe),ie=(0,D.W9)(D.TT.AUTOTOME_MAX_NUMBER_OF_PAGES),ae=ne&&ie?ie:25;switch(r){case Tp.q.DELEGATE:return Q?(0,i.jsxs)(i.Fragment,{children:[(0,i.jsx)(Zf,{onCloseBehavior:ee.open,promptBackgroundRef:l,onDoneButtonClick:m,setShowOverlayAndBlockKeys:P,onSelectCandidate:A,tomeId:t,outlinePageIndex:x??0,pageCandidates:y,focusedPageId:T,titleAndOutlineContent:s,submitOutlineIndexToGeneratePage:X,focusInput:C,resultsIdForAutoSelectRef:J,onClickOutside:g,backgroundRef:l}),(0,i.jsx)(df,{subscriptionId:b,expectedUpdateCount:4,onError:q,onUpdate:W,onAllUpdatesReceived:Y},b),(0,i.jsx)(v.Z,{ref:ee.ref,title:ll.ZP.t("commandPrompt.autotomeV3.confirmationModal.title"),subtitle:ll.ZP.t("commandPrompt.autotomeV3.confirmationModal.subtitle"),primaryButtonContent:ll.ZP.t("commandPrompt.autotomeV3.confirmationModal.primaryButtonLabel"),primaryButtonAction:ee.close,cancelButtonText:ll.ZP.t("commandPrompt.autotomeV3.confirmationModal.cancelButtonLabel"),cancelButtonAction:te,buttonColor:"primary",dismissible:!0})]}):(0,i.jsx)(lf,{changePromptMode:p,onSubmit:X(0),onRegenerate:M,titleAndOutlineContent:s,setTitleAndOutlineContent:j,setTomeTitle:k,tomeTitle:u,isLoading:h??!0,onClickOutside:g,backgroundRef:l,reportTomeAnalytics:R,maxContentLength:ae});case Tp.q.ROOT:case Tp.q.SCOPED:default:return(0,i.jsx)(Qm,{Icon:Rm,commandHandler:S})}},ControlStripComponent:mf,hasFallbackMode(e){let{input:t}=e;return t.length<zm},keywords:ll.ZP.t("commandPrompt.autotome.keywords",{returnObjects:!0})};const Mf=new Set(ll.ZP.t("commandPrompt.tokenization.stopWords",{returnObjects:!0})),$f=ll.ZP.t("commandPrompt.tokenization.separator"),Lf=1.875;class Af{register(e){let{id:t,title:o,placeholder:n,Component:i,PassiveComponent:a,ControlStripComponent:r,hasFallbackMode:l,contentDependency:s,keywords:d,featureFlag:c,userContextFilter:u,hideInRootMode:p=!1}=e;p&&this.hideInRootModeCommandIds.add(t),this.values.push(new od.mY(t,o,n,i,a,r,l,s,d,c,u))}getCommandById(e){return this.values.find((t=>t.id===e))??null}getFlagVisibility(e){var t;return!e.featureFlag||!0===(null===(t=this.userContext.flags)||void 0===t?void 0:t[e.featureFlag])}getUserContextVisibility(e){return!e.userContextFilter||e.userContextFilter(this.userContext)}getVisibility(e){return this.getFlagVisibility(e)&&this.getUserContextVisibility(e)&&!this.hideInRootModeCommandIds.has(e.id)}visibleCommands(){return this.values.filter((e=>this.getVisibility(e)))}getPassiveCommandComponent(e){var t;return(null===(t=this.visibleCommands().find((t=>t.id===e&&t.passiveComponent)))||void 0===t?void 0:t.passiveComponent)??null}getMatchingCommands(e){let{isEmptyTome:t,query:o="",selectedCommandId:n}=e;const i=o.trim().split($f),a=i.filter((e=>!Mf.has(e))).join($f);let r=this.visibleCommands().map((e=>({command:e,matchScore:e.score(a)})));a.length>0&&(r=r.filter((e=>{return e.matchScore.type!==od.iW.NONE||e.command.id===n||(t=e.command.hasFallbackMode,i={input:o},"function"==typeof t?t(i):t);var t,i})));let l;const s=r.map((e=>{const o=e.matchScore.type===od.iW.TITLE?15*e.matchScore.score:12*e.matchScore.score,n=t&&e.command.contentDependency===od.oq.EMPTY||!t&&e.command.contentDependency===od.oq.DIRTY||e.command.contentDependency===od.oq.ALWAYS_PRIORITY,i=t&&e.command.contentDependency===od.oq.DIRTY||!t&&e.command.contentDependency===od.oq.EMPTY;let a=0;return n?a=Lf:i&&(a=-1.875),!i&&e.command.hasFallbackMode&&(a+=.9375),{command:e.command,rankingScore:o+a}})).map((e=>{if(!e.command.hasFallbackMode||!a)return e;const{fallbackString:t,prefixScore:o}=Af.calculateFallbackString(e.command,i);let n=0;return o>0&&(n=3.75),(void 0===l||t.length<l.length)&&(l=t),{command:e.command,rankingScore:e.rankingScore+n}}));let d=s;const c=s.every((e=>e.command.hasFallbackMode)),u=a.lastIndexOf(l??"");if(c&&-1!==u){const e=a.slice(0,u).trim(),t=s.filter((t=>{const o=t.command.score(e);return o.type===od.iW.TITLE&&o.score>od.GB}));t.length>0&&(d=t)}return d.sort(((e,t)=>t.rankingScore-e.rankingScore)).map((e=>({command:e.command,fallbackString:e.command.hasFallbackMode?l:void 0})))}static calculateFallbackString(e,t){let o,n=0,i=0;for(o=0;o<t.length;o++){if(Mf.has(t[o])){i+=1;continue}const a=t.slice(0,o+1).filter((e=>!Mf.has(e))).join($f),{score:r}=e.score(a);if(!r&&!n)break;if(!(r>=.8*n))break;n=r,i=o+1}return{command:e,fallbackString:t.slice(i).join($f),prefixScore:n}}constructor(e){this.userContext=e,this.values=[],this.hideInRootModeCommandIds=new Set}}function Nf(e,t){return t.findIndex((t=>t.command.id===e))}var Df=()=>{const[e,t]=(0,a.useState)(new Map),o=(0,a.useCallback)((t=>e.get(t)??{}),[e]),n=(0,a.useCallback)(((e,o)=>{t((t=>{const n=t.get(e)??{},i="function"==typeof o?o(n):{...n,...o};if(!(0,At.Z)(n,i)){const o=new Map(t);return o.set(e,i),o}return t}))}),[]),i=(0,a.useCallback)((()=>{t(new Map)}),[]);return(0,a.useMemo)((()=>({getCommandState:o,setCommandState:n,clearCommandState:i})),[i,o,n])},Bf=o(19015),Hf=o(13589),Vf=o(49312);var Ff=function(e){let{scroller:t,el:o,direction:n="UP",offset:i=0}=e;const a=t.getBoundingClientRect(),r=o.getBoundingClientRect();if("UP"===n){const e=r.top-a.top;if(e<6){const o=t.scrollTop+e-6-i;t.scrollTop=o}}if("DOWN"===n){const e=a.bottom-r.bottom;if(e<6){const o=t.scrollTop-e+6+i;t.scrollTop=o}}},Gf=o(20569);var Uf,zf=o(39953);!function(e){e[e.PROMPT=0]="PROMPT",e[e.DOCUMENT=1]="DOCUMENT"}(Uf||(Uf={}));const Wf=ll.ZP.t("commandPrompt.placeholder.default");var Kf=(0,a.forwardRef)(((e,t)=>{let{editorContentJSONRef:o,placeholder:n=Wf,navigateForward:r,navigateBackward:l,onArrowUp:s,onArrowDown:d,onInputChange:c,onInputPaste:u,mode:p,inputMode:m}=e;const[h,g]=(0,a.useState)((()=>(0,Vf.Q)(o.current).length>0)),[C,f]=(0,a.useState)((()=>(0,Vf.Q)(o.current).length>=1e3)),x=p===Tp.q.ROOT,v=m===Uf.DOCUMENT||x?5e4:1e3,b=(0,a.useCallback)((e=>{const t=(0,Vf.Q)(e);g(t.length>0),f(t.length>=v),c(e)}),[v,c]),y=(0,a.useMemo)((()=>{const e={esc:()=>(l(),!0)};if(m===Uf.PROMPT&&(e.enter=()=>(r(),!0)),m===Uf.DOCUMENT&&(e["mod+enter"]=()=>(r(),!0),e.esc=()=>!h&&(l(),!0)),p===Tp.q.ROOT&&(e.arrowup=()=>(s(),!0),e.arrowdown=()=>(d(),!0),e.arrowright=()=>!h&&(r(),!0)),p===Tp.q.SCOPED){const t=()=>!h&&(l(),!0);e.arrowleft=t,e.backspace=t}return e}),[p,m,h,r,l,s,d]),w=m===Uf.PROMPT?[]:[Vt.Ar.TYPE_SCALES,Vt.Ar.LISTS,Vt.Ar.STRICT_MODE];return(0,i.jsx)(ep.SR,{$inRootMode:x,children:(0,i.jsx)(ep.rD,{bodyFontSize:18,innerTilePadding:0,$isMobile:lc.tq,$horizontalAlignment:G.KxP.Leading,$verticalAlignment:G.Q4P.Top,$placeholder:n,$error:C,$hasContent:h,$inRootMode:x,disabled:!1,"data-testid":"command_prompt_input",children:(0,i.jsx)(Gf.Z,{ref:t,autoFocus:p!==Tp.q.DELEGATE,placeholder:n,value:o.current,setValue:b,onPaste:u,features:w,keyBindings:y,wrapText:!x,disableHistory:!1,maxCharacterLimit:v,formatBarZIndex:zf.FormatBarZIndex.COMMAND_PROMPT})})})}));const qf=(0,g.ZP)(d.E.div).withConfig({displayName:"CommandPromptError__ErrorMessage",componentId:"sc-d0c3383a-0"})`
  width: 100%;
  height: 100%;
  display: flex;
  flex-direction: row;
  justify-content: space-between;
  align-items: flex-start;
  font-size: ${e=>{let{theme:t}=e;return t.fontSizes.sm}};
  line-height: 20px;
  padding-left: 16px;
  color: ${e=>{let{theme:t}=e;return t.colors.errorText}};
  cursor: auto;

  svg {
    fill: currentColor;
  }

  svg:hover {
    fill: currentColor;
  }
`;var Yf=e=>{let{errorCode:t}=e;const{message:o}=_p(t);return(0,i.jsx)(qf,{"data-testid":"command_prompt_error",children:o})};const Jf=(0,g.ZP)(d.E.div).withConfig({displayName:"CommandPromptListItem__CommandPromptListItemContainer",componentId:"sc-f34183b0-0"})`
  flex-shrink: 0;
  // This allows CommandLayout to absolutely position itself.
  position: relative;
  pointer-events: ${e=>{let{$isVisible:t}=e;return t?"auto":"none"}};
  width: 100%;
`,Xf=(0,g.ZP)(d.E.div).withConfig({displayName:"CommandPromptListItem__CommandPromptListItemInnerContainer",componentId:"sc-f34183b0-1"})`
  // 6px on the left and right of each command are dead areas. This allows
  // the user's cursor to move within these areas without changing command
  // focus or selecting a command.
  padding: 0 6px;
  width: 100%;
`;var Qf=e=>{let{initial:t,animate:o,transition:n,onAnimationComplete:a,onMouseMove:r,isVisible:l,dataTestId:s,dataFocused:d,children:c,heightMeasurementRef:u}=e;return(0,i.jsx)(Jf,{ref:u,initial:t,animate:o,transition:n,onAnimationComplete:a,$isVisible:l,"data-testid":s,"data-focused":d,children:(0,i.jsx)(Xf,{onMouseMove:r,children:c})})};var ex=function(e){let{tomeId:t}=e;const{apolloClient:o}=(0,L.bp)();return(0,a.useCallback)((e=>{let{commandId:n,input:i,mode:a}=e;Ne.ZP.reportSumbitCommand({apolloClient:o,commandId:n,commandInput:i.slice(0,5e3),commandInputLength:i.length,commandMode:a,tomeId:t})}),[o,t])};var tx=e=>{let{commandRegistry:t,setShowOverlayAndBlockKeys:o,tomeId:n,isEmptyTome:r,editorContentJSONRef:l,errorCode:s,setErrorCode:d,getCommandState:c,setCommandState:u,clearCommandState:p,backgroundRef:m,shouldScaleContentsIn:h}=e;var g,C;const f=ex({tomeId:n}),{commandPromptMode:x,setCommandPromptMode:v,controlCommandPrompt:b,setShouldResetCommandPromptAfterClose:y,selectedCommandId:w,setSelectedCommandId:T,directlyInvokeCommand:I,setDirectlyInvokeCommand:P,setBlockCommandPromptToggle:E,promptAnimationsEnabled:_,setPromptAnimationsEnabled:j}=(0,ws.uJ)(),k=(0,a.useCallback)((()=>(0,Vf.Q)(l.current)),[l]),S=(0,a.useCallback)((()=>l.current),[l]),Z=x===Tp.q.ROOT,R=x===Tp.q.SCOPED,O=x===Tp.q.DELEGATE,[M,A]=(0,a.useState)((()=>t.getMatchingCommands({isEmptyTome:r,query:k(),selectedCommandId:w}))),[N,D]=(0,a.useState)((()=>t.getMatchingCommands({isEmptyTome:r,query:k(),selectedCommandId:w})[0].command.id)),B=(0,a.useRef)(null),H=(0,a.useRef)();H.current=(e,t,o)=>{I&&w===e&&t&&(P(!1),o({stringValue:"",jsonValue:Hu.yS,wasDirectlyInvoked:!0}))};const V=(0,a.useRef)(new Map),F=(0,Xt.Z)(((e,t,o)=>{var n;null===(n=V)||void 0===n||n.current.set(e,o),H.current&&H.current(e,t,o)}),[]),G=(0,a.useCallback)((()=>{var e,t;if(Z&&N)f({commandId:N,input:k(),mode:"ROOT"}),null===(t=V)||void 0===t||null===(e=t.current.get(N))||void 0===e||e({stringValue:k(),jsonValue:S(),wasDirectlyInvoked:!1});else if(R&&w&&k().length>0){var o,n;f({commandId:w,input:k(),mode:"SCOPED"}),null===(n=V)||void 0===n||null===(o=n.current.get(w))||void 0===o||o({stringValue:k(),jsonValue:S(),wasDirectlyInvoked:!1})}}),[Z,N,R,w,k,f,S]),U=(0,a.useRef)(null),z=(0,a.useCallback)((()=>{var e;return null===(e=U.current)||void 0===e?void 0:e.focusEditor()}),[]),W=(0,a.useCallback)((()=>{var e;return null===(e=U.current)||void 0===e?void 0:e.blurEditor()}),[]),K=(0,a.useCallback)((()=>{var e;return(null===(e=U.current)||void 0===e?void 0:e.isFocused())??!1}),[]),q=(0,a.useCallback)((e=>{let{newRenderableCommands:t,forceRerender:o=!1}=e;var n;A((e=>{if(e.length!==t.length||o)return t;return e.every(((e,o)=>e.command.id===t[o].command.id&&e.fallbackString===t[o].fallbackString))?e:t})),D(t[0].command.id),(null===(n=B)||void 0===n?void 0:n.current)&&(B.current.scrollTop=0)}),[]),Y=(0,a.useCallback)((e=>{const o=t.getMatchingCommands({isEmptyTome:r,query:e,selectedCommandId:w});q({newRenderableCommands:o})}),[t,r,w,q]),J=(0,a.useCallback)((()=>{q({newRenderableCommands:t.getMatchingCommands({isEmptyTome:r,selectedCommandId:w}),forceRerender:!0})}),[t,r,w,q]),X=(0,a.useRef)(new Set),Q=(0,a.useCallback)((e=>{X.current.add(e)}),[]),ee=(0,a.useCallback)((e=>{X.current.delete(e)}),[]),te=(0,a.useCallback)((e=>{if(l.current=e,X.current.forEach((e=>e())),d(null),Z){const t=(0,Vf.Q)(e);Y(t)}}),[Y,Z,l,d]),oe=(0,a.useCallback)((()=>{setTimeout((()=>{var e,t,o;const n=null===(t=U)||void 0===t||null===(e=t.current)||void 0===e?void 0:e.getEditor(),i=null===(o=n)||void 0===o?void 0:o.selection;if(i){var a,r,l;const e=(0,nn.lrJ)(n,i),t=null===(a=e)||void 0===a?void 0:a.getBoundingClientRect().bottom,o=null===(l=m)||void 0===l||null===(r=l.current)||void 0===r?void 0:r.getBoundingClientRect().bottom;var s,d;if(t&&o&&t>o)null===(d=e)||void 0===d||null===(s=d.endContainer.parentElement)||void 0===s||s.scrollIntoView({block:"end"})}}),1)}),[m]),ne=(0,a.useCallback)(((e,t)=>{const o=Nf(e,M);if(B.current){const e=B.current,n=Array.from(B.current.children).slice(1,-1)[o];e&&n&&Ff({scroller:e,el:n,direction:t,offset:20})}}),[M]),ie=(0,a.useCallback)((()=>{l.current=(0,rm.Z)(Hu.yS),J()}),[J,l]),ae=(0,a.useCallback)((e=>{l.current=(0,Hu.Tj)(e)}),[l]),re=(0,Xt.Z)(((e,t)=>{switch(t){case Tp.q.ROOT:ie(),d(null),T(null);break;case Tp.q.SCOPED:case Tp.q.DELEGATE:T(e.id)}v(t),j(!0),t===Tp.q.DELEGATE?W():z()}),[v,j,ie,d,T,W,z]),le=(0,Xt.Z)(u,[u]),se=(0,a.useCallback)((()=>{y(!0)}),[y]),de=(0,a.useCallback)((()=>{b({action:ws.$C.CLOSE})}),[b]),ce=(0,a.useCallback)((()=>{y(!0),de()}),[de,y]),ue=(0,a.useCallback)((()=>{if(k().length>0)ie();else switch(x){case Tp.q.SCOPED:T(null),J(),j(!0),v(Tp.q.ROOT),p();break;case Tp.q.ROOT:ce();case Tp.q.DELEGATE:}}),[k,x,ie,T,J,j,v,p,ce]),pe=(0,a.useCallback)((()=>{const e=Nf(N,M),t=Math.min(e+1,M.length-1),{command:o}=M[t];D(o.id),ne(o.id,"UP")}),[M,N,ne]),me=(0,a.useCallback)((()=>{const e=Nf(N,M),t=Math.max(e-1,0),{command:o}=M[t];D(o.id),ne(o.id,"DOWN")}),[M,N,ne]),{headerBackButtonRef:he}=(0,L.TR)(),ge=(0,a.useMemo)((()=>({exemptRefs:[he]})),[he]);(0,Lp.Z)(x!==Tp.q.DELEGATE?m:null,de,ge);const Ce=(0,a.useRef)(new Map),fe=(0,Xt.Z)(((e,t)=>{Ce.current.set(e,t)}),[]),{height:xe}=(0,$.Z)({ref:Ce.current.get(w??"")}),ve=xe??ep.BY,be=e=>{var t,o;return e===w?Nf(e,M)*ep.xJ+((null===(o=B)||void 0===o||null===(t=o.current)||void 0===t?void 0:t.scrollTop)||0)+ep.d1:0},ye=e=>({opacity:null===w||e===w?1:0,y:be(e)}),we={height:s?"36px":0,opacity:s?1:0},[Te,Ie]=(0,a.useState)(Uf.PROMPT),Pe=(0,a.useCallback)((()=>{w===od.mm.DOC_TO_TOME?Ie(Uf.DOCUMENT):Ie(Uf.PROMPT)}),[w]),Ee=(0,a.useCallback)((()=>{R&&j(!1)}),[R,j]),_e=(0,a.useMemo)((()=>(0,Lu.Z)(((e,t)=>{if(Z){if(0===Math.hypot(e.movementX,e.movementY))return;D(t)}}),50)),[Z]),je=w?t.getCommandById(w):null,ke=null!=je&&R&&(null===(g=je)||void 0===g?void 0:g.controlStripComponent),Se={height:ke?ep.FA:0,opacity:ke?1:0},Ze=O&&je?{title:je.title,mode:Tp.q.DELEGATE,changePromptMode:re(je),contributeCommandHandler:F(je.id)(!0),getInputJSON:S,getInputString:k,setInputString:ae,addInputChangeListener:Q,removeInputChangeListener:ee,focusInput:z,getIsInputFocused:K,blurInput:W,clearInput:ie,setShowOverlayAndBlockKeys:o,tomeId:n,promptBackgroundRef:m,onComplete:ce,closeCommandPrompt:de,clearCommandState:p,setErrorCode:d,isFocusedInRootMode:!1,disableTitleAnimations:!1,resetCommandPromptAfterClose:se,setBlockCommandPromptToggle:E}:null,Re=R&&je?{title:je.title,mode:Tp.q.SCOPED,changePromptMode:re(je),contributeCommandHandler:F(je.id)(!1),getInputJSON:S,getInputString:k,setInputString:ae,addInputChangeListener:Q,removeInputChangeListener:ee,focusInput:z,blurInput:W,getIsInputFocused:K,clearInput:ie,setShowOverlayAndBlockKeys:o,tomeId:n,promptBackgroundRef:m,onComplete:ce,closeCommandPrompt:de,clearCommandState:p,setErrorCode:d,isFocusedInRootMode:!1,disableTitleAnimations:!1,resetCommandPromptAfterClose:se,setBlockCommandPromptToggle:E}:null;return(0,i.jsxs)(ep.CM,{initial:!!h&&{opacity:0,scale:.8},exit:{opacity:0,scale:.2,transition:ep.U2},animate:{opacity:1,scale:1,transition:ep.U2},transition:_?ep.c:ep.Xi,onAnimationComplete:Ee,style:{originX:.5,originY:1},children:[(0,i.jsxs)(ep._2,{layout:"size",transition:_?ep.c:ep.Xi,style:{position:Z||R?"relative":"absolute"},animate:{opacity:Z||R?1:0},children:[(0,i.jsxs)(ep.Ur,{ref:B,transition:ep.TP,initial:!1,animate:{height:`${Z?Math.min(ep.rZ,M.length*ep.xJ+2*ep.EW):ve}px`},$disableScroll:R,onAnimationComplete:Pe,"data-testid":"command_prompt_list",children:[(0,i.jsx)(ep.T7,{}),M.map((e=>{let{command:t,fallbackString:a}=e;const r=t.id===w,l=t.id===N,s=R&&!r||!_,u={title:t.title,mode:r?Tp.q.SCOPED:Tp.q.ROOT,changePromptMode:re(t),contributeCommandHandler:F(t.id)(!1),getInputJSON:S,getInputString:k,setInputString:ae,addInputChangeListener:Q,removeInputChangeListener:ee,focusInput:z,blurInput:W,getIsInputFocused:K,clearInput:ie,setShowOverlayAndBlockKeys:o,tomeId:n,promptBackgroundRef:m,onComplete:ce,closeCommandPrompt:de,clearCommandState:p,setErrorCode:d,isFocusedInRootMode:Z&&l,fallbackString:a,disableTitleAnimations:!_,resetCommandPromptAfterClose:se,setBlockCommandPromptToggle:E};return(0,i.jsx)(Qf,{initial:ye(t.id),animate:ye(t.id),transition:s?ep.YB:ep.TP,onAnimationComplete:r?Ee:void 0,dataTestId:`${t.id}_${x}_mode`,dataFocused:Z?l:void 0,onMouseMove:e=>_e(e,t.id),isVisible:null===w||r,heightMeasurementRef:fe(t.id),children:(0,i.jsx)(_m,{value:u,children:(0,i.jsx)(t.component,{setCommandState:le(t.id),...c(t.id),...u})})},t.id)})),(0,i.jsx)(ep.T7,{})]}),(0,i.jsx)(ep.iz,{transition:ep.$E,animate:{opacity:Z?1:0}}),(0,i.jsx)(Kf,{ref:U,editorContentJSONRef:l,placeholder:null===(C=je)||void 0===C?void 0:C.placeholder,onInputChange:te,onInputPaste:oe,mode:x,inputMode:Te,navigateForward:G,navigateBackward:ue,onArrowUp:pe,onArrowDown:me}),(0,i.jsx)(ep.cW,{initial:we,animate:we,transition:{type:"spring",bounce:0},children:s&&(0,i.jsx)(Yf,{errorCode:s})}),(0,i.jsx)(ep.ki,{initial:Se,animate:Se,children:ke&&Re&&(0,i.jsx)(_m,{value:Re,children:(0,i.jsx)(je.controlStripComponent,{setCommandState:le(je.id),...c(je.id),...Re})})})]}),(0,i.jsx)(ep.ef,{transition:_?ep.c:ep.Xi,style:{position:O?"relative":"absolute"},initial:{opacity:0},animate:{opacity:O?1:0},onAnimationComplete:Ee,children:null!=je&&null!=Ze&&(0,i.jsx)(_m,{value:Ze,children:(0,i.jsx)(je.component,{setCommandState:le(je.id),...c(je.id),...Ze})})})]})},ox=o(16401);var nx=(0,a.forwardRef)(((e,t)=>{let{fillColor:o}=e;return(0,i.jsxs)(ye.Z,{ref:t,width:"21",height:"10",viewBox:"0 0 21 10",fill:"none","data-testid":"command_k_icon",children:[(0,i.jsx)("path",{d:"M2.125 10C3.68056 10 4.18056 9.02778 4.18056 7.86111V6.70833H5.70833V7.86111C5.70833 9.02778 6.20833 10 7.76389 10C9.05556 10 9.88889 9.18056 9.88889 7.90278C9.88889 6.55556 9.08333 5.76389 7.5 5.76389H6.68055V4.23611H7.5C9.08333 4.23611 9.88889 3.44444 9.88889 2.09722C9.88889 0.819445 9.05556 0 7.76389 0C6.20833 0 5.70833 0.972222 5.70833 2.13889V3.29167H4.18056V2.13889C4.18056 0.972222 3.68056 0 2.125 0C0.833333 0 0 0.819445 0 2.09722C0 3.44444 0.805556 4.23611 2.38889 4.23611H3.20833V5.76389H2.38889C0.805556 5.76389 0 6.55556 0 7.90278C0 9.18056 0.833333 10 2.125 10ZM6.68055 2.11111C6.68055 1.40278 7.04167 0.958333 7.76389 0.958333C8.41667 0.958333 8.90278 1.27778 8.90278 2.09722C8.90278 2.88889 8.48611 3.29167 7.5 3.29167H6.68055V2.11111ZM2.38889 3.29167C1.40278 3.29167 0.986111 2.88889 0.986111 2.09722C0.986111 1.27778 1.47222 0.958333 2.125 0.958333C2.84722 0.958333 3.20833 1.40278 3.20833 2.11111V3.29167H2.38889ZM4.18056 5.76389V4.23611H5.70833V5.76389H4.18056ZM2.125 9.04167C1.47222 9.04167 0.986111 8.72222 0.986111 7.90278C0.986111 7.11111 1.40278 6.70833 2.38889 6.70833H3.20833V7.88889C3.20833 8.59722 2.84722 9.04167 2.125 9.04167ZM6.68055 7.88889V6.70833H7.5C8.48611 6.70833 8.90278 7.11111 8.90278 7.90278C8.90278 8.72222 8.41667 9.04167 7.76389 9.04167C7.04167 9.04167 6.68055 8.59722 6.68055 7.88889Z",fill:o}),(0,i.jsx)("path",{d:"M13.6868 10V0.277778H14.9368V4.48611C15.0294 4.38426 15.1776 4.21296 15.3813 3.97222L18.6313 0.277778H20.1591L14.9368 6.13889V10H13.6868ZM19.1591 10L15.298 5.34722L16.1868 4.51389L20.7841 10H19.1591Z",fill:o})]})}));var ix=(0,a.forwardRef)(((e,t)=>{let{fillColor:o}=e;return(0,i.jsxs)(ye.Z,{ref:t,width:"49",height:"10",viewBox:"0 0 49 10",fill:"none","data-testid":"control_k_icon",children:[(0,i.jsx)("path",{d:"M3.74829 10C5.78659 10 6.85362 8.75513 7.0725 6.70315H5.78659C5.55404 8.11217 5.02052 8.96033 3.72093 8.96033C2.1751 8.96033 1.31327 7.3461 1.31327 4.95212C1.31327 2.57182 2.13406 1.05335 3.72093 1.05335C4.95212 1.05335 5.54036 2.01094 5.70451 3.31053H7.0725C6.9357 1.43639 5.85499 0 3.81669 0C1.47743 0 0 1.99726 0 4.95212C0 8.04378 1.35431 10 3.74829 10Z",fill:o}),(0,i.jsx)("path",{d:"M13.6882 9.91792C14.0713 9.91792 14.4817 9.8632 14.7963 9.7948V8.74145C14.4543 8.79617 14.1944 8.82353 13.9071 8.82353C12.1834 8.82353 11.7457 8.26265 11.7457 6.96306V4.17237H14.6732V3.20109H11.7457V1.02599H10.5692V3.20109H8.07947V4.17237H10.5692V7.12722C10.5692 9.11081 11.6499 9.91792 13.6882 9.91792Z",fill:o}),(0,i.jsx)("path",{d:"M19.0728 9.7948V6.55267C19.0728 5.06156 19.9209 4.17237 21.8361 4.17237C22.1371 4.17237 22.4107 4.19973 22.6432 4.22709V3.07797C22.397 3.03694 22.1918 3.02326 21.9455 3.02326C20.2082 3.02326 19.4148 3.85773 19.0728 4.59644V3.48837V3.20109H17.8963V9.7948H19.0728Z",fill:o}),(0,i.jsx)("path",{d:"M29.1632 0.218878H25.3328V1.19015H28.0004V8.82353H24.7719V9.7948H31.9265V8.82353H29.1632V0.218878Z",fill:o}),(0,i.jsx)("path",{d:"M36.7912 5.21204V2.35294H35.7926V5.21204H33.0566V6.18331H35.7926V9.04241H36.7912V6.18331H39.5409V5.21204H36.7912Z",fill:o}),(0,i.jsx)("path",{d:"M43.9404 4.50068L47.7571 0.218878H46.2523L43.0513 3.85773C42.9008 4.03557 42.7503 4.21341 42.6135 4.36388V0.218878H41.3823V9.7948H42.6135V5.99179L43.1333 5.40356L46.7722 9.7948H48.3727L43.9404 4.50068Z",fill:o})]})}));const ax={hover:{opacity:0,transition:{repeat:1/0,repeatType:"mirror",duration:.5,delay:.5,ease:"easeOut"}},default:{}},rx=(0,g.ZP)(d.E.div).withConfig({displayName:"CollapsedCommandPrompt__RoundedRectangle",componentId:"sc-a2fb8452-0"})`
  height: 100%;
  width: 100%;
  border-radius: 10px;
  box-shadow: ${e=>{let{theme:t}=e;return t.colors.collapsedCommandPromptBoxShadow}};
  backdrop-filter: saturate(180%) blur(20px);
  pointer-events: auto;

  // Instead of using on &:hover here, we want to use our custom
  // hover state keep this background color in sync with the
  // other hover CSS changes + animations
  background-color: ${e=>{let{theme:t,$activeHover:o}=e;return o?t.colors.collapsedCommandPromptBackgroundHover:t.colors.collapsedCommandPromptBackground}};
`,lx=(0,g.ZP)(d.E.div).withConfig({displayName:"CollapsedCommandPrompt__Content",componentId:"sc-a2fb8452-1"})`
  height: 100%;
  width: 100%;
  display: flex;
  justify-content: space-between;
  align-items: center;
  position: relative;
  padding: 10px;
`,sx=(0,g.ZP)(Ie.Z).withConfig({displayName:"CollapsedCommandPrompt__Button",componentId:"sc-a2fb8452-2"})`
  // position hidden button over top of background to handle clicks and position tooltip
  opacity: 0;
  width: ${ep.jo}px;
  height: ${ep.V3}px;
  position: absolute;
  inset: 0;
`,dx=g.ZP.div.withConfig({displayName:"CollapsedCommandPrompt__CursorBar",componentId:"sc-a2fb8452-3"})`
  width: 3px;
  height: 16px;
  border-radius: 2px;

  // We need to use the custom hover state here to ensure the color
  // changes correctly when the theme is switched.
  background-color: ${e=>{let{theme:t,$activeHover:o}=e;return o?t.colors.collapsedCommandPromptBlinkingCursor:t.colors.collapsedCommandPromptStaticCursor}};
  transition: background-color 0.5s ease-out;
`;var cx=()=>{const{t:e}=(0,C.$G)(),t=e("commandPrompt.collapsedCommandPromptLabel"),o=(0,g.Fg)(),n=(0,ws.yP)(),r=(0,ws.kL)(),[l,s]=(0,a.useState)(!1),[c,u]=(0,a.useState)(!1),p=(0,a.useCallback)((()=>{n({action:ws.$C.OPEN})}),[n]);return(0,i.jsx)(rx,{onMouseEnter:()=>{s(!0)},onMouseLeave:()=>{s(!1)},layout:!0,initial:!1,animate:{opacity:r?0:1},style:{borderRadius:"10px"},transition:ep.U2,onAnimationStart:()=>{u(!0)},onAnimationComplete:()=>{u(!1),s(!1)},$activeHover:l,"data-testid":"collapsed_command_prompt","data-testid-collapsed-command-prompt-hover-state":l,children:(0,i.jsxs)(lx,{initial:!1,animate:{opacity:r?0:1},transition:r?ep.DJ:ep.te,children:[(0,i.jsx)(d.E.div,{initial:{opacity:1},animate:l?"hover":"default",variants:ax,transition:ep.U2,children:(0,i.jsx)(dx,{$activeHover:l,"data-testid":"cursor_bar"})}),!r&&!c&&(0,i.jsx)($o.Z,{content:t,placement:"top",tooltipDisabled:!l,children:(0,i.jsx)(sx,{onClick:p,"aria-label":t})}),ox.Os.isMac()?(0,i.jsx)(nx,{fillColor:o.colors.collapsedCommandPromptShortcutFill}):(0,i.jsx)(ix,{fillColor:o.colors.collapsedCommandPromptShortcutFill})]})})};var ux=e=>{let{commandRegistry:t,setShowOverlayAndBlockKeys:o,tomeId:n,isEmptyTome:l,editorContentJSONRef:s,errorCode:d,setErrorCode:u,getCommandState:p,setCommandState:m,clearCommandState:h,resetStateIfNeeded:g,canEdit:C}=e;const f=(0,a.useRef)(null),x=(0,r.sJ)(A.DH),{commandPromptIsOpen:v,commandPromptMode:b,promptAnimationsEnabled:y}=(0,ws.uJ)(),w=b===Tp.q.ROOT,T=b===Tp.q.SCOPED,I=v?{y:0}:{y:20},P=v?w||T?`${ep.Wu}px`:"auto":`${ep.jo}px`,E=v?"auto":`${ep.V3}px`,_=y?ep.U2:ep.Xi,j=v?ep.v:ep.k$,k=(0,H.Z)(v),S=v&&!1===k;return(0,i.jsxs)(ep.QO,{initial:!1,animate:I,transition:ep.U2,children:[(0,i.jsx)(ep.Id,{children:(0,i.jsx)(Hf.S,{children:(0,i.jsx)(ep.VL,{ref:f,layout:!0,initial:!1,animate:{opacity:v?1:0,transition:j},style:{height:E,width:P,borderRadius:"10px"},transition:_,onPointerDown:ct.Z,children:(0,i.jsx)(c.M,{onExitComplete:g,children:v&&(0,i.jsx)(tx,{commandRegistry:t,setShowOverlayAndBlockKeys:o,tomeId:n,isEmptyTome:l,editorContentJSONRef:s,errorCode:d,setErrorCode:u,getCommandState:p,setCommandState:m,clearCommandState:h,backgroundRef:f,shouldScaleContentsIn:S})})})})}),(0,i.jsx)(c.M,{initial:!1,children:C&&!x&&(0,i.jsx)(ep.oz,{style:{zIndex:v?ep.m4-1:ep.m4+1},...yg({stagger:vg.None}),children:(0,i.jsx)(cx,{})})})]})};const px=e=>{let{setKeyboardEnabled:t,tomeId:o,isEmptyTome:n,canEdit:r}=e;const l=(0,a.useContext)(oi.Z),s=(0,a.useMemo)((()=>(e=>{const t=new Af(e);return t.register(yC),t.register(Of),t.register(og),t.register(EC),t.register(Im),t.register(RC({id:od.mm.CREATE_IMAGE,icon:Le.Z,title:ll.ZP.t("commandPrompt.tiles.createImage.commandTitle"),tileType:G.YUT.Image,keywords:ll.ZP.t("commandPrompt.tiles.createImage.keywords",{returnObjects:!0}),afterAddTileAction:zn.B.CLICK_IMAGE_TILE_CREATE_BUTTON})),t.register(RC({id:od.mm.UPLOAD_IMAGE,icon:Ae.Z,title:ll.ZP.t("commandPrompt.tiles.uploadImage.commandTitle"),tileType:G.YUT.Image,keywords:ll.ZP.t("commandPrompt.tiles.uploadImage.keywords",{returnObjects:!0}),afterAddTileAction:zn.B.CLICK_IMAGE_TILE_UPLOAD_BUTTON})),t.register(RC({id:od.mm.SEARCH_IMAGE,icon:De.Z,title:ll.ZP.t("commandPrompt.tiles.searchImage.commandTitle"),tileType:G.YUT.Image,keywords:ll.ZP.t("commandPrompt.tiles.searchImage.keywords",{returnObjects:!0}),afterAddTileAction:zn.B.CLICK_IMAGE_TILE_SEARCH_BUTTON})),t.register(RC({id:od.mm.ADD_TEXT_TILE,icon:zc.Z,title:ll.ZP.t("commandPrompt.tiles.text.commandTitle"),tileType:G.YUT.Text,keywords:ll.ZP.t("commandPrompt.tiles.text.keywords",{returnObjects:!0})})),t.register(RC({id:od.mm.ADD_VIDEO_TILE,icon:Vu.Z,title:ll.ZP.t("commandPrompt.tiles.video.commandTitle"),tileType:G.YUT.Video,keywords:ll.ZP.t("commandPrompt.tiles.video.keywords",{returnObjects:!0})})),t.register(RC({id:od.mm.ADD_TABLE_TILE,icon:Wc.Z,title:ll.ZP.t("commandPrompt.tiles.table.commandTitle"),tileType:G.YUT.Table,keywords:ll.ZP.t("commandPrompt.tiles.table.keywords",{returnObjects:!0})})),t.register(RC({id:od.mm.ADD_GIPHY_TILE,icon:qu.Z,title:ll.ZP.t("commandPrompt.tiles.giphy.commandTitle"),tileType:G.YUT.Giphy,keywords:ll.ZP.t("commandPrompt.tiles.giphy.keywords",{returnObjects:!0})})),t.register(RC({id:od.mm.ADD_FIGMA_TILE,icon:Fu.Z,title:ll.ZP.t("commandPrompt.tiles.figma.commandTitle"),tileType:G.YUT.Figma,keywords:ll.ZP.t("commandPrompt.tiles.figma.keywords",{returnObjects:!0})})),t.register(RC({id:od.mm.ADD_AIRTABLE_TILE,icon:Gu.Z,title:ll.ZP.t("commandPrompt.tiles.airtable.commandTitle"),tileType:G.YUT.Airtable,keywords:ll.ZP.t("commandPrompt.tiles.airtable.keywords",{returnObjects:!0})})),t.register(RC({id:od.mm.ADD_TWITTER_TILE,icon:zu.Z,title:ll.ZP.t("commandPrompt.tiles.twitter.commandTitle"),tileType:G.YUT.Twitter,keywords:ll.ZP.t("commandPrompt.tiles.twitter.keywords",{returnObjects:!0})})),t.register(RC({id:od.mm.ADD_FRAMER_TILE,icon:Wu.Z,title:ll.ZP.t("commandPrompt.tiles.framer.commandTitle"),tileType:G.YUT.Framer,keywords:ll.ZP.t("commandPrompt.tiles.framer.keywords",{returnObjects:!0})})),t.register(RC({id:od.mm.ADD_MIRO_TILE,icon:Ku.Z,title:ll.ZP.t("commandPrompt.tiles.miro.commandTitle"),tileType:G.YUT.Miro,keywords:ll.ZP.t("commandPrompt.tiles.miro.keywords",{returnObjects:!0})})),t.register(RC({id:od.mm.ADD_LOOKER_TILE,icon:Yu.Z,title:ll.ZP.t("commandPrompt.tiles.looker.commandTitle"),tileType:G.YUT.Looker,keywords:ll.ZP.t("commandPrompt.tiles.looker.keywords",{returnObjects:!0})})),t.register(RC({id:od.mm.ADD_WEB_TILE,icon:Uu.Z,title:ll.ZP.t("commandPrompt.tiles.web.commandTitle"),tileType:G.YUT.Web,keywords:ll.ZP.t("commandPrompt.tiles.web.keywords",{returnObjects:!0})})),t.register(Sm),t.register(OC(od.mm.OPEN_CUSTOMIZE_PANEL,Ju,ll.ZP.t("commandPrompt.setTheme.commandTitle"),_.Z.CUSTOMIZE,ll.ZP.t("commandPrompt.setTheme.keywords",{returnObjects:!0}))),t.register(OC(od.mm.OPEN_RECORD_PANEL,Ts,ll.ZP.t("commandPrompt.recordNarration.commandTitle"),_.Z.RECORD,ll.ZP.t("commandPrompt.recordNarration.keywords",{returnObjects:!0}))),t.register(Ep),t.register(AC),t.register(jC),t.register(kC),t.register(LC(od.mm.PROMPT_TIPS_LINK,Xu.Z,ll.ZP.t("commandPrompt.help.promptTips.commandTitle"),"https://tome.app/tomecommunity/prompt-guide-tips-for-crafting-generative-prompts-clbtp8jdh0b5c4w5x3p596esr?utm_source=tome&utm_medium=referral&utm_campaign=command-prompt&utm_content=tips-for-crafting&utm_term=",ll.ZP.t("commandPrompt.help.promptTips.keywords",{returnObjects:!0}))),t.register(LC(od.mm.GETTING_STARTED_LINK,Qu.Z,ll.ZP.t("commandPrompt.help.gettingStarted.commandTitle"),"https://tome.app/tomecommunity/tome-getting-started-guide-cl5sigulu1899274x5iqictrjgv?utm_source=tome&utm_medium=referral&utm_campaign=command-prompt&utm_content=getting-started&utm_term=",ll.ZP.t("commandPrompt.help.gettingStarted.keywords",{returnObjects:!0}))),t.register(NC),t.register(SC),t.register(DC),t})(l)),[l]),d=(0,a.useRef)(Hu.yS),[u,p]=(0,a.useState)(null),[m,h]=(0,a.useState)(!1),g=(0,a.useCallback)((e=>{h(e),t(!e)}),[t]),{getCommandState:C,setCommandState:f,clearCommandState:x}=Df(),{shouldResetCommandPromptAfterClose:v,setShouldResetCommandPromptAfterClose:b,resetCommandPromptState:y,selectedCommandId:w,commandPromptIsOpen:T}=(0,ws.uJ)(),P=(0,a.useCallback)((()=>{b(!1),y(),d.current=Hu.yS,p(null),x(),t(!0)}),[x,y,t,b]),E=(0,a.useCallback)((()=>{v&&P()}),[v,P]);(0,a.useEffect)((()=>()=>{P()}),[]);const j=(0,a.useMemo)((()=>s.getPassiveCommandComponent(w)),[s,w]);return(0,i.jsxs)(ep.uS,{"data-testid":"command_prompt_portal",style:{zIndex:I.IT},children:[(0,i.jsx)(ux,{commandRegistry:s,setShowOverlayAndBlockKeys:g,tomeId:o,isEmptyTome:n,editorContentJSONRef:d,errorCode:u,setErrorCode:p,getCommandState:C,setCommandState:f,clearCommandState:x,resetStateIfNeeded:E,canEdit:r}),(0,i.jsx)(c.M,{children:m&&(0,i.jsx)(Bf.C,{"data-testid":"block_clicks_and_dim_overlay",onPointerDown:ct.Z,initial:{opacity:0},animate:{opacity:1},exit:{opacity:0},transition:ep.OG})}),j&&!T&&(0,i.jsx)(j,{resetCommandPrompt:P,getCommandState:C})]})};var mx=(0,a.memo)(px),hx=o(9043),gx=o(68443);const Cx=e=>{let{...t}=e;return(0,i.jsx)(gx.fC,{...t})},fx=gx.xz,xx=g.ZP.span.withConfig({displayName:"Item__ContextMenuItemText",componentId:"sc-1950126f-0"})``,vx=(0,g.ZP)(gx.ck).withConfig({displayName:"Item__StyledItem",componentId:"sc-1950126f-1"})`
  display: flex;
  flex: 1;
  align-items: center;
  font-size: ${e=>e.theme.fontSizes.sm};
  line-height: ${Vo.xW}px;
  font-weight: 400;
  padding: ${Vo.CN}px 8px;
  border-radius: ${Vo.aX}px;
  transition: background-color 0.075s ease-in-out, color 0.075s ease-in-out;

  color: ${e=>(0,Vo.Lq)({$disabled:!!e.disabled,theme:e.theme})};
  ${ye.K} {
    fill: currentColor;
  }

  ${Vo.z9} {
    color: ${e=>(0,Vo.zJ)({$disabled:!!e.disabled,theme:e.theme})};
  }

  ${xx} {
    display: flex;
    flex: 1;
  }

  ${e=>g.iv`
      &[data-highlighted] {
        outline: none;
        color: ${(0,Vo.VQ)({$disabled:!!e.disabled,theme:e.theme})};
        background-color: ${(0,Vo.jR)({$disabled:!!e.disabled,theme:e.theme})};
      }
    `}
`,bx=(0,a.forwardRef)(((e,t)=>{let{...o}=e;return(0,i.jsx)(vx,{ref:t,...o})})),yx=(0,g.ZP)(gx.VY).withConfig({displayName:"Content__StyledContent",componentId:"sc-2240067e-0"})`
  ${lC.D}
`,wx=(0,a.forwardRef)(((e,t)=>{let{...o}=e;const{portalProps:n,...a}=o;return(0,i.jsx)(gx.Uv,{...n,children:(0,i.jsx)(yx,{ref:t,...a})})})),Tx=(0,g.ZP)(wx).withConfig({displayName:"TomeCanvasContextMenu__StyledContextMenuContent",componentId:"sc-c6a46c67-0"})`
  z-index: ${I.m6};
`;var Ix=e=>{let{disabled:t,children:o}=e;const{t:n}=(0,C.$G)(),r=(0,a.useCallback)((()=>{window.postMessage({type:hx.SG})}),[]),l=(0,qr.Z)(!0),{undo:s,redo:d}=(0,nd.C5)(),{hasUndoEdits:c,hasRedoEdits:u}=(0,nd.j0)(),p=(0,i.jsxs)(i.Fragment,{children:[(0,i.jsxs)(bx,{onSelect:s,disabled:!c,children:[(0,i.jsx)(xx,{children:n("hooks.tile.menu.undo")}),(0,i.jsx)(Vo.z9,{children:(0,Is.Ul)()})]}),(0,i.jsxs)(bx,{onSelect:d,disabled:!u,children:[(0,i.jsx)(xx,{children:n("hooks.tile.menu.redo")}),(0,i.jsx)(Vo.z9,{children:(0,Is.SW)()})]})]});return(0,i.jsxs)(Cx,{children:[(0,i.jsx)(fx,{asChild:!0,disabled:t,children:o}),(0,i.jsxs)(Tx,{"data-testid":"menu",children:[(0,i.jsxs)(bx,{onSelect:r,disabled:!l,children:[(0,i.jsx)(xx,{children:n("hooks.tile.menu.paste")}),(0,i.jsx)(Vo.z9,{children:(0,Is.Yt)()})]}),p]})]})};const Px=p()((()=>o.e(5862).then(o.bind(o,75862))),{loadableGenerated:{webpack:()=>[75862]}}),Ex=e=>{let{pages:t,presentMode:o,isMobile:n}=e;return Sd({pages:t,presentMode:o,isMobile:n}),null},_x=(0,g.ZP)(d.E.div).withConfig({displayName:"Tome__TomeStyles",componentId:"sc-50986b76-0"})`
  display: flex;
  flex-direction: column;
  overflow: ${e=>e.$isMobile?"visible":"hidden"};
  height: 100%;
`,jx=g.ZP.div.withConfig({displayName:"Tome__TomeContent",componentId:"sc-50986b76-1"})`
  display: flex;
  justify-content: center;
  flex: 1;
  position: relative;
`;function kx(e){e.preventDefault()}const Sx=(0,a.memo)((e=>{let{id:t,tome:o,isBot:n=!1,isMobileFromUA:d=!1,triggerTomeRefetch:u}=e;var p,h,b,y,w,T,I,_,j;const k=(0,g.Fg)(),Z=(0,Bc.Z)(),O=(0,Uc.sk)()?d:Z,{t:M}=(0,C.$G)(),$=(0,ws.yP)(),{user:D,flags:H,loading:F,error:G}=(0,a.useContext)(oi.Z),{apolloClient:U,clientId:z}=(0,L.bp)(),W=(0,m.useRouter)(),{exclusiveSelectTiles:K,deselectAllTiles:q}=(0,V.N4)();(0,a.useEffect)((()=>("undefined"!=typeof document&&document.addEventListener("contextmenu",kx),()=>{document.removeEventListener("contextmenu",kx)})),[]),(0,a.useEffect)((()=>()=>{(0,A.oG)(!1)}),[]);const[Y,J]=(0,r.FV)(A.xi);(0,a.useEffect)((()=>()=>{J(!1)}),[J]),(0,a.useEffect)((()=>{var e;if((null===(e=o)||void 0===e?void 0:e.canonicalUrl)&&W.asPath){const e=new URL(o.canonicalUrl),t=new URL(W.asPath,window.location.origin);e.pathname!==t.pathname&&W.replace(e.toString().replace(e.origin,""),void 0,{shallow:!0})}}),[null===(p=o)||void 0===p?void 0:p.canonicalUrl,W,W.asPath]),(0,a.useEffect)((()=>(l.v.addRumGlobalContext("tomeId",t),()=>{l.v.removeRumGlobalContext("tomeId")})),[t]),(0,a.useEffect)((()=>{var e;F||Ne.ZP.reportTomeView({apolloClient:U,tomeId:t,tomeOrgId:null===(e=o.org)||void 0===e?void 0:e.id})}),[F,t,U,null===(h=o.org)||void 0===h?void 0:h.id]);const X=!F&&!D,Q=(0,r.Zl)(A.Vx),ee=(0,r.Zl)(A.pt),te=(0,s.l)(A.oG),[oe,ne]=(0,r.FV)(A.DH),ie=null!==oe,ae=Ql(),[re,le]=(0,r.FV)((0,Hd.J)(o.id)),se=(0,E.t2)(),{height:de,width:ce}=(0,B.Z)(),ue=(0,r.sJ)(A.GP),pe=(0,r.sJ)(ke.cm),me=(0,r.sJ)(ke.s5),he=(0,s.l)(A.Ad),[ge,Ce]=(0,r.FV)(A.dt),fe=(null===(b=o.currentUserPermission)||void 0===b?void 0:b.canEdit)&&!O,xe=(null===(y=o.currentUserPermission)||void 0===y?void 0:y.canComment)&&!O,ve=fe&&!te&&!O&&(ue||!(null===(w=H)||void 0===w?void 0:w.offlineReadOnly))&&0===he.length,be=(0,r._8)((e=>{let{snapshot:t}=e;return e=>{var n;const i=t.getLoadable(A.Vx).getValue();if(!ve||te||ie)return;const a=(0,N.xh)(o.pages,i),r=null===a?(null===(n=o.pages)||void 0===n?void 0:n.length)||0:a+1,{pageId:l,tileId:s}=(0,Fc.Vy)(o,r,U,z,e);Q(l),K([s]),ee((e=>e.length>0?[]:e))}}),[ve,te,ie,o,U,z,Q,K,ee]),ye=(0,a.useCallback)((()=>{(0,A.oG)(!1),ne(null),se.closePropertyPanel(),q()}),[q,se,ne]),we=(0,a.useCallback)((()=>{te||(ye(),(0,A.oG)(!0),Ne.ZP.reportTogglePlayMode({apolloClient:U,tomeId:t,mode:Ne.jv.ON}))}),[U,t,te,ye]),Te=(0,a.useCallback)((()=>{ne(null),q()}),[q,ne]),Ie=(0,a.useCallback)((()=>{te&&(fe||xe)&&(ye(),Ne.ZP.reportTogglePlayMode({apolloClient:U,tomeId:t,mode:Ne.jv.OFF}))}),[te,fe,xe,ye,U,t]),Pe=(0,a.useRef)(null),{handleTap:Ee,handlePointerDown:_e,handlePointerUp:je,isHoldingLeft:Se}=Vc({pages:o.pages,enabled:O&&!re}),{outlineWidth:Ze,toolbarWidth:Re,pageContainerWidth:Oe,pageContainerHeight:Me,pageVerticalMargin:$e}=(0,Zr.yn)(ce||0,de||0,O);(0,a.useEffect)((()=>{(0,dr.hT)(U,o.id)}),[U,o.id]);const Le=(0,a.useRef)(null),Ae=(0,a.useRef)(null),De=(0,a.useRef)(null),Be=(0,a.useRef)(null),He=(0,a.useRef)(null),Ve=(0,a.useRef)(null),Fe=(0,a.useRef)(null),Ge=(0,a.useRef)(null),Ue=(0,a.useRef)(null),ze=(0,a.useRef)(null),We=(0,a.useCallback)((e=>{if(pe||me)return;const t=Le.current&&Le.current.contains(e.target),o=De.current&&De.current.contains(e.target),n=Be.current&&Be.current.contains(e.target),i=He.current&&He.current.contains(e.target),a=Ve.current&&Ve.current.contains(e.target),r=e.target.closest("[data-reference-element]");let l=!1;He.current&&He.current.querySelectorAll("[data-tile-type]").forEach((t=>{t.contains(e.target)&&(l=!0)})),t||ee((e=>e.length>0?[]:e)),e.target===He.current&&q(),o||n||i||r||(se.closePropertyPanel(),e.shiftKey||(0,Is.ZP)(e)||q(),(0,A.PS)(!1),(0,A.k$)(!1)),a||(0,A.k$)(!1),oe&&!l&&Te()}),[pe,me,oe,ee,se,q,Te]),Ke=(0,a.useRef)(0),qe=(0,r.Zl)(R.GS),Ye=(0,v.s)(),Je=(0,v.s)(),Xe=(0,Go.Z)();(0,a.useEffect)((()=>{var e,t;(null===(e=H)||void 0===e?void 0:e.mutationErrorModal)&&0!==he.length&&(he[0].gqlErrors&&"Not Authorised!"===(null===(t=he[0].gqlErrors[0])||void 0===t?void 0:t.message)?(l.v.addAction("showSessionErrorModal",{errorEdits:he}),Je.open()):(l.v.addAction("showMutationErrorModal",{errorEdits:he}),Ye.open()))}),[he,null===(T=H)||void 0===T?void 0:T.mutationErrorModal,Ye,Je]),(0,a.useEffect)((()=>{var e;const t=!!(null===(e="cl8t9mtgr3144354v7xr4gn6cil,cl87q63j59832314v9olin8ij08,cl94ocnr82784764u5etg10rltp,clabpa1uk930704u8nbyxrumct,clbzdtalb0001853y4f6m6z8q")?void 0:e.split(",").includes(o.id));le(t)}),[le,o.id]);const Qe=(0,a.useMemo)((()=>({outlineRef:Le,toolbarRef:De,propertyPanelRef:Be,currentPageRef:He,commentsSheetRef:Ve,expandedTileRef:Fe,onboardingAutotomeRef:Ge,titleEditableLabelRef:Ue,headerBackButtonRef:ze,addPageRef:Ae})),[Le,De,Be,He,Ve,Fe,Ge,Ue,ze,Ae]);if(!F&&G)return null;const et=(0,Ol.$Q)(o),tt=(null===(I=H)||void 0===I?void 0:I.editorIaUpdates)?(0,i.jsx)(uu,{height:de||0,width:Re,tomeId:o.id}):(0,i.jsx)(Nc,{height:de||0,width:Re});return(0,i.jsxs)(i.Fragment,{children:[(0,i.jsx)(Su,{triggerTomeRefetch:u}),(0,i.jsx)(Ex,{pages:o.pages,presentMode:te,isMobile:O}),(0,i.jsx)(Od,{id:t,tome:o}),(0,i.jsx)(jd,{tome:o}),(0,i.jsxs)(L.dK.Provider,{value:Qe,children:[(0,i.jsx)(Pu,{ref:Ge}),(0,i.jsx)(mx,{setKeyboardEnabled:Ce,tomeId:o.id,isEmptyTome:et,canEdit:ve}),(0,i.jsxs)(_x,{$isMobile:O,"data-testid":"tome_styles",style:{backgroundColor:te||O?k.colors.page:k.colors.background},onClickCapture:Ee,onPointerDownCapture:_e,onPointerUpCapture:je,onDragEnter:e=>{ve&&(0,Gc.C)(e)&&(Ke.current+=1,1===Ke.current&&(qe(!0),$({action:ws.$C.CLOSE})))},onDragLeave:e=>{ve&&(0,Gc.C)(e)&&(Ke.current-=1,0===Ke.current&&qe(!1))},onDrop:e=>{(0,Gc.C)(e)&&(e.preventDefault(),ve&&(Ke.current=0,qe(!1)))},onDragOver:e=>{(0,Gc.C)(e)&&e.preventDefault()},children:[O&&(0,i.jsx)(Eu,{visible:Se}),!n&&(0,i.jsx)(ur,{tomeId:o.id}),!O&&(0,i.jsx)(Id,{tome:o,presentMode:te,expandMode:ie,enterPresentMode:we,exitPresentMode:Ie}),O&&(0,i.jsx)(Wr,{isInExpandMode:ie,tome:o}),(0,i.jsx)(Ix,{disabled:!ve||te,children:(0,i.jsxs)(jx,{onMouseDown:We,children:[!O&&(0,i.jsx)(x.Z,{presentMode:te||!!oe,skipPresentModeAnimation:X,transition:P.Oo,children:(0,i.jsx)(Px,{tome:o,width:Ze,canEdit:ve,onAddPage:be,showLayoutSelection:Y,setShowLayoutSelection:J})}),re&&(null===(j=o)||void 0===j||null===(_=j.pages)||void 0===_?void 0:_[0].overlay)&&(0,i.jsx)($u,{overlayData:o.pages[0].overlay,isMobile:O,pages:o.pages,tomeId:o.id,sliderRef:Pe}),ge&&(0,i.jsx)(Bu,{isInExpandMode:ie,enterPresentMode:we,exitPresentMode:Ie,exitExpandMode:Te,tome:o,canEdit:ve,presentMode:te,setShowLayoutSelection:J}),(0,i.jsx)(wc,{ref:Pe,isBot:n,isMobile:O,isInExpandMode:ie,canEdit:ve,useEditablePage:fe,presentMode:te,fullscreenMode:ae,tome:o,width:ce||0,pageContainerWidth:Oe,pageContainerHeight:Me,pageVerticalMargin:$e}),(0,i.jsxs)(x.Z,{presentMode:te||!!oe,skipPresentModeAnimation:X,transition:P.Oo,children:[(0,i.jsx)(Qa,{height:de||0,tome:o,toolbarWidth:Re}),!O&&ve&&tt]}),!n&&(0,i.jsxs)(i.Fragment,{children:[(0,i.jsx)(c.M,{children:te&&(0,i.jsx)(S,{height:de||0,width:Re,resetToFullCanvas:ye})}),(0,i.jsx)(pr.Z,{subscribeTo:A.x0})]})]})}),(0,i.jsx)(x.Z,{presentMode:te||!!oe,skipPresentModeAnimation:X,transition:P.Oo,children:(0,i.jsx)(pu.W,{children:!O&&(0,i.jsx)(f.Z,{})})}),te&&!ie&&!O&&(0,i.jsx)(sr,{}),!ie&&(0,i.jsx)(x.Z,{presentMode:!te||O,skipPresentModeAnimation:X,children:(0,i.jsx)(vr,{pages:o.pages,isFullscreen:ae})}),Xe&&(0,i.jsxs)(i.Fragment,{children:[(0,i.jsx)(v.Z,{ref:Ye.ref,title:M("components.tome.errorSyncing.tomeErrorSyncingModalTitle"),subtitle:M("components.tome.errorSyncing.tomeErrorSyncingModalSubtitle"),primaryButtonContent:M("components.tome.errorSyncing.reloadButtonLabel"),primaryButtonAction:()=>{var e,t;null===(t=window)||void 0===t||null===(e=t.location)||void 0===e||e.reload()},cancelButtonText:M("components.tome.errorSyncing.cancelButtonLabel"),cancelButtonAction:()=>{Ye.close()},buttonColor:"default",dismissible:!0}),(0,i.jsx)(v.Z,{ref:Je.ref,title:M("components.tome.sessionExpired.sessionExpiredErrorModalTitle"),subtitle:M("components.tome.sessionExpired.sessionExpiredErrorModalSubtitle"),primaryButtonContent:M("components.tome.sessionExpired.signInButtonLabel"),primaryButtonAction:()=>{window.location.href=(0,Xl.bM)(W)},cancelButtonText:M("components.tome.sessionExpired.cancelButtonLabel"),cancelButtonAction:()=>{Je.close()},buttonColor:"default",dismissible:!0}),(0,i.jsx)(Oo.n,{})]}),Xe&&(0,i.jsx)(ju,{tomeId:o.id})]})]})]})}));var Zx=e=>{let{tome:t,...o}=e;return(0,i.jsx)(fa.Z,{tomeId:t.id,children:(0,i.jsx)(Z.e,{children:(0,i.jsx)(Nt.N,{children:(0,i.jsx)(Dc.G,{children:(0,i.jsx)(Sx,{tome:t,...o})})})})})},Rx=o(57789),Ox=o(3667),Mx=o(89834);const $x=e=>{let{guestId:t}=e;var o,n;const{t:a}=(0,C.$G)(),{data:r}=(0,G.lt1)({variables:{id:t}}),l=null===(n=r)||void 0===n||null===(o=n.guestInvite)||void 0===o?void 0:o.email;if(!l)return null;const s=a("components.accessError.thisLinkWasSentToInviteEmailExtraMessage",{inviteEmail:l});return(0,i.jsx)(i.Fragment,{children:s})};var Lx=e=>{let{email:t,guestId:o}=e;const n=(0,m.useRouter)(),{t:a}=(0,C.$G)();return t?(0,i.jsx)(Mx.Z,{mainMessage:a("components.accessError.youDoNotHaveAccessToThisTomeMainErrorMessage"),children:(0,i.jsxs)(Mx.N,{children:[o&&(0,i.jsx)($x,{guestId:o}),a("components.accessError.youAreSignedInAsEmailMessage",{email:t}),(0,i.jsx)(yr(),{href:(0,Xl.bM)(n),children:a("components.accessError.signInLinkInAccessErrorPage")}),a("components.accessError.withADifferentAccount")]})}):(0,i.jsx)(Rx.default,{})},Ax=o(18049),Nx=o(2705);function Dx(e){var t,o,n;const i=null===(t=e)||void 0===t?void 0:t.currentUserPermission;return!(!(null===(o=e)||void 0===o?void 0:o.publicScope)||"PUBLIC"!==(null===(n=i)||void 0===n?void 0:n.how))||!(!i||!vs(i))}const Bx=e=>{let{id:t,fetchFullPage:o,isBot:n,isMobileFromUA:s,loadingTheme:d,ssrTome:c,preloadFontData:u,preferCache:p}=e;var m,h,g,C;const f=(0,r.sJ)(A.Vx),{activePageRef:x}=(0,sa.R)(),{loading:v,error:b,data:y,refetch:w}=(0,G.OWl)({variables:{id:t,fetchFullPage:o,prefetchPreviewImage:!1},fetchPolicy:p?"cache-first":"network-only",nextFetchPolicy:"cache-first",errorPolicy:"all"}),{loading:T,data:I}=(0,G.UEB)({errorPolicy:"all"}),P=(0,r.Zl)(Ox.Z);(0,a.useEffect)((()=>function(){P(!1)}),[P]);const E=function(e){let{meData:t,meQueryLoading:o,tomeData:n,tomeQueryLoading:i,ssrTome:a}=e;const r=o?null:!t;let l;return l=a?Dx(a):i?null:Dx(n),!0===r||!0===l||(null===r||null===l?null:r||l)}({meData:null===(m=I)||void 0===m?void 0:m.me,meQueryLoading:T,tomeData:null===(h=y)||void 0===h?void 0:h.tome,tomeQueryLoading:v,ssrTome:c});(0,a.useEffect)((()=>{null!==E&&(0,A.oG)(E)}),[E]);const _=E||s,j=(null===(g=y)||void 0===g?void 0:g.tome)??(_?c:null);if((v||T)&&!c)return(0,i.jsx)(Yd.Z,{theme:d,preloadFontData:u,children:(0,i.jsx)(Ax.Z,{})});if(b){var k,S;let e=!1;"undefined"!=typeof document&&(e=document.hasFocus()),l.v.addError(b,{hasFocus:e});const t=new URL(window.location.href);if(t.searchParams.get("promptLogin"))return(0,i.jsx)(Nx.Z,{});const o=t.searchParams.get("guest");return(null===(k=I)||void 0===k?void 0:k.me)?(0,i.jsx)(Lx,{email:null===(S=I)||void 0===S?void 0:S.me.email,guestId:o}):(0,i.jsx)(Rx.default,{})}if(!j)return null;const Z=(0,N.yW)(j.pages,f);return(0,i.jsx)(Yd.Z,{theme:null===(C=Z)||void 0===C?void 0:C.theme,themeRef:x,activeBodyTheme:!0,loadFonts:!0,preloadFontData:u,children:(0,i.jsx)(Zx,{id:t,triggerTomeRefetch:w,tome:j,isBot:n,isMobileFromUA:s})})},Hx=e=>{const{id:t,loadingTheme:o,preloadFontData:n,...a}=e;return t?(0,i.jsx)(Bx,{...a,id:t,loadingTheme:o,preloadFontData:n}):(0,i.jsx)(Yd.Z,{theme:o,preloadFontData:n,children:(0,i.jsx)(Ax.Z,{})})};var Vx=Bx},25937:function(e,t,o){o.d(t,{Z:function(){return y}});var n=o(85893),i=o(67294),a=o(59016),r=o(4298),l=o.n(r),s=o(1922),d=o(59090),c=o(51521),u=o(93996),p=o(38452),m=o(2767);var h=(0,i.forwardRef)(((e,t)=>(0,n.jsx)(m.Z,{ref:t,viewBox:"0 0 28 28",...e,children:(0,n.jsx)("path",{fillRule:"evenodd",clipRule:"evenodd",d:"M14.0093 24.509V24.509C8.2103 24.509 3.50928 19.808 3.50928 14.009C3.50928 8.21006 8.2103 3.50903 14.0093 3.50903C19.8083 3.50903 24.5093 8.21006 24.5093 14.009V14.009C24.5093 19.808 19.8083 24.509 14.0093 24.509V24.509ZM14.0093 5.25903V5.25903C9.17678 5.25903 5.25928 9.17654 5.25928 14.009C5.25928 18.8415 9.17679 22.759 14.0093 22.759C18.8418 22.759 22.7593 18.8415 22.7593 14.009V14.0091C22.7593 9.17667 18.8418 5.25916 14.0094 5.25912L14.0093 5.25903ZM14.9937 15.759C14.9937 16.0007 14.7978 16.1965 14.5562 16.1965H13.5718V16.1965C13.3302 16.1965 13.1343 16.0007 13.1343 15.759C13.1343 12.8521 15.5952 13.126 15.5952 10.9465C15.5952 10.2216 14.7727 9.63403 13.9273 9.63403C13.0819 9.63403 12.2456 10.2216 12.2456 10.9465V10.9465C12.2427 11.1955 12.2811 11.4433 12.3594 11.6797V11.6797C12.4388 11.9067 12.3192 12.1551 12.0922 12.2346C12.0459 12.2508 11.9972 12.2591 11.9481 12.2591H11.0595V12.2591C10.8622 12.2596 10.6887 12.1285 10.6353 11.9385V11.9385C10.5481 11.6152 10.5057 11.2814 10.5093 10.9465C10.5093 9.25516 12.0762 7.88403 14.0093 7.88403C15.9424 7.88403 17.5093 9.25512 17.5093 10.9465C17.5092 13.7539 14.9936 13.6446 14.9936 15.7591L14.9937 15.759ZM14.0093 17.509V17.509C14.7342 17.509 15.3218 18.0967 15.3218 18.8215C15.3218 19.5464 14.7342 20.134 14.0093 20.134C13.2844 20.134 12.6968 19.5464 12.6968 18.8215V18.8216C12.6968 18.0967 13.2844 17.5091 14.0092 17.5091L14.0093 17.509Z"})}))),g=o(18428),C=o(8034);var f=(0,i.forwardRef)(((e,t)=>(0,n.jsx)(m.Z,{ref:t,viewBox:"0 0 64 64",...e,children:(0,n.jsx)("path",{fillRule:"evenodd",clipRule:"evenodd",d:"M52.4973 56H11.5058V56C10.6712 55.9979 9.99628 55.3195 9.99842 54.4848C9.99854 54.4362 10.001 54.3876 10.0058 54.3392C10.677 47.5048 17.7956 40 32.0015 40C46.2074 40 53.3256 47.5048 53.997 54.3392V54.3392C54.0796 55.1698 53.4732 55.91 52.6426 55.9926C52.5944 55.9974 52.5459 55.9999 52.4973 56V56ZM32.0015 36C25.6 36 20.0082 30.4443 20.0082 21.5C20.0082 13.8 24.85 8 32.0015 8C39.153 8 43.995 13.8 43.995 21.5C43.995 30.4443 38.4032 36 32.0015 36Z"})}))),x=o(47612),v=o(90036);const b=(0,a.ZP)(p.ZP).withConfig({displayName:"Help__Button",componentId:"sc-feb451ab-0"})`
  z-index: ${c.bf};
`;var y=()=>{const e=(0,a.Fg)(),{t:t}=(0,s.$G)(),o=(0,d.ye)(d.TT.EDITOR_IA_UPDATES),r=o?e.buttonSize:e.largerButtonSize,c=o?e.iconSize:e.largerIconSize,p=(0,n.jsx)(h,{style:{width:c,height:c}}),m=t("components.help.helpIconTooltiplabel"),y=(0,i.useCallback)((()=>{window.open("https://tome.app/tomecommunity/help-and-support-guide-cl4g57jlc4983274wc2flzoz9np","_blank")}),[]),w=(0,i.useCallback)((()=>{window.open("https://tome.app/tomecommunity/tome-getting-started-guide-cl5sigulu1899274x5iqictrjgv","_blank")}),[]),T=(0,i.useCallback)((()=>{window.open("https://calendly.com/use-tome/personal-tour","_blank")}),[]),I=(0,i.useCallback)((()=>{window.Intercom&&window.Intercom("show")}),[]),P=(0,i.useMemo)((()=>[{type:"option",text:t("components.help.gettingStartedGuideMenuItemLabel"),action:w,image:(0,n.jsx)(v.Z,{style:{width:16,height:16,marginRight:8}})},{type:"option",text:t("components.help.helpAndSupportGuideMenuItemLabel"),action:y,image:(0,n.jsx)(x.Z,{style:{width:16,height:16,marginRight:8}})},{type:"option",text:t("components.help.sendUsAMessageMenuItemLabel"),action:I,image:(0,n.jsx)(C.Z,{style:{width:16,height:16,marginRight:8}})},{type:"option",text:t("components.help.scheduleAPersonalTourMenuItemLabel"),action:T,image:(0,n.jsx)(f,{style:{width:16,height:16,marginRight:8}})}]),[T,I,y,w,t]);return(0,n.jsxs)(n.Fragment,{children:[(0,n.jsx)(l(),{id:"intercom-settings",children:'\n        window.intercomSettings = {\n          api_base: "https://api-iam.intercom.io",\n          app_id: "qsgvgurd",\n          hide_default_launcher: true,\n        };      \n      '}),(0,n.jsx)(l(),{id:"intercom-script-load",strategy:"lazyOnload",children:"\n          (function(){var w=window;var ic=w.Intercom;if(typeof ic===\"function\"){ic('reattach_activator');ic('update',w.intercomSettings);}else{var d=document;var i=function(){i.c(arguments);};i.q=[];i.c=function(args){i.q.push(args);};w.Intercom=i;var l=function(){var s=d.createElement('script');s.type='text/javascript';s.async=true;s.src='https://widget.intercom.io/widget/qsgvgurd';var x=d.getElementsByTagName('script')[0];x.parentNode.insertBefore(s,x);};if(document.readyState==='complete'){l();}else if(w.attachEvent){w.attachEvent('onload',l);}else{w.addEventListener('load',l,false);}}})();\n        "}),(0,n.jsx)(g.Z,{itemsOrFn:P,menuWidth:208,menuPosition:"above",menuAlign:"right",additionalSpacing:-8,children:(0,n.jsx)(u.Z,{content:m,children:(0,n.jsx)(b,{style:{width:r,minWidth:r,height:r},variant:"uncontained","aria-label":m,onClick:()=>{},onZ0:!0,iconOpacity:.5,icon:p})})})]})}},80882:function(e,t,o){var n=o(85893),i=o(67294),a=o(59016);const r=a.ZP.span.withConfig({displayName:"Badge__StyledComponent",componentId:"sc-5413426f-0"})`
  position: relative;
`,l=a.ZP.span.withConfig({displayName:"Badge__BadgeDisplay",componentId:"sc-5413426f-1"})`
  opacity: ${e=>e.$visible?1:0};

  // Generic positioning
  display: flex;
  flex-direction: row;
  flex-wrap: wrap;
  justify-content: center;
  align-content: center;
  align-items: center;
  position: absolute;
  box-sizing: border-box;
  z-index: 1;

  // Sizing
  border-radius: ${4}px;
  height: ${8}px;
  width: ${8}px;
  padding: 0;
  background-color: ${e=>e.theme.colors.uiAccent};
  border: 1px solid ${e=>e.theme.colors.background};

  // Positioning top-right
  top: ${2}px;
  right: ${2}px;
`,s=(0,i.forwardRef)(((e,t)=>{const{$visible:o=!0,children:i,component:a="span",...s}=e;return(0,n.jsxs)(r,{as:a,ref:t,...s,children:[(0,n.jsx)(l,{$visible:o}),i]})}));t.Z=s},44359:function(e,t,o){o.d(t,{Y:function(){return i},Z:function(){return a}});var n=o(59016);const i=n.ZP.button.withConfig({displayName:"BaseButton",componentId:"sc-3b22cbe0-0"})`
  font-size: ${e=>e.theme.fontSizes.xs};
  color: ${e=>e.theme.colors.contrast};
  background: ${e=>e.selected?e.theme.colors.buttonTransparentBackgroundSelected:e.theme.colors.transparent};
  ${e=>e.disabled&&"\n    opacity: 0.4;\n  "}
  &:hover {
    background: ${e=>e.selected?e.theme.colors.buttonTransparentBackgroundSelectedHover:e.theme.colors.buttonTransparentBackgroundHover};
  }
`,a=(0,n.ZP)(i).withConfig({displayName:"BaseButton__BaseFilledButton",componentId:"sc-3b22cbe0-1"})`
  background: ${e=>e.selected?e.theme.colors.buttonFilledBackgroundSelected:e.theme.colors.buttonFilledBackground};
  &:hover {
    background: ${e=>e.selected?e.theme.colors.buttonFilledBackgroundSelectedHover:e.theme.colors.buttonFilledBackgroundHover};
  }
`},40920:function(e,t,o){o.d(t,{Z:function(){return p}});var n,i=o(85893),a=o(59016),r=o(67294);function l(){return l=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var o=arguments[t];for(var n in o)Object.prototype.hasOwnProperty.call(o,n)&&(e[n]=o[n])}return e},l.apply(this,arguments)}var s=function(e){return r.createElement("svg",l({width:39,height:37,fill:"none",xmlns:"http://www.w3.org/2000/svg"},e),n||(n=r.createElement("path",{fillRule:"evenodd",clipRule:"evenodd",d:"M3.667 16.855l9.79 14.022L34.406.867a2.001 2.001 0 013.05-.279c.696.732.768 1.857.172 2.672L15.49 34.97a2.482 2.482 0 01-4.07 0L.446 19.25a2.088 2.088 0 01.17-2.672 2.002 2.002 0 013.051.278z",fill:"#fff"})))};const d=a.ZP.div.withConfig({displayName:"Checkbox__CheckboxContainer",componentId:"sc-70110d59-0"})`
  position: relative;
  width: ${e=>e.width}px;
  height: ${e=>e.height}px;
`,c=a.ZP.input.attrs({type:"checkbox"}).withConfig({displayName:"Checkbox__CheckboxInput",componentId:"sc-70110d59-1"})`
  position: absolute;
  top: 0;
  left: 0;
  opacity: 0;
  height: 100%;
  width: 100%;
  cursor: pointer;
`,u=a.ZP.div.withConfig({displayName:"Checkbox__CheckboxBase",componentId:"sc-70110d59-2"})`
  width: 100%;
  height: 100%;
  background: ${e=>e.checked?e.theme.colors.uiAccent:e.theme.colors.contrast8};
  border-radius: 2px;
  display: flex;
  align-items: center;
  justify-content: center;
`;var p=e=>{let{id:t,height:o,width:n,checked:a,onClick:r}=e;return(0,i.jsxs)(d,{height:o,width:n,children:[(0,i.jsx)(c,{id:t,"data-testid":t,onClick:()=>r?r():null,checked:a,readOnly:!0}),(0,i.jsx)(u,{checked:a,children:a&&(0,i.jsx)(s,{viewBox:"-10 -10 60 60"})})]})}},32587:function(e,t,o){o.r(t),o.d(t,{default:function(){return Q}});var n=o(85893),i=o(62830),a=o.n(i),r=o(67294),l=o(64310),s=o(1922),d=o(96215),c=o(9228),u=o(979),p=o(82273),m=o(1150),h=o(28670),g=o.n(h),C=o(59016),f=o(3266),x=o(2767);var v=(0,r.forwardRef)(((e,t)=>(0,n.jsx)(x.Z,{ref:t,viewBox:"0 0 64 64",...e,children:(0,n.jsx)("path",{d:"M33.1779 26.6645L37.3671 30.8535C38.256 31.7395 38.2583 33.1783 37.3724 34.0672C37.3709 34.0686 37.3695 34.0701 37.368 34.0715L21.555 49.8569C17.9355 53.4769 14.6766 51.7988 12.9542 53.5211C12.2418 54.1422 11.1887 54.1695 10.445 53.5862C9.86205 52.8424 9.88937 51.7895 10.5101 51.0769C12.2326 49.3546 10.5548 46.096 14.1743 42.4769L29.96 26.6636H29.96C30.8462 25.7753 32.2848 25.7735 33.1731 26.6597C33.1747 26.6613 33.1763 26.6629 33.1779 26.6645V26.6645ZM52.4868 18.9818L45.0624 26.4L46.0251 27.362C47.3262 28.6516 47.3354 30.7517 46.0458 32.0528C44.7562 33.3538 42.6561 33.363 41.355 32.0734C41.3475 32.0659 41.3399 32.0584 41.3324 32.0508L31.9471 22.6733C30.6523 21.3774 30.6532 19.2772 31.9491 17.9824C33.245 16.6876 35.3452 16.6885 36.64 17.9844L37.6329 18.9764L45.0573 11.5583V11.5583C47.1073 9.50657 50.4323 9.50512 52.4841 11.5551C54.5358 13.605 54.5373 16.9301 52.4873 18.9818H52.4868Z"})}))),b=o(8292),y=o(59090),w=o(34959),T=o(18428),I=o(64945),P=o(89522),E=o(38452),_=o(74215);const j=C.ZP.div.withConfig({displayName:"ColorPickerPanel.styles__SaturationWrapper",componentId:"sc-881bff69-0"})`
  height: 140px;
  position: relative;
  border-radius: 8px;
  margin: 0 12px;
  overflow: hidden;
`,k=C.ZP.div.withConfig({displayName:"ColorPickerPanel.styles__SaturationInnerWrapper",componentId:"sc-881bff69-1"})`
  width: 100%;
  height: 100%;
`,S=C.ZP.div.withConfig({displayName:"ColorPickerPanel.styles__HueWrapper",componentId:"sc-881bff69-2"})`
  width: 100%;
  height: 8px;
  margin: 12px 0;
  position: relative;

  .hue-horizontal {
    border-radius: 4px;
    width: auto;
    margin: 0 12px;
  }
`,Z=C.ZP.div.withConfig({displayName:"ColorPickerPanel.styles__PickerContainer",componentId:"sc-881bff69-3"})`
  width: 14px;
  height: 14px;
  transform: ${e=>e.$isHue?"translate(-7px, -3px);":"translate(-7px, -7px);"};
`,R=C.ZP.div.attrs((e=>({style:{backgroundColor:`hsl(${e.$hue}, 100%, 50%)`}}))).withConfig({displayName:"ColorPickerPanel.styles__PickerInner",componentId:"sc-881bff69-4"})`
  width: 8px;
  height: 8px;
  top: 3px;
  left: 3px;
  border-radius: 100%;
  position: absolute;
  box-shadow: inset 0px 0.5px 1.5px rgba(0, 0, 0, 0.25);
`,O=C.ZP.div.withConfig({displayName:"ColorPickerPanel.styles__PickerOuter",componentId:"sc-881bff69-5"})`
  width: 14px;
  height: 14px;
  border-radius: 100%;
  background-color: transparent;
  position: absolute;
  border: 3px solid white;
  box-shadow: 0px 0.5px 1.5px rgba(0, 0, 0, 0.25);
`,M=C.ZP.div.withConfig({displayName:"ColorPickerPanel.styles__PickerInputsContainer",componentId:"sc-881bff69-6"})`
  display: flex;
  padding: 0 12px 12px 12px;
  gap: 8px;
`,$=C.ZP.div.withConfig({displayName:"ColorPickerPanel.styles__ColorPickerOverlay",componentId:"sc-881bff69-7"})`
  position: fixed;
  top: 0;
  left: 0;
  width: 100vw;
  height: 100vh;
  background-color: transparent;
`,L=()=>(0,n.jsx)(Z,{"data-testid":"saturation_picker",children:(0,n.jsx)(O,{})}),A=e=>{let{hsl:t}=e;return(0,n.jsxs)(Z,{$isHue:!0,"data-testid":"hue_picker",children:[(0,n.jsx)(O,{}),(0,n.jsx)(R,{$hue:t.h})]})},N=C.ZP.div.withConfig({displayName:"ColorPickerPanel.styles__WorspaceColorsContainer",componentId:"sc-881bff69-8"})`
  padding: 0 12px 12px 12px;
`,D=C.ZP.div.withConfig({displayName:"ColorPickerPanel.styles__WorkspaceSwatches",componentId:"sc-881bff69-9"})`
  display: flex;
  flex-direction: row;
  flex-wrap: wrap;
  gap: 8px;
  margin-top: 9px;
`,B=C.ZP.div.withConfig({displayName:"ColorPickerPanel.styles__SwatchLabel",componentId:"sc-881bff69-10"})`
  font-size: ${e=>e.theme.fontSizes.sm};
  color: ${e=>e.theme.colors.contrast40};
`,H=C.ZP.div.withConfig({displayName:"ColorPickerPanel.styles__EmptyStateLabel",componentId:"sc-881bff69-11"})`
  font-size: ${e=>e.theme.fontSizes.sm};
  color: ${e=>e.theme.colors.contrast40};
  text-align: center;
  padding: 0px 22px;
  margin: 4px 0px;
`,V=(0,C.ZP)(_.Z).attrs((e=>{let{color:t,theme:o}=e;return{style:{backgroundColor:t,borderColor:(0,w.D1)({foregroundColorHex:t,backgroundColorHex:o.RAW_VALUES_LEGACY.sidebar})}}})).withConfig({displayName:"ColorPickerPanel.styles__Swatch",componentId:"sc-881bff69-12"})`
  height: 24px;
  width: 24px;
  border-radius: 100%;
  border-width: 1px;
  border-style: solid;
`,F=(0,r.createContext)({}),G=e=>{let{children:t,workspaceColors:o,workspaceColorsEnabled:i,addNewWorkspaceColor:a}=e;const l=(0,r.useMemo)((()=>({workspaceColors:o,workspaceColorsEnabled:i,addNewWorkspaceColor:a})),[o,i,a]);return(0,n.jsx)(F.Provider,{value:l,children:t})};var U=F,z=o(40405),W=o(42002);const K=(0,C.ZP)(z.Z).withConfig({displayName:"CustomColorInput__StyledInput",componentId:"sc-1fa70ca8-0"})`
  margin: 0px;
  min-height: unset;
  height: 28px;
  padding-left: 12px;
  user-select: text;
  text-transform: uppercase;

  :focus {
    outline: 1px ${e=>{let{theme:t}=e;return t.colors.uiAccent}} solid;
  }
`;var q=e=>{let{value:t,onChangeComplete:o}=e;const[i,a]=(0,r.useState)(t),l=(0,r.useRef)(null);(0,r.useEffect)((()=>{a(t)}),[t]);const s=(0,r.useCallback)((e=>{a(e.target.value)}),[]),d=(0,r.useCallback)((()=>{const e=i.trim();if((0,W.B)(e)){const n=g()(e).hex();n!==t&&o(n),i!==t&&a(n)}else a(t)}),[i,o,t]),c=(0,r.useCallback)((e=>{e.preventDefault(),l.current&&l.current.blur()}),[]);return(0,r.useEffect)((()=>{const e=l.current;return e&&e.addEventListener("blur",d),()=>{e&&e.removeEventListener("blur",d)}}),[d]),(0,n.jsx)("form",{onSubmit:c,children:(0,n.jsx)(K,{ref:l,variant:"fill",autoComplete:"false",spellCheck:"false",value:i,onChange:s})})};const Y=(0,p.iS)((e=>{let{onChange:t,customOnChangeComplete:o,...i}=e;const a=(0,P.s)(),[l,d]=(0,r.useState)({hue:!1,saturation:!1}),{workspaceColors:u,workspaceColorsEnabled:p,addNewWorkspaceColor:h}=(0,r.useContext)(U),C=u.map((e=>e.toLowerCase())),x=(0,r.useCallback)((e=>{var n,i;null===(n=o)||void 0===n||n(e),null===(i=t)||void 0===i||i(e)}),[o,t]),b=(0,r.useCallback)((()=>{(new EyeDropper).open().then((e=>{var n;if(e&&(null===(n=e)||void 0===n?void 0:n.sRGBHex)){var i;const n=g()(e.sRGBHex).hex();null===(i=t)||void 0===i||i(n),o&&o(n)}})).catch((()=>{}))}),[t,o]),{t:y}=(0,s.$G)(),w=(0,r.useCallback)((()=>{i.hex&&C.includes(i.hex)?(0,c.ak)({message:y("library.colorPickerPanel.handleAddWorkspaceColorClickMessage")}):a.open()}),[i.hex,C,a,y]),T=(0,r.useCallback)((()=>{a.close()}),[a]),I=(0,r.useCallback)((()=>{i.hex&&h(i.hex),a.close()}),[h,i.hex,a]),_=(0,r.useCallback)((()=>{o&&o(i.hex),d((()=>({hue:!1,saturation:!1})))}),[o,i.hex]),Z=(0,r.useCallback)(((e,t)=>{e.preventDefault(),e.stopPropagation(),d((e=>({...e,[t]:!0})))}),[d]);return(0,n.jsxs)(n.Fragment,{children:[(0,n.jsx)(P.Z,{ref:a.ref,title:y("library.colorPickerPanel.confirmationModalTitle"),subtitle:y("library.colorPickerPanel.subtitleShareMessage"),cancelButtonText:y("library.colorPickerPanel.cancelButton"),cancelButtonAction:T,primaryButtonContent:y("library.colorPickerPanel.saveButton"),primaryButtonAction:I,buttonColor:"default",dismissible:!0}),(0,n.jsx)(j,{"data-testid":"saturation_panel",children:(0,n.jsxs)(k,{onMouseUp:_,onMouseDown:e=>Z(e,"saturation"),children:[l.saturation&&(0,n.jsx)($,{}),(0,n.jsx)(m.OQ,{...i,onChange:t,pointer:L})]})}),(0,n.jsxs)(S,{onMouseUp:_,onMouseDown:e=>Z(e,"hue"),"data-testid":"hue_panel",children:[l.hue&&(0,n.jsx)($,{}),(0,n.jsx)(m.PS,{...i,onChange:t,pointer:A})]}),(0,n.jsxs)(M,{children:[" ",window.EyeDropper&&(0,n.jsx)(E.ZP,{"aria-label":y("library.colorPickerPanel.ariaLabel.eyeDropper"),startIcon:(0,n.jsx)(v,{style:{width:18,height:18}}),style:{height:28,width:36,minWidth:36,padding:"0 10px"},iconStyles:{margin:0},onClick:b}),(0,n.jsx)(q,{value:i.hex||"",onChangeComplete:x}),p&&(0,n.jsx)(E.ZP,{value:i.hex,"aria-label":y("library.colorPickerPanel.ariaLabel.addWorkspaceColor"),startIcon:(0,n.jsx)(f.Z,{style:{width:18,height:18}}),style:{height:28,width:36,minWidth:36,padding:"0 10px"},iconStyles:{margin:0},onClick:w})]})]})})),J=C.ZP.div.withConfig({displayName:"ColorPickerPanel__ColorPickerPanelContainer",componentId:"sc-b5aa933d-0"})`
  width: 240px;
`;var X=e=>{let{setColor:t,setColorComplete:o,color:i,workspaceColors:a=[],addNewWorkspaceColor:l,removeWorkspaceColor:d}=e,c=i??"#000000";"black"===i||"dark"===i?c="#000000":"light"===i&&(c="#ffffff");const u=(0,y.ye)(y.TT.WORKSPACE_COLORS),p=(0,P.s)(),m=(0,r.useRef)(null),{t:h}=(0,s.$G)(),g=(0,r.useCallback)((e=>{t(e.hex)}),[t]),C=(0,r.useCallback)((e=>{var n;t(e.target.value),null===(n=o)||void 0===n||n(e.target.value)}),[t,o]),f=(0,I.Z)((e=>()=>{m.current=e,p.open()}),[p]),x=(0,r.useCallback)((()=>{m.current=null,p.close()}),[p]),v=(0,r.useCallback)((()=>{m.current&&(d(m.current),m.current=null),p.close()}),[d,p]);return(0,n.jsxs)(J,{"data-testid":"color_picker",children:[(0,n.jsx)(G,{workspaceColors:a,addNewWorkspaceColor:l,workspaceColorsEnabled:u,children:(0,n.jsx)(Y,{color:c,onChange:g,customOnChangeComplete:o})}),u&&(0,n.jsxs)(N,{children:[(0,n.jsx)(P.Z,{ref:p.ref,title:h("library.colorPickerPanel.deleteColorTitle"),subtitle:h("library.colorPickerPanel.deleteColorMessage"),cancelButtonText:h("library.colorPickerPanel.cancelButton"),cancelButtonAction:x,primaryButtonContent:h("library.colorPickerPanel.deleteButton"),primaryButtonAction:v,dismissible:!0,buttonColor:"destructive"}),a.length>0&&(0,n.jsxs)("div",{children:[(0,n.jsx)(B,{children:h("library.colorPickerPanel.workSpace")}),(0,n.jsx)(D,{"data-testid":"workspace_swatches",children:a.map((e=>(0,n.jsx)(T.Z,{menuWidth:140,menuPosition:"below",menuAlign:"click",rightClickActivated:!0,itemsOrFn:[{text:`${h("library.colorPickerPanel.deleteSavedColorButton")}`,action:f(e),variant:"destructive"}],children:(0,n.jsx)(V,{selected:i===e,disabled:i===e,title:e,color:e,value:e,onClick:C,children:i===e&&(0,n.jsx)(b.Z,{style:{scale:.5,fill:(0,w.YC)(e),height:"100%",width:"100%"}})})},e)))})]}),0===a.length&&(0,n.jsx)(H,{"data-testid":"empty_workspace_colors_label",children:h("library.colorPickerPanel.clickPlusButtonMessage")})]})]})};var Q=e=>{let{color:t,setColor:o,setColorComplete:i}=e;var p,m,h,g,C,f,x,v,b,y,w,T,I;const P=(0,u.j)(),[E]=(0,d.bpV)(),[_]=(0,d.gG)(),{data:j,refetch:k}=(0,d.OWj)({variables:{tomeId:P},fetchPolicy:"network-only",nextFetchPolicy:"cache-first"}),S=null===(g=j)||void 0===g||null===(h=g.tome)||void 0===h||null===(m=h.org)||void 0===m||null===(p=m.colors)||void 0===p?void 0:p.map((e=>e.hex)),{t:Z}=(0,s.$G)(),R=(0,r.useCallback)((e=>{var t,o,n;const i=null===(n=j)||void 0===n||null===(o=n.tome)||void 0===o||null===(t=o.org)||void 0===t?void 0:t.id;if(!i)return;const r=a()();E({variables:{colorId:r,orgId:i,colorHex:e},optimisticResponse:{__typename:"Mutation",createOrgColor:{__typename:"Color",id:r,hex:e,createdAt:(new Date).toISOString()}},update(e,t){let{data:o}=t;var n;const a=null===(n=o)||void 0===n?void 0:n.createOrgColor;if(!a)return;const r=e.writeFragment({id:`Color:${a.id}`,fragment:d.gr2,data:a,fragmentName:"ColorFragment"});e.modify({id:`Organization:${i}`,fields:{colors(){return[...arguments.length>0&&void 0!==arguments[0]?arguments[0]:[],r]}}})}}).catch((t=>{var o,n;l.v.addError(t,{colorHex:e}),(null===(n=t)||void 0===n||null===(o=n.message)||void 0===o?void 0:o.includes("already exists"))?((0,c.ak)({message:Z("library.stateConnectedColorPicker.alreadyExistErrorMessage")}),k({tomeId:P})):(0,c.ak)({message:Z("library.stateConnectedColorPicker.oopsSomethingWentWrongErrorMessage")})}))}),[E,null===(x=j)||void 0===x||null===(f=x.tome)||void 0===f||null===(C=f.org)||void 0===C?void 0:C.id,k,P,Z]),O=(0,r.useCallback)((e=>{var t,o,n,i,a,r,s,d;const u=null===(n=j)||void 0===n||null===(o=n.tome)||void 0===o||null===(t=o.org)||void 0===t?void 0:t.id,p=null===(d=j)||void 0===d||null===(s=d.tome)||void 0===s||null===(r=s.org)||void 0===r||null===(a=r.colors)||void 0===a||null===(i=a.find((t=>t.hex===e)))||void 0===i?void 0:i.id;p&&u&&_({variables:{colorId:p},update(e){e.modify({id:`Organization:${u}`,fields:{colors(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[],{readField:t}=arguments.length>1?arguments[1]:void 0;return e.filter((e=>p!==t("id",e)))}}})}}).catch((t=>{l.v.addError(t,{colorHex:e}),(0,c.ak)({message:Z("library.stateConnectedColorPicker.oopsSomethingWentWrongErrorMessage")}),k({tomeId:P})}))}),[_,null===(y=j)||void 0===y||null===(b=y.tome)||void 0===b||null===(v=b.org)||void 0===v?void 0:v.colors,null===(I=j)||void 0===I||null===(T=I.tome)||void 0===T||null===(w=T.org)||void 0===w?void 0:w.id,k,P,Z]);return(0,n.jsx)(X,{addNewWorkspaceColor:R,removeWorkspaceColor:O,workspaceColors:S,color:t,setColor:o,setColorComplete:i})}},18049:function(e,t,o){var n=o(85893);const i=o(59016).ZP.div.withConfig({displayName:"LoadingPage__LoadingPageStyles",componentId:"sc-68f14bc5-0"})`
  width: 100%;
  height: 100%;
  background-color: ${e=>e.theme.colors.page};
`;t.Z=()=>(0,n.jsx)(i,{})},3558:function(e,t,o){o.d(t,{Z:function(){return p}});var n=o(85893),i=(o(67294),o(60348)),a=o(59016);const r=a.ZP.div.withConfig({displayName:"Toggle.styles__ToggleContainer",componentId:"sc-513a9713-0"})`
  position: relative;
  width: ${e=>e.width};
  height: ${e=>e.height};
  background: ${e=>e.checked&&e.$onBgColor?e.theme.colors.toggleBackgroundOn:e.theme.colors.toggleBackgroundOff};
  transition: background-color 0.4s;
  margin: ${e=>e.margin};
  border-radius: ${e=>{let{radius:t=6}=e;return t}}px;
  display: flex;
  justify-content: space-around;
  font-size: ${e=>e.theme.fontSizes.xs};
  line-height: 14px;
  font-weight: 500;
  flex-shrink: 0;
`,l=a.ZP.input.withConfig({displayName:"Toggle.styles__ToggleInput",componentId:"sc-513a9713-1"})`
  cursor: inherit;
  position: absolute;
  top: 0;
  left: 0;
  opacity: 0;
  width: 100%;
  height: 100%;
  z-index: 2;
`,s=a.ZP.div.withConfig({displayName:"Toggle.styles__ToggleSlider",componentId:"sc-513a9713-2"})`
  position: absolute;
  top: 0;
  left: 0;
  cursor: pointer;
  background-color: ${e=>e.switchColor||(e.checked?e.theme.colors.toggleSliderOn:e.theme.colors.toggleSliderOff)};
  transition: 0.4s;
  width: calc(50% - 4px);
  height: calc(100% - 4px);
  border-radius: ${e=>{let{radius:t=6}=e;return t-2}}px;
  margin: 2px;
  input:checked ~ & {
    transform: translateX(calc(100% + 4px));
  }
`,d=a.ZP.div.withConfig({displayName:"Toggle.styles__ToggleOff",componentId:"sc-513a9713-3"})`
  z-index: 1;
  display: flex;
  flex-direction: row;
  justify-content: center;
  align-items: center;
  color: ${e=>e.theme.colors.contrast};
  transition: 0.4s;
  input:checked ~ & {
    color: rgba(255, 255, 255, 0.35);
  }
`,c=a.ZP.div.withConfig({displayName:"Toggle.styles__ToggleOn",componentId:"sc-513a9713-4"})`
  z-index: 1;
  display: flex;
  flex-direction: column;
  justify-content: center;
  color: rgba(255, 255, 255, 0.35);
  transition: 0.4s;
  input:checked ~ & {
    color: ${e=>e.theme.colors.contrast};
  }
`,u=e=>{let{offText:t,onText:o,width:a,height:u,radius:p,checked:m,onClick:h,onKeydown:g=i.Z,onBgColor:C,switchColor:f,margin:x,disabled:v,inputId:b}=e;return(0,n.jsxs)(r,{width:a,height:u,radius:p,checked:m,$onBgColor:C,margin:x,children:[(0,n.jsx)(l,{id:b,"data-testid":b,checked:m,type:"checkbox",readOnly:!0,onClick:e=>{v||h(e)},onKeyDown:g}),(0,n.jsx)(s,{checked:m,switchColor:f,radius:p}),(0,n.jsx)(d,{children:t}),(0,n.jsx)(c,{children:o})]})};u.defaultProps={offText:void 0,onText:void 0,onBgColor:!1,switchColor:void 0,margin:void 0,disabled:!1,inputId:void 0};var p=u},99691:function(e,t,o){o.d(t,{Jb:function(){return c},Vh:function(){return m},ex:function(){return h},fH:function(){return d},lu:function(){return p},ub:function(){return s}});var n=o(85893),i=o(59016),a=o(1922),r=o(38452),l=o(25854);const s=i.ZP.div.withConfig({displayName:"Comments__EmptyState",componentId:"sc-506cdaf8-0"})`
  height: 100%;
  font-size: ${e=>e.theme.fontSizes.sm};
  display: flex;
  flex-direction: column;
  text-align: center;
  padding: 0px 25px;
  align-items: center;
  justify-content: center;
  color: ${e=>e.theme.colors.contrast40};
`,d=i.ZP.div.withConfig({displayName:"Comments__CommentInputSection",componentId:"sc-506cdaf8-1"})`
  display: flex;
  position: relative;
`,c=i.ZP.div.withConfig({displayName:"Comments__CommentsStyle",componentId:"sc-506cdaf8-2"})`
  p {
    user-select: text;
  }
`,u=i.ZP.div.withConfig({displayName:"Comments__CommentsPermissionsMessageWrapper",componentId:"sc-506cdaf8-3"})`
  text-align: center;
  font-size: ${e=>e.theme.fontSizes.xxs};
  color: ${e=>e.theme.colors.contrast40};
  padding: 12px 12px 4px 12px;
  display: flex;
  align-items: center;
  justify-content: center;
`,p=()=>{const{t:e}=(0,a.$G)();return(0,n.jsx)(u,{children:e("comments.noPermissionToCommentText")})},m=i.ZP.div.withConfig({displayName:"Comments__ScrollableListStyles",componentId:"sc-506cdaf8-4"})`
  height: calc(100vh - 260px);
  overflow: auto;
  padding-top: 10px;
  padding-bottom: 23px;
`,h=e=>{let{error:t}=e;const{t:o}=(0,a.$G)();return t?(0,n.jsx)(m,{children:(0,n.jsxs)(s,{children:[(0,n.jsx)("p",{children:o("comments.commentsFailedToLoadText")}),(0,n.jsx)(r.ZP,{onClick:()=>{window.location.reload()},children:o("comments.refreshPageButton")})]})}):(0,n.jsx)(m,{children:(0,n.jsx)(s,{children:(0,n.jsx)(l.T,{})})})}},64147:function(e,t,o){var n=o(85893),i=o(67294),a=o(2767);const r=(e,t)=>{const{style:o,...i}=e;return(0,n.jsx)(a.Z,{ref:t,style:{...o},viewBox:"0 0 64 64",...i,children:(0,n.jsx)("path",{d:"M34.4999 14.0001C34.4999 12.6193 33.3807 11.5001 31.9999 11.5001C30.6192 11.5001 29.4999 12.6193 29.4999 14.0001V29.5H14C12.6193 29.5 11.5 30.6193 11.5 32C11.5 33.3807 12.6193 34.5 14 34.5H29.4999V50.0001C29.4999 51.3808 30.6192 52.5001 31.9999 52.5001C33.3807 52.5001 34.4999 51.3808 34.4999 50.0001V34.5H50C51.3807 34.5 52.5 33.3807 52.5 32C52.5 30.6193 51.3807 29.5 50 29.5H34.4999V14.0001Z"})})};t.Z=(0,i.forwardRef)(r)},47612:function(e,t,o){var n=o(85893),i=o(67294),a=o(2767);const r=(0,i.forwardRef)(((e,t)=>(0,n.jsx)(a.Z,{ref:t,viewBox:"0 0 64 64",...e,children:(0,n.jsx)("path",{fillRule:"evenodd",clipRule:"evenodd",d:"M29.15 50.8536H29.15C25.5124 48.9538 21.4637 47.9769 17.36 48.0088V48.0088C15.0346 48.0305 12.7213 48.347 10.4755 48.9505V48.9505C9.88645 49.1408 9.25462 48.8176 9.0643 48.2285C9.02788 48.1158 9.00955 47.998 9.01002 47.8795V15.2637V15.2636C9.00986 14.7937 9.30188 14.3731 9.7423 14.2091H9.7423C12.211 13.4469 14.7765 13.0435 17.36 13.0112H17.36C21.981 12.956 26.5228 14.2132 30.4575 16.6369V16.6369C30.8049 16.8685 31.0126 17.2594 31.01 17.6769V49.7838V49.7838C31.0051 50.4702 30.4447 51.0226 29.7584 51.0177C29.5449 51.0162 29.3353 50.9596 29.15 50.8536H29.15ZM55.01 15.2636V47.8795V47.8795C55.0124 48.4986 54.5126 49.0024 53.8935 49.0048C53.775 49.0053 53.6572 48.9869 53.5445 48.9505V48.9505C51.2987 48.347 48.9854 48.0305 46.66 48.0088V48.0088C42.5563 47.9769 38.5076 48.9539 34.87 50.8536V50.8536C34.2743 51.1945 33.515 50.9879 33.1741 50.3921C33.068 50.2068 33.0115 49.9972 33.01 49.7836V17.6769V17.6769C33.0075 17.2594 33.2151 16.8685 33.5625 16.6369H33.5625C37.4973 14.2132 42.039 12.956 46.66 13.0112H46.66C49.2436 13.0435 51.8092 13.4469 54.278 14.2091V14.2091C54.7183 14.3733 55.0102 14.7938 55.01 15.2637V15.2636Z"})})));t.Z=r},26202:function(e,t,o){var n=o(85893),i=o(67294),a=o(2767);const r=(0,i.forwardRef)(((e,t)=>(0,n.jsx)(a.Z,{ref:t,viewBox:"0 0 64 64",...e,children:(0,n.jsx)("path",{d:"M12 52V28C12 26.8954 12.8954 26 14 26H24C25.1046 26 26 26.8954 26 28V52C26 53.1046 25.1046 54 24 54H14C12.8954 54 12 53.1046 12 52ZM16 49C16 49.5523 16.4477 50 17 50H21C21.5523 50 22 49.5523 22 49V47C22 46.4477 21.5523 46 21 46H17C16.4477 46 16 46.4477 16 47V49ZM16 41C16 41.5523 16.4477 42 17 42H21C21.5523 42 22 41.5523 22 41V39C22 38.4477 21.5523 38 21 38H17C16.4477 38 16 38.4477 16 39V41ZM16 33C16 33.5523 16.4477 34 17 34H21C21.5523 34 22 33.5523 22 33V31C22 30.4477 21.5523 30 21 30H17C16.4477 30 16 30.4477 16 31V33ZM50 54H32C30.8954 54 30 53.1046 30 52V12C30 10.8954 30.8954 10 32 10H50C51.1046 10 52 10.8954 52 12V52C52 53.1046 51.1046 54 50 54ZM40 15C40 14.4477 39.5523 14 39 14H35C34.4477 14 34 14.4477 34 15V17C34 17.5523 34.4477 18 35 18H39C39.5523 18 40 17.5523 40 17V15ZM40 23C40 22.4477 39.5523 22 39 22H35C34.4477 22 34 22.4477 34 23V25C34 25.5523 34.4477 26 35 26H39C39.5523 26 40 25.5523 40 25V23ZM40 31C40 30.4477 39.5523 30 39 30H35C34.4477 30 34 30.4477 34 31V33C34 33.5523 34.4477 34 35 34H39C39.5523 34 40 33.5523 40 33V31ZM40 39C40 38.4477 39.5523 38 39 38H35C34.4477 38 34 38.4477 34 39V41C34 41.5523 34.4477 42 35 42H39C39.5523 42 40 41.5523 40 41V39ZM40 47C40 46.4477 39.5523 46 39 46H35C34.4477 46 34 46.4477 34 47V49C34 49.5523 34.4477 50 35 50H39C39.5523 50 40 49.5523 40 49V47ZM48 15C48 14.4477 47.5523 14 47 14H43C42.4477 14 42 14.4477 42 15V17C42 17.5523 42.4477 18 43 18H47C47.5523 18 48 17.5523 48 17V15ZM48 23C48 22.4477 47.5523 22 47 22H43C42.4477 22 42 22.4477 42 23V25C42 25.5523 42.4477 26 43 26H47C47.5523 26 48 25.5523 48 25V23ZM48 31C48 30.4477 47.5523 30 47 30H43C42.4477 30 42 30.4477 42 31V33C42 33.5523 42.4477 34 43 34H47C47.5523 34 48 33.5523 48 33V31ZM48 39C48 38.4477 47.5523 38 47 38H43C42.4477 38 42 38.4477 42 39V41C42 41.5523 42.4477 42 43 42H47C47.5523 42 48 41.5523 48 41V39ZM48 47C48 46.4477 47.5523 46 47 46H43C42.4477 46 42 46.4477 42 47V49C42 49.5523 42.4477 50 43 50H47C47.5523 50 48 49.5523 48 49V47Z"})})));t.Z=r},8034:function(e,t,o){var n=o(85893),i=o(67294),a=o(2767);const r=(0,i.forwardRef)(((e,t)=>(0,n.jsx)(a.Z,{ref:t,viewBox:"0 0 64 64",...e,children:(0,n.jsx)("path",{fillRule:"evenodd",clipRule:"evenodd",d:"M10 38.4706V22C10 17.5817 13.5817 14 18 14H46C50.4183 14 54 17.5817 54 22V38C54 42.4183 50.4183 46 46 46H30.7241C30.2562 46 29.8032 46.164 29.4437 46.4636L21.2804 53.2664C19.9777 54.3519 18 53.4256 18 51.7299V46.4706C18 46.2107 17.7893 46 17.5294 46C13.371 46 10 42.629 10 38.4706ZM19 26C19 24.8954 19.8954 24 21 24H43C44.1046 24 45 24.8954 45 26C45 27.1046 44.1046 28 43 28H21C19.8954 28 19 27.1046 19 26ZM21 32C19.8954 32 19 32.8954 19 34C19 35.1046 19.8954 36 21 36H37C38.1046 36 39 35.1046 39 34C39 32.8954 38.1046 32 37 32H21Z"})})));t.Z=r},28201:function(e,t,o){var n=o(85893),i=o(67294),a=o(2767);const r=(0,i.forwardRef)(((e,t)=>(0,n.jsx)(a.Z,{ref:t,viewBox:"0 0 64 64",...e,children:(0,n.jsxs)("g",{children:[(0,n.jsx)("path",{d:"M37.5 11C36.3954 11 35.5 11.8954 35.5 13C35.5 14.1046 36.3954 15 37.5 15H46.6716L30.5858 31.0858C29.8047 31.8668 29.8047 33.1332 30.5858 33.9142C31.3668 34.6953 32.6332 34.6953 33.4142 33.9142L49.5 17.8284V27C49.5 28.1046 50.3954 29 51.5 29C52.6046 29 53.5 28.1046 53.5 27V13C53.5 11.8954 52.6046 11 51.5 11H37.5Z"}),(0,n.jsx)("path",{d:"M16 22C16 20.8954 16.8954 20 18 20H22C23.1046 20 24 19.1046 24 18C24 16.8954 23.1046 16 22 16H18C14.6863 16 12 18.6863 12 22V47C12 50.3137 14.6863 53 18 53H43C46.3137 53 49 50.3137 49 47V43C49 41.8954 48.1046 41 47 41C45.8954 41 45 41.8954 45 43V47C45 48.1046 44.1046 49 43 49H18C16.8954 49 16 48.1046 16 47V22Z"})]})})));t.Z=r},78843:function(e,t,o){var n=o(85893),i=o(67294),a=o(2767);const r=(0,i.forwardRef)(((e,t)=>(0,n.jsxs)(a.Z,{ref:t,viewBox:"0 0 64 64",...e,children:[(0,n.jsx)("path",{d:"M34 22C34 23.6569 32.6569 25 31 25C29.3431 25 28 23.6569 28 22C28 20.3431 29.3431 19 31 19C32.6569 19 34 20.3431 34 22Z"}),(0,n.jsx)("path",{d:"M26 30C26 28.8954 26.8954 28 28 28H32C33.1046 28 34 28.8954 34 30V39.5C34 39.7761 34.2239 40 34.5 40H37C38.1046 40 39 40.8954 39 42C39 43.1046 38.1046 44 37 44H27C25.8954 44 25 43.1046 25 42C25 40.8954 25.8954 40 27 40H29.5C29.7761 40 30 39.7761 30 39.5V32.5C30 32.2239 29.7761 32 29.5 32H28C26.8954 32 26 31.1046 26 30Z"}),(0,n.jsx)("path",{fillRule:"evenodd",clipRule:"evenodd",d:"M56 32C56 45.2548 45.2548 56 32 56C18.7452 56 8 45.2548 8 32C8 18.7452 18.7452 8 32 8C45.2548 8 56 18.7452 56 32ZM52 32C52 43.0457 43.0457 52 32 52C20.9543 52 12 43.0457 12 32C12 20.9543 20.9543 12 32 12C43.0457 12 52 20.9543 52 32Z"})]})));t.Z=r},90036:function(e,t,o){var n=o(85893),i=o(67294),a=o(2767);const r=(0,i.forwardRef)(((e,t)=>(0,n.jsx)(a.Z,{ref:t,viewBox:"0 0 64 64",...e,children:(0,n.jsx)("path",{fillRule:"evenodd",clipRule:"evenodd",d:"M39.268 40.5977C38.6861 42.5877 38.2125 44.0192 36.198 44.0192H27.8468C25.832 44.0192 25.3583 42.5875 24.7768 40.5977C22.8344 33.9552 17.1026 31.7516 17.0268 23.1716V23.1716C16.9468 14.8894 23.5959 8.1105 31.8781 8.0305C40.1602 7.95048 46.9392 14.5996 47.0192 22.8818C47.0201 22.9784 47.0201 23.075 47.0192 23.1716C46.9423 31.7516 41.21 33.9552 39.268 40.5977V40.5977ZM27.0188 46.0194H37.0257V46.0194C38.1305 46.0194 39.0261 46.915 39.0261 48.0198C39.0261 49.1246 38.1305 50.0202 37.0257 50.0202H27.0188V50.0202C25.914 50.0202 25.0184 49.1246 25.0184 48.0198C25.0184 46.915 25.914 46.0194 27.0188 46.0194V46.0194ZM28.19 52.0199H35.8548V52.0199C36.5017 52.0201 37.026 52.5447 37.0259 53.1916C37.0259 53.1916 37.0259 53.1916 37.0259 53.1916V53.1917C37.0259 53.7223 36.8152 54.2311 36.4401 54.6063L35.6124 55.4348V55.4348C35.2376 55.8098 34.7292 56.0206 34.199 56.0206H29.8455H29.8455C29.3153 56.0206 28.8069 55.8098 28.4321 55.4348L27.6044 54.6063V54.6063C27.2295 54.231 27.0188 53.7222 27.0188 53.1917V53.1917C27.0186 52.5448 27.5428 52.0201 28.1898 52.0199C28.1898 52.0199 28.1899 52.0199 28.19 52.0199V52.0199Z"})})));t.Z=r},56302:function(e,t,o){var n=o(85893),i=o(67294),a=o(2767);const r=(0,i.forwardRef)(((e,t)=>{let{pathFill:o="currentcolor",...i}=e;return(0,n.jsx)(a.Z,{ref:t,viewBox:"0 0 64 64",...i,children:(0,n.jsx)("path",{fill:o,d:"M 63.648438 29.429688 L 58.011719 9.296875 C 57.792969 8.507812 57.371094 7.789062 56.792969 7.207031 C 56.210938 6.628906 55.492188 6.207031 54.703125 5.988281 L 34.570312 0.351562 C 32.886719 -0.117188 31.109375 -0.117188 29.429688 0.351562 L 9.296875 5.988281 C 8.507812 6.207031 7.789062 6.628906 7.207031 7.207031 C 6.628906 7.785156 6.207031 8.503906 5.988281 9.292969 L 0.351562 29.429688 C -0.117188 31.109375 -0.117188 32.890625 0.351562 34.570312 L 5.984375 54.707031 C 6.207031 55.496094 6.625 56.214844 7.207031 56.792969 C 7.785156 57.375 8.507812 57.792969 9.296875 58.015625 L 29.433594 63.648438 C 31.113281 64.117188 32.890625 64.117188 34.574219 63.648438 L 54.707031 58.015625 C 55.496094 57.792969 56.214844 57.371094 56.792969 56.792969 C 57.375 56.214844 57.792969 55.496094 58.015625 54.707031 L 63.648438 34.570312 C 64.117188 32.890625 64.117188 31.109375 63.648438 29.429688 Z M 58.429688 34.25 L 34.25 58.429688 C 33.953125 58.726562 33.601562 58.960938 33.214844 59.121094 C 32.832031 59.28125 32.417969 59.363281 32 59.363281 C 31.582031 59.363281 31.167969 59.28125 30.78125 59.121094 C 30.398438 58.960938 30.046875 58.726562 29.75 58.429688 L 5.570312 34.25 C 5.273438 33.953125 5.039062 33.605469 4.878906 33.21875 C 4.71875 32.832031 4.636719 32.417969 4.636719 32 C 4.636719 31.582031 4.71875 31.167969 4.878906 30.785156 C 5.039062 30.398438 5.273438 30.046875 5.570312 29.753906 L 29.75 5.570312 C 30.046875 5.273438 30.398438 5.039062 30.78125 4.878906 C 31.167969 4.722656 31.582031 4.636719 32 4.636719 C 32.417969 4.636719 32.832031 4.722656 33.214844 4.878906 C 33.601562 5.039062 33.953125 5.273438 34.25 5.570312 L 58.429688 29.753906 C 58.722656 30.046875 58.957031 30.398438 59.117188 30.785156 C 59.277344 31.167969 59.359375 31.582031 59.359375 32 C 59.359375 32.417969 59.277344 32.832031 59.117188 33.21875 C 58.957031 33.605469 58.722656 33.953125 58.429688 34.25 Z M 58.429688 34.25 "})})}));t.Z=r},89522:function(e,t,o){o.d(t,{s:function(){return u}});var n=o(85893),i=o(67294),a=o(59016),r=o(38452),l=o(78084),s=o(34981),d=o(510);const c=(0,a.ZP)(r.ZP).withConfig({displayName:"ConfirmationModal__ModalButton",componentId:"sc-4af7a8df-0"})`
  padding: 12px;
`,u=()=>{const e=(0,i.useRef)(),t=(0,i.useCallback)((()=>{var t;null===(t=e.current)||void 0===t||t.open()}),[e]),o=(0,i.useCallback)((()=>{var t;null===(t=e.current)||void 0===t||t.close()}),[e]);return{ref:e,open:t,close:o}},p=(0,i.forwardRef)(((e,t)=>{const{title:o,subtitle:a,children:r,cancelButtonText:u,cancelButtonAction:p,primaryButtonContent:m,primaryButtonAction:h,dismissible:g=!0,buttonColor:C,onOpen:f,onClose:x}=e,[v,b]=(0,i.useState)(!1),y=(0,i.useCallback)((()=>{var e;b(!0),null===(e=f)||void 0===e||e()}),[f]),w=(0,i.useCallback)((()=>{var e;b(!1),null===(e=x)||void 0===e||e()}),[x]);return(0,i.useImperativeHandle)(t,(()=>({open:y,close:w}))),(0,n.jsxs)(l.u_,{open:v,onOpenChange:e=>b(e),modal:!0,children:[(0,n.jsx)(d.kZ,{}),(0,n.jsxs)(d.If,{"data-testid":"confirmation_container",width:240,onPointerDownOutside:g?void 0:e=>{e.preventDefault()},children:[(0,n.jsxs)(d.v5,{children:[(0,n.jsx)(d.Dx,{children:o}),(0,n.jsx)(d.QE,{children:a}),r]}),(0,n.jsxs)(d.KE,{$center:!g,children:[g&&(0,n.jsx)(c,{onMouseDown:s.Z,onClick:p,children:u}),(0,n.jsx)(c,{color:g&&!C?"destructive":C,onMouseDown:s.Z,onClick:h,style:{...g?{}:{width:"100%"}},children:m})]})]})]})}));t.Z=p},32265:function(e,t,o){o.d(t,{m:function(){return m}});var n=o(85893),i=o(67294),a=o(87536),r=o(59016),l=o(1922),s=o(38452),d=o(78084),c=o(40405),u=o(34981),p=o(510);const m=()=>{const e=(0,i.useRef)(),t=(0,i.useCallback)((()=>{var t;null===(t=e.current)||void 0===t||t.open()}),[e]),o=(0,i.useCallback)((()=>{var t;null===(t=e.current)||void 0===t||t.close()}),[e]);return{ref:e,open:t,close:o}},h=(0,r.ZP)(p.QE).withConfig({displayName:"PromptModal__CustomSubtitle",componentId:"sc-c942eb0-0"})`
  padding-bottom: 4px;
`,g=(0,r.ZP)(p.v5).withConfig({displayName:"PromptModal__CustomContentArea",componentId:"sc-c942eb0-1"})`
  padding: 12px 12px 0 12px;
`,C=(0,i.forwardRef)(((e,t)=>{const{t:o}=(0,l.$G)(),{title:r,subtitle:m,primaryButtonText:C,cancelButtonText:f=o("components.promptModal.cancelPromptModalButtonLabel"),buttonColor:x="default",placeholder:v,onSubmit:b}=e,[y,w]=(0,i.useState)(!1),T=(0,i.useCallback)((()=>{w(!0)}),[]),I=(0,i.useCallback)((()=>{w(!1)}),[]);(0,i.useImperativeHandle)(t,(()=>({open:T,close:I})));const{register:P,handleSubmit:E,formState:{isValid:_,isSubmitting:j},reset:k}=(0,a.cI)({mode:"onChange"});return(0,n.jsxs)(d.u_,{open:y,onOpenChange:e=>w(e),modal:!0,children:[(0,n.jsx)(p.kZ,{}),(0,n.jsx)(p.If,{width:240,"data-testid":"prompt_modal",onMouseDown:u.Z,children:(0,n.jsxs)("form",{onSubmit:E((e=>{b(e.prompt),I(),k()})),autoComplete:"off",children:[(0,n.jsxs)(g,{children:[(0,n.jsx)(p.Dx,{children:r}),m&&(0,n.jsx)(h,{children:m}),(0,n.jsx)(c.Z,{variant:"fill",placeholder:v,...P("prompt",{required:!0})})]}),(0,n.jsxs)(p.KE,{children:[(0,n.jsx)(s.ZP,{onClick:I,children:f}),(0,n.jsx)(s.ZP,{type:"submit",color:x,disabled:!_||j,children:C})]})]})})]})}));t.Z=C},66605:function(e,t,o){o.d(t,{B:function(){return b},DX:function(){return r},GJ:function(){return c},Ir:function(){return u},M$:function(){return d},WE:function(){return l},Z5:function(){return x},a4:function(){return C},c3:function(){return s},kv:function(){return f},pP:function(){return h},pf:function(){return m},tL:function(){return g},xp:function(){return v},y3:function(){return p}});var n=o(59016),i=o(47201),a=o(46051);const r=n.ZP.div.withConfig({displayName:"UserPresence.styles__UserPresenceStyles",componentId:"sc-915b815d-0"})`
  display: flex;
  flex-direction: column;
  position: relative;
`,l=n.ZP.div.withConfig({displayName:"UserPresence.styles__SeenHeadsWrapper",componentId:"sc-915b815d-1"})`
  display: flex;
  flex-direction: row;
  align-items: center;
  cursor: pointer;
  margin-right: 8px;
`,s=n.ZP.div.withConfig({displayName:"UserPresence.styles__SeenHeadsOverflow",componentId:"sc-915b815d-2"})`
  font-size: ${e=>e.$fontSize}px;
  font-weight: 500;
  line-height: ${e=>e.$lineHeight}px;
  color: ${e=>e.theme.colors.seenByOverflow};
  padding: 2px 6px 2px 4px;
  margin-left: 4px;
  border-radius: 36px;
  background-color: ${e=>e.theme.colors.seenByOverflowBackground};
  display: flex;
`,d=n.ZP.div.withConfig({displayName:"UserPresence.styles__SeenHeadsOverflowPlus",componentId:"sc-915b815d-3"})`
  font-size: ${e=>e.$fontSize}px;
  line-height: ${e=>e.$lineHeight}px;
`,c=n.ZP.div.withConfig({displayName:"UserPresence.styles__SeenHeadsBackground",componentId:"sc-915b815d-4"})`
  width: ${a.sK}px;
  background-color: ${e=>e.theme.colors.menuBackgroundLayer[0]};
  box-shadow: ${e=>{let{theme:t}=e;return t.colors.sheetBoxShadow}};
  border-radius: 12px;
`,u=n.ZP.div.withConfig({displayName:"UserPresence.styles__SeenHeadsDetail",componentId:"sc-915b815d-5"})`
  width: ${a.sK}px;
  padding: 4px 12px;
  overflow-y: auto;
  max-height: 70vh;
  min-height: 10px;
`,p=n.ZP.div.withConfig({displayName:"UserPresence.styles__SeenHeadsDetailHeader",componentId:"sc-915b815d-6"})`
  height: 34px;
  color: ${e=>e.theme.colors.contrast40};
  font-size: ${e=>e.theme.fontSizes.sm};
  font-weight: 500;
  line-height: 22px;
  padding: 18px 12px;
  z-index: 1;
  padding-top: 8px;
`,m=n.ZP.div.withConfig({displayName:"UserPresence.styles__SeenHeadsDetailRow",componentId:"sc-915b815d-7"})`
  display: flex;
  flex-direction: row;
  align-items: stretch;
  height: 32px;
  font-size: ${e=>e.theme.fontSizes.sm};
  line-height: 17px;
  padding: 6px 0;
  color: ${e=>e.theme.colors.contrast40};
`,h=n.ZP.div.withConfig({displayName:"UserPresence.styles__SeenHeadsDetailNameLabel",componentId:"sc-915b815d-8"})`
  align-self: center;
  flex-grow: 0;
  flex-basis: auto;
  margin-left: 8px;
  font-size: ${e=>e.theme.fontSizes.sm};
  color: ${e=>e.theme.colors.seenByDetailName};
  ${i.wR}
`,g=n.ZP.div.withConfig({displayName:"UserPresence.styles__SeenHeadsDetailTimeLabel",componentId:"sc-915b815d-9"})`
  margin-left: 4px;
  align-self: center;
  ${i.wR}
`,C=n.ZP.div.withConfig({displayName:"UserPresence.styles__ProfileHoverWrapper",componentId:"sc-915b815d-10"})`
  width: ${200}px;
  display: flex;
  flex-direction: column;
  align-items: center;
  margin-top: -6px;
`,f=n.ZP.div.withConfig({displayName:"UserPresence.styles__ProfileHoverStyles",componentId:"sc-915b815d-11"})`
  background-color: ${e=>e.theme.colors.tooltipBg};
  border-radius: 8px;
  padding: 6px 8px;
  display: flex;
  flex-direction: column;
  align-items: center;
`,x=n.ZP.div.withConfig({displayName:"UserPresence.styles__ProfileHoverName",componentId:"sc-915b815d-12"})`
  font-size: ${e=>e.theme.fontSizes.sm};
  font-weight: 500;
  line-height: 16px;
`,v=n.ZP.div.withConfig({displayName:"UserPresence.styles__ProfileHoverContent",componentId:"sc-915b815d-13"})`
  margin-top: 2px;
  font-size: ${e=>e.theme.fontSizes.xxs};
  line-height: 13px;
  color: ${e=>e.theme.colors.tooltipSecondaryTextColor};
`,b=n.ZP.span.withConfig({displayName:"UserPresence.styles__GuestLabel",componentId:"sc-915b815d-14"})`
  font-size: ${e=>{let{theme:t}=e;return t.fontSizes.xxs}};
  color: ${e=>{let{theme:t}=e;return t.colors.guestBadgeText}};
  margin-left: 4px;
`},54817:function(e,t,o){o.d(t,{Z:function(){return P}});var n=o(85893),i=o(67294),a=o(82703),r=o(86090),l=o(73765),s=o(55902),d=o(9965),c=o(93996),u=o(97332),p=o(46051),m=o(66605),h=o(59016),g=o(1922),C=o(51521),f=o(78843),x=o(2767);var v=(0,i.forwardRef)(((e,t)=>(0,n.jsx)(x.Z,{ref:t,style:{width:"1em",height:"1em"},viewBox:"0 0 64 64",...e,children:(0,n.jsx)("path",{fillRule:"evenodd",clipRule:"evenodd",d:"M52.4973 56H11.5058V56C10.6712 55.9979 9.99628 55.3195 9.99842 54.4848C9.99854 54.4362 10.001 54.3876 10.0058 54.3392C10.677 47.5048 17.7956 40 32.0015 40C46.2074 40 53.3256 47.5048 53.997 54.3392V54.3392C54.0796 55.1698 53.4732 55.91 52.6426 55.9926C52.5944 55.9974 52.5459 55.9999 52.4973 56V56ZM32.0015 36C25.6 36 20.0082 30.4443 20.0082 21.5C20.0082 13.8 24.85 8 32.0015 8C39.153 8 43.995 13.8 43.995 21.5C43.995 30.4443 38.4032 36 32.0015 36Z"})})));const b=(0,h.ZP)(v).withConfig({displayName:"UserPresenceList__StyledAnonUserIcon",componentId:"sc-11535db0-0"})`
  width: 20px !important;
  height: 20px !important;
  flex-basis: 20px;
  flex-shrink: 0;
  flex-grow: 0;
  color: ${e=>{let{theme:t}=e;return t.colors.uiAccent}};
`,y=(0,h.ZP)(f.Z).withConfig({displayName:"UserPresenceList__StyledInfoIcon",componentId:"sc-11535db0-1"})`
  width: 20px;
  height: 20px;
  margin-left: 5px;
  transform: translateY(5px);
`,w=h.ZP.div.withConfig({displayName:"UserPresenceList__StyledLabelIcon",componentId:"sc-11535db0-2"})`
  display: inline;
`,T=h.ZP.div.withConfig({displayName:"UserPresenceList__StyledLabelTimeContainer",componentId:"sc-11535db0-3"})`
  justify-content: space-between;
  display: flex;
  flex: 1;
  // Shrink to fit available width if necessary.
  min-width: 0;
`;var I=e=>{let{activities:t,userOrgName:o}=e;const i=(0,h.Fg)(),{t:a}=(0,g.$G)(),r=o?a("userPresence.externalViewersWithOrgNameTooltip",{orgName:o}):a("userPresence.externalViewersTooltip");return(0,n.jsxs)(m.GJ,{children:[(0,n.jsx)(m.y3,{children:a("userPresence.seenByHeader")}),(0,n.jsx)(m.Ir,{children:t.map((e=>((e,t,o,i)=>{var a;return e.user?(0,n.jsxs)(m.pf,{children:[(0,n.jsx)(s.Z,{user:e.user,size:20}),(0,n.jsxs)(T,{children:[(0,n.jsx)(m.pP,{children:null===(a=e.user)||void 0===a?void 0:a.name}),(0,n.jsx)(m.tL,{children:e.label})]})]},e.activityId):(0,n.jsxs)(m.pf,{children:[(0,n.jsx)(b,{}),(0,n.jsx)(m.pP,{children:e.label}),(0,n.jsx)(w,{children:(0,n.jsx)(c.Z,{content:t,placement:"top",style:{marginTop:"-5px"},zIndex:C.y$,background:o,children:(0,n.jsx)(y,{style:{fill:i}})})})]},e.activityId)})(e,r,i.colors.tooltipOnSheetBg,i.colors.contrast40)))})]})};var P=e=>{let{seenHeadsViewModels:t,overflowViewModels:o,avatarSize:h,navigateToPage:g,dropShadow:C=!1,animated:f=!1,anonymousViewers:x=0,userOrgName:v=""}=e;const b=(0,i.useRef)(null),[y,w]=(0,i.useState)(!1),T=(0,i.useRef)(null),P=(0,i.useCallback)((()=>{w(!1)}),[]);if((0,l.Z)({handleClose:P,enabled:y}),0===t.length)return null;const E=t.map((e=>function(e,t,o,i,a,l,d){const c={marginLeft:"3px"};return a&&(c.filter="drop-shadow(rgba(0, 0, 0, 0.10) -2px -2px 3px)"),(0,n.jsx)(s.Z,{user:e.user,opacity:o,size:t,style:c,animated:l,renderTooltip:()=>{var t,o;return i&&(0,n.jsx)(m.a4,{children:(0,n.jsxs)(m.kv,{children:[(0,n.jsx)(m.Z5,{children:null===(t=e.user)||void 0===t?void 0:t.name}),(0,n.jsxs)(m.xp,{children:[!0===(null===(o=e.user)||void 0===o?void 0:o.isGuest)&&(0,n.jsxs)(n.Fragment,{children:[(0,n.jsx)(m.B,{children:r.ZP.t("userPresence.guest")})," · "]}),e.label]})]})})},onClick:()=>{var t;return null===(t=d)||void 0===t?void 0:t(e.viewingPageId)}},e.activityId)}(e,h,e.isActive?1:.4,!0,C,f,g)));let _=0,j=0;if(b.current){const e=b.current.getBoundingClientRect();_=e.x+e.width/2-p.sK/2,j=e.y+e.height+8}let k=0;return k=x>0?o.length-1-t.length+x:o.length-t.length,(0,n.jsxs)(m.DX,{"data-testid":"user_presence",children:[(0,n.jsxs)(m.WE,{ref:b,children:[(0,n.jsx)(c.Z,{placement:"bottom",offset:10,ignoreWrapper:!0,withBackground:!1,children:(0,n.jsx)(a.M,{children:E})}),k>0&&(0,n.jsxs)(m.c3,{ref:T,$lineHeight:h-4,$fontSize:h-7,onMouseDown:()=>{w(!y)},children:[(0,n.jsx)(m.M$,{$lineHeight:h-4,$fontSize:h-9,children:"+"}),(0,n.jsx)("div",{children:`${k.toLocaleString()}`})]})]}),y&&(0,n.jsx)(d.Z,{left:_,top:j,zIndex:200,children:(0,n.jsx)(u.Z,{exemptContainerRefs:[T],onClick:()=>{y&&w(!1)},children:(0,n.jsx)(I,{activities:o,userOrgName:v})})})]})}},44308:function(e,t,o){o.d(t,{K3:function(){return c},Pr:function(){return l},UO:function(){return d},tQ:function(){return a}});var n=o(86090),i=o(74787);const a=e=>e>=1440?8:e>=1312?7:e>=1184?6:e>=1056?5:e>=928?4:3,r=e=>e.active?n.ZP.t("userPresence.viewingNow"):`${(0,i.Z)(e.lastTimestamp,!0,!1)}`,l=e=>{var t,o;return{user:{name:null===(t=e.user)||void 0===t?void 0:t.name,isGuest:e.isGuest??!1,profileImage:null===(o=e.user)||void 0===o?void 0:o.profileImage},label:r(e),viewingPageId:e.pageId??void 0,isActive:e.active,activityId:e.id}};function s(e,t){return e.active&&t.active?0:e.active?-1:t.active||e.lastTimestamp<t.lastTimestamp?1:e.lastTimestamp>t.lastTimestamp?-1:0}const d=e=>[...e].sort(s),c=e=>[...e].sort(s)},52665:function(e,t,o){const n=o(50456).ZP`
  query commentsLastSeenForUserAndPage(
    $userId: String!
    $tomeId: String!
    $pageId: String!
  ) {
    commentsLastSeenForUserAndPage(
      userId: $userId
      tomeId: $tomeId
      pageId: $pageId
    ) {
      pageId
      lastViewedAt
    }
  }
`;t.Z=n},98299:function(e,t,o){o.d(t,{T:function(){return u},Z:function(){return m}});var n=o(67294),i=o(30990),a=o(14158),r=o(1922),l=o(96215),s=o(62081),d=o(57622),c=o(41350);const u="MAX_FREE_TOMES_COUNT_REACHED",p=e=>{let{message:t,code:o}=e;return new i.cA({graphQLErrors:[new a._(t,void 0,void 0,void 0,void 0,void 0,{code:o})]})};function m(e){let{skipCacheUpdate:t}=e;var o;const{maybeIncrementFreeTomeCreationCount:i,remainingTomeCreationsForOrg:a}=(0,d.Z)(),m=0===a,{apolloClient:h}=(0,c.bp)(),{t:g}=(0,r.$G)(),[C,{data:f}]=(0,l.mTo)({update(e,o){let{data:{duplicateTome:n}}=o;t||(0,s.a)(e,n,i)}}),x=(0,n.useCallback)((()=>{var e;const t=null===(e=f)||void 0===e?void 0:e.duplicateTome;t&&(0,s.a)(h.cache,t,i)}),[h.cache,null===(o=f)||void 0===o?void 0:o.duplicateTome,i]),v=(0,n.useCallback)((async e=>{let{tomeId:t,orgId:o,onDuplicateComplete:n,onDuplicateError:i}=e;if(m)i(p({message:g("toastMessages.tomeCreationError.disabledBecauseOutOfFreeTomes"),code:u}));else try{const{data:e}=await C({variables:{tomeId:t,orgId:o}});if(null==e)return void i(new Error("No data returned from duplicate tome mutation"));const a=e.duplicateTome;if(!a)return void i(new Error("No duplicate tome returned from duplicate tome mutation"));n(a)}catch(e){let t=new Error("Unknown error occurred when duplicating tome.");e instanceof Error&&(t=e),i(t)}}),[C,g,m]);return(0,n.useMemo)((()=>({duplicateTome:v,addDuplicatedTomeToCache:x})),[x,v])}},47227:function(e,t,o){var n=o(67294),i=o(96215),a=o(41350);t.Z=function(){const{apolloClient:e}=(0,a.bp)();return(0,n.useCallback)((t=>e.readFragment({id:`Tome:${t}`,fragment:i.AKG,fragmentName:"TomeFragment",variables:{fetchFullPage:!0,prefetchPreviewImage:!1}})),[e])}},1918:function(e,t,o){o.d(t,{w:function(){return i}});var n=o(67294);const i=["left","right","up","down","escape","enter","tab","shift+tab"];t.Z=e=>{let{options:t,selectedType:o,setSelectedType:i,didSelect:a,didEscape:r}=e;const l=(0,n.useCallback)((()=>{if(!o)return;let e;for(e=0;e<t.length&&t[e]!==o;e+=1);e<t.length-1&&i(t[e+1])}),[o,t,i]),s=(0,n.useCallback)((()=>{if(!o)return;let e;for(e=0;e<t.length&&t[e]!==o;e+=1);e>0&&i(t[e-1])}),[o,t,i]),d=(0,n.useCallback)((()=>{if(!o)return;let e;for(e=0;e<t.length&&t[e]!==o;e+=1);e<t.length-2&&i(t[e+2])}),[t,o,i]),c=(0,n.useCallback)((()=>{if(!o)return;let e;for(e=0;e<t.length&&t[e]!==o;e+=1);e>1&&i(t[e-2])}),[t,o,i]);return{onKeyDown:e=>{["ArrowLeft","ArrowRight","ArrowUp","ArrowDown","Tab","Escape","Enter"].includes(e.key)&&(!o&&t.length>0&&"Escape"!==e.key?(i(t[0]),e.preventDefault()):"ArrowRight"===e.key||"Tab"===e.key&&!e.shiftKey?(l(),e.preventDefault()):"ArrowLeft"===e.key||"Tab"===e.key&&e.shiftKey?(s(),e.preventDefault()):"ArrowUp"===e.key?(c(),e.preventDefault()):"ArrowDown"===e.key?(d(),e.preventDefault()):"Enter"===e.key?(o&&a&&a(),e.preventDefault()):"Escape"===e.key&&(r&&r(),e.preventDefault()))}}}},95831:function(e,t,o){var n=o(85518),i=o(30587),a=o(79249);t.Z=()=>{const e=(0,i.GS)(a.Hb.mobile),t=n.tq||n.Em;return n.nI?e:t}},97233:function(e,t,o){o.d(t,{JN:function(){return p},Ni:function(){return c},l1:function(){return u}});var n=o(86090),i=o(96215),a=o(35383);const r={type:i.YUT.Text,textTileData:{content:(0,a.wj)(a.yG.Heading,a.SQ.Heading)}},l={type:i.YUT.Image},s={type:i.YUT.Text,textTileData:{content:(0,a.wj)(a.yG.Heading,a.SQ.Title),verticalAlignment:i.Q4P.Center,horizontalAlignment:i.KxP.Center}},d={type:i.YUT.Table,...(0,a.vJ)(4,7,!0)},c={id:"centered-text",description:n.ZP.t("layouts.centeredTextDescription"),rows:[{tiles:[s]}]},u={id:"text",description:n.ZP.t("layouts.textDescription"),rows:[{tiles:[r]}]},p=[u,c,{id:"text+media",description:n.ZP.t("layouts.textAndMediaDescription"),rows:[{tiles:[r,l]}]},{id:"text+table",description:n.ZP.t("layouts.textAndTableDescription"),hidesSublabels:!0,rows:[{tiles:[r]},{tiles:[d]}]},{id:"media",description:n.ZP.t("layouts.mediaDescription"),rows:[{relativeHeight:1,tiles:[l]}]},{id:"three-media",description:n.ZP.t("layouts.threeMediaDescription"),rows:[{relativeHeight:1,tiles:[l,l,l]}]},{id:"media+2-text",description:n.ZP.t("layouts.mediaAndTwoTextDescription"),rows:[{relativeHeight:1.25,tiles:[l]},{relativeHeight:.75,tiles:[r,r]}]},{id:"text-media-grid",description:n.ZP.t("layouts.textAndThreeByTwoDescription"),rows:[{relativeHeight:.666667,tiles:[s]},{relativeHeight:.666667,tiles:[l,l,l]},{relativeHeight:.666667,tiles:[l,l,l]}]}]},42207:function(e,t,o){o.d(t,{I0:function(){return g},P3:function(){return u},PI:function(){return x},PS:function(){return f},QA:function(){return C},QX:function(){return b},Ti:function(){return m},VK:function(){return v},hT:function(){return p},zh:function(){return h}});var n=o(62830),i=o.n(n),a=o(25934),r=o(86090),l=o(96215),s=o(52665),d=o(9228),c=o(41697);const u=(e,t)=>{t.comments&&t.comments.forEach((t=>{t&&e.cache.modify({id:e.cache.identify(t),fields:{unread(){return!1}}})}))},p=(e,t)=>{var o;const n=e.cache.readFragment({id:`Tome:${t}`,fragment:l.AKG,fragmentName:"TomeFragment",variables:{fetchFullPage:!0,prefetchPreviewImage:!1}});n&&(null===(o=n.pages)||void 0===o||o.forEach((o=>{o.comments&&o.comments.forEach((o=>{o&&e.cache.modify({id:e.cache.identify(o),fields:{unread(){return((e,t,o)=>{var n,i,a,r;const{me:d}=e.readQuery({query:l.fkZ});if((null===(i=t)||void 0===i||null===(n=i.author)||void 0===n?void 0:n.id)===d.id)return!1;const c=e.readQuery({query:s.Z,variables:{userId:d.id,tomeId:o,pageId:null===(a=t)||void 0===a?void 0:a.pageId}}),u=c&&c.commentsLastSeenForUserAndPage&&c.commentsLastSeenForUserAndPage.lastViewedAt&&new Date(c.commentsLastSeenForUserAndPage.lastViewedAt).valueOf();return!!u&&u<new Date(null===(r=t)||void 0===r?void 0:r.createdAt).valueOf()})(e.cache,o,t)}}})}))})))},m=e=>e&&e.pages&&e.pages.map((e=>e.comments&&e.comments.map((e=>{var t;return null===(t=e)||void 0===t?void 0:t.unread})).some((e=>!0===e)))).some((e=>!0===e)),h=e=>!!(e&&e.comments&&e.comments.map((e=>{var t;return null===(t=e)||void 0===t?void 0:t.unread})).some((e=>!0===e))),g=(e,t)=>{var o,n,i;const{me:a}=e.readQuery({query:l.fkZ});t.unread=!0,(null===(o=a)||void 0===o?void 0:o.id)&&(null===(i=t)||void 0===i||null===(n=i.author)||void 0===n?void 0:n.id)===a.id&&(t.unread=!1);const r=e.writeFragment({id:`Comment:${t.id}`,fragment:l.$zS,data:t,fragmentName:"CommentFragment"});e.modify({id:`Page:${t.pageId}`,fields:{comments(){return[...arguments.length>0&&void 0!==arguments[0]?arguments[0]:[],r]}}})},C=(e,t)=>{e.modify({id:e.identify(t),fields:{content(e){return t.content||e}}})},f=(e,t)=>{e.modify({id:`Page:${t.pageId}`,fields:{comments(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[],{readField:o}=arguments.length>1?arguments[1]:void 0;return e.filter((e=>t.id!==o("id",e)))}}})},x=async(e,t,o,n,s,u)=>{const p=i()(),m=(0,a.Z)(),h={__typename:"User",id:o.id,name:o.name,email:o.email,profileImage:o.profileImage},C={__typename:"Comment",id:p,pageId:t.id,author:h,content:n,createdAt:(new Date).toISOString(),unread:!1};await s.mutate({mutation:l.Zso,variables:{editId:m,clientId:u,tomeId:e,pageId:t.id,commentId:p,content:n},optimisticResponse:{createComment:{__typename:"Edit",id:m,authorId:h.id,clientId:u,tomeId:e,status:"SUCCESS",comment:C}},update(e,t){let{data:o}=t;var n;"SUCCESS"===(null===(n=o)||void 0===n?void 0:n.createComment.status)?g(e,C):(0,d.ak)({message:r.ZP.t("logic.tome.noPermissionForCommentMessage")})}}),c.ZP.reportNewCommentEvent({apolloClient:s,tomeId:e,pageId:t.id,commentId:p})},v=async(e,t,o,n,i)=>{const r=(0,a.Z)(),s=o.cache.readFragment({id:`Comment:${i}`,fragment:l.$zS,fragmentName:"CommentFragment"});s&&await o.mutate({mutation:l.ulC,variables:{editId:r,clientId:n,tomeId:e,commentId:i,content:t},optimisticResponse:{updateComment:{__typename:"Edit",id:r,authorId:s.author.id,clientId:n,tomeId:e,comment:{...s,content:t}}},update(e,t){let{data:o}=t;var n,i;(null===(n=o)||void 0===n?void 0:n.updateComment.comment)&&C(e,null===(i=o)||void 0===i?void 0:i.updateComment.comment)}})};function b(e,t,o,n,i){t.mutate({mutation:l.i9U,variables:{editId:(0,a.Z)(),clientId:o,tomeId:e,commentId:n},update(e){f(e,{id:n,pageId:i})}})}},60243:function(e,t,o){o.d(t,{oX:function(){return v},Vy:function(){return C},tj:function(){return f},ek:function(){return y},pp:function(){return g},lT:function(){return w},DE:function(){return T},aV:function(){return x},sR:function(){return I}});var n=o(62830),i=o.n(n),a=o(25934),r=o(96215),l=o(83694),s=o(33601),d=o(35383);const c=(e,t)=>{const o=(0,d.ZP)({tileType:e.type??r.YUT.Text});return{operation:r.C8.CreateTile,id:e.tileId,tile:{...o,type:e.type,order:e.order,...e.textTileData?{textTileData:e.textTileData}:{},...e.tableTileData?{tableTileData:e.tableTileData}:{}},page:{id:t}}};var u=(e,t,o,n)=>{const a={rows:t.rows.map((e=>({...e,tiles:e.tiles.map((e=>({...e,id:i()()})))})))}.rows.map((e=>({rowId:i()(),relativeHeight:e.relativeHeight??null,tiles:e.tiles.map(((e,t)=>({tileId:e.id,order:t+1,type:e.type,textTileData:e.textTileData,tableTileData:e.tableTileData})))}))),l=i()(),s=a[0].tiles[0].tileId,d={rows:a.map(((e,t)=>({rowId:e.rowId,relativeHeight:e.relativeHeight,order:t+1,tiles:e.tiles.map((e=>({tileId:e.tileId,order:e.order+1,relativeWidth:1})))})))},u=a.flatMap((e=>e.tiles.map((e=>c(e,l)))));return{apply:[{operation:r.C8.CreatePage,id:l,page:{autoThemeColor:!0,order:o,overlay:{videoStatus:r.Kwn.WaitingForCreation,videoId:null,videoThumbnailUrl:null,videoUrl:null,position:r._zJ.UpperRight},layout:d,themeId:n},tome:{id:e}},...u],revert:[{operation:r.C8.DeletePage,id:l,tome:{id:e}}],pageId:l,tileId:s}};var p=o(97233),m=o(41697),h=o(99364);function g(e,t){let o;return o=0===t.length?1:0===e?t[0].order/2:e===t.length?t[t.length-1].order+1:(t[e-1].order+t[e].order)/2,o}function C(e,t,o,n,i){var r;(null===(r=i)||void 0===r?void 0:r.id)&&m.ZP.reportNewCreatePageEvent({apolloClient:o,tomeId:e.id,layoutId:i.id});const s=g(t,e.pages),d=i||(1===s?p.Ni:p.l1),{apply:c,revert:C,pageId:f,tileId:x}=u(e.id,d,s,e.theme.id),v={id:(0,a.Z)(),tomeId:e.id,clientId:n,apply:c,revert:C},b=(0,h.mz)(v);return l.Q.submitMutation(o,b,v),{pageId:f,tileId:x}}function f(e,t,o,n,i){const d=[],c=[];let m;if(t.forEach((t=>{var o;d.push({operation:r.C8.DeletePage,id:t,tome:{id:e.id}}),c.push({operation:r.C8.RecoverPage,id:t,tome:{id:e.id}});const i=n.cache.readFragment({id:`Page:${t}`,fragment:r.bsn,fragmentName:"PageWithTilesFragment"});if(null===(o=i)||void 0===o?void 0:o.theme){const e=new s.Z(i.theme);e.isAnonymous&&(d.push({operation:r.C8.DeleteTheme,id:e.id}),c.push({operation:r.C8.RecoverTheme,id:e.id}))}})),o){const{apply:t,revert:o,pageId:n}=u(e.id,p.Ni,1,e.theme.id);m=n,d.push(...t),c.unshift(...o)}const h={id:(0,a.Z)(),tomeId:e.id,clientId:i,apply:d,revert:c};return l.Q.submitMutation(n,h),m}function x(e,t,o,n,i){const s=[...t].sort();if(function(e){for(let t=0;t<e.length-1;t++)if(e[t+1]-e[t]!=1)return!1;return!0}(s)&&s.includes(o))return;const d=s.map((t=>e.pages[t])),c=d.length+1;let u=0,p=0;if(0===o)u=0,p=e.pages[0].order/c;else{if(void 0===e.pages[o-1])return;o===e.pages.length?(u=Math.ceil(e.pages[o-1].order),p=1):(u=e.pages[o-1].order,p=(e.pages[o].order-e.pages[o-1].order)/c)}const m=[],h=[];d.forEach(((t,o)=>{const n=u+p*(o+1);m.push({operation:r.C8.UpdatePage,id:t.id,page:{order:n},tome:{id:e.id}}),h.push({operation:r.C8.UpdatePage,id:t.id,page:{order:t.order},tome:{id:e.id}})}));const g={id:(0,a.Z)(),tomeId:e.id,clientId:i,apply:m,revert:h};l.Q.submitMutation(n,g)}function v(e,t,o,n,a){var l;const s=[];s.push({operation:r.C8.CreatePage,id:o,page:{autoThemeColor:t.autoThemeColor,order:n,overlay:t.overlay,layout:t.layout,themeId:a},tome:{id:e}});const d=JSON.parse(JSON.stringify(t.layout)),c={};return null===(l=t.tiles)||void 0===l||l.forEach((e=>{c[e.id]=i()()})),t.tiles.forEach((e=>{var t;const n={...e};delete n.__typename,delete n.id;const a=c[e.id];if(n.type===r.YUT.Composite&&(null===(t=n.compositeTileData)||void 0===t?void 0:t.tileIds)){const e=n.compositeTileData.tileIds.map((e=>c[e]))||[];n.compositeTileData={...n.compositeTileData,tileIds:e}}d.rows.map((t=>{t.tiles.map((t=>(t.tileId===e.id&&(t.tileId=a),t)));const o=i()();return t.rowId=o,t})),s.push({operation:r.C8.CreateTile,id:a,tile:n,page:{id:o}})})),s.push({operation:r.C8.UpdatePage,id:o,page:{layout:d}}),s}function b(e,t,o,n,d){let c=1,u=1;if(!e.pages)return[];if(e.pages.length>0&&(u=e.pages[e.pages.length-1].order),o<e.pages.length-1){u=e.pages[o].order;const n=e.pages[o+1].order;c=(n-u)/(t.length+1)}const p=[],m=[],g=[];t.forEach(((t,o)=>{const n=u+c*(o+1),a=i()();g.push(a);let l=t.theme.id;if(t.theme){const o=new s.Z(t.theme),n=new s.Z(e.theme),a=o.id===n.id;if(o.isAnonymous&&!a){var d,h;const t=i()();l=t,p.push({operation:r.C8.CreateTheme,id:t,theme:{orgId:null===(h=e)||void 0===h||null===(d=h.org)||void 0===d?void 0:d.id,colors:o.colors,headingTypeface:o.headingTypeface,paragraphTypeface:o.paragraphTypeface}}),m.push({operation:r.C8.DeleteTheme,id:t})}}p.push(...v(e.id,t,a,n,l)),m.push({operation:r.C8.DeletePage,id:a,tome:{id:e.id}})}));const C={id:(0,a.Z)(),tomeId:e.id,clientId:d,apply:p,revert:m},f=(0,h.mz)(C);return l.Q.submitMutation(n,f,C),g}function y(e,t,o,n){const i=Math.max(...t),a=e.pages.filter(((e,o)=>t.includes(o)));return b(e,a,i,o,n)}function w(e,t){const o=[];return e.forEach((e=>{const n=`Page:${e}`,i=t.cache.readFragment({id:n,fragment:r.bsn,fragmentName:"PageWithTilesFragment"});o.push(i)})),o}function T(e,t,o,n){var i,a;const r=w(t,o);return f(e,t,t.length===(null===(a=e)||void 0===a||null===(i=a.pages)||void 0===i?void 0:i.length),o,n),r}function I(e,t,o,n,i){return b(e,t,o,n,i)}},62081:function(e,t,o){o.d(t,{W:function(){return a},a:function(){return i}});var n=o(96215);const i=(e,t,o)=>{const{me:i}=e.readQuery({query:n.fkZ}),a=e.writeFragment({id:e.identify(t),fragment:n.LWh,fragmentName:"WorkspaceTomeFragment",data:t});e.modify({id:e.identify(i),fields:{recentTomes(e){return{...e,nodes:[a,...e.nodes]}},tomes(e){return{...e,nodes:[a,...e.nodes]}}}}),o(e)},a=(e,t)=>{const o=t.id,i=e.readQuery({query:n.fkZ}),{me:a}=i||{};e.modify({id:e.identify(t),fields:{deleted(){return!1}}}),a&&e.modify({id:e.identify(a),fields:{tomes(e){const t=[{__ref:`Tome:${o}`},...e.nodes];return{...e,nodes:t}},deletedTomes(e,t){let{readField:n}=t;const i=e.nodes.filter((e=>o!==n("id",e)));return{...e,nodes:i}}}})}},57789:function(e,t,o){o.r(t),o.d(t,{__N_SSG:function(){return h},default:function(){return g}});var n=o(85893),i=o(41664),a=o.n(i),r=o(11163),l=o(59016),s=o(1922),d=o(99261),c=o(89834),u=o(38452);const p=(0,l.ZP)(u.ZP).withConfig({displayName:"sc-404__Button404",componentId:"sc-9d0b170c-0"})`
  &:hover,
  :focus,
  :active {
    text-decoration: none;
  }
  min-width: 145px;
  padding: 12px;
`,m=l.ZP.div.withConfig({displayName:"sc-404__ButtonContainer",componentId:"sc-9d0b170c-1"})`
  display: flex;
  gap: 12px;
  margin: 24px 0;
`;var h=!0;function g(){const e=(0,r.useRouter)(),{t:t}=(0,s.$G)();return(0,n.jsx)(c.Z,{mainMessage:t("pages.mainErrorMessage404Page"),children:(0,n.jsxs)(m,{"data-testid":"404_page_button_container",children:[(0,n.jsx)(a(),{href:"/",passHref:!0,legacyBehavior:!0,children:(0,n.jsx)(p,{component:"a",size:"large",children:t("pages.homeButton404Page")})}),(0,n.jsx)(a(),{href:(0,d.bM)(e),passHref:!0,legacyBehavior:!0,children:(0,n.jsx)(p,{component:"a",size:"large",children:t("pages.loginButton404Page")})})]})})}},3667:function(e,t,o){const n=(0,o(4480).cn)({key:"forceTomeViewWithCacheState",default:!1});t.Z=n},42002:function(e,t,o){o.d(t,{B:function(){return a}});var n=o(28670),i=o.n(n);const a=e=>i().valid(e)&&1===i()(e).get("rgba.a")},30862:function(e,t,o){function n(e,t){return!(t.left>e.right||t.right<e.left||t.top>e.bottom||t.bottom<e.top)}o.d(t,{B:function(){return n}})},2939:function(e,t,o){o.d(t,{Bb:function(){return d},Gi:function(){return u},sc:function(){return p},tv:function(){return m},xh:function(){return l},yW:function(){return s}});var n=o(97173),i=o(86090),a=o(9228),r=o(60243);const l=(e,t)=>{if(!t)return null;for(let o=0;o<e.length;o++)if(e[o].id===t)return o;return null},s=(e,t)=>{const[o]=e.filter((e=>e.id===t));return o||e[0]},d=(e,t)=>{const[o]=e.filter(((e,o)=>o===t));return o?o.id:null},c=function(e,t,o,n,l,s,d){let c=!(arguments.length>7&&void 0!==arguments[7])||arguments[7],u=arguments.length>8&&void 0!==arguments[8]&&arguments[8];const p=o.length===e.pages.length,m=(0,r.tj)(e,o,p,n,l);let h,g;if(c&&(0,a.ak)({message:i.ZP.t("utils.pageActions.pageDeleted_with_count",{count:o.length}),action:"undo"}),p)g=0,h=m;else{const n=e.pages.map((e=>e.id)).filter((e=>!o.includes(e))),i=Math.min(...t);g=n.length-1>=i?u?i-1:i:n.length-1,h=n[g]}d(h),s([g])},u=(e,t,o,n,i,a,r,s)=>{const d=t.map((t=>l(e.pages,t)));c(e,d,t,o,n,i,a,r,s)},p=(e,t,o,n,i,a,r,l)=>{const s=t.map((t=>e.pages[t].id));c(e,t,s,o,n,i,a,r,l)},m=(e,t,o,i,a,l)=>{if(0===t.length)return;const s=(0,r.ek)(e,t,o,i),d=Math.max(...t)+1;a((0,n.Z)(d,d+t.length)),l(s[0]||"")}},74787:function(e,t,o){var n=o(22839);const i=3600,a=86400,r=604800,l=2419200,s=31449600;t.Z=function(e,t,o){const d=(new Date).valueOf(),c=new Date(e).valueOf(),u=Math.round((d-c)/1e3);if(u<60)return o?n.ZP.t("utils.getRelativeTimeLabel.momentsAgoCapitalized"):n.ZP.t("utils.getRelativeTimeLabel.momentsAgoLowercase");let p;if(u<i){const e=Math.floor(u/60);p=!1===t?n.ZP.t("utils.getRelativeTimeLabel.intlRelativeTimeInMin_with_count",{count:e}):n.ZP.t("utils.getRelativeTimeLabel.intlRelativeTimeInMinuteShortlabel",{relativeTimeValue:e})}else if(u<a){const e=Math.floor(u/i);p=t?n.ZP.t("utils.getRelativeTimeLabel.intlRelativeTimeInHoursShortlabel",{relativeTimeValue:e}):n.ZP.t("utils.getRelativeTimeLabel.intlRelativeTimeInHours",{relativeTimeValue:-e})}else if(u<r){const e=Math.floor(u/a);p=t?n.ZP.t("utils.getRelativeTimeLabel.intlRelativeTimeInDaysShortlabel",{relativeTimeValue:e}):n.ZP.t("utils.getRelativeTimeLabel.intlRelativeTimeInDays",{relativeTimeValue:-e})}else if(u<l||t&&u<s){const e=Math.floor(u/r);p=t?n.ZP.t("utils.getRelativeTimeLabel.intlRelativeTimeInWeeksShortlabel",{relativeTimeValue:e}):n.ZP.t("utils.getRelativeTimeLabel.intlRelativeTimeInWeeks",{relativeTimeValue:-e})}else if(u<s&&!t){const e=Math.floor(u/l);p=n.ZP.t("utils.getRelativeTimeLabel.intlRelativeTimeInMonths",{relativeTimeValue:-e})}else{const e=Math.floor(u/s);p=t?n.ZP.t("utils.getRelativeTimeLabel.intlRelativeTimeInYearsShortlabel",{relativeTimeValue:e}):n.ZP.t("utils.getRelativeTimeLabel.intlRelativeTimeInYears",{relativeTimeValue:-e})}return p}}}]);
